{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js??ref--15-3!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/pkg/nowcom/babel.config.js","mtime":1716430386791},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js","mtime":1716430465967},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js","mtime":1716430466133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgTkFNRVNQQUNFX0ZJTFRFUl9OU19GVUxMX1BSRUZJWCwgTkFNRVNQQUNFX0ZJTFRFUl9QX0ZVTExfUFJFRklYIH0gZnJvbSAnQHNoZWxsL3V0aWxzL25hbWVzcGFjZS1maWx0ZXInOwppbXBvcnQgeyBnZXRQZXJmb3JtYW5jZVNldHRpbmcgfSBmcm9tICdAc2hlbGwvdXRpbHMvc2V0dGluZ3MnOwpjbGFzcyBQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nIHsKICAvKioKICAgKiBEb2VzIHRoZSByZXF1ZXN0IGBvcHRgIGRlZmluaXRpb24gcmVxdWlyZSByZXNvdXJjZXMgYXJlIGZldGNoZWQgZnJvbSBhIHNwZWNpZmljIHNldCBuYW1lc3BhY2VzL3Byb2plY3RzPwogICAqLwogIGlzQXBwbGljYWJsZShvcHQpIHsKICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdC5uYW1lc3BhY2VkKTsKICB9CiAgaXNFbmFibGVkKHJvb3RHZXR0ZXJzKSB7CiAgICB2YXIgX3BlcmZDb25maWckZm9yY2VOc0ZpOwogICAgY29uc3QgY3VycmVudFByb2R1Y3QgPSByb290R2V0dGVyc1snY3VycmVudFByb2R1Y3QnXTsKICAgIC8vIE9ubHkgZW5hYmxlIGZvciB0aGUgY2x1c3RlciBzdG9yZSBhdCB0aGUgbW9tZW50LiBJbiB0aGVvcnkgdGhpcyBzaG91bGQgd29yayBpbiBtYW5hZ2VtZW50IGFzIHdlbGwsIGFzIHRoZXkncmUgYm90aCAnc3RldmUnIHN0b3JlcwogICAgaWYgKChjdXJyZW50UHJvZHVjdCA9PT0gbnVsbCB8fCBjdXJyZW50UHJvZHVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY3VycmVudFByb2R1Y3QuaW5TdG9yZSkgIT09ICdjbHVzdGVyJykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoY3VycmVudFByb2R1Y3QgIT09IG51bGwgJiYgY3VycmVudFByb2R1Y3QgIT09IHZvaWQgMCAmJiBjdXJyZW50UHJvZHVjdC5zaG93V29ya3NwYWNlU3dpdGNoZXIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcGVyZkNvbmZpZyA9IGdldFBlcmZvcm1hbmNlU2V0dGluZyhyb290R2V0dGVycyk7CiAgICBpZiAoISgoX3BlcmZDb25maWckZm9yY2VOc0ZpID0gcGVyZkNvbmZpZy5mb3JjZU5zRmlsdGVyVjIpICE9PSBudWxsICYmIF9wZXJmQ29uZmlnJGZvcmNlTnNGaSAhPT0gdm9pZCAwICYmIF9wZXJmQ29uZmlnJGZvcmNlTnNGaS5lbmFibGVkKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogQ2hlY2sgaWYgYG9wdGAgcmVxdWlyZXMgcmVzb3VyY2VzIGZyb20gc3BlY2lmaWMgbnMvcHJvamVjdHMsIGlmIHNvIHJldHVybiB0aGUgcmVxdWlyZWQgcXVlcnkgcGFyYW0gKHg9eSkKICAgKi8KICBjaGVja0FuZENyZWF0ZVBhcmFtKG9wdCkgewogICAgaWYgKCF0aGlzLmlzQXBwbGljYWJsZShvcHQpKSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICAgIHJldHVybiB0aGlzLmNyZWF0ZVBhcmFtKG9wdC5uYW1lc3BhY2VkKTsKICB9CiAgY3JlYXRlUGFyYW0obmFtZXNwYWNlRmlsdGVyKSB7CiAgICBpZiAoIW5hbWVzcGFjZUZpbHRlciB8fCAhbmFtZXNwYWNlRmlsdGVyLmxlbmd0aCkgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgICBjb25zdCBwcm9qZWN0c09yTmFtZXNwYWNlcyA9IG5hbWVzcGFjZUZpbHRlci5tYXAoZiA9PiBmLnJlcGxhY2UoTkFNRVNQQUNFX0ZJTFRFUl9OU19GVUxMX1BSRUZJWCwgJycpLnJlcGxhY2UoTkFNRVNQQUNFX0ZJTFRFUl9QX0ZVTExfUFJFRklYLCAnJykpLmpvaW4oJywnKTsKICAgIHJldHVybiBgJHtQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nLnBhcmFtfT0ke3Byb2plY3RzT3JOYW1lc3BhY2VzfWA7CiAgfQp9ClByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcucGFyYW0gPSAncHJvamVjdHNvcm5hbWVzcGFjZXMnOwpleHBvcnQgZGVmYXVsdCBuZXcgUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZygpOw=="},{"version":3,"names":["NAMESPACE_FILTER_NS_FULL_PREFIX","NAMESPACE_FILTER_P_FULL_PREFIX","getPerformanceSetting","ProjectAndNamespaceFiltering","isApplicable","opt","Array","isArray","namespaced","isEnabled","rootGetters","_perfConfig$forceNsFi","currentProduct","inStore","showWorkspaceSwitcher","perfConfig","forceNsFilterV2","enabled","checkAndCreateParam","createParam","namespaceFilter","length","projectsOrNamespaces","map","f","replace","join","param"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts"],"sourcesContent":["import { NAMESPACE_FILTER_NS_FULL_PREFIX, NAMESPACE_FILTER_P_FULL_PREFIX } from '@shell/utils/namespace-filter';\nimport { getPerformanceSetting } from '@shell/utils/settings';\n\ntype Opt = { [key: string]: any, namespaced?: string[]}\n\nclass ProjectAndNamespaceFiltering {\n  static param = 'projectsornamespaces'\n\n  /**\n   * Does the request `opt` definition require resources are fetched from a specific set namespaces/projects?\n   */\n  isApplicable(opt: Opt): boolean {\n    return Array.isArray(opt.namespaced);\n  }\n\n  isEnabled(rootGetters: any): boolean {\n    const currentProduct = rootGetters['currentProduct'];\n\n    // Only enable for the cluster store at the moment. In theory this should work in management as well, as they're both 'steve' stores\n    if (currentProduct?.inStore !== 'cluster') {\n      return false;\n    }\n\n    if (currentProduct?.showWorkspaceSwitcher) {\n      return false;\n    }\n\n    const perfConfig = getPerformanceSetting(rootGetters);\n\n    if (!perfConfig.forceNsFilterV2?.enabled) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if `opt` requires resources from specific ns/projects, if so return the required query param (x=y)\n   */\n  checkAndCreateParam(opt: Opt): string {\n    if (!this.isApplicable(opt)) {\n      return '';\n    }\n\n    return this.createParam(opt.namespaced);\n  }\n\n  private createParam(namespaceFilter: string[] | undefined): string {\n    if (!namespaceFilter || !namespaceFilter.length) {\n      return '';\n    }\n\n    const projectsOrNamespaces = namespaceFilter\n      .map((f) => f.replace(NAMESPACE_FILTER_NS_FULL_PREFIX, '')\n        .replace(NAMESPACE_FILTER_P_FULL_PREFIX, ''))\n      .join(',');\n\n    return `${ ProjectAndNamespaceFiltering.param }=${ projectsOrNamespaces }`;\n  }\n}\n\nexport default new ProjectAndNamespaceFiltering();\n"],"mappings":"AAAA,SAASA,+BAA+B,EAAEC,8BAA8B,QAAQ,+BAA+B;AAC/G,SAASC,qBAAqB,QAAQ,uBAAuB;AAI7D,MAAMC,4BAA4B;EAGhC;;;EAGAC,YAAYA,CAACC,GAAQ;IACnB,OAAOC,KAAK,CAACC,OAAO,CAACF,GAAG,CAACG,UAAU,CAAC;EACtC;EAEAC,SAASA,CAACC,WAAgB;IAAA,IAAAC,qBAAA;IACxB,MAAMC,cAAc,GAAGF,WAAW,CAAC,gBAAgB,CAAC;IAEpD;IACA,IAAI,CAAAE,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEC,OAAO,MAAK,SAAS,EAAE;MACzC,OAAO,KAAK;;IAGd,IAAID,cAAc,aAAdA,cAAc,eAAdA,cAAc,CAAEE,qBAAqB,EAAE;MACzC,OAAO,KAAK;;IAGd,MAAMC,UAAU,GAAGb,qBAAqB,CAACQ,WAAW,CAAC;IAErD,IAAI,GAAAC,qBAAA,GAACI,UAAU,CAACC,eAAe,cAAAL,qBAAA,eAA1BA,qBAAA,CAA4BM,OAAO,GAAE;MACxC,OAAO,KAAK;;IAGd,OAAO,IAAI;EACb;EAEA;;;EAGAC,mBAAmBA,CAACb,GAAQ;IAC1B,IAAI,CAAC,IAAI,CAACD,YAAY,CAACC,GAAG,CAAC,EAAE;MAC3B,OAAO,EAAE;;IAGX,OAAO,IAAI,CAACc,WAAW,CAACd,GAAG,CAACG,UAAU,CAAC;EACzC;EAEQW,WAAWA,CAACC,eAAqC;IACvD,IAAI,CAACA,eAAe,IAAI,CAACA,eAAe,CAACC,MAAM,EAAE;MAC/C,OAAO,EAAE;;IAGX,MAAMC,oBAAoB,GAAGF,eAAe,CACzCG,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACC,OAAO,CAACzB,+BAA+B,EAAE,EAAE,CAAC,CACvDyB,OAAO,CAACxB,8BAA8B,EAAE,EAAE,CAAC,CAAC,CAC9CyB,IAAI,CAAC,GAAG,CAAC;IAEZ,OAAO,GAAIvB,4BAA4B,CAACwB,KAAM,IAAKL,oBAAqB,EAAE;EAC5E;;AApDOnB,4BAAA,CAAAwB,KAAK,GAAG,sBAAsB;AAuDvC,eAAe,IAAIxB,4BAA4B,EAAE"}]}
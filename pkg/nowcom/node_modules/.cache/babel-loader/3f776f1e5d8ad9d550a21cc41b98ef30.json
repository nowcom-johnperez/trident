{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/monitoring.js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/monitoring.js","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/pkg/nowcom/babel.config.js","mtime":1716430386791},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js","mtime":1716430465967},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gSGVscGVycyBmb3IgZGV0ZXJtaW5pbmcgaWYgVjIgb3IgdjEgTW9uaXRvcmluZyBhcmUgaW5zdGFsbGVkCgppbXBvcnQgeyBTQ0hFTUEsIE1PTklUT1JJTkcsIFdPUktMT0FEX1RZUEVTIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IG5vcm1hbGl6ZVR5cGUgfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9kYXNoYm9hcmQtc3RvcmUvbm9ybWFsaXplJzsKaW1wb3J0IHsgZmluZEJ5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FycmF5JzsKaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwoKLy8gQ2FuIGJlIHVzZWQgaW5zaWRlIGEgY29tcG9uZW50cycgY29tcHV0ZWQgcHJvcGVydHkKZXhwb3J0IGZ1bmN0aW9uIG1vbml0b3JpbmdTdGF0dXMoKSB7CiAgcmV0dXJuIHsKICAgIG1vbml0b3JpbmdTdGF0dXMoKSB7CiAgICAgIGNvbnN0IHN0YXR1cyA9IHsKICAgICAgICB2MTogaGF2ZVYxTW9uaXRvcmluZyh0aGlzLiRzdG9yZS5nZXR0ZXJzKSwKICAgICAgICB2MjogaGF2ZVYyTW9uaXRvcmluZyh0aGlzLiRzdG9yZS5nZXR0ZXJzKQogICAgICB9OwogICAgICBzdGF0dXMuaW5zdGFsbGVkID0gc3RhdHVzLnYxIHx8IHN0YXR1cy52MjsKICAgICAgcmV0dXJuIHN0YXR1czsKICAgIH0KICB9Owp9CmV4cG9ydCBmdW5jdGlvbiBoYXZlVjJNb25pdG9yaW5nKGdldHRlcnMpIHsKICAvLyBDYW4ndCBoYXZlIFYyIGFuZCBWMSBtb25pdG9yaW5nIGluc3RhbGxlZCwgc28gaWYgVjEgaXMgaW5zdGFsbGVkIHdlIGtub3cgdjIgaXMgbm90CiAgaWYgKGhhdmVWMU1vbml0b3JpbmcoZ2V0dGVycykpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3QgaW5TdG9yZSA9IGdldHRlcnNbJ2dldFN0b3JlTmFtZUJ5UHJvZHVjdElkJ107CgogIC8vIEp1c3QgY2hlY2sgZm9yIHRoZSBwb2QgbW9uaXRvcnMgQ1JECiAgY29uc3Qgc2NoZW1hcyA9IGdldHRlcnNbYCR7aW5TdG9yZX0vYWxsYF0oU0NIRU1BKTsKICBjb25zdCBleGlzdHMgPSBmaW5kQnkoc2NoZW1hcywgJ2lkJywgbm9ybWFsaXplVHlwZShNT05JVE9SSU5HLlBPRE1PTklUT1IpKTsKICByZXR1cm4gISFleGlzdHM7Cn0KCi8vIEZvciB2MSBNb25pdG9yaW5nLCB0aGUgY2x1c3RlciBvYmplY3QgaW5kaWNhdGVzIHByZXNlbmNlIHZpYSBzdGF0dXMubW9uaXRvcmluZ1N0YXR1cwpleHBvcnQgZnVuY3Rpb24gaGF2ZVYxTW9uaXRvcmluZyhnZXR0ZXJzKSB7CiAgdmFyIF9jbHVzdGVyJHN0YXR1czsKICBjb25zdCBjbHVzdGVyID0gZ2V0dGVyc1snY3VycmVudENsdXN0ZXInXTsKICByZXR1cm4gISEoY2x1c3RlciAhPT0gbnVsbCAmJiBjbHVzdGVyICE9PSB2b2lkIDAgJiYgKF9jbHVzdGVyJHN0YXR1cyA9IGNsdXN0ZXIuc3RhdHVzKSAhPT0gbnVsbCAmJiBfY2x1c3RlciRzdGF0dXMgIT09IHZvaWQgMCAmJiBfY2x1c3RlciRzdGF0dXMubW9uaXRvcmluZ1N0YXR1cyk7Cn0KY29uc3QgQ0FUVExFX01PTklUT1JJTkdfTkFNRVNQQUNFID0gJ2NhdHRsZS1tb25pdG9yaW5nLXN5c3RlbSc7CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYXZlVjFNb25pdG9yaW5nV29ya2xvYWRzKHN0b3JlKSB7CiAgY29uc3Qgd29ya2xvYWRzQnlUeXBlID0gYXdhaXQgUHJvbWlzZS5hbGwoT2JqZWN0LnZhbHVlcyhXT1JLTE9BRF9UWVBFUykubWFwKHR5cGUgPT4gc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsKICAgIHR5cGUKICB9KSkpOwogIGNvbnN0IHdvcmtsb2FkcyA9IHdvcmtsb2Fkc0J5VHlwZS5mbGF0KCk7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JrbG9hZHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBfd29ya2xvYWQkc3BlYywgX3dvcmtsb2FkJG1ldGFkYXRhOwogICAgY29uc3Qgd29ya2xvYWQgPSB3b3JrbG9hZHNbaV07CiAgICBpZiAoIWlzRW1wdHkod29ya2xvYWQgPT09IG51bGwgfHwgd29ya2xvYWQgPT09IHZvaWQgMCB8fCAoX3dvcmtsb2FkJHNwZWMgPSB3b3JrbG9hZC5zcGVjKSA9PT0gbnVsbCB8fCBfd29ya2xvYWQkc3BlYyA9PT0gdm9pZCAwIHx8IChfd29ya2xvYWQkc3BlYyA9IF93b3JrbG9hZCRzcGVjLnRlbXBsYXRlKSA9PT0gbnVsbCB8fCBfd29ya2xvYWQkc3BlYyA9PT0gdm9pZCAwIHx8IChfd29ya2xvYWQkc3BlYyA9IF93b3JrbG9hZCRzcGVjLnNwZWMpID09PSBudWxsIHx8IF93b3JrbG9hZCRzcGVjID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfd29ya2xvYWQkc3BlYy5jb250YWluZXJzKSAmJiB3b3JrbG9hZC5zcGVjLnRlbXBsYXRlLnNwZWMuY29udGFpbmVycy5maW5kKGMgPT4gewogICAgICB2YXIgX2MkaW1hZ2UsIF9jJGltYWdlMjsKICAgICAgcmV0dXJuICgoX2MkaW1hZ2UgPSBjLmltYWdlKSA9PT0gbnVsbCB8fCBfYyRpbWFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MkaW1hZ2UuaW5jbHVkZXMoJ3F1YXkuaW8vY29yZW9zL3Byb21ldGhldXMtb3BlcmF0b3InKSkgfHwgKChfYyRpbWFnZTIgPSBjLmltYWdlKSA9PT0gbnVsbCB8fCBfYyRpbWFnZTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jJGltYWdlMi5pbmNsdWRlcygncmFuY2hlci9jb3Jlb3MtcHJvbWV0aGV1cy1vcGVyYXRvcicpKTsKICAgIH0pICYmICh3b3JrbG9hZCA9PT0gbnVsbCB8fCB3b3JrbG9hZCA9PT0gdm9pZCAwIHx8IChfd29ya2xvYWQkbWV0YWRhdGEgPSB3b3JrbG9hZC5tZXRhZGF0YSkgPT09IG51bGwgfHwgX3dvcmtsb2FkJG1ldGFkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfd29ya2xvYWQkbWV0YWRhdGEubmFtZXNwYWNlKSAhPT0gQ0FUVExFX01PTklUT1JJTkdfTkFNRVNQQUNFKSB7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTsKICB9Cn0KCi8vIE90aGVyIHdheXMgd2UgY2hlY2sgZm9yIG1vbml0b3Jpbmc6CgovLyAoMSkgVXNpbmcgY291bnRzIChyZXF1aXJlcyBSQkFDIHBlcm1pc3Npb25zKQovLyByZXR1cm4gISF0aGlzLmNsdXN0ZXJDb3VudHM/LlswXT8uY291bnRzPy5bQ0FUQUxPRy5BUFBdPy5uYW1lc3BhY2VzPy5bJ2NhdHRsZS1tb25pdG9yaW5nLXN5c3RlbSddOwoKLy8gKDIpIFJldHJpZXZpbmcgYWxsIHdvcmtsb2FkcyBhbmQgbG9va2luZyBmb3IgY29udGFpbmVycyB3aXRoIGEgZ2l2ZW4gaW1hZ2UKLy8gU2VlIGNoYXJ0L21vbml0b3JpbmcvaW5kZXgudnVl"},{"version":3,"names":["SCHEMA","MONITORING","WORKLOAD_TYPES","normalizeType","findBy","isEmpty","monitoringStatus","status","v1","haveV1Monitoring","$store","getters","v2","haveV2Monitoring","installed","inStore","schemas","exists","PODMONITOR","_cluster$status","cluster","CATTLE_MONITORING_NAMESPACE","haveV1MonitoringWorkloads","store","workloadsByType","Promise","all","Object","values","map","type","dispatch","workloads","flat","i","length","_workload$spec","_workload$metadata","workload","spec","template","containers","find","c","_c$image","_c$image2","image","includes","metadata","namespace","resolve"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/monitoring.js"],"sourcesContent":["// Helpers for determining if V2 or v1 Monitoring are installed\n\nimport { SCHEMA, MONITORING, WORKLOAD_TYPES } from '@shell/config/types';\nimport { normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport { findBy } from '@shell/utils/array';\nimport { isEmpty } from '@shell/utils/object';\n\n// Can be used inside a components' computed property\nexport function monitoringStatus() {\n  return {\n    monitoringStatus() {\n      const status = {\n        v1: haveV1Monitoring(this.$store.getters),\n        v2: haveV2Monitoring(this.$store.getters),\n      };\n\n      status.installed = status.v1 || status.v2;\n\n      return status;\n    }\n  };\n}\n\nexport function haveV2Monitoring(getters) {\n  // Can't have V2 and V1 monitoring installed, so if V1 is installed we know v2 is not\n  if (haveV1Monitoring(getters)) {\n    return false;\n  }\n  const inStore = getters['getStoreNameByProductId'];\n\n  // Just check for the pod monitors CRD\n  const schemas = getters[`${ inStore }/all`](SCHEMA);\n  const exists = findBy(schemas, 'id', normalizeType(MONITORING.PODMONITOR));\n\n  return !!exists;\n}\n\n// For v1 Monitoring, the cluster object indicates presence via status.monitoringStatus\nexport function haveV1Monitoring(getters) {\n  const cluster = getters['currentCluster'];\n\n  return !!cluster?.status?.monitoringStatus;\n}\n\nconst CATTLE_MONITORING_NAMESPACE = 'cattle-monitoring-system';\n\nexport async function haveV1MonitoringWorkloads(store) {\n  const workloadsByType = await Promise.all(\n    Object.values(WORKLOAD_TYPES).map((type) => store.dispatch('cluster/findAll', { type })\n    )\n  );\n  const workloads = workloadsByType.flat();\n\n  for (let i = 0; i < workloads.length; i++) {\n    const workload = workloads[i];\n\n    if (!isEmpty(workload?.spec?.template?.spec?.containers) &&\n        workload.spec.template.spec.containers.find((c) => c.image?.includes('quay.io/coreos/prometheus-operator') ||\n          c.image?.includes('rancher/coreos-prometheus-operator')) &&\n        workload?.metadata?.namespace !== CATTLE_MONITORING_NAMESPACE) {\n      return Promise.resolve(true);\n    }\n\n    return Promise.resolve(false);\n  }\n}\n\n// Other ways we check for monitoring:\n\n// (1) Using counts (requires RBAC permissions)\n// return !!this.clusterCounts?.[0]?.counts?.[CATALOG.APP]?.namespaces?.['cattle-monitoring-system'];\n\n// (2) Retrieving all workloads and looking for containers with a given image\n// See chart/monitoring/index.vue\n"],"mappings":"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"}]}
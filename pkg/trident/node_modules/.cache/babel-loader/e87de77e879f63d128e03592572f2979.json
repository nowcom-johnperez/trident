{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/auth.js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/auth.js","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/pkg/trident/babel.config.js","mtime":1716430386784},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/thread-loader/dist/cjs.js","mtime":1716430465967},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgUG9wdXAsIHBvcHVwV2luZG93T3B0aW9ucyB9IGZyb20gJ0BzaGVsbC91dGlscy93aW5kb3cnOwppbXBvcnQgeyBwYXJzZSBhcyBwYXJzZVVybCwgYWRkUGFyYW0gfSBmcm9tICdAc2hlbGwvdXRpbHMvdXJsJzsKaW1wb3J0IHsgQkFDS19UTywgU1BBLCBfRURJVCwgX0ZMQUdHRUQgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IE1BTkFHRU1FTlQgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKZXhwb3J0IGZ1bmN0aW9uIG9wZW5BdXRoUG9wdXAodXJsLCBwcm92aWRlcikgewogIGNvbnN0IHBvcHVwID0gbmV3IFBvcHVwKCgpID0+IHsKICAgIHBvcHVwLnByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHBvcHVwLnJlc29sdmUgPSByZXNvbHZlOwogICAgICBwb3B1cC5yZWplY3QgPSByZWplY3Q7CiAgICB9KTsKICAgIHdpbmRvdy5vbkF1dGhUZXN0ID0gKGVycm9yLCBjb2RlKSA9PiB7CiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHBvcHVwLnJlamVjdChlcnJvcik7CiAgICAgIH0KICAgICAgZGVsZXRlIHdpbmRvdy5vbkF1dGhUZXN0OwogICAgICBwb3B1cC5yZXNvbHZlKGNvZGUpOwogICAgfTsKICB9LCAoKSA9PiB7CiAgICBwb3B1cC5yZWplY3QobmV3IEVycm9yKCdBY2Nlc3Mgd2FzIG5vdCBhdXRob3JpemVkJykpOwogIH0pOwogIHBvcHVwLm9wZW4odXJsLCAnYXV0aC10ZXN0JywgcG9wdXBXaW5kb3dPcHRpb25zKCkpOwogIHJldHVybiBwb3B1cC5wcm9taXNlOwp9CmV4cG9ydCBmdW5jdGlvbiByZXR1cm5UbyhvcHQsIHZtKSB7CiAgbGV0IHsKICAgIHJvdXRlID0gYC9hdXRoL3ZlcmlmeWAKICB9ID0gb3B0OwogIGlmICh2bS4kcm91dGVyLm9wdGlvbnMgJiYgdm0uJHJvdXRlci5vcHRpb25zLmJhc2UpIHsKICAgIGNvbnN0IHJvdXRlckJhc2UgPSB2bS4kcm91dGVyLm9wdGlvbnMuYmFzZTsKICAgIGlmIChyb3V0ZXJCYXNlICE9PSAnLycpIHsKICAgICAgcm91dGUgPSBgJHtyb3V0ZXJCYXNlLnJlcGxhY2UoL1wvKyQvLCAnJyl9LyR7cm91dGUucmVwbGFjZSgvXlwvKy8sICcnKX1gOwogICAgfQogIH0KICBsZXQgcmV0dXJuVG9VcmwgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufSR7cm91dGV9YDsKICBjb25zdCBwYXJzZWQgPSBwYXJzZVVybCh3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgaWYgKHBhcnNlZC5xdWVyeS5zcGEgIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuVG9VcmwgPSBhZGRQYXJhbShyZXR1cm5Ub1VybCwgU1BBLCBfRkxBR0dFRCk7CiAgfQogIGlmIChvcHQuYmFja1RvKSB7CiAgICByZXR1cm5Ub1VybCA9IGFkZFBhcmFtKHJldHVyblRvVXJsLCBCQUNLX1RPLCBvcHQuYmFja1RvKTsKICB9CiAgaWYgKG9wdC5jb25maWcpIHsKICAgIHJldHVyblRvVXJsID0gYWRkUGFyYW0ocmV0dXJuVG9VcmwsICdjb25maWcnLCBvcHQuY29uZmlnKTsKICB9CiAgcmV0dXJuIHJldHVyblRvVXJsOwp9CgovKioNCiAqIERldGVybWluZXMgY29tbW9uIGF1dGggcHJvdmlkZXIgaW5mbyBhcyB0aG9zZSB0aGF0IGFyZSBhdmFpbGFibGUgKG5vbi1sb2NhbCkgYW5kIHRoZSBsb2NhdGlvbiBvZiB0aGUgZW5hYmxlZCBwcm92aWRlcg0KICovCmV4cG9ydCBjb25zdCBhdXRoUHJvdmlkZXJzSW5mbyA9IGFzeW5jIHN0b3JlID0+IHsKICBjb25zdCByb3dzID0gYXdhaXQgc3RvcmUuZGlzcGF0Y2goYG1hbmFnZW1lbnQvZmluZEFsbGAsIHsKICAgIHR5cGU6IE1BTkFHRU1FTlQuQVVUSF9DT05GSUcKICB9KTsKICBjb25zdCBub25Mb2NhbCA9IHJvd3MuZmlsdGVyKHggPT4geC5uYW1lICE9PSAnbG9jYWwnKTsKICAvLyBHZW5lcmljIE9JREMgaXMgcmV0dXJuZWQgdmlhIEFQSSBidXQgbm90IHN1cHBvcnRlZCAoYW5kIHdpbGwgYmUgcmVtb3ZlZCBvciBmaXhlZCBpbiBmdXR1cmUpCiAgY29uc3Qgc3VwcG9ydGVkTm9uTG9jYWwgPSBub25Mb2NhbC5maWx0ZXIoeCA9PiB4LmlkICE9PSAnb2lkYycpOwogIGNvbnN0IGVuYWJsZWQgPSBub25Mb2NhbC5maWx0ZXIoeCA9PiB4LmVuYWJsZWQgPT09IHRydWUpOwogIGNvbnN0IGVuYWJsZWRMb2NhdGlvbiA9IGVuYWJsZWQubGVuZ3RoID09PSAxID8gewogICAgbmFtZTogJ2MtY2x1c3Rlci1hdXRoLWNvbmZpZy1pZCcsCiAgICBwYXJhbXM6IHsKICAgICAgaWQ6IGVuYWJsZWRbMF0uaWQKICAgIH0sCiAgICBxdWVyeTogewogICAgICBtb2RlOiBfRURJVAogICAgfQogIH0gOiBudWxsOwogIHJldHVybiB7CiAgICBub25Mb2NhbDogc3VwcG9ydGVkTm9uTG9jYWwsCiAgICBlbmFibGVkTG9jYXRpb24sCiAgICBlbmFibGVkCiAgfTsKfTsKZXhwb3J0IGNvbnN0IGNoZWNrU2NoZW1hc0ZvckZpbmRBbGxIYXNoID0gKHR5cGVzLCBzdG9yZSkgPT4gewogIGNvbnN0IGhhc2ggPSB7fTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0eXBlcykpIHsKICAgIGNvbnN0IHNjaGVtYSA9IHN0b3JlLmdldHRlcnNbYCR7dmFsdWUuaW5TdG9yZVR5cGV9L3NjaGVtYUZvcmBdKHZhbHVlLnR5cGUpOwoKICAgIC8vIEl0IGNvdWxkIGJlIHRoYXQgdXNlciBoYXMgcGVybWlzc2lvbnMgZm9yIEdFVCBidXQgbm90IGxpc3QKICAgIC8vIGUuZy4gU3RhbmRhcmQgdXNlciB3aXRoIEdpdFJlcG8gcGVybWlzc2lvbnMgdHJ5IHRvIGZldGNoIGxpc3Qgb2YgZmxlZXR3b3Jrc3BhY2VzCiAgICAvLyB1c2VyIGhhcyBhYmlsaXR5IHRvIEdFVCBidXQgbm90IGZsZWV0IHdvcmtzcGFjZXMKICAgIC8vIHNvIG9wdGlvbmFsbHkgZGVmaW5lIGEgZnVuY3Rpb24gdGhhdCByZXF1aXJlIGl0IHRvIHBhc3MgYmVmb3JlIC9maW5kQWxsCiAgICBjb25zdCB2YWxpZFNjaGVtYSA9IHZhbHVlLnNjaGVtYVZhbGlkYXRvciA/IHZhbHVlLnNjaGVtYVZhbGlkYXRvcihzY2hlbWEpIDogISFzY2hlbWE7CiAgICBpZiAodmFsaWRTY2hlbWEpIHsKICAgICAgaGFzaFtrZXldID0gc3RvcmUuZGlzcGF0Y2goYCR7dmFsdWUuaW5TdG9yZVR5cGV9L2ZpbmRBbGxgLCB7CiAgICAgICAgdHlwZTogdmFsdWUudHlwZQogICAgICB9KTsKICAgIH0KICB9CiAgcmV0dXJuIGFsbEhhc2goaGFzaCk7Cn07CmV4cG9ydCBjb25zdCBjaGVja1Blcm1pc3Npb25zID0gKHR5cGVzLCBnZXR0ZXJzKSA9PiB7CiAgY29uc3QgaGFzaCA9IHt9OwogIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHR5cGVzKSkgewogICAgY29uc3Qgc2NoZW1hID0gZ2V0dGVyc1snbWFuYWdlbWVudC9zY2hlbWFGb3InXSh2YWx1ZS50eXBlKTsKICAgIGlmICghc2NoZW1hKSB7CiAgICAgIGhhc2hba2V5XSA9IGZhbHNlOwogICAgICBjb250aW51ZTsKICAgIH0KCiAgICAvLyBJdCBjb3VsZCBiZSB0aGF0IHVzZXIgaGFzIHBlcm1pc3Npb25zIGZvciBHRVQgYnV0IG5vdCBsaXN0CiAgICAvLyBlLmcuIFN0YW5kYXJkIHVzZXIgd2l0aCBHaXRSZXBvIHBlcm1pc3Npb25zIHRyeSB0byBmZXRjaCBsaXN0IG9mIGZsZWV0d29ya3NwYWNlcwogICAgLy8gdXNlciBoYXMgYWJpbGl0eSB0byBHRVQgYnV0IG5vdCBmbGVldCB3b3Jrc3BhY2VzCiAgICAvLyBzbyBvcHRpb25hbGx5IGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgcmVxdWlyZSBpdCB0byBwYXNzIGJlZm9yZSAvZmluZEFsbAogICAgaWYgKHZhbHVlLnNjaGVtYVZhbGlkYXRvcikgewogICAgICBoYXNoW2tleV0gPSB2YWx1ZS5zY2hlbWFWYWxpZGF0b3Ioc2NoZW1hKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAodmFsdWUucmVzb3VyY2VNZXRob2RzICYmIHNjaGVtYSkgewogICAgICBoYXNoW2tleV0gPSB2YWx1ZS5yZXNvdXJjZU1ldGhvZHMuZXZlcnkobWV0aG9kID0+IHsKICAgICAgICByZXR1cm4gKHNjaGVtYS5yZXNvdXJjZU1ldGhvZHMgfHwgW10pLmluY2x1ZGVzKG1ldGhvZCk7CiAgICAgIH0pOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmICh2YWx1ZS5jb2xsZWN0aW9uTWV0aG9kcyAmJiBzY2hlbWEpIHsKICAgICAgaGFzaFtrZXldID0gdmFsdWUuY29sbGVjdGlvbk1ldGhvZHMuZXZlcnkobWV0aG9kID0+IHsKICAgICAgICByZXR1cm4gKHNjaGVtYS5jb2xsZWN0aW9uTWV0aG9kcyB8fCBbXSkuaW5jbHVkZXMobWV0aG9kKTsKICAgICAgfSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaGFzaFtrZXldID0gISFzY2hlbWE7CiAgfQogIHJldHVybiBhbGxIYXNoKGhhc2gpOwp9OwpleHBvcnQgY29uc3QgY2FuVmlld1Jlc291cmNlID0gKHN0b3JlLCByZXNvdXJjZSkgPT4gewogIC8vIE5vdGUgLSBkb24ndCB1c2UgdGhlIGN1cnJlbnQgcHJvZHVjdHMgc3RvcmUuLi4gYmVjYXVzZSBwcm9kdWN0cyBjYW4gb3ZlcnJpZGUgc3RvcmVzIGZvciByZXNvdXJjZXMgd2l0aCBgdHlwZVN0b3JlTWFwYAogIGNvbnN0IGluU3RvcmUgPSBzdG9yZS5nZXR0ZXJzWydjdXJyZW50U3RvcmUnXShyZXNvdXJjZSk7CiAgLy8gVGhlcmUncyBhIGNoYW5jZSB3ZSdyZSBpbiBhbiBleHRlbnNpb24ncyBwcm9kdWN0IHdobydzIHN0b3JlIGNvdWxkIGJlIGFueXRoaW5nLCBzbyBjb25maXJtIHNjaGVtYUZvciBleGlzdHMKICBjb25zdCBzY2hlbWFGb3IgPSBzdG9yZS5nZXR0ZXJzW2Ake2luU3RvcmV9L3NjaGVtYUZvcmBdOwoKICAvLyBJbiBvcmRlciB0byBjaGVjayBhIHJlc291cmNlIGlzIHZhbGlkIHdlIG5lZWQgdGhlc2UKICBpZiAoIWluU3RvcmUgfHwgIXNjaGVtYUZvcikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gUmVzb3VyY2UgaXMgdmFsaWQgaWYgYSBzY2hlbWEgZXhpc3RzIGZvciBpdCAoc3RhbmRhcmQgcmVzb3VyY2UsIHNwb29mZWQgcmVzb3VyY2UpIG9yIGl0J3MgYSB2aXJ0dWFsIHJlc291cmNlCiAgY29uc3QgdmFsaWRSZXNvdXJjZSA9IHNjaGVtYUZvcihyZXNvdXJjZSkgfHwgc3RvcmUuZ2V0dGVyc1sndHlwZS1tYXAvaXNWaXJ0dWFsJ10ocmVzb3VyY2UpOwogIHJldHVybiAhIXZhbGlkUmVzb3VyY2U7Cn07"},{"version":3,"names":["Popup","popupWindowOptions","parse","parseUrl","addParam","BACK_TO","SPA","_EDIT","_FLAGGED","MANAGEMENT","allHash","openAuthPopup","url","provider","popup","promise","Promise","resolve","reject","window","onAuthTest","error","code","Error","open","returnTo","opt","vm","route","$router","options","base","routerBase","replace","returnToUrl","location","origin","parsed","href","query","spa","undefined","backTo","config","authProvidersInfo","store","rows","dispatch","type","AUTH_CONFIG","nonLocal","filter","x","name","supportedNonLocal","id","enabled","enabledLocation","length","params","mode","checkSchemasForFindAllHash","types","hash","key","value","Object","entries","schema","getters","inStoreType","validSchema","schemaValidator","checkPermissions","resourceMethods","every","method","includes","collectionMethods","canViewResource","resource","inStore","schemaFor","validResource"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/auth.js"],"sourcesContent":["import { Popup, popupWindowOptions } from '@shell/utils/window';\r\nimport { parse as parseUrl, addParam } from '@shell/utils/url';\r\nimport { BACK_TO, SPA, _EDIT, _FLAGGED } from '@shell/config/query-params';\r\nimport { MANAGEMENT } from '@shell/config/types';\r\nimport { allHash } from '@shell/utils/promise';\r\n\r\nexport function openAuthPopup(url, provider) {\r\n  const popup = new Popup(() => {\r\n    popup.promise = new Promise((resolve, reject) => {\r\n      popup.resolve = resolve;\r\n      popup.reject = reject;\r\n    });\r\n\r\n    window.onAuthTest = (error, code) => {\r\n      if (error) {\r\n        popup.reject(error);\r\n      }\r\n\r\n      delete window.onAuthTest;\r\n      popup.resolve(code);\r\n    };\r\n  }, () => {\r\n    popup.reject(new Error('Access was not authorized'));\r\n  });\r\n\r\n  popup.open(url, 'auth-test', popupWindowOptions());\r\n\r\n  return popup.promise;\r\n}\r\n\r\nexport function returnTo(opt, vm) {\r\n  let { route = `/auth/verify` } = opt;\r\n\r\n  if ( vm.$router.options && vm.$router.options.base ) {\r\n    const routerBase = vm.$router.options.base;\r\n\r\n    if ( routerBase !== '/' ) {\r\n      route = `${ routerBase.replace(/\\/+$/, '') }/${ route.replace(/^\\/+/, '') }`;\r\n    }\r\n  }\r\n\r\n  let returnToUrl = `${ window.location.origin }${ route }`;\r\n\r\n  const parsed = parseUrl(window.location.href);\r\n\r\n  if ( parsed.query.spa !== undefined ) {\r\n    returnToUrl = addParam(returnToUrl, SPA, _FLAGGED);\r\n  }\r\n\r\n  if ( opt.backTo ) {\r\n    returnToUrl = addParam(returnToUrl, BACK_TO, opt.backTo);\r\n  }\r\n\r\n  if (opt.config) {\r\n    returnToUrl = addParam(returnToUrl, 'config', opt.config);\r\n  }\r\n\r\n  return returnToUrl;\r\n}\r\n\r\n/**\r\n * Determines common auth provider info as those that are available (non-local) and the location of the enabled provider\r\n */\r\nexport const authProvidersInfo = async(store) => {\r\n  const rows = await store.dispatch(`management/findAll`, { type: MANAGEMENT.AUTH_CONFIG });\r\n  const nonLocal = rows.filter((x) => x.name !== 'local');\r\n  // Generic OIDC is returned via API but not supported (and will be removed or fixed in future)\r\n  const supportedNonLocal = nonLocal.filter((x) => x.id !== 'oidc');\r\n  const enabled = nonLocal.filter((x) => x.enabled === true );\r\n\r\n  const enabledLocation = enabled.length === 1 ? {\r\n    name:   'c-cluster-auth-config-id',\r\n    params: { id: enabled[0].id },\r\n    query:  { mode: _EDIT }\r\n  } : null;\r\n\r\n  return {\r\n    nonLocal: supportedNonLocal,\r\n    enabledLocation,\r\n    enabled\r\n  };\r\n};\r\n\r\nexport const checkSchemasForFindAllHash = (types, store) => {\r\n  const hash = {};\r\n\r\n  for (const [key, value] of Object.entries(types)) {\r\n    const schema = store.getters[`${ value.inStoreType }/schemaFor`](value.type);\r\n\r\n    // It could be that user has permissions for GET but not list\r\n    // e.g. Standard user with GitRepo permissions try to fetch list of fleetworkspaces\r\n    // user has ability to GET but not fleet workspaces\r\n    // so optionally define a function that require it to pass before /findAll\r\n    const validSchema = value.schemaValidator ? value.schemaValidator(schema) : !!schema;\r\n\r\n    if (validSchema) {\r\n      hash[key] = store.dispatch(`${ value.inStoreType }/findAll`, { type: value.type } );\r\n    }\r\n  }\r\n\r\n  return allHash(hash);\r\n};\r\n\r\nexport const checkPermissions = (types, getters) => {\r\n  const hash = {};\r\n\r\n  for (const [key, value] of Object.entries(types)) {\r\n    const schema = getters['management/schemaFor'](value.type);\r\n\r\n    if (!schema) {\r\n      hash[key] = false;\r\n\r\n      continue;\r\n    }\r\n\r\n    // It could be that user has permissions for GET but not list\r\n    // e.g. Standard user with GitRepo permissions try to fetch list of fleetworkspaces\r\n    // user has ability to GET but not fleet workspaces\r\n    // so optionally define a function that require it to pass before /findAll\r\n    if (value.schemaValidator) {\r\n      hash[key] = value.schemaValidator(schema);\r\n\r\n      continue;\r\n    }\r\n\r\n    if (value.resourceMethods && schema) {\r\n      hash[key] = value.resourceMethods.every((method) => {\r\n        return (schema.resourceMethods || []).includes(method);\r\n      });\r\n\r\n      continue;\r\n    }\r\n\r\n    if (value.collectionMethods && schema) {\r\n      hash[key] = value.collectionMethods.every((method) => {\r\n        return (schema.collectionMethods || []).includes(method);\r\n      });\r\n\r\n      continue;\r\n    }\r\n\r\n    hash[key] = !!schema;\r\n  }\r\n\r\n  return allHash(hash);\r\n};\r\n\r\nexport const canViewResource = (store, resource) => {\r\n  // Note - don't use the current products store... because products can override stores for resources with `typeStoreMap`\r\n  const inStore = store.getters['currentStore'](resource);\r\n  // There's a chance we're in an extension's product who's store could be anything, so confirm schemaFor exists\r\n  const schemaFor = store.getters[`${ inStore }/schemaFor`];\r\n\r\n  // In order to check a resource is valid we need these\r\n  if (!inStore || !schemaFor) {\r\n    return false;\r\n  }\r\n\r\n  // Resource is valid if a schema exists for it (standard resource, spoofed resource) or it's a virtual resource\r\n  const validResource = schemaFor(resource) || store.getters['type-map/isVirtual'](resource);\r\n\r\n  return !!validResource;\r\n};\r\n"],"mappings":"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"}]}
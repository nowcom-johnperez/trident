{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/promptRemove/management.cattle.io.project.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/promptRemove/management.cattle.io.project.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcFN0YXRlLCBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IFBST0pFQ1QgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCB7IE1BTkFHRU1FTlQsIE5BTUVTUEFDRSB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gnOwppbXBvcnQgeyByZXNvdXJjZU5hbWVzIH0gZnJvbSAnQHNoZWxsL3V0aWxzL3N0cmluZyc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1Byb2plY3RBbmROYW1lc3BhY2VzUHJvbXB0UmVtb3ZlJywKCiAgY29tcG9uZW50czogeyBDaGVja2JveCB9LAoKICBwcm9wczogewogICAgdmFsdWU6IHsKICAgICAgdHlwZTogICAgQXJyYXksCiAgICAgIGRlZmF1bHQ6ICgpID0+IHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCgogICAgdHlwZTogewogICAgICB0eXBlOiAgICAgU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgdGhpcy5hbGxOYW1lc3BhY2VzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsgdHlwZTogTkFNRVNQQUNFIH0pOwogICAgdGhpcy5hbGxQcm9qZWN0cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuUFJPSkVDVCB9KTsKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVsZXRlUHJvamVjdE5hbWVzcGFjZXM6IGZhbHNlLAogICAgICBhbGxOYW1lc3BhY2VzOiAgICAgICAgICAgW10sCiAgICAgIGFsbFByb2plY3RzOiAgICAgICAgICAgICBbXSwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKCdhY3Rpb24tbWVudScsIFsndG9SZW1vdmUnXSksCiAgICAuLi5tYXBHZXR0ZXJzKHsgdDogJ2kxOG4vdCcgfSksCiAgICAuLi5tYXBHZXR0ZXJzKFsnY3VycmVudENsdXN0ZXInXSksCgogICAgY3VycmVudFByb2plY3QoKSB7CiAgICAgIGlmICggdGhpcy5hbGxQcm9qZWN0cykgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlWzBdOwogICAgICB9CgogICAgICByZXR1cm4ge307CiAgICB9LAoKICAgIGZpbHRlcmVkTmFtZXNwYWNlcygpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudFByb2plY3QpIHsKICAgICAgICByZXR1cm4gdGhpcy5hbGxOYW1lc3BhY2VzLmZpbHRlcigobikgPT4gbi5tZXRhZGF0YS5sYWJlbHNbUFJPSkVDVF0gPT09IHRoaXMuY3VycmVudFByb2plY3QubWV0YWRhdGE/Lm5hbWUpOwogICAgICB9CgogICAgICByZXR1cm4gW107CiAgICB9LAoKICAgIHBsdXNNb3JlKCkgewogICAgICBjb25zdCByZW1haW5pbmcgPSB0aGlzLmZpbHRlcmVkTmFtZXNwYWNlcy5sZW5ndGggPiA1ID8gdGhpcy5maWx0ZXJlZE5hbWVzcGFjZXMubGVuZ3RoIC0gNSA6IDA7CgogICAgICByZXR1cm4gdGhpcy50KCdwcm9tcHRSZW1vdmUuYW5kT3RoZXJzJywgeyBjb3VudDogcmVtYWluaW5nIH0pOwogICAgfSwKCiAgICBkaXNwbGF5TmFtZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2plY3Q/LnNwZWM/LmRpc3BsYXlOYW1lOwogICAgfSwKCiAgICBuYW1lcygpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyZWROYW1lc3BhY2VzLm1hcCgob2JqKSA9PiBvYmoubmFtZURpc3BsYXkpLnNsaWNlKDAsIDUpOwogICAgfSwKCiAgICBjYW5NYW5hZ2VOYW1lc3BhY2VzKCkgewogICAgICAvLyBPbmx5IGFkbWlucyBhbmQgY2x1c3RlciBvd25lcnMgY2FuIHNlZSBuYW1lc3BhY2VzIG91dHNpZGUgb2YgcHJvamVjdHMKICAgICAgLy8gQlVUIGNsdXN0ZXIgbWVtYmVycyBjYW4gYWxzbyBtYW5hZ2UgcHJvamVjdHMgYW5kIG5hbWVzcGFjZXMgYW5kIG1heSB3YW50IHRvIG5vdCBkZWxldGUgdGhlIG5hbWVzcGFjZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBwcm9qZWN0CiAgICAgIC8vIGFzIHBlciBodHRwczovL2dpdGh1Yi5jb20vcmFuY2hlci9kYXNoYm9hcmQvaXNzdWVzLzk1MTcgZGVzcGl0ZSB0aGUgbmFtZXNwYWNlcyBjYW5ub3QgYmUgc2VlbiBhZnRlcndhcmRzIChwcm9qZWN0bGVzcykKICAgICAgcmV0dXJuIHRoaXMuY3VycmVudENsdXN0ZXIuY2FuVXBkYXRlIHx8ICh0aGlzLmN1cnJlbnRQcm9qZWN0LmNhbkRlbGV0ZSAmJiB0aGlzLmZpbHRlcmVkTmFtZXNwYWNlcy5sZW5ndGggJiYgdGhpcy5maWx0ZXJlZE5hbWVzcGFjZXNbMF0/LmNhbkRlbGV0ZSk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICByZXNvdXJjZU5hbWVzLAogICAgcmVtb3ZlKCkgewogICAgICAvLyBEZWxldGUgYWxsIG9mIHRocmUgbmFtZXNwYWNlcyBhbmQgcmV0dXJuIGZhbHNlIC0gdGhpcyB0ZWxscyB0aGUgcHJvbXB0IHJlbW92ZSBkaWFsb2cgdG8gY29udGludWUgYW5kIGRlbGV0ZSB0aGUgcHJvamVjdAogICAgICAvLyBEZWxldGUgYWxsIG5hbWVzcGFjZXMgaWYgdGhlIHVzZXIgd291bGRuJ3QgYmUgYWJsZSB0byBzZWUgdGhlbSBhZnRlciBkZWxldGluZyB0aGUgcHJvamVjdAogICAgICBpZiAodGhpcy5kZWxldGVQcm9qZWN0TmFtZXNwYWNlcyB8fCAhdGhpcy5jYW5NYW5hZ2VOYW1lc3BhY2VzKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHRoaXMuZmlsdGVyZWROYW1lc3BhY2VzLm1hcCgobikgPT4gbi5yZW1vdmUoKSkpLnRoZW4oKCkgPT4gZmFsc2UpOwogICAgICB9CgogICAgICAvLyBSZXR1cm4gZmFsc2Ugc28gdGhhdCB0aGUgbWFpbiBwcm9tcHRSZW1vdmFsIHdpbGwgY29udGludWUgdG8gcmVtb3ZlIHRoZSBwcm9qZWN0CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["management.cattle.io.project.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"management.cattle.io.project.vue","sourceRoot":"../../node_modules/@rancher/shell/promptRemove","sourcesContent":["<script>\nimport { mapState, mapGetters } from 'vuex';\nimport { PROJECT } from '@shell/config/labels-annotations';\nimport { MANAGEMENT, NAMESPACE } from '@shell/config/types';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { resourceNames } from '@shell/utils/string';\n\nexport default {\n  name: 'ProjectAndNamespacesPromptRemove',\n\n  components: { Checkbox },\n\n  props: {\n    value: {\n      type:    Array,\n      default: () => {\n        return [];\n      }\n    },\n\n    type: {\n      type:     String,\n      required: true\n    }\n  },\n\n  async fetch() {\n    this.allNamespaces = await this.$store.dispatch('cluster/findAll', { type: NAMESPACE });\n    this.allProjects = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.PROJECT });\n  },\n\n  data() {\n    return {\n      deleteProjectNamespaces: false,\n      allNamespaces:           [],\n      allProjects:             [],\n    };\n  },\n\n  computed: {\n    ...mapState('action-menu', ['toRemove']),\n    ...mapGetters({ t: 'i18n/t' }),\n    ...mapGetters(['currentCluster']),\n\n    currentProject() {\n      if ( this.allProjects) {\n        return this.value[0];\n      }\n\n      return {};\n    },\n\n    filteredNamespaces() {\n      if (this.currentProject) {\n        return this.allNamespaces.filter((n) => n.metadata.labels[PROJECT] === this.currentProject.metadata?.name);\n      }\n\n      return [];\n    },\n\n    plusMore() {\n      const remaining = this.filteredNamespaces.length > 5 ? this.filteredNamespaces.length - 5 : 0;\n\n      return this.t('promptRemove.andOthers', { count: remaining });\n    },\n\n    displayName() {\n      return this.currentProject?.spec?.displayName;\n    },\n\n    names() {\n      return this.filteredNamespaces.map((obj) => obj.nameDisplay).slice(0, 5);\n    },\n\n    canManageNamespaces() {\n      // Only admins and cluster owners can see namespaces outside of projects\n      // BUT cluster members can also manage projects and namespaces and may want to not delete the namespaces associated with the project\n      // as per https://github.com/rancher/dashboard/issues/9517 despite the namespaces cannot be seen afterwards (projectless)\n      return this.currentCluster.canUpdate || (this.currentProject.canDelete && this.filteredNamespaces.length && this.filteredNamespaces[0]?.canDelete);\n    }\n  },\n  methods: {\n    resourceNames,\n    remove() {\n      // Delete all of thre namespaces and return false - this tells the prompt remove dialog to continue and delete the project\n      // Delete all namespaces if the user wouldn't be able to see them after deleting the project\n      if (this.deleteProjectNamespaces || !this.canManageNamespaces) {\n        return Promise.all(this.filteredNamespaces.map((n) => n.remove())).then(() => false);\n      }\n\n      // Return false so that the main promptRemoval will continue to remove the project\n      return false;\n    },\n  },\n};\n</script>\n\n<template>\n  <div>\n    <div>\n      <div class=\"mb-10\">\n        {{ t('promptRemove.attemptingToRemove', { type }) }} <span class=\"display-name\">{{ `${displayName}.` }}</span>\n        <template v-if=\"!canManageNamespaces\">\n          <span class=\"delete-warning\"> {{ t('promptRemove.willDeleteAssociatedNamespaces') }}</span> <br>\n          <div\n            v-clean-html=\"resourceNames(names, plusMore, t)\"\n            class=\"mt-10\"\n          />\n        </template>\n      </div>\n      <div\n        v-if=\"filteredNamespaces.length > 0 && canManageNamespaces\"\n        class=\"mt-20 remove-project-dialog\"\n      >\n        <Checkbox\n          v-model=\"deleteProjectNamespaces\"\n          :label=\"t('promptRemove.deleteAssociatedNamespaces')\"\n        />\n        <div class=\"mt-10 ml-20\">\n          <span v-clean-html=\"resourceNames(names, plusMore, t)\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.delete-warning{\n    color: var(--error)\n}\n.remove-project-dialog {\n  border: 1px solid var(--border);\n  padding: 10px;\n  border-radius: 5px;\n\n  .display-name {\n    font-weight: bold;\n  }\n}\n</style>\n"]}]}
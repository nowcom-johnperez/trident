{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js??ref--16-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js??ref--17-0!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js??ref--17-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/babel.config.js","mtime":1716430386710},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js","mtime":1716430466133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCB7IE5BTUVTUEFDRV9GSUxURVJfTlNfRlVMTF9QUkVGSVgsIE5BTUVTUEFDRV9GSUxURVJfUF9GVUxMX1BSRUZJWCB9IGZyb20gJ0BzaGVsbC91dGlscy9uYW1lc3BhY2UtZmlsdGVyJzsKaW1wb3J0IHsgZ2V0UGVyZm9ybWFuY2VTZXR0aW5nIH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NldHRpbmdzJzsKdmFyIFByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZyk7CiAgfQogIF9jcmVhdGVDbGFzcyhQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nLCBbewogICAga2V5OiAiaXNBcHBsaWNhYmxlIiwKICAgIHZhbHVlOgogICAgLyoqCiAgICAgKiBEb2VzIHRoZSByZXF1ZXN0IGBvcHRgIGRlZmluaXRpb24gcmVxdWlyZSByZXNvdXJjZXMgYXJlIGZldGNoZWQgZnJvbSBhIHNwZWNpZmljIHNldCBuYW1lc3BhY2VzL3Byb2plY3RzPwogICAgICovCiAgICBmdW5jdGlvbiBpc0FwcGxpY2FibGUob3B0KSB7CiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdC5uYW1lc3BhY2VkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0VuYWJsZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRW5hYmxlZChyb290R2V0dGVycykgewogICAgICB2YXIgX2E7CiAgICAgIHZhciBjdXJyZW50UHJvZHVjdCA9IHJvb3RHZXR0ZXJzWydjdXJyZW50UHJvZHVjdCddOwogICAgICAvLyBPbmx5IGVuYWJsZSBmb3IgdGhlIGNsdXN0ZXIgc3RvcmUgYXQgdGhlIG1vbWVudC4gSW4gdGhlb3J5IHRoaXMgc2hvdWxkIHdvcmsgaW4gbWFuYWdlbWVudCBhcyB3ZWxsLCBhcyB0aGV5J3JlIGJvdGggJ3N0ZXZlJyBzdG9yZXMKICAgICAgaWYgKChjdXJyZW50UHJvZHVjdCA9PT0gbnVsbCB8fCBjdXJyZW50UHJvZHVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY3VycmVudFByb2R1Y3QuaW5TdG9yZSkgIT09ICdjbHVzdGVyJykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoY3VycmVudFByb2R1Y3QgPT09IG51bGwgfHwgY3VycmVudFByb2R1Y3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJlbnRQcm9kdWN0LnNob3dXb3Jrc3BhY2VTd2l0Y2hlcikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgcGVyZkNvbmZpZyA9IGdldFBlcmZvcm1hbmNlU2V0dGluZyhyb290R2V0dGVycyk7CiAgICAgIGlmICghKChfYSA9IHBlcmZDb25maWcuZm9yY2VOc0ZpbHRlclYyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW5hYmxlZCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGBvcHRgIHJlcXVpcmVzIHJlc291cmNlcyBmcm9tIHNwZWNpZmljIG5zL3Byb2plY3RzLCBpZiBzbyByZXR1cm4gdGhlIHJlcXVpcmVkIHF1ZXJ5IHBhcmFtICh4PXkpCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJjaGVja0FuZENyZWF0ZVBhcmFtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0FuZENyZWF0ZVBhcmFtKG9wdCkgewogICAgICBpZiAoIXRoaXMuaXNBcHBsaWNhYmxlKG9wdCkpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlUGFyYW0ob3B0Lm5hbWVzcGFjZWQpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZVBhcmFtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVQYXJhbShuYW1lc3BhY2VGaWx0ZXIpIHsKICAgICAgaWYgKCFuYW1lc3BhY2VGaWx0ZXIgfHwgIW5hbWVzcGFjZUZpbHRlci5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgICAgdmFyIHByb2plY3RzT3JOYW1lc3BhY2VzID0gbmFtZXNwYWNlRmlsdGVyLm1hcChmdW5jdGlvbiAoZikgewogICAgICAgIHJldHVybiBmLnJlcGxhY2UoTkFNRVNQQUNFX0ZJTFRFUl9OU19GVUxMX1BSRUZJWCwgJycpLnJlcGxhY2UoTkFNRVNQQUNFX0ZJTFRFUl9QX0ZVTExfUFJFRklYLCAnJyk7CiAgICAgIH0pLmpvaW4oJywnKTsKICAgICAgcmV0dXJuICIiLmNvbmNhdChQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nLnBhcmFtLCAiPSIpLmNvbmNhdChwcm9qZWN0c09yTmFtZXNwYWNlcyk7CiAgICB9CiAgfV0pOwogIHJldHVybiBQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nOwp9KCk7ClByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcucGFyYW0gPSAncHJvamVjdHNvcm5hbWVzcGFjZXMnOwpleHBvcnQgZGVmYXVsdCBuZXcgUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZygpOw=="},{"version":3,"names":["NAMESPACE_FILTER_NS_FULL_PREFIX","NAMESPACE_FILTER_P_FULL_PREFIX","getPerformanceSetting","ProjectAndNamespaceFiltering","_classCallCheck","_createClass","key","value","isApplicable","opt","Array","isArray","namespaced","isEnabled","rootGetters","currentProduct","inStore","showWorkspaceSwitcher","perfConfig","_a","forceNsFilterV2","enabled","checkAndCreateParam","createParam","namespaceFilter","length","projectsOrNamespaces","map","f","replace","join","concat","param"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts"],"sourcesContent":["import { NAMESPACE_FILTER_NS_FULL_PREFIX, NAMESPACE_FILTER_P_FULL_PREFIX } from '@shell/utils/namespace-filter';\nimport { getPerformanceSetting } from '@shell/utils/settings';\n\ntype Opt = { [key: string]: any, namespaced?: string[]}\n\nclass ProjectAndNamespaceFiltering {\n  static param = 'projectsornamespaces'\n\n  /**\n   * Does the request `opt` definition require resources are fetched from a specific set namespaces/projects?\n   */\n  isApplicable(opt: Opt): boolean {\n    return Array.isArray(opt.namespaced);\n  }\n\n  isEnabled(rootGetters: any): boolean {\n    const currentProduct = rootGetters['currentProduct'];\n\n    // Only enable for the cluster store at the moment. In theory this should work in management as well, as they're both 'steve' stores\n    if (currentProduct?.inStore !== 'cluster') {\n      return false;\n    }\n\n    if (currentProduct?.showWorkspaceSwitcher) {\n      return false;\n    }\n\n    const perfConfig = getPerformanceSetting(rootGetters);\n\n    if (!perfConfig.forceNsFilterV2?.enabled) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if `opt` requires resources from specific ns/projects, if so return the required query param (x=y)\n   */\n  checkAndCreateParam(opt: Opt): string {\n    if (!this.isApplicable(opt)) {\n      return '';\n    }\n\n    return this.createParam(opt.namespaced);\n  }\n\n  private createParam(namespaceFilter: string[] | undefined): string {\n    if (!namespaceFilter || !namespaceFilter.length) {\n      return '';\n    }\n\n    const projectsOrNamespaces = namespaceFilter\n      .map((f) => f.replace(NAMESPACE_FILTER_NS_FULL_PREFIX, '')\n        .replace(NAMESPACE_FILTER_P_FULL_PREFIX, ''))\n      .join(',');\n\n    return `${ ProjectAndNamespaceFiltering.param }=${ projectsOrNamespaces }`;\n  }\n}\n\nexport default new ProjectAndNamespaceFiltering();\n"],"mappings":";;;;;;;AAAA,SAASA,+BAA+B,EAAEC,8BAA8B,QAAQ,+BAA+B;AAC/G,SAASC,qBAAqB,QAAQ,uBAAuB;AAAC,IAIxDC,4BAA4B;EAAA,SAAAA,6BAAA;IAAAC,eAAA,OAAAD,4BAAA;EAAA;EAAAE,YAAA,CAAAF,4BAAA;IAAAG,GAAA;IAAAC,KAAA;IAGhC;;;IAGA,SAAAC,aAAaC,GAAQ;MACnB,OAAOC,KAAK,CAACC,OAAO,CAACF,GAAG,CAACG,UAAU,CAAC;IACtC;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAED,SAAAM,UAAUC,WAAgB;;MACxB,IAAMC,cAAc,GAAGD,WAAW,CAAC,gBAAgB,CAAC;MAEpD;MACA,IAAI,CAAAC,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEC,OAAO,MAAK,SAAS,EAAE;QACzC,OAAO,KAAK;;MAGd,IAAID,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEE,qBAAqB,EAAE;QACzC,OAAO,KAAK;;MAGd,IAAMC,UAAU,GAAGhB,qBAAqB,CAACY,WAAW,CAAC;MAErD,IAAI,GAAAK,EAAA,GAACD,UAAU,CAACE,eAAe,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,OAAO,GAAE;QACxC,OAAO,KAAK;;MAGd,OAAO,IAAI;IACb;IAEA;;;EAAA;IAAAf,GAAA;IAAAC,KAAA,EAGA,SAAAe,oBAAoBb,GAAQ;MAC1B,IAAI,CAAC,IAAI,CAACD,YAAY,CAACC,GAAG,CAAC,EAAE;QAC3B,OAAO,EAAE;;MAGX,OAAO,IAAI,CAACc,WAAW,CAACd,GAAG,CAACG,UAAU,CAAC;IACzC;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAEO,SAAAgB,YAAYC,eAAqC;MACvD,IAAI,CAACA,eAAe,IAAI,CAACA,eAAe,CAACC,MAAM,EAAE;QAC/C,OAAO,EAAE;;MAGX,IAAMC,oBAAoB,GAAGF,eAAe,CACzCG,GAAG,CAAC,UAACC,CAAC;QAAA,OAAKA,CAAC,CAACC,OAAO,CAAC7B,+BAA+B,EAAE,EAAE,CAAC,CACvD6B,OAAO,CAAC5B,8BAA8B,EAAE,EAAE,CAAC;MAAA,EAAC,CAC9C6B,IAAI,CAAC,GAAG,CAAC;MAEZ,UAAAC,MAAA,CAAW5B,4BAA4B,CAAC6B,KAAM,OAAAD,MAAA,CAAKL,oBAAqB;IAC1E;EAAC;EAAA,OAAAvB,4BAAA;AAAA;AApDMA,4BAAA,CAAA6B,KAAK,GAAG,sBAAsB;AAuDvC,eAAe,IAAI7B,4BAA4B,EAAE"}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js??ref--16-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/caches/resourceCache.js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/caches/resourceCache.js","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/babel.config.js","mtime":1716430386710},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgeyBTQ0hFTUEsIENPVU5UIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IGtleUZpZWxkRm9yLCBub3JtYWxpemVUeXBlIH0gZnJvbSAnQHNoZWxsL3BsdWdpbnMvZGFzaGJvYXJkLXN0b3JlL25vcm1hbGl6ZSc7CmltcG9ydCB7IGFkZFNjaGVtYUluZGV4RmllbGRzIH0gZnJvbSAnQHNoZWxsL3BsdWdpbnMvc3RldmUvc2NoZW1hLnV0aWxzJzsKaW1wb3J0IHsgaGFzaE9iaiB9IGZyb20gJ0BzaGVsbC91dGlscy9jcnlwdG8vYnJvd3Nlckhhc2hVdGlscyc7CnZhciBSZXNvdXJjZUNhY2hlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBSZXNvdXJjZUNhY2hlKHR5cGUpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBSZXNvdXJjZUNhY2hlKTsKICAgIHRoaXMucmVzb3VyY2VzID0ge307CiAgICB0aGlzLnR5cGUgPSB2b2lkIDA7CiAgICB0aGlzLmtleUZpZWxkID0gdm9pZCAwOwogICAgdGhpcy50eXBlID0gbm9ybWFsaXplVHlwZSh0eXBlID09PSAnY291bnRzJyA/IENPVU5UIDogdHlwZSk7CiAgICB0aGlzLmtleUZpZWxkID0ga2V5RmllbGRGb3IodGhpcy50eXBlKTsKICB9CiAgX2NyZWF0ZUNsYXNzKFJlc291cmNlQ2FjaGUsIFt7CiAgICBrZXk6ICJsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICB2YXIgY29sbGVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICAgIC8vIGNvbnNvbGUudGltZSgnc3RhcnRTY2hlbWFMb2FkcyEhIScpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbGxlY3Rpb24ubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcmVzb3VyY2UgPSBjb2xsZWN0aW9uW2ldOwogICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFNDSEVNQSkgewogICAgICAgICAgYWRkU2NoZW1hSW5kZXhGaWVsZHMocmVzb3VyY2UpOwogICAgICAgIH0KICAgICAgICB2YXIgaWQgPSByZXNvdXJjZVt0aGlzLmtleUZpZWxkXTsKCiAgICAgICAgLy8gU3RvcmUgdGhlIGhhc2ggaW5zdGVhZCBvZiB0aGUgd2hvbGUgb2JqZWN0LiBUaGlzIG1lYW5zIGxvbmdlciBsb2FkIHRpbWUgYmUgcmVkdWNlcyBtZW1vcnkgZm9vdHByaW50CiAgICAgICAgLy8gUGVyZiBOb3RlOiAzLjMyODEyNSBtcyB0byBsb2FkIH4yNTAwIHNjaGVtYXMgYXMgb2JqZWN0cyBpbnRvIGNhY2hlCiAgICAgICAgLy8gUGVyZiBOb3RlOiA2Ny40NTA5Mjc3MzQzNzUgbXMgdG8gbG9hZCB+MjUwMCBzY2hlbWFzIGFzIGhhc2hlcyBpbnRvIGNhY2hlCiAgICAgICAgdGhpcy5yZXNvdXJjZXNbaWRdID0gaGFzaE9iaihyZXNvdXJjZSk7CiAgICAgIH0KICAgICAgLy8gY29uc29sZS50aW1lRW5kKCdzdGFydFNjaGVtYUxvYWRzISEhJyk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZShyZXNvdXJjZSwgY2FsbGJhY2spIHsKICAgICAgaWYgKHRoaXMudHlwZSA9PT0gU0NIRU1BKSB7CiAgICAgICAgYWRkU2NoZW1hSW5kZXhGaWVsZHMocmVzb3VyY2UpOwogICAgICB9CiAgICAgIHZhciBleGlzdGluZ1Jlc291cmNlSGFzaCA9IHRoaXMucmVzb3VyY2VzW3Jlc291cmNlW3RoaXMua2V5RmllbGRdXSB8fCB7fTsKICAgICAgdmFyIG5ld1Jlc291cmNlSGFzaCA9IGhhc2hPYmoocmVzb3VyY2UpOwogICAgICBpZiAoZXhpc3RpbmdSZXNvdXJjZUhhc2ggIT09IG5ld1Jlc291cmNlSGFzaCkgewogICAgICAgIHRoaXMucmVzb3VyY2VzW3Jlc291cmNlW3RoaXMua2V5RmllbGRdXSA9IHJlc291cmNlOwogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZShyZXNvdXJjZSwgY2FsbGJhY2spIHsKICAgICAgLy8gVG9EbzogdGhlIGxvZ2ljIGZvciBjcmVhdGUgaXMgaWRlbnRpY2FsIHRvIGNoYW5nZSBpbiB0aGVzZSBjYWNoZXMgYnV0IHRoZSB3b3JrZXIgZG9lc24ndCBrbm93IHRoYXQKICAgICAgdGhpcy5jaGFuZ2UocmVzb3VyY2UsIGNhbGxiYWNrKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShpZCwgY2FsbGJhY2spIHsKICAgICAgaWYgKHRoaXMucmVzb3VyY2VzW2lkXSkgewogICAgICAgIGRlbGV0ZSB0aGlzLnJlc291cmNlc1tpZF07CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfQogIH1dKTsKICByZXR1cm4gUmVzb3VyY2VDYWNoZTsKfSgpOwpleHBvcnQgeyBSZXNvdXJjZUNhY2hlIGFzIGRlZmF1bHQgfTs="},{"version":3,"names":["SCHEMA","COUNT","keyFieldFor","normalizeType","addSchemaIndexFields","hashObj","ResourceCache","type","_classCallCheck","resources","keyField","_createClass","key","value","load","collection","arguments","length","undefined","i","resource","id","change","callback","existingResourceHash","newResourceHash","create","remove","default"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/caches/resourceCache.js"],"sourcesContent":["import { SCHEMA, COUNT } from '@shell/config/types';\nimport { keyFieldFor, normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport { addSchemaIndexFields } from '@shell/plugins/steve/schema.utils';\nimport { hashObj } from '@shell/utils/crypto/browserHashUtils';\n\nexport default class ResourceCache {\n  resources = {};\n  type;\n  keyField;\n  constructor(type) {\n    this.type = normalizeType(type === 'counts' ? COUNT : type);\n    this.keyField = keyFieldFor(this.type);\n  }\n\n  load(collection = []) {\n    // console.time('startSchemaLoads!!!');\n    for (let i = 0; i < collection.length; i++) {\n      const resource = collection[i];\n\n      if ( this.type === SCHEMA ) {\n        addSchemaIndexFields(resource);\n      }\n      const id = resource[this.keyField];\n\n      // Store the hash instead of the whole object. This means longer load time be reduces memory footprint\n      // Perf Note: 3.328125 ms to load ~2500 schemas as objects into cache\n      // Perf Note: 67.450927734375 ms to load ~2500 schemas as hashes into cache\n      this.resources[id] = hashObj(resource);\n    }\n    // console.timeEnd('startSchemaLoads!!!');\n\n    return this;\n  }\n\n  change(resource, callback) {\n    if ( this.type === SCHEMA ) {\n      addSchemaIndexFields(resource);\n    }\n\n    const existingResourceHash = this.resources[resource[this.keyField]] || {};\n    const newResourceHash = hashObj(resource);\n\n    if (existingResourceHash !== newResourceHash) {\n      this.resources[resource[this.keyField]] = resource;\n      callback();\n    }\n  }\n\n  create(resource, callback) {\n    // ToDo: the logic for create is identical to change in these caches but the worker doesn't know that\n    this.change(resource, callback);\n  }\n\n  remove(id, callback) {\n    if (this.resources[id]) {\n      delete this.resources[id];\n      callback();\n    }\n  }\n}\n"],"mappings":";;AAAA,SAASA,MAAM,EAAEC,KAAK,QAAQ,qBAAqB;AACnD,SAASC,WAAW,EAAEC,aAAa,QAAQ,0CAA0C;AACrF,SAASC,oBAAoB,QAAQ,mCAAmC;AACxE,SAASC,OAAO,QAAQ,sCAAsC;AAAC,IAE1CC,aAAa;EAIhC,SAAAA,cAAYC,IAAI,EAAE;IAAAC,eAAA,OAAAF,aAAA;IAAA,KAHlBG,SAAS,GAAG,CAAC,CAAC;IAAA,KACdF,IAAI;IAAA,KACJG,QAAQ;IAEN,IAAI,CAACH,IAAI,GAAGJ,aAAa,CAACI,IAAI,KAAK,QAAQ,GAAGN,KAAK,GAAGM,IAAI,CAAC;IAC3D,IAAI,CAACG,QAAQ,GAAGR,WAAW,CAAC,IAAI,CAACK,IAAI,CAAC;EACxC;EAACI,YAAA,CAAAL,aAAA;IAAAM,GAAA;IAAAC,KAAA,EAED,SAAAC,KAAA,EAAsB;MAAA,IAAjBC,UAAU,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;MAClB;MACA,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,UAAU,CAACE,MAAM,EAAEE,CAAC,EAAE,EAAE;QAC1C,IAAMC,QAAQ,GAAGL,UAAU,CAACI,CAAC,CAAC;QAE9B,IAAK,IAAI,CAACZ,IAAI,KAAKP,MAAM,EAAG;UAC1BI,oBAAoB,CAACgB,QAAQ,CAAC;QAChC;QACA,IAAMC,EAAE,GAAGD,QAAQ,CAAC,IAAI,CAACV,QAAQ,CAAC;;QAElC;QACA;QACA;QACA,IAAI,CAACD,SAAS,CAACY,EAAE,CAAC,GAAGhB,OAAO,CAACe,QAAQ,CAAC;MACxC;MACA;;MAEA,OAAO,IAAI;IACb;EAAC;IAAAR,GAAA;IAAAC,KAAA,EAED,SAAAS,OAAOF,QAAQ,EAAEG,QAAQ,EAAE;MACzB,IAAK,IAAI,CAAChB,IAAI,KAAKP,MAAM,EAAG;QAC1BI,oBAAoB,CAACgB,QAAQ,CAAC;MAChC;MAEA,IAAMI,oBAAoB,GAAG,IAAI,CAACf,SAAS,CAACW,QAAQ,CAAC,IAAI,CAACV,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC;MAC1E,IAAMe,eAAe,GAAGpB,OAAO,CAACe,QAAQ,CAAC;MAEzC,IAAII,oBAAoB,KAAKC,eAAe,EAAE;QAC5C,IAAI,CAAChB,SAAS,CAACW,QAAQ,CAAC,IAAI,CAACV,QAAQ,CAAC,CAAC,GAAGU,QAAQ;QAClDG,QAAQ,CAAC,CAAC;MACZ;IACF;EAAC;IAAAX,GAAA;IAAAC,KAAA,EAED,SAAAa,OAAON,QAAQ,EAAEG,QAAQ,EAAE;MACzB;MACA,IAAI,CAACD,MAAM,CAACF,QAAQ,EAAEG,QAAQ,CAAC;IACjC;EAAC;IAAAX,GAAA;IAAAC,KAAA,EAED,SAAAc,OAAON,EAAE,EAAEE,QAAQ,EAAE;MACnB,IAAI,IAAI,CAACd,SAAS,CAACY,EAAE,CAAC,EAAE;QACtB,OAAO,IAAI,CAACZ,SAAS,CAACY,EAAE,CAAC;QACzBE,QAAQ,CAAC,CAAC;MACZ;IACF;EAAC;EAAA,OAAAjB,aAAA;AAAA;AAAA,SArDkBA,aAAa,IAAAsB,OAAA"}]}
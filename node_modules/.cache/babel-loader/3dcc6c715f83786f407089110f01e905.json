{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js??ref--16-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/subscribe.js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/subscribe.js","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/babel.config.js","mtime":1716430386710},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycy5qcyI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKZnVuY3Rpb24gb3duS2V5cyhlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9CmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyhPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IF9kZWZpbmVQcm9wZXJ0eShlLCByLCB0W3JdKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH0KZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTsgaWYgKCFpdCkgeyBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyB2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTsgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTsgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsgfSwgZTogZnVuY3Rpb24gZShfZSkgeyB0aHJvdyBfZTsgfSwgZjogRiB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfSB2YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IGl0ID0gaXQuY2FsbChvKTsgfSwgbjogZnVuY3Rpb24gbigpIHsgdmFyIHN0ZXAgPSBpdC5uZXh0KCk7IG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7IHJldHVybiBzdGVwOyB9LCBlOiBmdW5jdGlvbiBlKF9lMikgeyBkaWRFcnIgPSB0cnVlOyBlcnIgPSBfZTI7IH0sIGY6IGZ1bmN0aW9uIGYoKSB7IHRyeSB7IGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdC5yZXR1cm4gIT0gbnVsbCkgaXQucmV0dXJuKCk7IH0gZmluYWxseSB7IGlmIChkaWRFcnIpIHRocm93IGVycjsgfSB9IH07IH0KZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTsgcmV0dXJuIGFycjI7IH0KaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmVudHJpZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnByb21pc2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKLyoqCiAqIEhhbmRsZXMgc3Vic2NyaXB0aW9ucyB0byB3ZWJzb2NrZXRzIHdoaWNoIHJlY2VpdmUgdXBkYXRlcyB0byByZXNvdXJjZXMKICoKICogQ292ZXJzIHRocmVlIHVzZSBjYXNlcwogKiAxKSBIYW5kbGVzIHN1YnNjcmlwdGlvbiB3aXRoaW4gdGhpcyBmaWxlCiAqIDIpIEhhbmRsZXMgYGNsdXN0ZXJgIHN1YnNjcmlwdGlvbnMgZm9yIHNvbWUgYmFzaWMgdHlwZXMgaW4gYSB3ZWIgd29ya2VyIChTRVRUSU5HLlVJX1BFUkZPUk1BTkNFIGFkdmFuY2VkV29ya2VyID0gZmFsc2UpCiAqIDIpIEhhbmRsZXMgYGNsdXN0ZXJgIHN1YnNjcmlwdGlvbnMgYW5kIG9wdGltaXNhdGlvbnMgaW4gYW4gYWR2YW5jZWQgd29ya2VyIChTRVRUSU5HLlVJX1BFUkZPUk1BTkNFIGFkdmFuY2VkV29ya2VyID0gdHJ1ZSkKICovCgppbXBvcnQgeyBhZGRPYmplY3QsIGNsZWFyLCByZW1vdmVPYmplY3QgfSBmcm9tICdAc2hlbGwvdXRpbHMvYXJyYXknOwppbXBvcnQgeyBnZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgU0NIRU1BLCBNQU5BR0VNRU5UIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IFNFVFRJTkcgfSBmcm9tICdAc2hlbGwvY29uZmlnL3NldHRpbmdzJzsKaW1wb3J0IHsgQ1NSRiB9IGZyb20gJ0BzaGVsbC9jb25maWcvY29va2llcyc7CmltcG9ydCB7IGdldFBlcmZvcm1hbmNlU2V0dGluZyB9IGZyb20gJ0BzaGVsbC91dGlscy9zZXR0aW5ncyc7CmltcG9ydCBTb2NrZXQsIHsgRVZFTlRfQ09OTkVDVEVELCBFVkVOVF9ESVNDT05ORUNURUQsIEVWRU5UX01FU1NBR0UsCi8vICBFVkVOVF9GUkFNRV9USU1FT1VULApFVkVOVF9DT05ORUNUX0VSUk9SLCBFVkVOVF9ESVNDT05ORUNUX0VSUk9SLCBOT19XQVRDSCwgTk9fU0NIRU1BLCBSRVZJU0lPTl9UT09fT0xEIH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NvY2tldCc7CmltcG9ydCB7IG5vcm1hbGl6ZVR5cGUgfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9kYXNoYm9hcmQtc3RvcmUvbm9ybWFsaXplJzsKaW1wb3J0IGRheSBmcm9tICdkYXlqcyc7CmltcG9ydCB7IERBVEVfRk9STUFULCBUSU1FX0ZPUk1BVCB9IGZyb20gJ0BzaGVsbC9zdG9yZS9wcmVmcyc7CmltcG9ydCB7IGVzY2FwZUh0bWwgfSBmcm9tICdAc2hlbGwvdXRpbHMvc3RyaW5nJzsKaW1wb3J0IHsga2V5Rm9yU3Vic2NyaWJlIH0gZnJvbSAnQHNoZWxsL3BsdWdpbnMvc3RldmUvcmVzb3VyY2VXYXRjaGVyJzsKaW1wb3J0IHsgd2FpdEZvciB9IGZyb20gJ0BzaGVsbC91dGlscy9hc3luYyc7CmltcG9ydCB7IFdPUktFUl9NT0RFUyB9IGZyb20gJy4vd29ya2VyJzsKaW1wb3J0IHBBbmRORmlsdGVyaW5nIGZyb20gJ0BzaGVsbC91dGlscy9wcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nLnV0aWxzJzsKaW1wb3J0IHsgQkxBTktfQ0xVU1RFUiwgU1RPUkUgfSBmcm9tICdAc2hlbGwvc3RvcmUvc3RvcmUtdHlwZXMuanMnOwoKLy8gbWluaW11bSBsZW5ndGggb2YgdGltZSBhIGRpc2Nvbm5lY3Qgbm90aWZpY2F0aW9uIGlzIHNob3duCnZhciBNSU5JTVVNX1RJTUVfTk9USUZJRUQgPSAzMDAwOwp2YXIgd29ya2VyUXVldWVzID0ge307CnZhciBzdXBwb3J0ZWRTdG9yZXMgPSBbU1RPUkUuQ0xVU1RFUiwgU1RPUkUuUkFOQ0hFUiwgU1RPUkUuTUFOQUdFTUVOVF07CnZhciBpc1dhaXRpbmdGb3JEZXN0cm95ID0gZnVuY3Rpb24gaXNXYWl0aW5nRm9yRGVzdHJveShzdG9yZU5hbWUsIHN0b3JlKSB7CiAgdmFyIF9zdG9yZSQkd29ya2VycyRzdG9yZTsKICByZXR1cm4gKChfc3RvcmUkJHdvcmtlcnMkc3RvcmUgPSBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdKSA9PT0gbnVsbCB8fCBfc3RvcmUkJHdvcmtlcnMkc3RvcmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdG9yZSQkd29ya2VycyRzdG9yZS53YWl0aW5nRm9yRGVzdHJveSkgJiYgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXS53YWl0aW5nRm9yRGVzdHJveSgpOwp9Owp2YXIgd2FpdEZvclNldHRpbmdzU2NoZW1hID0gZnVuY3Rpb24gd2FpdEZvclNldHRpbmdzU2NoZW1hKHN0b3JlTmFtZSwgc3RvcmUpIHsKICByZXR1cm4gd2FpdEZvcihmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gaXNXYWl0aW5nRm9yRGVzdHJveShzdG9yZU5hbWUsIHN0b3JlKSB8fCAhIXN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYnlJZCddKFNDSEVNQSwgTUFOQUdFTUVOVC5TRVRUSU5HKTsKICB9KTsKfTsKdmFyIHdhaXRGb3JTZXR0aW5ncyA9IGZ1bmN0aW9uIHdhaXRGb3JTZXR0aW5ncyhzdG9yZU5hbWUsIHN0b3JlKSB7CiAgcmV0dXJuIHdhaXRGb3IoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGlzV2FpdGluZ0ZvckRlc3Ryb3koc3RvcmVOYW1lLCBzdG9yZSkgfHwgISFzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L2J5SWQnXShNQU5BR0VNRU5ULlNFVFRJTkcsIFNFVFRJTkcuVUlfUEVSRk9STUFOQ0UpOwogIH0pOwp9Owp2YXIgaXNBZHZhbmNlZFdvcmtlciA9IGZ1bmN0aW9uIGlzQWR2YW5jZWRXb3JrZXIoY3R4KSB7CiAgdmFyIHJvb3RHZXR0ZXJzID0gY3R4LnJvb3RHZXR0ZXJzLAogICAgZ2V0dGVycyA9IGN0eC5nZXR0ZXJzOwogIHZhciBzdG9yZU5hbWUgPSBnZXR0ZXJzLnN0b3JlTmFtZTsKICB2YXIgY2x1c3RlcklkID0gcm9vdEdldHRlcnMuY2x1c3RlcklkOwogIGlmICghc3VwcG9ydGVkU3RvcmVzLmluY2x1ZGVzKHN0b3JlTmFtZSkgfHwgY2x1c3RlcklkID09PSBCTEFOS19DTFVTVEVSICYmIHN0b3JlTmFtZSA9PT0gU1RPUkUuQ0xVU1RFUikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICB2YXIgcGVyZlNldHRpbmcgPSBnZXRQZXJmb3JtYW5jZVNldHRpbmcocm9vdEdldHRlcnMpOwogIHJldHVybiBwZXJmU2V0dGluZyA9PT0gbnVsbCB8fCBwZXJmU2V0dGluZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGVyZlNldHRpbmcuYWR2YW5jZWRXb3JrZXIuZW5hYmxlZDsKfTsKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVdvcmtlcihfeCwgX3gyKSB7CiAgcmV0dXJuIF9jcmVhdGVXb3JrZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQpmdW5jdGlvbiBfY3JlYXRlV29ya2VyKCkgewogIF9jcmVhdGVXb3JrZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KHN0b3JlLCBjdHgpIHsKICAgIHZhciBnZXR0ZXJzLCBfZGlzcGF0Y2gsIHN0b3JlTmFtZSwgYWR2YW5jZWRXb3JrZXIsIHdvcmtlckFjdGlvbnMsIHdvcmtlck1vZGUsIHdvcmtlciwgX3dvcmtlclF1ZXVlcyRzdG9yZU5hLCBtZXNzYWdlOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGdldHRlcnMgPSBjdHguZ2V0dGVycywgX2Rpc3BhdGNoID0gY3R4LmRpc3BhdGNoOwogICAgICAgICAgc3RvcmVOYW1lID0gZ2V0dGVycy5zdG9yZU5hbWU7CiAgICAgICAgICBzdG9yZS4kd29ya2VycyA9IHN0b3JlLiR3b3JrZXJzIHx8IHt9OwogICAgICAgICAgaWYgKHN1cHBvcnRlZFN0b3Jlcy5pbmNsdWRlcyhzdG9yZU5hbWUpKSB7CiAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgaWYgKCFzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdKSB7CiAgICAgICAgICAgIC8vIHdlIGtub3cgd2UgbmVlZCBhIHdvcmtlciBhdCB0aGlzIHBvaW50IGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoIG9uZSBzbyB3ZSdyZSBjcmVhdGluZyBhIG1vY2sgaW50ZXJmYWNlCiAgICAgICAgICAgIC8vIGl0IHdpbGwgc2ltcGx5IHF1ZXVlIHVwIGFueSBtZXNzYWdlcyBmb3IgdGhlIHJlYWwgd29ya2VyIHRvIHByb2Nlc3Mgd2hlbiBpdCBsb2FkcyB1cAogICAgICAgICAgICBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdID0gewogICAgICAgICAgICAgIHBvc3RNZXNzYWdlOiBmdW5jdGlvbiBwb3N0TWVzc2FnZShtc2cpIHsKICAgICAgICAgICAgICAgIHZhciBfT2JqZWN0JGtleXM7CiAgICAgICAgICAgICAgICBpZiAoKChfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhtc2cpKSA9PT0gbnVsbCB8fCBfT2JqZWN0JGtleXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9PYmplY3Qka2V5c1swXSkgPT09ICdkZXN0cm95V29ya2VyJykgewogICAgICAgICAgICAgICAgICAvLyBUaGUgd29ya2VyIGhhcyBiZWVuIGRlc3Ryb3llZCBiZWZvcmUgaXQncyBiZWVuIHNldCB1cC4gRmxhZyB0aGlzIHNvIHdlIHN0b3Agd2FpdGluZyBmb3IgbWdtdCBzZXR0aW5ncyBhbmQgdGhlbiBjYW4gZGVzdHJveSB3b3JrZXIuCiAgICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FuIG9jY3VyciB3aGVuIHRoZSB1c2VyIGlzIHJlZGlyZWN0ZWQgdG8gdGhlIGxvZyBpbiBwYWdlCiAgICAgICAgICAgICAgICAgIC8vIC0gd29ya2VycyBjcmVhdGVkIChidXQgd2FpdGluZykKICAgICAgICAgICAgICAgICAgLy8gLSBsb2dvdXQgaXMgY2FsbGVkCiAgICAgICAgICAgICAgICAgIC8vIC0gPHN0b3JlPi91bnN1YnNjcmliZSBpcyBkaXNwYXRjaGVkCiAgICAgICAgICAgICAgICAgIC8vIC0gd2FpdCBmb3Igd29ya2VyIG9iamVjdCB0byBiZSBkZXN0cm95ZWQgPC0tIHJlcXVpcmVzIGluaXRpYWwgd2FpdCB0byBiZSB1bmJsb2NrZWQKICAgICAgICAgICAgICAgICAgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXS5tb2RlID0gV09SS0VSX01PREVTLkRFU1RST1lfTU9DSzsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdKSB7CiAgICAgICAgICAgICAgICAgIHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdLnB1c2gobXNnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdID0gW21zZ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBtb2RlOiBXT1JLRVJfTU9ERVMuV0FJVElORywKICAgICAgICAgICAgICB3YWl0aW5nRm9yRGVzdHJveTogZnVuY3Rpb24gd2FpdGluZ0ZvckRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0b3JlJCR3b3JrZXJzJHN0b3JlMjsKICAgICAgICAgICAgICAgIHJldHVybiAoKF9zdG9yZSQkd29ya2VycyRzdG9yZTIgPSBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdKSA9PT0gbnVsbCB8fCBfc3RvcmUkJHdvcmtlcnMkc3RvcmUyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RvcmUkJHdvcmtlcnMkc3RvcmUyLm1vZGUpID09PSBXT1JLRVJfTU9ERVMuREVTVFJPWV9NT0NLOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIC8vIFNpbWlsYXIgdG8gd29ya2VyQWN0aW9ucy5kZXN0cm95V29ya2VyCiAgICAgICAgICAgICAgICBkZWxldGUgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDg7CiAgICAgICAgICByZXR1cm4gd2FpdEZvclNldHRpbmdzU2NoZW1hKHN0b3JlTmFtZSwgc3RvcmUpOwogICAgICAgIGNhc2UgODoKICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTA7CiAgICAgICAgICByZXR1cm4gd2FpdEZvclNldHRpbmdzKHN0b3JlTmFtZSwgc3RvcmUpOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBpZiAoIXN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0ud2FpdGluZ0ZvckRlc3Ryb3koKSkgewogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEzOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0uZGVzdHJveSgpOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwogICAgICAgIGNhc2UgMTM6CiAgICAgICAgICBhZHZhbmNlZFdvcmtlciA9IGlzQWR2YW5jZWRXb3JrZXIoY3R4KTsKICAgICAgICAgIHdvcmtlckFjdGlvbnMgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KHsKICAgICAgICAgICAgbG9hZDogZnVuY3Rpb24gbG9hZChyZXNvdXJjZSkgewogICAgICAgICAgICAgIHF1ZXVlQ2hhbmdlKGN0eCwgcmVzb3VyY2UsIHRydWUsICdDaGFuZ2UnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveVdvcmtlcjogZnVuY3Rpb24gZGVzdHJveVdvcmtlcigpIHsKICAgICAgICAgICAgICBpZiAoc3RvcmUuJHdvcmtlcnMpIHsKICAgICAgICAgICAgICAgIHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0udGVybWluYXRlKCk7CiAgICAgICAgICAgICAgICBkZWxldGUgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJhdGNoQ2hhbmdlczogZnVuY3Rpb24gYmF0Y2hDaGFuZ2VzKGJhdGNoKSB7CiAgICAgICAgICAgICAgX2Rpc3BhdGNoKCdiYXRjaENoYW5nZXMnLCBuYW1lc3BhY2VIYW5kbGVyLnZhbGlkYXRlQmF0Y2hDaGFuZ2UoY3R4LCBiYXRjaCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2gobXNnKSB7CiAgICAgICAgICAgICAgX2Rpc3BhdGNoKCJ3cy4iLmNvbmNhdChtc2cubmFtZSksIG1zZyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlZGlzcGF0Y2g6IGZ1bmN0aW9uIHJlZGlzcGF0Y2gobXNnKSB7CiAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICogYmVjYXVzZSB3ZSBoYWQgdG8gcXVldWUgdXAgc29tZSBtZXNzYWdlcyBwcmlvciB0byBsb2FkaW5nIHRoZSB3b3JrZXI6CiAgICAgICAgICAgICAgICogdGhlIGJhc2ljIHdvcmtlciB3aWxsIG5lZWQgdG8gcmVkaXNwYXRjaCBzb21lIG9mIHRoZSBxdWV1ZWQgbWVzc2FnZXMgYmFjayB0byB0aGUgVUkgdGhyZWFkCiAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMobXNnKS5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmMjQpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmMjUgPSBfc2xpY2VkVG9BcnJheShfcmVmMjQsIDIpLAogICAgICAgICAgICAgICAgICBhY3Rpb24gPSBfcmVmMjVbMF0sCiAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IF9yZWYyNVsxXTsKICAgICAgICAgICAgICAgIF9kaXNwYXRjaChhY3Rpb24sIHBhcmFtcyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIEVWRU5UX0NPTk5FQ1RfRVJST1IsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF9kaXNwYXRjaCgnZXJyb3InLCBlKTsKICAgICAgICAgIH0pLCBFVkVOVF9ESVNDT05ORUNUX0VSUk9SLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfZGlzcGF0Y2goJ2Vycm9yJywgZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICghc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXSB8fCBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdLm1vZGUgPT09IFdPUktFUl9NT0RFUy5XQUlUSU5HKSB7CiAgICAgICAgICAgIHdvcmtlck1vZGUgPSBhZHZhbmNlZFdvcmtlciA/IFdPUktFUl9NT0RFUy5BRFZBTkNFRCA6IFdPUktFUl9NT0RFUy5CQVNJQzsKICAgICAgICAgICAgd29ya2VyID0gc3RvcmUuc3RldmVDcmVhdGVXb3JrZXIod29ya2VyTW9kZSk7CiAgICAgICAgICAgIHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0gPSB3b3JrZXI7CiAgICAgICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaW5pdFdvcmtlcjogewogICAgICAgICAgICAgICAgc3RvcmVOYW1lOiBzdG9yZU5hbWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIENvdmVycyBtZXNzYWdlIGZyb20gV29ya2VyIHRvIFVJIHRocmVhZAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIC8qIG9uIHRoZSBvZmYgY2hhbmNlIHRoZXJlJ3MgbW9yZSB0aGFuIGtleSBpbiB0aGUgbWVzc2FnZSwgd2UgaGFuZGxlIHRoZW0gaW4gdGhlIG9yZGVyIHRoYXQgdGhleSAia2V5cyIgbWV0aG9kIHByb3ZpZGVzIHdoaWNoIGlzCiAgICAgICAgICAgICAgLy8gZ29vZCBlbm91Z2ggZm9yIG5vdyBjb25zaWRlcmluZyB0aGF0IHdlIG5ldmVyIHNlbmQgbW9yZSB0aGFuIG9uZSBtZXNzYWdlIGFjdGlvbiBhdCBhIHRpbWUgcmlnaHQgbm93ICovCiAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VBY3Rpb25zID0gT2JqZWN0LmtleXMoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmRhdGEpOwogICAgICAgICAgICAgIG1lc3NhZ2VBY3Rpb25zLmZvckVhY2goZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgICAgICAgICAgd29ya2VyQWN0aW9uc1thY3Rpb25dKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5kYXRhW2FjdGlvbl0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKChfd29ya2VyUXVldWVzJHN0b3JlTmEgPSB3b3JrZXJRdWV1ZXNbc3RvcmVOYW1lXSkgIT09IG51bGwgJiYgX3dvcmtlclF1ZXVlcyRzdG9yZU5hICE9PSB2b2lkIDAgJiYgX3dvcmtlclF1ZXVlcyRzdG9yZU5hLmxlbmd0aCkgewogICAgICAgICAgICBtZXNzYWdlID0gd29ya2VyUXVldWVzW3N0b3JlTmFtZV0uc2hpZnQoKTsKICAgICAgICAgICAgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXS5wb3N0TWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgIH0KICAgICAgICBjYXNlIDE3OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgfQogICAgfSwgX2NhbGxlZTYpOwogIH0pKTsKICByZXR1cm4gX2NyZWF0ZVdvcmtlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CmV4cG9ydCBmdW5jdGlvbiBlcXVpdmFsZW50V2F0Y2goYSwgYikgewogIHZhciBhcmVzb3VyY2VUeXBlID0gYS5yZXNvdXJjZVR5cGUgfHwgYS50eXBlOwogIHZhciBicmVzb3VyY2VUeXBlID0gYi5yZXNvdXJjZVR5cGUgfHwgYi50eXBlOwogIGlmIChhcmVzb3VyY2VUeXBlICE9PSBicmVzb3VyY2VUeXBlKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChhLmlkICE9PSBiLmlkICYmIChhLmlkIHx8IGIuaWQpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChhLm5hbWVzcGFjZSAhPT0gYi5uYW1lc3BhY2UgJiYgKGEubmFtZXNwYWNlIHx8IGIubmFtZXNwYWNlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoYS5zZWxlY3RvciAhPT0gYi5zZWxlY3RvciAmJiAoYS5zZWxlY3RvciB8fCBiLnNlbGVjdG9yKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gdHJ1ZTsKfQoKLyoqCiAqIFNvY2tldHMgd2lsbCBub3QgYmUgYWJsZSB0byBzdWJzY3JpYmUgdG8gbW9yZSB0aGFuIG9uZSBuYW1lc3BhY2UuIElmIHRoaXMgaXMgcmVxdWVzdGVkIHdlIHByZXRlbmQgdG8gaGFuZGxlIGl0CiAqIC0gQ2hhbmdlcyB0byBhbGwgcmVzb3VyY2VzIGFyZSBtb25pdG9yZWQgKG5vIG5hbWVzcGFjZSBwcm92aWRlZCBpbiBzdWIpCiAqIC0gV2UgaWdub3JlIGFueSBldmVudHMgbm90IGZyb20gYSByZXF1aXJlZCBuYW1lc3BhY2UgKHdlIGhhdmUgdGhlIGNvbnZlcnNpb24gb2YgcHJvamVjdCAtLT4gbmFtZXNwYWNlcyBhbHJlYWR5KQogKi8KdmFyIG5hbWVzcGFjZUhhbmRsZXIgPSB7CiAgLyoqCiAgICogTm90ZSAtIG5hbWVzcGFjZSBjYW4gYmUgYSBsaXN0IG9mIHByb2plY3RzIG9yIG5hbWVzcGFjZXMKICAgKi8KICBzdWJzY3JpYmVOYW1lc3BhY2U6IGZ1bmN0aW9uIHN1YnNjcmliZU5hbWVzcGFjZShuYW1lc3BhY2UpIHsKICAgIGlmIChwQW5kTkZpbHRlcmluZy5pc0FwcGxpY2FibGUoewogICAgICBuYW1lc3BhY2VkOiBuYW1lc3BhY2UKICAgIH0pICYmIG5hbWVzcGFjZS5sZW5ndGgpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsgLy8gQUtBIHN1YiB0byBldmVyeXRoaW5nCiAgICB9CiAgICByZXR1cm4gbmFtZXNwYWNlOwogIH0sCiAgdmFsaWRDaGFuZ2U6IGZ1bmN0aW9uIHZhbGlkQ2hhbmdlKF9yZWYsIHR5cGUsIGRhdGEpIHsKICAgIHZhciBnZXR0ZXJzID0gX3JlZi5nZXR0ZXJzLAogICAgICByb290R2V0dGVycyA9IF9yZWYucm9vdEdldHRlcnM7CiAgICB2YXIgaGF2ZU5hbWVzcGFjZSA9IGdldHRlcnMuaGF2ZU5hbWVzcGFjZSh0eXBlKTsKICAgIGlmIChoYXZlTmFtZXNwYWNlICE9PSBudWxsICYmIGhhdmVOYW1lc3BhY2UgIT09IHZvaWQgMCAmJiBoYXZlTmFtZXNwYWNlLmxlbmd0aCkgewogICAgICB2YXIgbmFtZXNwYWNlcyA9IHJvb3RHZXR0ZXJzLmFjdGl2ZU5hbWVzcGFjZUNhY2hlOwogICAgICBpZiAoIW5hbWVzcGFjZXNbZGF0YS5tZXRhZGF0YS5uYW1lc3BhY2VdKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9LAogIHZhbGlkYXRlQmF0Y2hDaGFuZ2U6IGZ1bmN0aW9uIHZhbGlkYXRlQmF0Y2hDaGFuZ2UoX3JlZjIsIGJhdGNoKSB7CiAgICB2YXIgZ2V0dGVycyA9IF9yZWYyLmdldHRlcnMsCiAgICAgIHJvb3RHZXR0ZXJzID0gX3JlZjIucm9vdEdldHRlcnM7CiAgICB2YXIgbmFtZXNwYWNlcyA9IHJvb3RHZXR0ZXJzLmFjdGl2ZU5hbWVzcGFjZUNhY2hlOwogICAgT2JqZWN0LmVudHJpZXMoYmF0Y2gpLmZvckVhY2goZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgIHZhciBfc2NoZW1hJGF0dHJpYnV0ZXM7CiAgICAgIHZhciBfcmVmNCA9IF9zbGljZWRUb0FycmF5KF9yZWYzLCAyKSwKICAgICAgICB0eXBlID0gX3JlZjRbMF0sCiAgICAgICAgZW50cmllcyA9IF9yZWY0WzFdOwogICAgICB2YXIgaGF2ZU5hbWVzcGFjZSA9IGdldHRlcnMuaGF2ZU5hbWVzcGFjZSh0eXBlKTsKICAgICAgaWYgKCEoaGF2ZU5hbWVzcGFjZSAhPT0gbnVsbCAmJiBoYXZlTmFtZXNwYWNlICE9PSB2b2lkIDAgJiYgaGF2ZU5hbWVzcGFjZS5sZW5ndGgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBzY2hlbWEgPSBnZXR0ZXJzLnNjaGVtYUZvcih0eXBlKTsKICAgICAgaWYgKCEoc2NoZW1hICE9PSBudWxsICYmIHNjaGVtYSAhPT0gdm9pZCAwICYmIChfc2NoZW1hJGF0dHJpYnV0ZXMgPSBzY2hlbWEuYXR0cmlidXRlcykgIT09IG51bGwgJiYgX3NjaGVtYSRhdHRyaWJ1dGVzICE9PSB2b2lkIDAgJiYgX3NjaGVtYSRhdHRyaWJ1dGVzLm5hbWVzcGFjZWQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIE9iamVjdC5rZXlzKGVudHJpZXMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgdmFyIG5hbWVzcGFjZSA9IGlkLnNwbGl0KCcvJylbMF07CiAgICAgICAgaWYgKCFuYW1lc3BhY2UgfHwgIW5hbWVzcGFjZXNbbmFtZXNwYWNlXSkgewogICAgICAgICAgZGVsZXRlIGVudHJpZXNbaWRdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBiYXRjaDsKICB9Cn07CmZ1bmN0aW9uIHF1ZXVlQ2hhbmdlKF9yZWY1LCBfcmVmNiwgbG9hZCwgbGFiZWwpIHsKICB2YXIgZ2V0dGVycyA9IF9yZWY1LmdldHRlcnMsCiAgICBzdGF0ZSA9IF9yZWY1LnN0YXRlLAogICAgcm9vdEdldHRlcnMgPSBfcmVmNS5yb290R2V0dGVyczsKICB2YXIgZGF0YSA9IF9yZWY2LmRhdGEsCiAgICByZXZpc2lvbiA9IF9yZWY2LnJldmlzaW9uOwogIHZhciB0eXBlID0gZ2V0dGVycy5ub3JtYWxpemVUeXBlKGRhdGEudHlwZSk7CiAgdmFyIGVudHJ5ID0gZ2V0dGVycy50eXBlRW50cnkodHlwZSk7CiAgaWYgKGVudHJ5KSB7CiAgICBlbnRyeS5yZXZpc2lvbiA9IE1hdGgubWF4KGVudHJ5LnJldmlzaW9uLCBwYXJzZUludChyZXZpc2lvbiwgMTApKTsKICB9IGVsc2UgewogICAgcmV0dXJuOwogIH0KCiAgLy8gY29uc29sZS5sb2coYCR7IGxhYmVsIH0gRXZlbnQgWyR7IHN0YXRlLmNvbmZpZy5uYW1lc3BhY2UgfV1gLCBkYXRhLnR5cGUsIGRhdGEuaWQpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgaWYgKCFuYW1lc3BhY2VIYW5kbGVyLnZhbGlkQ2hhbmdlKHsKICAgIGdldHRlcnM6IGdldHRlcnMsCiAgICByb290R2V0dGVyczogcm9vdEdldHRlcnMKICB9LCB0eXBlLCBkYXRhKSkgewogICAgcmV0dXJuOwogIH0KICBpZiAobG9hZCkgewogICAgc3RhdGUucXVldWUucHVzaCh7CiAgICAgIGFjdGlvbjogJ2Rpc3BhdGNoJywKICAgICAgZXZlbnQ6ICdsb2FkJywKICAgICAgYm9keTogZGF0YQogICAgfSk7CiAgfSBlbHNlIHsKICAgIHZhciBvYmogPSBnZXR0ZXJzLmJ5SWQoZGF0YS50eXBlLCBkYXRhLmlkKTsKICAgIGlmIChvYmopIHsKICAgICAgc3RhdGUucXVldWUucHVzaCh7CiAgICAgICAgYWN0aW9uOiAnY29tbWl0JywKICAgICAgICBldmVudDogJ3JlbW92ZScsCiAgICAgICAgYm9keTogb2JqCiAgICAgIH0pOwogICAgfQogICAgaWYgKHR5cGUgPT09IFNDSEVNQSkgewogICAgICAvLyBDbGVhciB0aGUgY3VycmVudCByZWNvcmRzIGluIHRoZSBzdG9yZSB3aGVuIGEgdHlwZSBkaXNhcHBlYXJzCiAgICAgIHN0YXRlLnF1ZXVlLnB1c2goewogICAgICAgIGFjdGlvbjogJ2NvbW1pdCcsCiAgICAgICAgZXZlbnQ6ICdmb3JnZXRUeXBlJywKICAgICAgICBib2R5OiBkYXRhLmlkCiAgICAgIH0pOwogICAgfQogIH0KfQpmdW5jdGlvbiBncm93bHNEaXNhYmxlZChyb290R2V0dGVycykgewogIHZhciBfZ2V0UGVyZm9ybWFuY2VTZXR0aW47CiAgcmV0dXJuIChfZ2V0UGVyZm9ybWFuY2VTZXR0aW4gPSBnZXRQZXJmb3JtYW5jZVNldHRpbmcocm9vdEdldHRlcnMpKSA9PT0gbnVsbCB8fCBfZ2V0UGVyZm9ybWFuY2VTZXR0aW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nZXRQZXJmb3JtYW5jZVNldHRpbi5kaXNhYmxlV2Vic29ja2V0Tm90aWZpY2F0aW9uOwp9CgovKioKICogQWN0aW9ucyB0aGF0IGNvdmVyIGFsbCBjYXNlcyAoc2VlIGZpbGUgZGVzY3JpcHRpb24pCiAqLwp2YXIgc2hhcmVkQWN0aW9ucyA9IHsKICBzdWJzY3JpYmU6IGZ1bmN0aW9uIHN1YnNjcmliZShjdHgsIG9wdCkgewogICAgdmFyIF90aGlzID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciBfcm9vdEdldHRlcnMkaXNTaW5nbGU7CiAgICAgIHZhciBzdGF0ZSwgY29tbWl0LCBkaXNwYXRjaCwgZ2V0dGVycywgcm9vdEdldHRlcnMsIHNvY2tldCwgdXJsLCBtYXhUcmllcywgbWV0YWRhdGE7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0YXRlID0gY3R4LnN0YXRlLCBjb21taXQgPSBjdHguY29tbWl0LCBkaXNwYXRjaCA9IGN0eC5kaXNwYXRjaCwgZ2V0dGVycyA9IGN0eC5nZXR0ZXJzLCByb290R2V0dGVycyA9IGN0eC5yb290R2V0dGVyczsgLy8gVG9EbzogbmVlZCB0byBrZWVwIHRoZSB3b3JrZXIgdXAgdG8gZGF0ZSBvbiBDU1JGIGNvb2tpZQogICAgICAgICAgICBpZiAoISgoX3Jvb3RHZXR0ZXJzJGlzU2luZ2xlID0gcm9vdEdldHRlcnNbJ2lzU2luZ2xlUHJvZHVjdCddKSAhPT0gbnVsbCAmJiBfcm9vdEdldHRlcnMkaXNTaW5nbGUgIT09IHZvaWQgMCAmJiBfcm9vdEdldHRlcnMkaXNTaW5nbGUuZGlzYWJsZVN0ZXZlU29ja2V0cykpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgc29ja2V0ID0gc3RhdGUuc29ja2V0OwogICAgICAgICAgICBjb21taXQoJ3NldFdhbnRTb2NrZXQnLCB0cnVlKTsKICAgICAgICAgICAgaWYgKCFwcm9jZXNzLnNlcnZlcikgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlN1YnNjcmliZSBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIikpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgdXJsID0gIiIuY29uY2F0KHN0YXRlLmNvbmZpZy5iYXNlVXJsLCAiL3N1YnNjcmliZSIpOwogICAgICAgICAgICBtYXhUcmllcyA9IGdyb3dsc0Rpc2FibGVkKHJvb3RHZXR0ZXJzKSA/IG51bGwgOiAzOwogICAgICAgICAgICBtZXRhZGF0YSA9IGdldChvcHQsICdtZXRhZGF0YScpOwogICAgICAgICAgICBpZiAoIWlzQWR2YW5jZWRXb3JrZXIoY3R4KSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3RoaXMuJHdvcmtlcnNbZ2V0dGVycy5zdG9yZU5hbWVdKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVdvcmtlcihfdGhpcywgY3R4KTsKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIC8vIGlmIHRoZSB3b3JrZXIgaXMgaW4gYWR2YW5jZWQgbW9kZSB0aGVuIGl0J2xsIGNvbnRhaW4gaXQncyBvd24gc29ja2V0IHdoaWNoIGl0IGNhbGxzIGEgJ3dhdGNoZXInCiAgICAgICAgICAgIF90aGlzLiR3b3JrZXJzW2dldHRlcnMuc3RvcmVOYW1lXS5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgY3JlYXRlV2F0Y2hlcjogewogICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLAogICAgICAgICAgICAgICAgdXJsOiAiIi5jb25jYXQoc3RhdGUuY29uZmlnLmJhc2VVcmwsICIvc3Vic2NyaWJlIiksCiAgICAgICAgICAgICAgICBjc3JmOiBfdGhpcy4kY29va2llcy5nZXQoQ1NSRiwgewogICAgICAgICAgICAgICAgICBwYXJzZUpTT046IGZhbHNlCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG1heFRyaWVzOiBtYXhUcmllcwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxOTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICBpZiAoc29ja2V0KSB7CiAgICAgICAgICAgICAgc29ja2V0LnNldEF1dG9SZWNvbm5lY3QodHJ1ZSk7CiAgICAgICAgICAgICAgc29ja2V0LnNldFVybCh1cmwpOwogICAgICAgICAgICAgIHNvY2tldC5jb25uZWN0KG1ldGFkYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzb2NrZXQgPSBuZXcgU29ja2V0KCIiLmNvbmNhdChzdGF0ZS5jb25maWcuYmFzZVVybCwgIi9zdWJzY3JpYmUiKSwgdHJ1ZSwgbnVsbCwgbnVsbCwgbWF4VHJpZXMpOwogICAgICAgICAgICAgIGNvbW1pdCgnc2V0U29ja2V0Jywgc29ja2V0KTsKICAgICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9DT05ORUNURUQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgnb3BlbmVkJywgZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfRElTQ09OTkVDVEVELCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZGlzcGF0Y2goJ2Nsb3NlZCcsIGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKEVWRU5UX0NPTk5FQ1RfRVJST1IsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgnZXJyb3InLCBlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9ESVNDT05ORUNUX0VSUk9SLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZGlzcGF0Y2goJ2Vycm9yJywgZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfTUVTU0FHRSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHZhciBldmVudCA9IGUuZGV0YWlsOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEpIHsKICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgICAgICAgICAgIGlmIChtc2cubmFtZSkgewogICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKCJ3cy4iLmNvbmNhdChtc2cubmFtZSksIG1zZyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzb2NrZXQuY29ubmVjdChtZXRhZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkoKTsKICB9LAogIHVuc3Vic2NyaWJlOiBmdW5jdGlvbiB1bnN1YnNjcmliZShfcmVmNykgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICB2YXIgY29tbWl0ID0gX3JlZjcuY29tbWl0LAogICAgICBnZXR0ZXJzID0gX3JlZjcuZ2V0dGVycywKICAgICAgc3RhdGUgPSBfcmVmNy5zdGF0ZTsKICAgIHZhciBzb2NrZXQgPSBzdGF0ZS5zb2NrZXQ7CiAgICBjb21taXQoJ3NldFdhbnRTb2NrZXQnLCBmYWxzZSk7CiAgICB2YXIgY2xlYW51cFRhc2tzID0gW107CiAgICB2YXIgd29ya2VyID0gKHRoaXMuJHdvcmtlcnMgfHwge30pW2dldHRlcnMuc3RvcmVOYW1lXTsKICAgIGlmICh3b3JrZXIpIHsKICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICBkZXN0cm95V29ya2VyOiB0cnVlCiAgICAgIH0pOyAvLyB3ZSdyZSBvbmx5IHBhc3NpbmcgdGhlIGJvb2xlYW4gaGVyZSBiZWNhdXNlIHRoZSBrZXkgbmVlZHMgdG8gYmUgc29tZXRoaW5nIHRydXRoeSB0byBlbnN1cmUgaXQncyBwYXNzZWQgb24gdGhlIG9iamVjdC4KICAgICAgY2xlYW51cFRhc2tzLnB1c2god2FpdEZvcihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICFfdGhpczIuJHdvcmtlcnNbZ2V0dGVycy5zdG9yZU5hbWVdOwogICAgICB9LCAnV29ya2VyIGlzIGRlc3Ryb3llZCcpKTsKICAgIH0KICAgIGlmIChzb2NrZXQpIHsKICAgICAgY2xlYW51cFRhc2tzLnB1c2goc29ja2V0LmRpc2Nvbm5lY3QoKSk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwoY2xlYW51cFRhc2tzKTsKICB9LAogIHdhdGNoOiBmdW5jdGlvbiB3YXRjaChfcmVmOCwgcGFyYW1zKSB7CiAgICB2YXIgX3RoaXMkJHdvcmtlcnM7CiAgICB2YXIgc3RhdGUgPSBfcmVmOC5zdGF0ZSwKICAgICAgZGlzcGF0Y2ggPSBfcmVmOC5kaXNwYXRjaCwKICAgICAgZ2V0dGVycyA9IF9yZWY4LmdldHRlcnMsCiAgICAgIHJvb3RHZXR0ZXJzID0gX3JlZjgucm9vdEdldHRlcnM7CiAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIldhdGNoIFJlcXVlc3QgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgdmFyIHR5cGUgPSBwYXJhbXMudHlwZSwKICAgICAgc2VsZWN0b3IgPSBwYXJhbXMuc2VsZWN0b3IsCiAgICAgIGlkID0gcGFyYW1zLmlkLAogICAgICByZXZpc2lvbiA9IHBhcmFtcy5yZXZpc2lvbiwKICAgICAgbmFtZXNwYWNlID0gcGFyYW1zLm5hbWVzcGFjZSwKICAgICAgc3RvcCA9IHBhcmFtcy5zdG9wLAogICAgICBmb3JjZSA9IHBhcmFtcy5mb3JjZTsKICAgIG5hbWVzcGFjZSA9IG5hbWVzcGFjZUhhbmRsZXIuc3Vic2NyaWJlTmFtZXNwYWNlKG5hbWVzcGFjZSk7CiAgICB0eXBlID0gZ2V0dGVycy5ub3JtYWxpemVUeXBlKHR5cGUpOwogICAgaWYgKHJvb3RHZXR0ZXJzWyd0eXBlLW1hcC9pc1Nwb29mZWQnXSh0eXBlKSkgewogICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oJ1dpbGwgbm90IFdhdGNoICh0eXBlIGlzIHNwb29mZWQpJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIElmIHNvY2tldCBpcyBpbiBlcnJvciBkb24ndCB0cnkgdG8gd2F0Y2guLi4uIHVubGVzcyB3ZSBgZm9yY2VgIGl0CiAgICB2YXIgaW5FcnJvciA9IGdldHRlcnMuaW5FcnJvcihwYXJhbXMpOwogICAgaWYgKCFzdG9wICYmICFmb3JjZSAmJiBpbkVycm9yKSB7CiAgICAgIC8vIFJFVklTSU9OX1RPT19PTEQgaXMgYSB0ZW1wb3Jhcnkgc3RhdGUgYW5kIHdpbGwgYmUgaGFuZGxlZCB3aGVuIGByZXN5bmNXYXRjaGAgY29tcGxldGVzCiAgICAgIGlmIChpbkVycm9yICE9PSBSRVZJU0lPTl9UT09fT0xEKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiQWJvcnRpbmcgV2F0Y2ggUmVxdWVzdCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdLiBXYXRjaGVyIGluIGVycm9yICgiKS5jb25jYXQoaW5FcnJvciwgIikiKSwgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghc3RvcCAmJiBnZXR0ZXJzLndhdGNoU3RhcnRlZCh7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGlkOiBpZCwKICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yLAogICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZQogICAgfSkpIHsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5kZWJ1ZygiQWxyZWFkeSBXYXRjaGluZyBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIHsKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIGlkOiBpZCwKICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3IsCiAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0eXBlb2YgcmV2aXNpb24gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHJldmlzaW9uID0gZ2V0dGVycy5uZXh0UmVzb3VyY2VWZXJzaW9uKHR5cGUsIGlkKTsKICAgIH0KICAgIHZhciBtc2cgPSB7CiAgICAgIHJlc291cmNlVHlwZTogdHlwZQogICAgfTsKICAgIGlmIChyZXZpc2lvbikgewogICAgICBtc2cucmVzb3VyY2VWZXJzaW9uID0gIiIuY29uY2F0KHJldmlzaW9uKTsKICAgIH0KICAgIGlmIChuYW1lc3BhY2UpIHsKICAgICAgbXNnLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKICAgIH0KICAgIGlmIChzdG9wKSB7CiAgICAgIG1zZy5zdG9wID0gdHJ1ZTsKICAgIH0KICAgIGlmIChpZCkgewogICAgICBtc2cuaWQgPSBpZDsKICAgIH0KICAgIGlmIChzZWxlY3RvcikgewogICAgICBtc2cuc2VsZWN0b3IgPSBzZWxlY3RvcjsKICAgIH0KICAgIHZhciB3b3JrZXIgPSAoKF90aGlzJCR3b3JrZXJzID0gdGhpcy4kd29ya2VycykgPT09IG51bGwgfHwgX3RoaXMkJHdvcmtlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJCR3b3JrZXJzW2dldHRlcnMuc3RvcmVOYW1lXSkgfHwge307CiAgICBpZiAod29ya2VyLm1vZGUgPT09IFdPUktFUl9NT0RFUy5BRFZBTkNFRCB8fCB3b3JrZXIubW9kZSA9PT0gV09SS0VSX01PREVTLldBSVRJTkcpIHsKICAgICAgaWYgKGZvcmNlKSB7CiAgICAgICAgbXNnLmZvcmNlID0gdHJ1ZTsKICAgICAgfQogICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgIHdhdGNoOiBtc2cKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHJldHVybiBkaXNwYXRjaCgnc2VuZCcsIG1zZyk7CiAgfSwKICB1bndhdGNoOiBmdW5jdGlvbiB1bndhdGNoKGN0eCwgX3JlZjkpIHsKICAgIHZhciB0eXBlID0gX3JlZjkudHlwZSwKICAgICAgaWQgPSBfcmVmOS5pZCwKICAgICAgbmFtZXNwYWNlID0gX3JlZjkubmFtZXNwYWNlLAogICAgICBzZWxlY3RvciA9IF9yZWY5LnNlbGVjdG9yOwogICAgdmFyIGNvbW1pdCA9IGN0eC5jb21taXQsCiAgICAgIGdldHRlcnMgPSBjdHguZ2V0dGVycywKICAgICAgZGlzcGF0Y2ggPSBjdHguZGlzcGF0Y2g7CiAgICBpZiAoZ2V0dGVyc1snc2NoZW1hRm9yJ10odHlwZSkpIHsKICAgICAgbmFtZXNwYWNlID0gbmFtZXNwYWNlSGFuZGxlci5zdWJzY3JpYmVOYW1lc3BhY2UobmFtZXNwYWNlKTsKICAgICAgdmFyIG9iaiA9IHsKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIGlkOiBpZCwKICAgICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZSwKICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3IsCiAgICAgICAgc3RvcDogdHJ1ZSAvLyBTdG9wcyB0aGUgd2F0Y2ggb24gYSB0eXBlCiAgICAgIH07CiAgICAgIGlmIChpc0FkdmFuY2VkV29ya2VyKGN0eCkpIHsKICAgICAgICBkaXNwYXRjaCgnd2F0Y2gnLCBvYmopOyAvLyBBc2sgdGhlIGJhY2tlbmQgdG8gc3RvcCB3YXRjaGluZyB0aGUgdHlwZQogICAgICB9IGVsc2UgaWYgKGdldHRlcnNbJ3dhdGNoU3RhcnRlZCddKG9iaikpIHsKICAgICAgICAvLyBTZXQgdGhhdCB3ZSBkb24ndCB3YW50IHRvIHdhdGNoIHRoaXMgdHlwZQogICAgICAgIC8vIE90aGVyd2lzZSwgdGhlIGRpc3BhdGNoIHRvIHVud2F0Y2ggYmVsb3cgd2lsbCBqdXN0IGNhdXNlIGEgcmUtd2F0Y2ggd2hlbiB3ZQogICAgICAgIC8vIGRldGVjdCB0aGUgc3RvcCBtZXNzYWdlIGZyb20gdGhlIGJhY2tlbmQgb3ZlciB0aGUgd2ViIHNvY2tldAogICAgICAgIGNvbW1pdCgnc2V0V2F0Y2hTdG9wcGVkJywgb2JqKTsKICAgICAgICBkaXNwYXRjaCgnd2F0Y2gnLCBvYmopOyAvLyBBc2sgdGhlIGJhY2tlbmQgdG8gc3RvcCB3YXRjaGluZyB0aGUgdHlwZQogICAgICAgIC8vIE1ha2Ugc3VyZSBhbnl0aGluZyBpbiB0aGUgcGVuZGluZyBxdWV1ZSBmb3IgdGhlIHR5cGUgaXMgcmVtb3ZlZCwgc2luY2Ugd2UndmUgbm93IHJlbW92ZWQgdGhlIHR5cGUKICAgICAgICBjb21taXQoJ2NsZWFyRnJvbVF1ZXVlJywgdHlwZSk7CiAgICAgIH0KICAgIH0KICB9LAogICd3cy5waW5nJzogZnVuY3Rpb24gd3NQaW5nKF9yZWYxMCwgbXNnKSB7CiAgICB2YXIgZ2V0dGVycyA9IF9yZWYxMC5nZXR0ZXJzLAogICAgICBkaXNwYXRjaCA9IF9yZWYxMC5kaXNwYXRjaDsKICAgIGlmIChnZXR0ZXJzLnN0b3JlTmFtZSA9PT0gJ21hbmFnZW1lbnQnKSB7CiAgICAgIHZhciBfbXNnJGRhdGE7CiAgICAgIHZhciB2ZXJzaW9uID0gKG1zZyA9PT0gbnVsbCB8fCBtc2cgPT09IHZvaWQgMCB8fCAoX21zZyRkYXRhID0gbXNnLmRhdGEpID09PSBudWxsIHx8IF9tc2ckZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21zZyRkYXRhLnZlcnNpb24pIHx8IG51bGw7CiAgICAgIGRpc3BhdGNoKCd1cGRhdGVTZXJ2ZXJWZXJzaW9uJywgdmVyc2lvbiwgewogICAgICAgIHJvb3Q6IHRydWUKICAgICAgfSk7CiAgICAgIGNvbnNvbGUuaW5mbygiUGluZyBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIGZyb20gIikuY29uY2F0KHZlcnNpb24gfHwgJ3Vua25vd24gdmVyc2lvbicpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICB9CiAgfQp9OwoKLyoqCiAqIE11dGF0aW9ucyB0aGF0IGNvdmVyIGFsbCBjYXNlcyAoYm90aCBzdWJzY3JpcHRpb25zIGhlcmUgYW5kIGluIGFkdmFuY2VkIHdvcmtlcikKICovCnZhciBzaGFyZWRNdXRhdGlvbnMgPSB7CiAgZGVidWc6IGZ1bmN0aW9uIGRlYnVnKHN0YXRlLCBvbiwgc3RvcmUpIHsKICAgIHN0YXRlLmRlYnVnU29ja2V0ID0gb24gIT09IGZhbHNlOwogICAgaWYgKHN0b3JlICYmIHRoaXMuJHdvcmtlcnNbc3RvcmVdKSB7CiAgICAgIHRoaXMuJHdvcmtlcnNbc3RvcmVdLnBvc3RNZXNzYWdlKHsKICAgICAgICB0b2dnbGVEZWJ1Zzogb24gIT09IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0KfTsKCi8qKgogKiBBY3Rpb25zIHRoYXQgY292ZXIgY2FzZXMgMSAmIDIgKHNlZSBmaWxlIGRlc2NyaXB0aW9uKQogKi8KdmFyIGRlZmF1bHRBY3Rpb25zID0gewogIGZsdXNoOiBmdW5jdGlvbiBmbHVzaChfcmVmMTEpIHsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICB2YXIgc3RhdGUsIGNvbW1pdCwgZGlzcGF0Y2gsIGdldHRlcnMsIHF1ZXVlLCB0b0xvYWQsIHN0YXJ0ZWQsIF9pdGVyYXRvciwgX3N0ZXAsIF9zdGVwJHZhbHVlLCBhY3Rpb24sIGV2ZW50LCBib2R5OwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc3RhdGUgPSBfcmVmMTEuc3RhdGUsIGNvbW1pdCA9IF9yZWYxMS5jb21taXQsIGRpc3BhdGNoID0gX3JlZjExLmRpc3BhdGNoLCBnZXR0ZXJzID0gX3JlZjExLmdldHRlcnM7CiAgICAgICAgICAgIHF1ZXVlID0gc3RhdGUucXVldWU7CiAgICAgICAgICAgIHRvTG9hZCA9IFtdOwogICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgc3RhcnRlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICBzdGF0ZS5xdWV1ZSA9IFtdOwogICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmRlYnVnKCJTdWJzY3JpYmUgRmx1c2ggWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBxdWV1ZS5sZW5ndGgsICdpdGVtcycpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocXVldWUpOwogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDk7CiAgICAgICAgICAgIF9pdGVyYXRvci5zKCk7CiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBpZiAoKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3N0ZXAkdmFsdWUgPSBfc3RlcC52YWx1ZSwgYWN0aW9uID0gX3N0ZXAkdmFsdWUuYWN0aW9uLCBldmVudCA9IF9zdGVwJHZhbHVlLmV2ZW50LCBib2R5ID0gX3N0ZXAkdmFsdWUuYm9keTsKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnZGlzcGF0Y2gnICYmIGV2ZW50ID09PSAnbG9hZCcpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBHcm91cCBsb2FkcyBpbnRvIG9uZSBsb2FkTXVsdGkgd2hlbiBwb3NzaWJsZQogICAgICAgICAgICB0b0xvYWQucHVzaChib2R5KTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICBpZiAoIXRvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjA7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnbG9hZE11bHRpJywgdG9Mb2FkKTsKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHRvTG9hZCA9IFtdOwogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnZGlzcGF0Y2gnKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyNDsKICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKGV2ZW50LCBib2R5KTsKICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnY29tbWl0JykpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDMwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbW1pdChldmVudCwgYm9keSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHF1ZXVlZCBhY3Rpb24nKTsKICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzODsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDM1OwogICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oOSk7CiAgICAgICAgICAgIF9pdGVyYXRvci5lKF9jb250ZXh0Mi50MCk7CiAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDM4OwogICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmZpbmlzaCgzOCk7CiAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICBpZiAoIXRvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDQ7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnbG9hZE11bHRpJywgdG9Mb2FkKTsKICAgICAgICAgIGNhc2UgNDQ6CiAgICAgICAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuZGVidWcoIlN1YnNjcmliZSBGbHVzaCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIGZpbmlzaGVkIiksIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhcnRlZCwgJ21zJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgICAgICAgY2FzZSA0NToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbOSwgMzUsIDM4LCA0MV1dKTsKICAgIH0pKSgpOwogIH0sCiAgcmVoeWRyYXRlU3Vic2NyaWJlOiBmdW5jdGlvbiByZWh5ZHJhdGVTdWJzY3JpYmUoX3JlZjEyKSB7CiAgICB2YXIgc3RhdGUgPSBfcmVmMTIuc3RhdGUsCiAgICAgIGRpc3BhdGNoID0gX3JlZjEyLmRpc3BhdGNoOwogICAgaWYgKHByb2Nlc3MuY2xpZW50ICYmIHN0YXRlLndhbnRTb2NrZXQgJiYgIXN0YXRlLnNvY2tldCkgewogICAgICBkaXNwYXRjaCgnc3Vic2NyaWJlJyk7CiAgICB9CiAgfSwKICByZWNvbm5lY3RXYXRjaGVzOiBmdW5jdGlvbiByZWNvbm5lY3RXYXRjaGVzKF9yZWYxMykgewogICAgdmFyIHN0YXRlID0gX3JlZjEzLnN0YXRlLAogICAgICBnZXR0ZXJzID0gX3JlZjEzLmdldHRlcnMsCiAgICAgIGNvbW1pdCA9IF9yZWYxMy5jb21taXQsCiAgICAgIGRpc3BhdGNoID0gX3JlZjEzLmRpc3BhdGNoOwogICAgdmFyIHByb21pc2VzID0gW107CiAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHN0YXRlLnN0YXJ0ZWQuc2xpY2UoKSksCiAgICAgIF9zdGVwMjsKICAgIHRyeSB7CiAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgdmFyIGVudHJ5ID0gX3N0ZXAyLnZhbHVlOwogICAgICAgIGNvbnNvbGUuaW5mbygiUmVjb25uZWN0IFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgSlNPTi5zdHJpbmdpZnkoZW50cnkpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICAgIGlmIChnZXR0ZXJzLnNjaGVtYUZvcihlbnRyeS50eXBlKSkgewogICAgICAgICAgY29tbWl0KCdzZXRXYXRjaFN0b3BwZWQnLCBlbnRyeSk7CiAgICAgICAgICBkZWxldGUgZW50cnkucmV2aXNpb247CiAgICAgICAgICBwcm9taXNlcy5wdXNoKGRpc3BhdGNoKCd3YXRjaCcsIGVudHJ5KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICB9IGZpbmFsbHkgewogICAgICBfaXRlcmF0b3IyLmYoKTsKICAgIH0KICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgfSwKICByZXN5bmNXYXRjaDogZnVuY3Rpb24gcmVzeW5jV2F0Y2goX3JlZjE0LCBwYXJhbXMpIHsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICB2YXIgc3RhdGUsIGdldHRlcnMsIGRpc3BhdGNoLCBjb21taXQsIHJlc291cmNlVHlwZSwgbmFtZXNwYWNlLCBpZCwgc2VsZWN0b3IsIG9wdCwgaGF2ZSwgd2FudCwgd2FudE1hcCwgX2l0ZXJhdG9yMywgX3N0ZXAzLCBvYmosIF9pdGVyYXRvcjQsIF9zdGVwNCwgX29iajsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0YXRlID0gX3JlZjE0LnN0YXRlLCBnZXR0ZXJzID0gX3JlZjE0LmdldHRlcnMsIGRpc3BhdGNoID0gX3JlZjE0LmRpc3BhdGNoLCBjb21taXQgPSBfcmVmMTQuY29tbWl0OwogICAgICAgICAgICByZXNvdXJjZVR5cGUgPSBwYXJhbXMucmVzb3VyY2VUeXBlLCBuYW1lc3BhY2UgPSBwYXJhbXMubmFtZXNwYWNlLCBpZCA9IHBhcmFtcy5pZCwgc2VsZWN0b3IgPSBwYXJhbXMuc2VsZWN0b3I7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygiUmVzeW5jIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgcGFyYW1zKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgIG9wdCA9IHsKICAgICAgICAgICAgICBmb3JjZTogdHJ1ZSwKICAgICAgICAgICAgICBmb3JjZVdhdGNoOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICghaWQpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA3OwogICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goJ2ZpbmQnLCB7CiAgICAgICAgICAgICAgdHlwZTogcmVzb3VyY2VUeXBlLAogICAgICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgICAgICBvcHQ6IG9wdAogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgY29tbWl0KCdjbGVhckluRXJyb3InLCBwYXJhbXMpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhhdmUgPSBnZXR0ZXJzWydtYXRjaGluZyddKHJlc291cmNlVHlwZSwgc2VsZWN0b3IpLnNsaWNlKCk7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnZmluZE1hdGNoaW5nJywgewogICAgICAgICAgICAgIHR5cGU6IHJlc291cmNlVHlwZSwKICAgICAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3IsCiAgICAgICAgICAgICAgb3B0OiBvcHQKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICB3YW50ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgaGF2ZSA9IGdldHRlcnNbJ2FsbCddKHJlc291cmNlVHlwZSkuc2xpY2UoKTsKICAgICAgICAgICAgaWYgKG5hbWVzcGFjZSkgewogICAgICAgICAgICAgIGhhdmUgPSBoYXZlLmZpbHRlcihmdW5jdGlvbiAoeCkgewogICAgICAgICAgICAgICAgdmFyIF94JG1ldGFkYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuICgoX3gkbWV0YWRhdGEgPSB4Lm1ldGFkYXRhKSA9PT0gbnVsbCB8fCBfeCRtZXRhZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3gkbWV0YWRhdGEubmFtZXNwYWNlKSA9PT0gbmFtZXNwYWNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjA7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnZmluZEFsbCcsIHsKICAgICAgICAgICAgICB0eXBlOiByZXNvdXJjZVR5cGUsCiAgICAgICAgICAgICAgd2F0Y2hOYW1lc3BhY2U6IG5hbWVzcGFjZSwKICAgICAgICAgICAgICBvcHQ6IG9wdAogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHdhbnQgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIHdhbnRNYXAgPSB7fTsKICAgICAgICAgICAgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHdhbnQpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICAgICAgICB3YW50TWFwW29iai5pZF0gPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGhhdmUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICBfb2JqID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKCF3YW50TWFwW19vYmouaWRdKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygiUmVtb3ZlIHN0YWxlIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgcmVzb3VyY2VUeXBlLCBfb2JqLmlkKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICAgICAgICAgICAgICBjb21taXQoJ3JlbW92ZScsIF9vYmopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNC5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNC5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzKTsKICAgIH0pKSgpOwogIH0sCiAgb3BlbmVkOiBmdW5jdGlvbiBvcGVuZWQoX3JlZjE1LCBldmVudCkgewogICAgdmFyIF90aGlzMyA9IHRoaXM7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgdmFyIF9ldmVudCRkZXRhaWw7CiAgICAgIHZhciBjb21taXQsIGRpc3BhdGNoLCBzdGF0ZSwgZ2V0dGVycywgcm9vdEdldHRlcnMsIHNvY2tldCwgdHJpZXMsIHQsIGRpc2FibGVHcm93bCwgZ3Jvd2xFcnIsIF9pdGVyYXRvcjUsIF9zdGVwNSwgb2JqOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY29tbWl0ID0gX3JlZjE1LmNvbW1pdCwgZGlzcGF0Y2ggPSBfcmVmMTUuZGlzcGF0Y2gsIHN0YXRlID0gX3JlZjE1LnN0YXRlLCBnZXR0ZXJzID0gX3JlZjE1LmdldHRlcnMsIHJvb3RHZXR0ZXJzID0gX3JlZjE1LnJvb3RHZXR0ZXJzOwogICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIldlYlNvY2tldCBPcGVuZWQgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgIHNvY2tldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7CiAgICAgICAgICAgIHRyaWVzID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCB8fCAoX2V2ZW50JGRldGFpbCA9IGV2ZW50LmRldGFpbCkgPT09IG51bGwgfHwgX2V2ZW50JGRldGFpbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2V2ZW50JGRldGFpbC50cmllczsgLy8gaGF2ZSB0byBwdWxsIGl0IG9mZiBvZiB0aGUgZXZlbnQgYmVjYXVzZSB0aGUgc29ja2V0J3MgdHJpZXMgaXMgYWxyZWFkeSByZXNldCB0byAwCiAgICAgICAgICAgIHQgPSByb290R2V0dGVyc1snaTE4bi90J107CiAgICAgICAgICAgIGRpc2FibGVHcm93bCA9IGdyb3dsc0Rpc2FibGVkKHJvb3RHZXR0ZXJzKTsKICAgICAgICAgICAgX3RoaXMzLiRzb2NrZXQgPSBzb2NrZXQ7CiAgICAgICAgICAgIGlmICghc3RhdGUucXVldWUpIHsKICAgICAgICAgICAgICBzdGF0ZS5xdWV1ZSA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc3RhdGUucXVldWVUaW1lcikgewogICAgICAgICAgICAgIHN0YXRlLmZsdXNoUXVldWUgPSAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLnF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKCdmbHVzaCcpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnF1ZXVlVGltZXIgPSBzZXRUaW1lb3V0KHN0YXRlLmZsdXNoUXVldWUsIDEwMDApOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgc3RhdGUuZmx1c2hRdWV1ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc29ja2V0Lmhhc1JlY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goJ3JlY29ubmVjdFdhdGNoZXMnKTsKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIC8vIENoZWNrIGZvciBkaXNjb25uZWN0IG5vdGlmaWNhdGlvbnMgYW5kIGNsZWFyIHRoZW0KICAgICAgICAgICAgZ3Jvd2xFcnIgPSByb290R2V0dGVyc1snZ3Jvd2wvZmluZCddKHsKICAgICAgICAgICAgICBrZXk6ICd1cmwnLAogICAgICAgICAgICAgIHZhbDogc29ja2V0LnVybAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGdyb3dsRXJyKSB7CiAgICAgICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3JlbW92ZScsIGdyb3dsRXJyLmlkLCB7CiAgICAgICAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRyaWVzID4gMSAmJiAhZGlzYWJsZUdyb3dsKSB7CiAgICAgICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3N1Y2Nlc3MnLCB7CiAgICAgICAgICAgICAgICB0aXRsZTogdCgnZ3Jvd2wucmVjb25uZWN0ZWQudGl0bGUnKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHQoJ2dyb3dsLnJlY29ubmVjdGVkLm1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIHVybDogX3RoaXMzLiRzb2NrZXQudXJsLAogICAgICAgICAgICAgICAgICB0cmllczogdHJpZXMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAvLyBUcnkgcmVzZW5kaW5nIGFueSBmcmFtZXMgdGhhdCB3ZXJlIGF0dGVtcHRlZCB0byBiZSBzZW50IHdoaWxlIHRoZSBzb2NrZXQgd2FzIGRvd24sIG9uY2UuCiAgICAgICAgICAgIGlmICghcHJvY2Vzcy5zZXJ2ZXIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoc3RhdGUucGVuZGluZ0ZyYW1lcy5zbGljZSgpKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgICAgb2JqID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICAgICAgICBjb21taXQoJ2RlcXVldWVQZW5kaW5nRnJhbWUnLCBvYmopOwogICAgICAgICAgICAgICAgICBkaXNwYXRjaCgnc2VuZEltbWVkaWF0ZScsIG9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yNS5mKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlNSk7CiAgICB9KSkoKTsKICB9LAogIGNsb3NlZDogZnVuY3Rpb24gY2xvc2VkKF9yZWYxNykgewogICAgdmFyIHN0YXRlID0gX3JlZjE3LnN0YXRlLAogICAgICBnZXR0ZXJzID0gX3JlZjE3LmdldHRlcnM7CiAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIldlYlNvY2tldCBDbG9zZWQgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICBjbGVhclRpbWVvdXQoc3RhdGUucXVldWVUaW1lcik7CiAgICBzdGF0ZS5xdWV1ZVRpbWVyID0gbnVsbDsKICB9LAogIGVycm9yOiBmdW5jdGlvbiBlcnJvcihfcmVmMTgsIGUpIHsKICAgIHZhciBnZXR0ZXJzID0gX3JlZjE4LmdldHRlcnMsCiAgICAgIHN0YXRlID0gX3JlZjE4LnN0YXRlLAogICAgICBkaXNwYXRjaCA9IF9yZWYxOC5kaXNwYXRjaCwKICAgICAgcm9vdEdldHRlcnMgPSBfcmVmMTgucm9vdEdldHRlcnM7CiAgICBjbGVhclRpbWVvdXQoc3RhdGUucXVldWVUaW1lcik7CiAgICBzdGF0ZS5xdWV1ZVRpbWVyID0gbnVsbDsKCiAgICAvLyBkZXRlcm1pbmUgaWYgd2Vic29ja2V0IG5vdGlmaWNhdGlvbnMgYXJlIGRpc2FibGVkCiAgICB2YXIgZGlzYWJsZUdyb3dsID0gZ3Jvd2xzRGlzYWJsZWQocm9vdEdldHRlcnMpOwogICAgaWYgKCFkaXNhYmxlR3Jvd2wpIHsKICAgICAgdmFyIF9lJHNyY0VsZW1lbnQsIF9lJHNyY0VsZW1lbnQyLCBfc3RhdGUkc29ja2V0OwogICAgICB2YXIgZGF0ZUZvcm1hdCA9IGVzY2FwZUh0bWwocm9vdEdldHRlcnNbJ3ByZWZzL2dldCddKERBVEVfRk9STUFUKSk7CiAgICAgIHZhciB0aW1lRm9ybWF0ID0gZXNjYXBlSHRtbChyb290R2V0dGVyc1sncHJlZnMvZ2V0J10oVElNRV9GT1JNQVQpKTsKICAgICAgdmFyIHRpbWUgPSAoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgfHwgKF9lJHNyY0VsZW1lbnQgPSBlLnNyY0VsZW1lbnQpID09PSBudWxsIHx8IF9lJHNyY0VsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lJHNyY0VsZW1lbnQuZGlzY29ubmVjdGVkQXQpIHx8IERhdGUubm93KCk7CiAgICAgIHZhciB0aW1lRm9ybWF0dGVkID0gIiIuY29uY2F0KGRheSh0aW1lKS5mb3JtYXQoIiIuY29uY2F0KGRhdGVGb3JtYXQsICIgIikuY29uY2F0KHRpbWVGb3JtYXQpKSk7CiAgICAgIHZhciB1cmwgPSBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCB8fCAoX2Ukc3JjRWxlbWVudDIgPSBlLnNyY0VsZW1lbnQpID09PSBudWxsIHx8IF9lJHNyY0VsZW1lbnQyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZSRzcmNFbGVtZW50Mi51cmw7CiAgICAgIHZhciB0cmllcyA9IHN0YXRlID09PSBudWxsIHx8IHN0YXRlID09PSB2b2lkIDAgfHwgKF9zdGF0ZSRzb2NrZXQgPSBzdGF0ZS5zb2NrZXQpID09PSBudWxsIHx8IF9zdGF0ZSRzb2NrZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRzb2NrZXQudHJpZXM7CiAgICAgIHZhciB0ID0gcm9vdEdldHRlcnNbJ2kxOG4vdCddOwogICAgICB2YXIgZ3Jvd2xFcnIgPSByb290R2V0dGVyc1snZ3Jvd2wvZmluZCddKHsKICAgICAgICBrZXk6ICd1cmwnLAogICAgICAgIHZhbDogdXJsCiAgICAgIH0pOwogICAgICBpZiAoZS50eXBlID09PSBFVkVOVF9DT05ORUNUX0VSUk9SKSB7CiAgICAgICAgLy8gaWYgdGhpcyBvY2N1cnMsIHRoZW4gd2UncmUgYXQgbGVhc3QgcmV0cnlpbmcgdG8gY29ubmVjdAogICAgICAgIGlmIChncm93bEVycikgewogICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3JlbW92ZScsIGdyb3dsRXJyLmlkLCB7CiAgICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBkaXNwYXRjaCgnZ3Jvd2wvZXJyb3InLCB7CiAgICAgICAgICB0aXRsZTogdCgnZ3Jvd2wuY29ubmVjdEVycm9yLnRpdGxlJyksCiAgICAgICAgICBtZXNzYWdlOiB0KCdncm93bC5jb25uZWN0RXJyb3IubWVzc2FnZScsIHsKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIHRpbWU6IHRpbWVGb3JtYXR0ZWQsCiAgICAgICAgICAgIHRyaWVzOiB0cmllcwogICAgICAgICAgfSwgewogICAgICAgICAgICByYXc6IHRydWUKICAgICAgICAgIH0pLAogICAgICAgICAgaWNvbjogJ2Vycm9yJywKICAgICAgICAgIGVhcmxpZXN0Q2xvc2U6IHRpbWUgKyBNSU5JTVVNX1RJTUVfTk9USUZJRUQsCiAgICAgICAgICB1cmw6IHVybAogICAgICAgIH0sIHsKICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChlLnR5cGUgPT09IEVWRU5UX0RJU0NPTk5FQ1RfRVJST1IpIHsKICAgICAgICAvLyBpZiB0aGlzIG9jY3Vycywgd2UndmUgZ2l2ZW4gdXAgb24gdHJ5aW5nIHRvIHJlY29ubmVjdAogICAgICAgIGlmIChncm93bEVycikgewogICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3JlbW92ZScsIGdyb3dsRXJyLmlkLCB7CiAgICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBkaXNwYXRjaCgnZ3Jvd2wvZXJyb3InLCB7CiAgICAgICAgICB0aXRsZTogdCgnZ3Jvd2wuZGlzY29ubmVjdEVycm9yLnRpdGxlJyksCiAgICAgICAgICBtZXNzYWdlOiB0KCdncm93bC5kaXNjb25uZWN0RXJyb3IubWVzc2FnZScsIHsKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIHRpbWU6IHRpbWVGb3JtYXR0ZWQsCiAgICAgICAgICAgIHRyaWVzOiB0cmllcwogICAgICAgICAgfSwgewogICAgICAgICAgICByYXc6IHRydWUKICAgICAgICAgIH0pLAogICAgICAgICAgaWNvbjogJ2Vycm9yJywKICAgICAgICAgIGVhcmxpZXN0Q2xvc2U6IHRpbWUgKyBNSU5JTVVNX1RJTUVfTk9USUZJRUQsCiAgICAgICAgICB1cmw6IHVybAogICAgICAgIH0sIHsKICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBpZiB0aGUgZXJyb3IgaXMgbm90IGEgY29ubmVjdCBlcnJvciBvciBkaXNjb25uZWN0IGVycm9yLCB0aGUgc29ja2V0IG5ldmVyIHdvcmtlZDogbG9nIHdoZXRoZXIgdGhlIGN1cnJlbnQgYnJvd3NlciBpcyBzYWZhcmkKICAgICAgICBjb25zb2xlLmVycm9yKCJXZWJTb2NrZXQgQ29ubmVjdGlvbiBFcnJvciBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIGUuZGV0YWlsKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgIH0KICAgIH0KICB9LAogIHNlbmQ6IGZ1bmN0aW9uIHNlbmQoX3JlZjE5LCBvYmopIHsKICAgIHZhciBzdGF0ZSA9IF9yZWYxOS5zdGF0ZSwKICAgICAgY29tbWl0ID0gX3JlZjE5LmNvbW1pdDsKICAgIGlmIChzdGF0ZS5zb2NrZXQpIHsKICAgICAgdmFyIG9rID0gc3RhdGUuc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkob2JqKSk7CiAgICAgIGlmIChvaykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29tbWl0KCdlbnF1ZXVlUGVuZGluZ0ZyYW1lJywgb2JqKTsKICB9LAogIHNlbmRJbW1lZGlhdGU6IGZ1bmN0aW9uIHNlbmRJbW1lZGlhdGUoX3JlZjIwLCBvYmopIHsKICAgIHZhciBzdGF0ZSA9IF9yZWYyMC5zdGF0ZTsKICAgIGlmIChzdGF0ZS5zb2NrZXQpIHsKICAgICAgcmV0dXJuIHN0YXRlLnNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KG9iaikpOwogICAgfQogIH0sCiAgLyoqCiAgICogU3RldmUgb25seSBldmVudAogICAqLwogICd3cy5yZXNvdXJjZS5zdGFydCc6IGZ1bmN0aW9uIHdzUmVzb3VyY2VTdGFydChfcmVmMjEsIG1zZykgewogICAgdmFyIHN0YXRlID0gX3JlZjIxLnN0YXRlLAogICAgICBnZXR0ZXJzID0gX3JlZjIxLmdldHRlcnMsCiAgICAgIGNvbW1pdCA9IF9yZWYyMS5jb21taXQsCiAgICAgIGRpc3BhdGNoID0gX3JlZjIxLmRpc3BhdGNoOwogICAgc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5pbmZvKCJSZXNvdXJjZSBzdGFydDogWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBtc2cpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICB2YXIgbmV3V2F0Y2ggPSB7CiAgICAgIHR5cGU6IG1zZy5yZXNvdXJjZVR5cGUsCiAgICAgIG5hbWVzcGFjZTogbXNnLm5hbWVzcGFjZSwKICAgICAgaWQ6IG1zZy5pZCwKICAgICAgc2VsZWN0b3I6IG1zZy5zZWxlY3RvcgogICAgfTsKICAgIHN0YXRlLnN0YXJ0ZWQuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkgewogICAgICBpZiAoZW50cnkudHlwZSA9PT0gbmV3V2F0Y2gudHlwZSAmJiBlbnRyeS5uYW1lc3BhY2UgIT09IG5ld1dhdGNoLm5hbWVzcGFjZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChlbnRyeSkgewogICAgICBkaXNwYXRjaCgndW53YXRjaCcsIGVudHJ5KTsKICAgIH0pOwogICAgY29tbWl0KCdzZXRXYXRjaFN0YXJ0ZWQnLCBuZXdXYXRjaCk7CiAgfSwKICAnd3MucmVzb3VyY2UuZXJyb3InOiBmdW5jdGlvbiB3c1Jlc291cmNlRXJyb3IoX3JlZjIyLCBtc2cpIHsKICAgIHZhciBfbXNnJGRhdGEyOwogICAgdmFyIGdldHRlcnMgPSBfcmVmMjIuZ2V0dGVycywKICAgICAgY29tbWl0ID0gX3JlZjIyLmNvbW1pdCwKICAgICAgZGlzcGF0Y2ggPSBfcmVmMjIuZGlzcGF0Y2g7CiAgICBjb25zb2xlLndhcm4oIlJlc291cmNlIGVycm9yIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgbXNnLnJlc291cmNlVHlwZSwgJzonLCBtc2cuZGF0YS5lcnJvcik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgIHZhciBlcnIgPSAoX21zZyRkYXRhMiA9IG1zZy5kYXRhKSA9PT0gbnVsbCB8fCBfbXNnJGRhdGEyID09PSB2b2lkIDAgfHwgKF9tc2ckZGF0YTIgPSBfbXNnJGRhdGEyLmVycm9yKSA9PT0gbnVsbCB8fCBfbXNnJGRhdGEyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbXNnJGRhdGEyLnRvTG93ZXJDYXNlKCk7CiAgICBpZiAoZXJyLmluY2x1ZGVzKCd3YXRjaCBub3QgYWxsb3dlZCcpKSB7CiAgICAgIGNvbW1pdCgnc2V0SW5FcnJvcicsIHsKICAgICAgICB0eXBlOiBtc2cucmVzb3VyY2VUeXBlLAogICAgICAgIHJlYXNvbjogTk9fV0FUQ0gKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGVyci5pbmNsdWRlcygnZmFpbGVkIHRvIGZpbmQgc2NoZW1hJykpIHsKICAgICAgY29tbWl0KCdzZXRJbkVycm9yJywgewogICAgICAgIHR5cGU6IG1zZy5yZXNvdXJjZVR5cGUsCiAgICAgICAgcmVhc29uOiBOT19TQ0hFTUEKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGVyci5pbmNsdWRlcygndG9vIG9sZCcpKSB7CiAgICAgIC8vIFNldCBhbiBlcnJvciBmb3IgKGFsbCkgc3VicyBvZiB0aGlzIHR5cGUuIFRoaXMuLgogICAgICAvLyAxKSBibG9ja3MgYXR0ZW1wdHMgYnkgcmVzb3VyY2Uuc3RvcCB0byByZXN1YiAoYXMgdHlwZSBpcyBpbiBlcnJvcikKICAgICAgLy8gMikgd2lsbCBiZSBjbGVhcmVkIHdoZW4gcmVzeW5jV2F0Y2ggLS0+IHdhdGNoICh3aXRoIGZvcmNlKSAtLT4gcmVzb3VyY2Uuc3RhcnQgY29tcGxldGVzCiAgICAgIGNvbW1pdCgnc2V0SW5FcnJvcicsIHsKICAgICAgICB0eXBlOiBtc2cucmVzb3VyY2VUeXBlLAogICAgICAgIHJlYXNvbjogUkVWSVNJT05fVE9PX09MRAogICAgICB9KTsKICAgICAgZGlzcGF0Y2goJ3Jlc3luY1dhdGNoJywgbXNnKTsKICAgIH0KICB9LAogIC8qKgogICAqIFN0ZXZlIG9ubHkgZXZlbnQKICAgKgogICAqIFN0ZXZlIGhhcyBzdG9wcGVkIHdhdGNoaW5nIHRoaXMgcmVzb3VyY2UuIFRoaXMgaGFwcGVucyBmb3IgYSBjb3VwbGUgb2YgcmVhc29ucwogICAqIC0gV2UgaGF2ZSByZXF1ZXN0ZWQgdGhhdCB0aGUgcmVzb3VyY2Ugd2F0Y2ggc2hvdWxkIGJlIHN0b3BwZWQgKGFuZCB3ZSByZWNlaXZlIHRoaXMgZXZlbnQgYXMgY29uZmlybWF0aW9uKQogICAqIC0gU3RldmUgdGVsbHMgdXMgdGhhdCB0aGUgcmVzb3VyY2Ugd2F0Y2ggaGFzIGJlZW4gc3RvcHBlZC4gUG9zc2libGUgcmVhc29ucwogICAqICAgLSBUaGUgcmFuY2hlciA8LS0+IGs4cyBzb2NrZXQgY2xvc2VkIChoYXBwZW5zIGV2ZXJ5IH4zMCBtaW5zIG9uIG1nbXQgc29ja2V0KQogICAqICAgLSBQZXJtaXNzaW9ucyBoYXMgY2hhbmdlZCBmb3IgdGhlIHN1YnNjcmliZWQgcmVzb3VyY2UsIHNvIHJhbmNoZXIgY2xvc2VzIHNvY2tldAogICAqLwogICd3cy5yZXNvdXJjZS5zdG9wJzogZnVuY3Rpb24gd3NSZXNvdXJjZVN0b3AoX3JlZjIzLCBtc2cpIHsKICAgIHZhciBzdGF0ZSA9IF9yZWYyMy5zdGF0ZSwKICAgICAgZ2V0dGVycyA9IF9yZWYyMy5nZXR0ZXJzLAogICAgICBjb21taXQgPSBfcmVmMjMuY29tbWl0LAogICAgICBkaXNwYXRjaCA9IF9yZWYyMy5kaXNwYXRjaDsKICAgIHZhciB0eXBlID0gbXNnLnJlc291cmNlVHlwZTsKICAgIHZhciBvYmogPSB7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGlkOiBtc2cuaWQsCiAgICAgIG5hbWVzcGFjZTogbXNnLm5hbWVzcGFjZSwKICAgICAgc2VsZWN0b3I6IG1zZy5zZWxlY3RvcgogICAgfTsKICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygiUmVzb3VyY2UgU3RvcCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIHR5cGUsIG1zZyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgIGlmICghdHlwZSkgewogICAgICBjb25zb2xlLmVycm9yKCJSZXNvdXJjZSBTdG9wIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0uIFJlY2VpdmVkIHJlc291cmNlLnN0b3Agd2l0aCBhbiBlbXB0eSByZXNvdXJjZVR5cGUsIGFib3J0aW5nIiksIG1zZyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIElmIHdlJ3JlIHRyeWluZyB0byB3YXRjaCB0aGlzIGV2ZW50LCBhdHRlbXB0IHRvIHJlLXdhdGNoCiAgICAvLwogICAgLy8gVG8gbWFrZSBsaWZlIGVhc2llciBpbiB0aGUgYWR2YW5jZWQgd29ya2VyIGByZXNvdXJjZS5zdG9wYCAtLT4gYHdhdGNoYCBpcyBoYW5kbGVkIGhlcmUgKGJhc2ljYWxseSBmb3IgYWNjZXNzIHRvIGdldHRlcnMubmV4dFJlc291cmNlVmVyc2lvbikKICAgIC8vIFRoaXMgbWVhbnMgdGhlIGNvbmNlcHQgb2YgcmVzb3VyY2Ugc3ViIHdhdGNoIHN0YXRlIG5lZWRzIG1hc3NhZ2luZwogICAgdmFyIGFkdmFuY2VkV29ya2VyID0gbXNnLmFkdmFuY2VkV29ya2VyOwogICAgdmFyIGxvY2FsU3RhdGUgPSAhYWR2YW5jZWRXb3JrZXI7CiAgICB2YXIgd2F0Y2hTdGFydGVkID0gbG9jYWxTdGF0ZSA/IGdldHRlcnNbJ3dhdGNoU3RhcnRlZCddKG9iaikgOiBhZHZhbmNlZFdvcmtlcjsKICAgIGlmIChnZXR0ZXJzWydzY2hlbWFGb3InXSh0eXBlKSAmJiB3YXRjaFN0YXJ0ZWQpIHsKICAgICAgaWYgKGxvY2FsU3RhdGUpIHsKICAgICAgICBjb21taXQoJ3NldFdhdGNoU3RvcHBlZCcsIG9iaik7CiAgICAgIH0KICAgICAgZGlzcGF0Y2goJ3dhdGNoJywgb2JqKTsKICAgIH0KICB9LAogICd3cy5yZXNvdXJjZS5jcmVhdGUnOiBmdW5jdGlvbiB3c1Jlc291cmNlQ3JlYXRlKGN0eCwgbXNnKSB7CiAgICBjdHguc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5pbmZvKCJSZXNvdXJjZSBDcmVhdGUgWyIuY29uY2F0KGN0eC5nZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgbXNnLnJlc291cmNlVHlwZSwgbXNnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICBxdWV1ZUNoYW5nZShjdHgsIG1zZywgdHJ1ZSwgJ0NyZWF0ZScpOwogIH0sCiAgJ3dzLnJlc291cmNlLmNoYW5nZSc6IGZ1bmN0aW9uIHdzUmVzb3VyY2VDaGFuZ2UoY3R4LCBtc2cpIHsKICAgIHZhciBfdHlwZU9wdGlvbiRhbGlhczsKICAgIHZhciBkYXRhID0gbXNnLmRhdGE7CiAgICB2YXIgdHlwZSA9IGRhdGEudHlwZTsKCiAgICAvLyBXb3JrLWFyb3VuZCBmb3Igd3MuZXJyb3IgbWVzc2FnZXMgYmVpbmcgc2VudCBhcyBjaGFuZ2UgZXZlbnRzCiAgICAvLyBUaGVzZSBoYXZlIG5vIGlkIChvciBvdGhlciBtZXRhZGF0YSkgd2hpY2ggYnJlYWtzIGxvdHMgaWYgdGhleSBhcmUgcHJvY2Vzc2VkIGFzIGNoYW5nZSBldmVudHMKICAgIGlmIChkYXRhLm1lc3NhZ2UgJiYgIWRhdGEuaWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFdlYiB3b3JrZXIgY2FuIHByb2Nlc3Mgc2NoZW1hcyB0byBjaGVjayB0aGF0IHRoZXkgYXJlIGFjdHVhbGx5IGNoYW5naW5nIGFuZAogICAgLy8gb25seSBsb2FkIHVwZGF0ZXMgaWYgdGhlIHNjaGVtYSBkaWQgYWN0dWFsbHkgY2hhbmdlCiAgICBpZiAodHlwZSA9PT0gU0NIRU1BKSB7CiAgICAgIHZhciB3b3JrZXIgPSAodGhpcy4kd29ya2VycyB8fCB7fSlbY3R4LmdldHRlcnMuc3RvcmVOYW1lXTsKICAgICAgaWYgKHdvcmtlcikgewogICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICB1cGRhdGVTY2hlbWE6IGRhdGEKICAgICAgICB9KTsKCiAgICAgICAgLy8gTm8gZnVydGhlciBwcm9jZXNzaW5nIC0gbGV0IHRoZSB3ZWIgd29ya2VyIGNoZWNrIHRoZSBzY2hlbWEgdXBkYXRlcwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgcXVldWVDaGFuZ2UoY3R4LCBtc2csIHRydWUsICdDaGFuZ2UnKTsKICAgIHZhciB0eXBlT3B0aW9uID0gY3R4LnJvb3RHZXR0ZXJzWyd0eXBlLW1hcC9vcHRpb25zRm9yJ10odHlwZSk7CiAgICBpZiAoKHR5cGVPcHRpb24gPT09IG51bGwgfHwgdHlwZU9wdGlvbiA9PT0gdm9pZCAwIHx8IChfdHlwZU9wdGlvbiRhbGlhcyA9IHR5cGVPcHRpb24uYWxpYXMpID09PSBudWxsIHx8IF90eXBlT3B0aW9uJGFsaWFzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHlwZU9wdGlvbiRhbGlhcy5sZW5ndGgpID4gMCkgewogICAgICB2YXIgYWxpYXMgPSAodHlwZU9wdGlvbiA9PT0gbnVsbCB8fCB0eXBlT3B0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0eXBlT3B0aW9uLmFsaWFzKSB8fCBbXTsKICAgICAgYWxpYXMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgY3R4LnN0YXRlLnF1ZXVlLnB1c2goewogICAgICAgICAgYWN0aW9uOiAnZGlzcGF0Y2gnLAogICAgICAgICAgZXZlbnQ6ICdsb2FkJywKICAgICAgICAgIGJvZHk6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgZGF0YSksIHt9LCB7CiAgICAgICAgICAgIHR5cGU6IHR5cGUKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgJ3dzLnJlc291cmNlLnJlbW92ZSc6IGZ1bmN0aW9uIHdzUmVzb3VyY2VSZW1vdmUoY3R4LCBtc2cpIHsKICAgIHZhciBfdHlwZU9wdGlvbiRhbGlhczI7CiAgICB2YXIgZGF0YSA9IG1zZy5kYXRhOwogICAgdmFyIHR5cGUgPSBkYXRhLnR5cGU7CiAgICBjdHguc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5pbmZvKCJSZXNvdXJjZSBSZW1vdmUgWyIuY29uY2F0KGN0eC5nZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgdHlwZSwgbXNnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgaWYgKHR5cGUgPT09IFNDSEVNQSkgewogICAgICB2YXIgd29ya2VyID0gKHRoaXMuJHdvcmtlcnMgfHwge30pW2N0eC5nZXR0ZXJzLnN0b3JlTmFtZV07CiAgICAgIGlmICh3b3JrZXIpIHsKICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgcmVtb3ZlU2NoZW1hOiBkYXRhLmlkCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHF1ZXVlQ2hhbmdlKGN0eCwgbXNnLCBmYWxzZSwgJ1JlbW92ZScpOwogICAgdmFyIHR5cGVPcHRpb24gPSBjdHgucm9vdEdldHRlcnNbJ3R5cGUtbWFwL29wdGlvbnNGb3InXSh0eXBlKTsKICAgIGlmICgodHlwZU9wdGlvbiA9PT0gbnVsbCB8fCB0eXBlT3B0aW9uID09PSB2b2lkIDAgfHwgKF90eXBlT3B0aW9uJGFsaWFzMiA9IHR5cGVPcHRpb24uYWxpYXMpID09PSBudWxsIHx8IF90eXBlT3B0aW9uJGFsaWFzMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3R5cGVPcHRpb24kYWxpYXMyLmxlbmd0aCkgPiAwKSB7CiAgICAgIHZhciBhbGlhcyA9ICh0eXBlT3B0aW9uID09PSBudWxsIHx8IHR5cGVPcHRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHR5cGVPcHRpb24uYWxpYXMpIHx8IFtdOwogICAgICBhbGlhcy5tYXAoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICB2YXIgb2JqID0gY3R4LmdldHRlcnMuYnlJZCh0eXBlLCBkYXRhLmlkKTsKICAgICAgICBjdHguc3RhdGUucXVldWUucHVzaCh7CiAgICAgICAgICBhY3Rpb246ICdjb21taXQnLAogICAgICAgICAgZXZlbnQ6ICdyZW1vdmUnLAogICAgICAgICAgYm9keTogb2JqCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTsKCi8qKgogKiBNdXRhdGlvbnMgdGhhdCBjb3ZlciBjYXNlcyAxICYgMiAoc2VlIGZpbGUgZGVzY3JpcHRpb24pCiAqLwp2YXIgZGVmYXVsdE11dGF0aW9ucyA9IHsKICBzZXRTb2NrZXQ6IGZ1bmN0aW9uIHNldFNvY2tldChzdGF0ZSwgc29ja2V0KSB7CiAgICBzdGF0ZS5zb2NrZXQgPSBzb2NrZXQ7CiAgfSwKICBzZXRXYW50U29ja2V0OiBmdW5jdGlvbiBzZXRXYW50U29ja2V0KHN0YXRlLCB3YW50KSB7CiAgICBzdGF0ZS53YW50U29ja2V0ID0gd2FudDsKICB9LAogIGVucXVldWVQZW5kaW5nRnJhbWU6IGZ1bmN0aW9uIGVucXVldWVQZW5kaW5nRnJhbWUoc3RhdGUsIG9iaikgewogICAgc3RhdGUucGVuZGluZ0ZyYW1lcy5wdXNoKG9iaik7CiAgfSwKICBkZXF1ZXVlUGVuZGluZ0ZyYW1lOiBmdW5jdGlvbiBkZXF1ZXVlUGVuZGluZ0ZyYW1lKHN0YXRlLCBvYmopIHsKICAgIHJlbW92ZU9iamVjdChzdGF0ZS5wZW5kaW5nRnJhbWVzLCBvYmopOwogIH0sCiAgc2V0V2F0Y2hTdGFydGVkOiBmdW5jdGlvbiBzZXRXYXRjaFN0YXJ0ZWQoc3RhdGUsIG9iaikgewogICAgdmFyIGV4aXN0aW5nID0gc3RhdGUuc3RhcnRlZC5maW5kKGZ1bmN0aW9uIChlbnRyeSkgewogICAgICByZXR1cm4gZXF1aXZhbGVudFdhdGNoKG9iaiwgZW50cnkpOwogICAgfSk7CiAgICBpZiAoIWV4aXN0aW5nKSB7CiAgICAgIGFkZE9iamVjdChzdGF0ZS5zdGFydGVkLCBvYmopOwogICAgfQogICAgZGVsZXRlIHN0YXRlLmluRXJyb3Jba2V5Rm9yU3Vic2NyaWJlKG9iaildOwogIH0sCiAgc2V0V2F0Y2hTdG9wcGVkOiBmdW5jdGlvbiBzZXRXYXRjaFN0b3BwZWQoc3RhdGUsIG9iaikgewogICAgdmFyIGV4aXN0aW5nID0gc3RhdGUuc3RhcnRlZC5maW5kKGZ1bmN0aW9uIChlbnRyeSkgewogICAgICByZXR1cm4gZXF1aXZhbGVudFdhdGNoKG9iaiwgZW50cnkpOwogICAgfSk7CiAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgcmVtb3ZlT2JqZWN0KHN0YXRlLnN0YXJ0ZWQsIGV4aXN0aW5nKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUud2FybigiVHJpZWQgdG8gcmVtb3ZlIGEgd2F0Y2ggdGhhdCBkb2Vzbid0IGV4aXN0Iiwgb2JqKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICB9CiAgfSwKICBzZXRJbkVycm9yOiBmdW5jdGlvbiBzZXRJbkVycm9yKHN0YXRlLCBtc2cpIHsKICAgIHZhciBrZXkgPSBrZXlGb3JTdWJzY3JpYmUobXNnKTsKICAgIHN0YXRlLmluRXJyb3Jba2V5XSA9IG1zZy5yZWFzb247CiAgfSwKICBjbGVhckluRXJyb3I6IGZ1bmN0aW9uIGNsZWFySW5FcnJvcihzdGF0ZSwgbXNnKSB7CiAgICB2YXIga2V5ID0ga2V5Rm9yU3Vic2NyaWJlKG1zZyk7CiAgICBkZWxldGUgc3RhdGUuaW5FcnJvcltrZXldOwogIH0sCiAgcmVzZXRTdWJzY3JpcHRpb25zOiBmdW5jdGlvbiByZXNldFN1YnNjcmlwdGlvbnMoc3RhdGUpIHsKICAgIC8vIENsZWFyIG91dCBzb2NrZXQgc3RhdGUuIFRoaXMgaXMgb25seSBldmVyIGNhbGxlZCBmcm9tIHJlc2V0Li4uIHdoaWNoIGlzIGFsd2F5cyBjYWxsZWQgYWZ0ZXIgd2UgYGRpc2Nvbm5lY3RgIGFib3ZlLgogICAgLy8gVGhpcyBjb3VsZCBwcm9iYWJseSBiZSBmb2xkZWQgaW4gdG8gdGhlcmUKICAgIGNsZWFyKHN0YXRlLnN0YXJ0ZWQpOwogICAgY2xlYXIoc3RhdGUucGVuZGluZ0ZyYW1lcyk7CiAgICBjbGVhcihzdGF0ZS5xdWV1ZSk7CiAgICBjbGVhclRpbWVvdXQoc3RhdGUucXVldWVUaW1lcik7CiAgICBzdGF0ZS5kZWZlcnJlZFJlcXVlc3RzID0ge307CiAgICBzdGF0ZS5xdWV1ZVRpbWVyID0gbnVsbDsKICB9LAogIGNsZWFyRnJvbVF1ZXVlOiBmdW5jdGlvbiBjbGVhckZyb21RdWV1ZShzdGF0ZSwgdHlwZSkgewogICAgLy8gUmVtb3ZlIGFueXRoaW5nIGluIHRoZSBxdWV1ZSB0aGF0IGlzIGEgcmVzb3VyY2UgdXBkYXRlIGZvciB0aGUgZ2l2ZW4gdHlwZQogICAgc3RhdGUucXVldWUgPSBzdGF0ZS5xdWV1ZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgdmFyIF9pdGVtJGJvZHk7CiAgICAgIHJldHVybiAoKF9pdGVtJGJvZHkgPSBpdGVtLmJvZHkpID09PSBudWxsIHx8IF9pdGVtJGJvZHkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pdGVtJGJvZHkudHlwZSkgIT09IHR5cGU7CiAgICB9KTsKICB9Cn07CgovKioKICogR2V0dGVycyB0aGF0IGNvdmVyIGNhc2VzIDEgJiAyIChzZWUgZmlsZSBkZXNjcmlwdGlvbikKICovCnZhciBkZWZhdWx0R2V0dGVycyA9IHsKICBpbkVycm9yOiBmdW5jdGlvbiBpbkVycm9yKHN0YXRlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICByZXR1cm4gc3RhdGUuaW5FcnJvcltrZXlGb3JTdWJzY3JpYmUob2JqKV07CiAgICB9OwogIH0sCiAgd2F0Y2hTdGFydGVkOiBmdW5jdGlvbiB3YXRjaFN0YXJ0ZWQoc3RhdGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7CiAgICAgIHJldHVybiAhIXN0YXRlLnN0YXJ0ZWQuZmluZChmdW5jdGlvbiAoZW50cnkpIHsKICAgICAgICByZXR1cm4gZXF1aXZhbGVudFdhdGNoKG9iaiwgZW50cnkpOwogICAgICB9KTsKICAgIH07CiAgfSwKICBuZXh0UmVzb3VyY2VWZXJzaW9uOiBmdW5jdGlvbiBuZXh0UmVzb3VyY2VWZXJzaW9uKHN0YXRlLCBnZXR0ZXJzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHR5cGUsIGlkKSB7CiAgICAgIHR5cGUgPSBub3JtYWxpemVUeXBlKHR5cGUpOwogICAgICB2YXIgcmV2aXNpb24gPSAwOwogICAgICBpZiAoaWQpIHsKICAgICAgICB2YXIgX2V4aXN0aW5nJG1ldGFkYXRhOwogICAgICAgIHZhciBleGlzdGluZyA9IGdldHRlcnNbJ2J5SWQnXSh0eXBlLCBpZCk7CiAgICAgICAgcmV2aXNpb24gPSBwYXJzZUludChleGlzdGluZyA9PT0gbnVsbCB8fCBleGlzdGluZyA9PT0gdm9pZCAwIHx8IChfZXhpc3RpbmckbWV0YWRhdGEgPSBleGlzdGluZy5tZXRhZGF0YSkgPT09IG51bGwgfHwgX2V4aXN0aW5nJG1ldGFkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXhpc3RpbmckbWV0YWRhdGEucmVzb3VyY2VWZXJzaW9uLCAxMCk7CiAgICAgIH0KICAgICAgaWYgKCFyZXZpc2lvbikgewogICAgICAgIHZhciBjYWNoZSA9IHN0YXRlLnR5cGVzW3R5cGVdOwogICAgICAgIGlmICghY2FjaGUpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXZpc2lvbiA9IGNhY2hlLnJldmlzaW9uOyAvLyBUaGlzIGlzIGFsd2F5cyB6ZXJvLi4uLi4KICAgICAgICB2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGNhY2hlLmxpc3QpLAogICAgICAgICAgX3N0ZXA2OwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgb2JqID0gX3N0ZXA2LnZhbHVlOwogICAgICAgICAgICBpZiAob2JqICYmIG9iai5tZXRhZGF0YSkgewogICAgICAgICAgICAgIHZhciBuZXUgPSBwYXJzZUludChvYmoubWV0YWRhdGEucmVzb3VyY2VWZXJzaW9uLCAxMCk7CiAgICAgICAgICAgICAgcmV2aXNpb24gPSBNYXRoLm1heChyZXZpc2lvbiwgbmV1KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yNi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmV2aXNpb24pIHsKICAgICAgICByZXR1cm4gcmV2aXNpb247CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0KfTsKZXhwb3J0IHZhciBhY3Rpb25zID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzaGFyZWRBY3Rpb25zKSwgZGVmYXVsdEFjdGlvbnMpOwpleHBvcnQgdmFyIG11dGF0aW9ucyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc2hhcmVkTXV0YXRpb25zKSwgZGVmYXVsdE11dGF0aW9ucyk7CmV4cG9ydCB2YXIgZ2V0dGVycyA9IF9vYmplY3RTcHJlYWQoe30sIGRlZmF1bHRHZXR0ZXJzKTs="},{"version":3,"names":["addObject","clear","removeObject","get","SCHEMA","MANAGEMENT","SETTING","CSRF","getPerformanceSetting","Socket","EVENT_CONNECTED","EVENT_DISCONNECTED","EVENT_MESSAGE","EVENT_CONNECT_ERROR","EVENT_DISCONNECT_ERROR","NO_WATCH","NO_SCHEMA","REVISION_TOO_OLD","normalizeType","day","DATE_FORMAT","TIME_FORMAT","escapeHtml","keyForSubscribe","waitFor","WORKER_MODES","pAndNFiltering","BLANK_CLUSTER","STORE","MINIMUM_TIME_NOTIFIED","workerQueues","supportedStores","CLUSTER","RANCHER","isWaitingForDestroy","storeName","store","_store$$workers$store","$workers","waitingForDestroy","waitForSettingsSchema","getters","waitForSettings","UI_PERFORMANCE","isAdvancedWorker","ctx","rootGetters","clusterId","includes","perfSetting","advancedWorker","enabled","createWorker","_x","_x2","_createWorker","apply","arguments","_asyncToGenerator","regeneratorRuntime","mark","_callee6","_dispatch","workerActions","workerMode","worker","_workerQueues$storeNa","message","wrap","_callee6$","_context6","prev","next","dispatch","abrupt","postMessage","msg","_Object$keys","Object","keys","mode","DESTROY_MOCK","push","WAITING","_store$$workers$store2","destroy","_defineProperty","load","resource","queueChange","destroyWorker","terminate","batchChanges","batch","namespaceHandler","validateBatchChange","concat","name","redispatch","entries","forEach","_ref24","_ref25","_slicedToArray","action","params","e","ADVANCED","BASIC","steveCreateWorker","initWorker","onmessage","messageActions","data","length","shift","stop","equivalentWatch","a","b","aresourceType","resourceType","type","bresourceType","id","namespace","selector","subscribeNamespace","isApplicable","namespaced","undefined","validChange","_ref","haveNamespace","namespaces","activeNamespaceCache","metadata","_ref2","_ref3","_schema$attributes","_ref4","schema","schemaFor","attributes","split","_ref5","_ref6","label","state","revision","entry","typeEntry","Math","max","parseInt","queue","event","body","obj","byId","growlsDisabled","_getPerformanceSettin","disableWebsocketNotification","sharedActions","subscribe","opt","_this","_callee","_rootGetters$isSingle","commit","socket","url","maxTries","_callee$","_context","disableSteveSockets","process","server","debugSocket","console","info","config","baseUrl","createWatcher","csrf","$cookies","parseJSON","setAutoReconnect","setUrl","connect","addEventListener","detail","JSON","parse","unsubscribe","_ref7","_this2","cleanupTasks","disconnect","Promise","all","watch","_ref8","_this$$workers","stringify","force","inError","error","watchStarted","debug","nextResourceVersion","resourceVersion","unwatch","_ref9","wsPing","_ref10","_msg$data","version","root","sharedMutations","on","toggleDebug","defaultActions","flush","_ref11","_callee2","toLoad","started","_iterator","_step","_step$value","_callee2$","_context2","Date","getTime","_createForOfIteratorHelper","s","n","done","value","Error","t0","f","finish","rehydrateSubscribe","_ref12","client","wantSocket","reconnectWatches","_ref13","promises","_iterator2","slice","_step2","err","resyncWatch","_ref14","_callee3","have","want","wantMap","_iterator3","_step3","_iterator4","_step4","_obj","_callee3$","_context3","forceWatch","sent","filter","x","_x$metadata","watchNamespace","opened","_ref15","_this3","_callee5","_event$detail","tries","t","disableGrowl","growlErr","_iterator5","_step5","_callee5$","_context5","currentTarget","$socket","queueTimer","flushQueue","_callee4","_callee4$","_context4","setTimeout","hasReconnected","key","val","title","pendingFrames","closed","_ref17","clearTimeout","_ref18","_e$srcElement","_e$srcElement2","_state$socket","dateFormat","timeFormat","time","srcElement","disconnectedAt","now","timeFormatted","format","raw","icon","earliestClose","send","_ref19","ok","sendImmediate","_ref20","wsResourceStart","_ref21","newWatch","wsResourceError","_ref22","_msg$data2","warn","toLowerCase","reason","wsResourceStop","_ref23","localState","wsResourceCreate","wsResourceChange","_typeOption$alias","updateSchema","typeOption","alias","map","_objectSpread","wsResourceRemove","_typeOption$alias2","removeSchema","defaultMutations","setSocket","setWantSocket","enqueuePendingFrame","dequeuePendingFrame","setWatchStarted","existing","find","setWatchStopped","setInError","clearInError","resetSubscriptions","deferredRequests","clearFromQueue","item","_item$body","defaultGetters","_existing$metadata","cache","types","_iterator6","list","_step6","neu","actions","mutations"],"sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/plugins/steve/subscribe.js"],"sourcesContent":["/**\n * Handles subscriptions to websockets which receive updates to resources\n *\n * Covers three use cases\n * 1) Handles subscription within this file\n * 2) Handles `cluster` subscriptions for some basic types in a web worker (SETTING.UI_PERFORMANCE advancedWorker = false)\n * 2) Handles `cluster` subscriptions and optimisations in an advanced worker (SETTING.UI_PERFORMANCE advancedWorker = true)\n */\n\nimport { addObject, clear, removeObject } from '@shell/utils/array';\nimport { get } from '@shell/utils/object';\nimport { SCHEMA, MANAGEMENT } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport { CSRF } from '@shell/config/cookies';\nimport { getPerformanceSetting } from '@shell/utils/settings';\nimport Socket, {\n  EVENT_CONNECTED,\n  EVENT_DISCONNECTED,\n  EVENT_MESSAGE,\n  //  EVENT_FRAME_TIMEOUT,\n  EVENT_CONNECT_ERROR,\n  EVENT_DISCONNECT_ERROR,\n  NO_WATCH,\n  NO_SCHEMA,\n  REVISION_TOO_OLD\n} from '@shell/utils/socket';\nimport { normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport day from 'dayjs';\nimport { DATE_FORMAT, TIME_FORMAT } from '@shell/store/prefs';\nimport { escapeHtml } from '@shell/utils/string';\nimport { keyForSubscribe } from '@shell/plugins/steve/resourceWatcher';\nimport { waitFor } from '@shell/utils/async';\nimport { WORKER_MODES } from './worker';\nimport pAndNFiltering from '@shell/utils/projectAndNamespaceFiltering.utils';\nimport { BLANK_CLUSTER, STORE } from '@shell/store/store-types.js';\n\n// minimum length of time a disconnect notification is shown\nconst MINIMUM_TIME_NOTIFIED = 3000;\n\nconst workerQueues = {};\n\nconst supportedStores = [STORE.CLUSTER, STORE.RANCHER, STORE.MANAGEMENT];\n\nconst isWaitingForDestroy = (storeName, store) => {\n  return store.$workers[storeName]?.waitingForDestroy && store.$workers[storeName].waitingForDestroy();\n};\n\nconst waitForSettingsSchema = (storeName, store) => {\n  return waitFor(() => isWaitingForDestroy(storeName, store) || !!store.getters['management/byId'](SCHEMA, MANAGEMENT.SETTING));\n};\n\nconst waitForSettings = (storeName, store) => {\n  return waitFor(() => isWaitingForDestroy(storeName, store) || !!store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.UI_PERFORMANCE));\n};\n\nconst isAdvancedWorker = (ctx) => {\n  const { rootGetters, getters } = ctx;\n  const storeName = getters.storeName;\n  const clusterId = rootGetters.clusterId;\n\n  if (!supportedStores.includes(storeName) || (clusterId === BLANK_CLUSTER && storeName === STORE.CLUSTER)) {\n    return false;\n  }\n\n  const perfSetting = getPerformanceSetting(rootGetters);\n\n  return perfSetting?.advancedWorker.enabled;\n};\n\nexport async function createWorker(store, ctx) {\n  const { getters, dispatch } = ctx;\n  const storeName = getters.storeName;\n\n  store.$workers = store.$workers || {};\n\n  if (!supportedStores.includes(storeName)) {\n    return;\n  }\n\n  if (!store.$workers[storeName]) {\n    // we know we need a worker at this point but we don't know which one so we're creating a mock interface\n    // it will simply queue up any messages for the real worker to process when it loads up\n    store.$workers[storeName] = {\n      postMessage: (msg) => {\n        if (Object.keys(msg)?.[0] === 'destroyWorker') {\n          // The worker has been destroyed before it's been set up. Flag this so we stop waiting for mgmt settings and then can destroy worker.\n          // This can occurr when the user is redirected to the log in page\n          // - workers created (but waiting)\n          // - logout is called\n          // - <store>/unsubscribe is dispatched\n          // - wait for worker object to be destroyed <-- requires initial wait to be unblocked\n          store.$workers[storeName].mode = WORKER_MODES.DESTROY_MOCK;\n\n          return;\n        }\n        if (workerQueues[storeName]) {\n          workerQueues[storeName].push(msg);\n        } else {\n          workerQueues[storeName] = [msg];\n        }\n      },\n      mode:              WORKER_MODES.WAITING,\n      waitingForDestroy: () => {\n        return store.$workers[storeName]?.mode === WORKER_MODES.DESTROY_MOCK;\n      },\n      destroy: () => {\n        // Similar to workerActions.destroyWorker\n        delete store.$workers[storeName];\n      }\n    };\n  }\n\n  await waitForSettingsSchema(storeName, store);\n  await waitForSettings(storeName, store);\n  if (store.$workers[storeName].waitingForDestroy()) {\n    store.$workers[storeName].destroy();\n\n    return;\n  }\n  const advancedWorker = isAdvancedWorker(ctx);\n\n  const workerActions = {\n    load: (resource) => {\n      queueChange(ctx, resource, true, 'Change');\n    },\n    destroyWorker: () => {\n      if (store.$workers) {\n        store.$workers[storeName].terminate();\n        delete store.$workers[storeName];\n      }\n    },\n    batchChanges: (batch) => {\n      dispatch('batchChanges', namespaceHandler.validateBatchChange(ctx, batch));\n    },\n    dispatch: (msg) => {\n      dispatch(`ws.${ msg.name }`, msg);\n    },\n    redispatch: (msg) => {\n      /**\n       * because we had to queue up some messages prior to loading the worker:\n       * the basic worker will need to redispatch some of the queued messages back to the UI thread\n       */\n      Object.entries(msg).forEach(([action, params]) => {\n        dispatch(action, params);\n      });\n    },\n    [EVENT_CONNECT_ERROR]: (e) => {\n      dispatch('error', e );\n    },\n    [EVENT_DISCONNECT_ERROR]: (e) => {\n      dispatch('error', e );\n    },\n  };\n\n  if (!store.$workers[storeName] || store.$workers[storeName].mode === WORKER_MODES.WAITING) {\n    const workerMode = advancedWorker ? WORKER_MODES.ADVANCED : WORKER_MODES.BASIC;\n    const worker = store.steveCreateWorker(workerMode);\n\n    store.$workers[storeName] = worker;\n\n    worker.postMessage({ initWorker: { storeName } });\n\n    /**\n     * Covers message from Worker to UI thread\n     */\n    store.$workers[storeName].onmessage = (e) => {\n      /* on the off chance there's more than key in the message, we handle them in the order that they \"keys\" method provides which is\n      // good enough for now considering that we never send more than one message action at a time right now */\n      const messageActions = Object.keys(e?.data);\n\n      messageActions.forEach((action) => {\n        workerActions[action](e?.data[action]);\n      });\n    };\n  }\n\n  while (workerQueues[storeName]?.length) {\n    const message = workerQueues[storeName].shift();\n\n    store.$workers[storeName].postMessage(message);\n  }\n}\n\nexport function equivalentWatch(a, b) {\n  const aresourceType = a.resourceType || a.type;\n  const bresourceType = b.resourceType || b.type;\n\n  if ( aresourceType !== bresourceType ) {\n    return false;\n  }\n\n  if ( a.id !== b.id && (a.id || b.id) ) {\n    return false;\n  }\n\n  if ( a.namespace !== b.namespace && (a.namespace || b.namespace) ) {\n    return false;\n  }\n\n  if ( a.selector !== b.selector && (a.selector || b.selector) ) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Sockets will not be able to subscribe to more than one namespace. If this is requested we pretend to handle it\n * - Changes to all resources are monitored (no namespace provided in sub)\n * - We ignore any events not from a required namespace (we have the conversion of project --> namespaces already)\n */\nconst namespaceHandler = {\n  /**\n   * Note - namespace can be a list of projects or namespaces\n   */\n  subscribeNamespace: (namespace) => {\n    if (pAndNFiltering.isApplicable({ namespaced: namespace }) && namespace.length) {\n      return undefined; // AKA sub to everything\n    }\n\n    return namespace;\n  },\n\n  validChange: ({ getters, rootGetters }, type, data) => {\n    const haveNamespace = getters.haveNamespace(type);\n\n    if (haveNamespace?.length) {\n      const namespaces = rootGetters.activeNamespaceCache;\n\n      if (!namespaces[data.metadata.namespace]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n\n  validateBatchChange: ({ getters, rootGetters }, batch) => {\n    const namespaces = rootGetters.activeNamespaceCache;\n\n    Object.entries(batch).forEach(([type, entries]) => {\n      const haveNamespace = getters.haveNamespace(type);\n\n      if (!haveNamespace?.length) {\n        return;\n      }\n\n      const schema = getters.schemaFor(type);\n\n      if (!schema?.attributes?.namespaced) {\n        return;\n      }\n\n      Object.keys(entries).forEach((id) => {\n        const namespace = id.split('/')[0];\n\n        if (!namespace || !namespaces[namespace]) {\n          delete entries[id];\n        }\n      });\n    });\n\n    return batch;\n  }\n};\n\nfunction queueChange({ getters, state, rootGetters }, { data, revision }, load, label) {\n  const type = getters.normalizeType(data.type);\n\n  const entry = getters.typeEntry(type);\n\n  if ( entry ) {\n    entry.revision = Math.max(entry.revision, parseInt(revision, 10));\n  } else {\n    return;\n  }\n\n  // console.log(`${ label } Event [${ state.config.namespace }]`, data.type, data.id); // eslint-disable-line no-console\n\n  if (!namespaceHandler.validChange({ getters, rootGetters }, type, data)) {\n    return;\n  }\n\n  if ( load ) {\n    state.queue.push({\n      action: 'dispatch',\n      event:  'load',\n      body:   data\n    });\n  } else {\n    const obj = getters.byId(data.type, data.id);\n\n    if ( obj ) {\n      state.queue.push({\n        action: 'commit',\n        event:  'remove',\n        body:   obj\n      });\n    }\n\n    if ( type === SCHEMA ) {\n      // Clear the current records in the store when a type disappears\n      state.queue.push({\n        action: 'commit',\n        event:  'forgetType',\n        body:   data.id\n      });\n    }\n  }\n}\n\nfunction growlsDisabled(rootGetters) {\n  return getPerformanceSetting(rootGetters)?.disableWebsocketNotification;\n}\n\n/**\n * Actions that cover all cases (see file description)\n */\nconst sharedActions = {\n  async subscribe(ctx, opt) {\n    const {\n      state, commit, dispatch, getters, rootGetters\n    } = ctx;\n\n    // ToDo: need to keep the worker up to date on CSRF cookie\n\n    if (rootGetters['isSingleProduct']?.disableSteveSockets) {\n      return;\n    }\n\n    let socket = state.socket;\n\n    commit('setWantSocket', true);\n\n    if ( process.server ) {\n      return;\n    }\n\n    state.debugSocket && console.info(`Subscribe [${ getters.storeName }]`); // eslint-disable-line no-console\n\n    const url = `${ state.config.baseUrl }/subscribe`;\n    const maxTries = growlsDisabled(rootGetters) ? null : 3;\n    const metadata = get(opt, 'metadata');\n\n    if (isAdvancedWorker(ctx)) {\n      if (!this.$workers[getters.storeName]) {\n        await createWorker(this, ctx);\n      }\n\n      // if the worker is in advanced mode then it'll contain it's own socket which it calls a 'watcher'\n      this.$workers[getters.storeName].postMessage({\n        createWatcher: {\n          metadata,\n          url:  `${ state.config.baseUrl }/subscribe`,\n          csrf: this.$cookies.get(CSRF, { parseJSON: false }),\n          maxTries\n        }\n      });\n    } else if ( socket ) {\n      socket.setAutoReconnect(true);\n      socket.setUrl(url);\n      socket.connect(metadata);\n    } else {\n      socket = new Socket(`${ state.config.baseUrl }/subscribe`, true, null, null, maxTries);\n\n      commit('setSocket', socket);\n      socket.addEventListener(EVENT_CONNECTED, (e) => {\n        dispatch('opened', e);\n      });\n\n      socket.addEventListener(EVENT_DISCONNECTED, (e) => {\n        dispatch('closed', e);\n      });\n\n      socket.addEventListener(EVENT_CONNECT_ERROR, (e) => {\n        dispatch('error', e );\n      });\n\n      socket.addEventListener(EVENT_DISCONNECT_ERROR, (e) => {\n        dispatch('error', e );\n      });\n\n      socket.addEventListener(EVENT_MESSAGE, (e) => {\n        const event = e.detail;\n\n        if ( event.data) {\n          const msg = JSON.parse(event.data);\n\n          if (msg.name) {\n            dispatch(`ws.${ msg.name }`, msg);\n          }\n        }\n      });\n      socket.connect(metadata);\n    }\n  },\n\n  unsubscribe({ commit, getters, state }) {\n    const socket = state.socket;\n\n    commit('setWantSocket', false);\n    const cleanupTasks = [];\n\n    const worker = (this.$workers || {})[getters.storeName];\n\n    if (worker) {\n      worker.postMessage({ destroyWorker: true }); // we're only passing the boolean here because the key needs to be something truthy to ensure it's passed on the object.\n      cleanupTasks.push(waitFor(() => !this.$workers[getters.storeName], 'Worker is destroyed'));\n    }\n\n    if ( socket ) {\n      cleanupTasks.push(socket.disconnect());\n    }\n\n    return Promise.all(cleanupTasks);\n  },\n\n  watch({\n    state, dispatch, getters, rootGetters\n  }, params) {\n    state.debugSocket && console.info(`Watch Request [${ getters.storeName }]`, JSON.stringify(params)); // eslint-disable-line no-console\n\n    let {\n      // eslint-disable-next-line prefer-const\n      type, selector, id, revision, namespace, stop, force\n    } = params;\n\n    namespace = namespaceHandler.subscribeNamespace(namespace);\n    type = getters.normalizeType(type);\n\n    if (rootGetters['type-map/isSpoofed'](type)) {\n      state.debugSocket && console.info('Will not Watch (type is spoofed)', JSON.stringify(params)); // eslint-disable-line no-console\n\n      return;\n    }\n\n    // If socket is in error don't try to watch.... unless we `force` it\n    const inError = getters.inError(params);\n\n    if ( !stop && !force && inError ) {\n      // REVISION_TOO_OLD is a temporary state and will be handled when `resyncWatch` completes\n      if (inError !== REVISION_TOO_OLD) {\n        console.error(`Aborting Watch Request [${ getters.storeName }]. Watcher in error (${ inError })`, JSON.stringify(params)); // eslint-disable-line no-console\n      }\n\n      return;\n    }\n\n    if ( !stop && getters.watchStarted({\n      type, id, selector, namespace\n    }) ) {\n      // eslint-disable-next-line no-console\n      state.debugSocket && console.debug(`Already Watching [${ getters.storeName }]`, {\n        type, id, selector, namespace\n      });\n\n      return;\n    }\n\n    if ( typeof revision === 'undefined' ) {\n      revision = getters.nextResourceVersion(type, id);\n    }\n\n    const msg = { resourceType: type };\n\n    if ( revision ) {\n      msg.resourceVersion = `${ revision }`;\n    }\n\n    if ( namespace ) {\n      msg.namespace = namespace;\n    }\n\n    if ( stop ) {\n      msg.stop = true;\n    }\n\n    if ( id ) {\n      msg.id = id;\n    }\n\n    if ( selector ) {\n      msg.selector = selector;\n    }\n\n    const worker = this.$workers?.[getters.storeName] || {};\n\n    if (worker.mode === WORKER_MODES.ADVANCED || worker.mode === WORKER_MODES.WAITING) {\n      if ( force ) {\n        msg.force = true;\n      }\n\n      worker.postMessage({ watch: msg });\n\n      return;\n    }\n\n    return dispatch('send', msg);\n  },\n\n  unwatch(ctx, {\n    type, id, namespace, selector\n  }) {\n    const { commit, getters, dispatch } = ctx;\n\n    if (getters['schemaFor'](type)) {\n      namespace = namespaceHandler.subscribeNamespace(namespace);\n\n      const obj = {\n        type,\n        id,\n        namespace,\n        selector,\n        stop: true, // Stops the watch on a type\n      };\n\n      if (isAdvancedWorker(ctx)) {\n        dispatch('watch', obj); // Ask the backend to stop watching the type\n      } else if (getters['watchStarted'](obj)) {\n        // Set that we don't want to watch this type\n        // Otherwise, the dispatch to unwatch below will just cause a re-watch when we\n        // detect the stop message from the backend over the web socket\n        commit('setWatchStopped', obj);\n        dispatch('watch', obj); // Ask the backend to stop watching the type\n        // Make sure anything in the pending queue for the type is removed, since we've now removed the type\n        commit('clearFromQueue', type);\n      }\n    }\n  },\n\n  'ws.ping'({ getters, dispatch }, msg) {\n    if ( getters.storeName === 'management' ) {\n      const version = msg?.data?.version || null;\n\n      dispatch('updateServerVersion', version, { root: true });\n      console.info(`Ping [${ getters.storeName }] from ${ version || 'unknown version' }`); // eslint-disable-line no-console\n    }\n  },\n};\n\n/**\n * Mutations that cover all cases (both subscriptions here and in advanced worker)\n */\nconst sharedMutations = {\n  debug(state, on, store) {\n    state.debugSocket = on !== false;\n    if (store && this.$workers[store]) {\n      this.$workers[store].postMessage({ toggleDebug: on !== false });\n    }\n  },\n};\n\n/**\n * Actions that cover cases 1 & 2 (see file description)\n */\nconst defaultActions = {\n\n  async flush({\n    state, commit, dispatch, getters\n  }) {\n    const queue = state.queue;\n    let toLoad = [];\n\n    if ( !queue.length ) {\n      return;\n    }\n\n    const started = new Date().getTime();\n\n    state.queue = [];\n\n    state.debugSocket && console.debug(`Subscribe Flush [${ getters.storeName }]`, queue.length, 'items'); // eslint-disable-line no-console\n\n    for ( const { action, event, body } of queue ) {\n      if ( action === 'dispatch' && event === 'load' ) {\n        // Group loads into one loadMulti when possible\n        toLoad.push(body);\n      } else {\n        // When we hit a different kind of event, process all the previous loads, then the other event.\n        if ( toLoad.length ) {\n          await dispatch('loadMulti', toLoad);\n          toLoad = [];\n        }\n\n        if ( action === 'dispatch' ) {\n          await dispatch(event, body);\n        } else if ( action === 'commit' ) {\n          commit(event, body);\n        } else {\n          throw new Error('Invalid queued action');\n        }\n      }\n    }\n\n    // Process any remaining loads\n    if ( toLoad.length ) {\n      await dispatch('loadMulti', toLoad);\n    }\n\n    state.debugSocket && console.debug(`Subscribe Flush [${ getters.storeName }] finished`, (new Date().getTime()) - started, 'ms'); // eslint-disable-line no-console\n  },\n\n  rehydrateSubscribe({ state, dispatch }) {\n    if ( process.client && state.wantSocket && !state.socket ) {\n      dispatch('subscribe');\n    }\n  },\n\n  reconnectWatches({\n    state, getters, commit, dispatch\n  }) {\n    const promises = [];\n\n    for ( const entry of state.started.slice() ) {\n      console.info(`Reconnect [${ getters.storeName }]`, JSON.stringify(entry)); // eslint-disable-line no-console\n\n      if ( getters.schemaFor(entry.type) ) {\n        commit('setWatchStopped', entry);\n        delete entry.revision;\n        promises.push(dispatch('watch', entry));\n      }\n    }\n\n    return Promise.all(promises);\n  },\n\n  async resyncWatch({\n    state, getters, dispatch, commit\n  }, params) {\n    const {\n      resourceType, namespace, id, selector\n    } = params;\n\n    console.info(`Resync [${ getters.storeName }]`, params); // eslint-disable-line no-console\n\n    const opt = { force: true, forceWatch: true };\n\n    if ( id ) {\n      await dispatch('find', {\n        type: resourceType,\n        id,\n        opt,\n      });\n      commit('clearInError', params);\n\n      return;\n    }\n\n    let have, want;\n\n    if ( selector ) {\n      have = getters['matching'](resourceType, selector).slice();\n      want = await dispatch('findMatching', {\n        type: resourceType,\n        selector,\n        opt,\n      });\n    } else {\n      have = getters['all'](resourceType).slice();\n\n      if ( namespace ) {\n        have = have.filter((x) => x.metadata?.namespace === namespace);\n      }\n\n      want = await dispatch('findAll', {\n        type:           resourceType,\n        watchNamespace: namespace,\n        opt\n      });\n    }\n\n    const wantMap = {};\n\n    for ( const obj of want ) {\n      wantMap[obj.id] = true;\n    }\n\n    for ( const obj of have ) {\n      if ( !wantMap[obj.id] ) {\n        state.debugSocket && console.info(`Remove stale [${ getters.storeName }]`, resourceType, obj.id); // eslint-disable-line no-console\n\n        commit('remove', obj);\n      }\n    }\n  },\n\n  async opened({\n    commit, dispatch, state, getters, rootGetters\n  }, event) {\n    state.debugSocket && console.info(`WebSocket Opened [${ getters.storeName }]`); // eslint-disable-line no-console\n    const socket = event.currentTarget;\n    const tries = event?.detail?.tries; // have to pull it off of the event because the socket's tries is already reset to 0\n    const t = rootGetters['i18n/t'];\n    const disableGrowl = growlsDisabled(rootGetters);\n\n    this.$socket = socket;\n\n    if ( !state.queue ) {\n      state.queue = [];\n    }\n\n    if ( !state.queueTimer ) {\n      state.flushQueue = async() => {\n        if ( state.queue.length ) {\n          await dispatch('flush');\n        }\n\n        state.queueTimer = setTimeout(state.flushQueue, 1000);\n      };\n\n      state.flushQueue();\n    }\n\n    if ( socket.hasReconnected ) {\n      await dispatch('reconnectWatches');\n      // Check for disconnect notifications and clear them\n      const growlErr = rootGetters['growl/find']({ key: 'url', val: socket.url });\n\n      if (growlErr) {\n        dispatch('growl/remove', growlErr.id, { root: true });\n      }\n      if (tries > 1 && !disableGrowl) {\n        dispatch('growl/success', {\n          title:   t('growl.reconnected.title'),\n          message: t('growl.reconnected.message', { url: this.$socket.url, tries }),\n        }, { root: true });\n      }\n    }\n\n    // Try resending any frames that were attempted to be sent while the socket was down, once.\n    if ( !process.server ) {\n      for ( const obj of state.pendingFrames.slice() ) {\n        commit('dequeuePendingFrame', obj);\n        dispatch('sendImmediate', obj);\n      }\n    }\n  },\n\n  closed({ state, getters }) {\n    state.debugSocket && console.info(`WebSocket Closed [${ getters.storeName }]`); // eslint-disable-line no-console\n    clearTimeout(state.queueTimer);\n    state.queueTimer = null;\n  },\n\n  error({\n    getters, state, dispatch, rootGetters\n  }, e) {\n    clearTimeout(state.queueTimer);\n    state.queueTimer = null;\n\n    // determine if websocket notifications are disabled\n    const disableGrowl = growlsDisabled(rootGetters);\n\n    if (!disableGrowl) {\n      const dateFormat = escapeHtml( rootGetters['prefs/get'](DATE_FORMAT));\n      const timeFormat = escapeHtml( rootGetters['prefs/get'](TIME_FORMAT));\n      const time = e?.srcElement?.disconnectedAt || Date.now();\n\n      const timeFormatted = `${ day(time).format(`${ dateFormat } ${ timeFormat }`) }`;\n      const url = e?.srcElement?.url;\n      const tries = state?.socket?.tries;\n\n      const t = rootGetters['i18n/t'];\n\n      const growlErr = rootGetters['growl/find']({ key: 'url', val: url });\n\n      if (e.type === EVENT_CONNECT_ERROR) { // if this occurs, then we're at least retrying to connect\n        if (growlErr) {\n          dispatch('growl/remove', growlErr.id, { root: true });\n        }\n        dispatch('growl/error', {\n          title:   t('growl.connectError.title'),\n          message: t('growl.connectError.message', {\n            url, time: timeFormatted, tries\n          }, { raw: true }),\n          icon:          'error',\n          earliestClose: time + MINIMUM_TIME_NOTIFIED,\n          url\n        }, { root: true });\n      } else if (e.type === EVENT_DISCONNECT_ERROR) { // if this occurs, we've given up on trying to reconnect\n        if (growlErr) {\n          dispatch('growl/remove', growlErr.id, { root: true });\n        }\n        dispatch('growl/error', {\n          title:   t('growl.disconnectError.title'),\n          message: t('growl.disconnectError.message', {\n            url, time: timeFormatted, tries\n          }, { raw: true }),\n          icon:          'error',\n          earliestClose: time + MINIMUM_TIME_NOTIFIED,\n          url\n        }, { root: true });\n      } else {\n        // if the error is not a connect error or disconnect error, the socket never worked: log whether the current browser is safari\n        console.error(`WebSocket Connection Error [${ getters.storeName }]`, e.detail); // eslint-disable-line no-console\n      }\n    }\n  },\n\n  send({ state, commit }, obj) {\n    if ( state.socket ) {\n      const ok = state.socket.send(JSON.stringify(obj));\n\n      if ( ok ) {\n        return;\n      }\n    }\n\n    commit('enqueuePendingFrame', obj);\n  },\n\n  sendImmediate({ state }, obj) {\n    if ( state.socket ) {\n      return state.socket.send(JSON.stringify(obj));\n    }\n  },\n\n  /**\n   * Steve only event\n   */\n  'ws.resource.start'({\n    state, getters, commit, dispatch\n  }, msg) {\n    state.debugSocket && console.info(`Resource start: [${ getters.storeName }]`, msg); // eslint-disable-line no-console\n\n    const newWatch = {\n      type:      msg.resourceType,\n      namespace: msg.namespace,\n      id:        msg.id,\n      selector:  msg.selector\n    };\n\n    state.started.filter((entry) => {\n      if (\n        entry.type === newWatch.type &&\n        entry.namespace !== newWatch.namespace\n      ) {\n        return true;\n      }\n    }).forEach((entry) => {\n      dispatch('unwatch', entry);\n    });\n\n    commit('setWatchStarted', newWatch);\n  },\n\n  'ws.resource.error'({ getters, commit, dispatch }, msg) {\n    console.warn(`Resource error [${ getters.storeName }]`, msg.resourceType, ':', msg.data.error); // eslint-disable-line no-console\n\n    const err = msg.data?.error?.toLowerCase();\n\n    if ( err.includes('watch not allowed') ) {\n      commit('setInError', { type: msg.resourceType, reason: NO_WATCH });\n    } else if ( err.includes('failed to find schema') ) {\n      commit('setInError', { type: msg.resourceType, reason: NO_SCHEMA });\n    } else if ( err.includes('too old') ) {\n      // Set an error for (all) subs of this type. This..\n      // 1) blocks attempts by resource.stop to resub (as type is in error)\n      // 2) will be cleared when resyncWatch --> watch (with force) --> resource.start completes\n      commit('setInError', { type: msg.resourceType, reason: REVISION_TOO_OLD });\n      dispatch('resyncWatch', msg);\n    }\n  },\n\n  /**\n   * Steve only event\n   *\n   * Steve has stopped watching this resource. This happens for a couple of reasons\n   * - We have requested that the resource watch should be stopped (and we receive this event as confirmation)\n   * - Steve tells us that the resource watch has been stopped. Possible reasons\n   *   - The rancher <--> k8s socket closed (happens every ~30 mins on mgmt socket)\n   *   - Permissions has changed for the subscribed resource, so rancher closes socket\n   */\n  'ws.resource.stop'({\n    state, getters, commit, dispatch\n  }, msg) {\n    const type = msg.resourceType;\n    const obj = {\n      type,\n      id:        msg.id,\n      namespace: msg.namespace,\n      selector:  msg.selector\n    };\n\n    state.debugSocket && console.info(`Resource Stop [${ getters.storeName }]`, type, msg); // eslint-disable-line no-console\n\n    if (!type) {\n      console.error(`Resource Stop [${ getters.storeName }]. Received resource.stop with an empty resourceType, aborting`, msg); // eslint-disable-line no-console\n\n      return;\n    }\n\n    // If we're trying to watch this event, attempt to re-watch\n    //\n    // To make life easier in the advanced worker `resource.stop` --> `watch` is handled here (basically for access to getters.nextResourceVersion)\n    // This means the concept of resource sub watch state needs massaging\n    const advancedWorker = msg.advancedWorker;\n    const localState = !advancedWorker;\n    const watchStarted = localState ? getters['watchStarted'](obj) : advancedWorker;\n\n    if ( getters['schemaFor'](type) && watchStarted) {\n      if (localState) {\n        commit('setWatchStopped', obj);\n      }\n\n      dispatch('watch', obj);\n    }\n  },\n\n  'ws.resource.create'(ctx, msg) {\n    ctx.state.debugSocket && console.info(`Resource Create [${ ctx.getters.storeName }]`, msg.resourceType, msg); // eslint-disable-line no-console\n    queueChange(ctx, msg, true, 'Create');\n  },\n\n  'ws.resource.change'(ctx, msg) {\n    const data = msg.data;\n    const type = data.type;\n\n    // Work-around for ws.error messages being sent as change events\n    // These have no id (or other metadata) which breaks lots if they are processed as change events\n    if (data.message && !data.id) {\n      return;\n    }\n\n    // Web worker can process schemas to check that they are actually changing and\n    // only load updates if the schema did actually change\n    if (type === SCHEMA) {\n      const worker = (this.$workers || {})[ctx.getters.storeName];\n\n      if (worker) {\n        worker.postMessage({ updateSchema: data });\n\n        // No further processing - let the web worker check the schema updates\n        return;\n      }\n    }\n\n    queueChange(ctx, msg, true, 'Change');\n\n    const typeOption = ctx.rootGetters['type-map/optionsFor'](type);\n\n    if (typeOption?.alias?.length > 0) {\n      const alias = typeOption?.alias || [];\n\n      alias.map((type) => {\n        ctx.state.queue.push({\n          action: 'dispatch',\n          event:  'load',\n          body:   {\n            ...data,\n            type,\n          },\n        });\n      });\n    }\n  },\n\n  'ws.resource.remove'(ctx, msg) {\n    const data = msg.data;\n    const type = data.type;\n\n    ctx.state.debugSocket && console.info(`Resource Remove [${ ctx.getters.storeName }]`, type, msg); // eslint-disable-line no-console\n\n    if (type === SCHEMA) {\n      const worker = (this.$workers || {})[ctx.getters.storeName];\n\n      if (worker) {\n        worker.postMessage({ removeSchema: data.id });\n      }\n    }\n\n    queueChange(ctx, msg, false, 'Remove');\n\n    const typeOption = ctx.rootGetters['type-map/optionsFor'](type);\n\n    if (typeOption?.alias?.length > 0) {\n      const alias = typeOption?.alias || [];\n\n      alias.map((type) => {\n        const obj = ctx.getters.byId(type, data.id);\n\n        ctx.state.queue.push({\n          action: 'commit',\n          event:  'remove',\n          body:   obj,\n        });\n      });\n    }\n  },\n};\n\n/**\n * Mutations that cover cases 1 & 2 (see file description)\n */\nconst defaultMutations = {\n  setSocket(state, socket) {\n    state.socket = socket;\n  },\n\n  setWantSocket(state, want) {\n    state.wantSocket = want;\n  },\n\n  enqueuePendingFrame(state, obj) {\n    state.pendingFrames.push(obj);\n  },\n\n  dequeuePendingFrame(state, obj) {\n    removeObject(state.pendingFrames, obj);\n  },\n\n  setWatchStarted(state, obj) {\n    const existing = state.started.find((entry) => equivalentWatch(obj, entry));\n\n    if ( !existing ) {\n      addObject(state.started, obj);\n    }\n\n    delete state.inError[keyForSubscribe(obj)];\n  },\n\n  setWatchStopped(state, obj) {\n    const existing = state.started.find((entry) => equivalentWatch(obj, entry));\n\n    if ( existing ) {\n      removeObject(state.started, existing);\n    } else {\n      console.warn(\"Tried to remove a watch that doesn't exist\", obj); // eslint-disable-line no-console\n    }\n  },\n\n  setInError(state, msg) {\n    const key = keyForSubscribe(msg);\n\n    state.inError[key] = msg.reason;\n  },\n\n  clearInError(state, msg) {\n    const key = keyForSubscribe(msg);\n\n    delete state.inError[key];\n  },\n\n  resetSubscriptions(state) {\n    // Clear out socket state. This is only ever called from reset... which is always called after we `disconnect` above.\n    // This could probably be folded in to there\n    clear(state.started);\n    clear(state.pendingFrames);\n    clear(state.queue);\n    clearTimeout(state.queueTimer);\n    state.deferredRequests = {};\n    state.queueTimer = null;\n  },\n\n  clearFromQueue(state, type) {\n    // Remove anything in the queue that is a resource update for the given type\n    state.queue = state.queue.filter((item) => {\n      return item.body?.type !== type;\n    });\n  },\n};\n\n/**\n * Getters that cover cases 1 & 2 (see file description)\n */\nconst defaultGetters = {\n  inError: (state) => (obj) => {\n    return state.inError[keyForSubscribe(obj)];\n  },\n\n  watchStarted: (state) => (obj) => {\n    return !!state.started.find((entry) => equivalentWatch(obj, entry));\n  },\n\n  nextResourceVersion: (state, getters) => (type, id) => {\n    type = normalizeType(type);\n    let revision = 0;\n\n    if ( id ) {\n      const existing = getters['byId'](type, id);\n\n      revision = parseInt(existing?.metadata?.resourceVersion, 10);\n    }\n\n    if ( !revision ) {\n      const cache = state.types[type];\n\n      if ( !cache ) {\n        return null;\n      }\n\n      revision = cache.revision; // This is always zero.....\n\n      for ( const obj of cache.list ) {\n        if ( obj && obj.metadata ) {\n          const neu = parseInt(obj.metadata.resourceVersion, 10);\n\n          revision = Math.max(revision, neu);\n        }\n      }\n    }\n\n    if ( revision ) {\n      return revision;\n    }\n\n    return null;\n  },\n};\n\nexport const actions = {\n  ...sharedActions,\n  ...defaultActions,\n};\n\nexport const mutations = {\n  ...sharedMutations,\n  ...defaultMutations,\n};\n\nexport const getters = { ...defaultGetters };\n"],"mappings":"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"}]}
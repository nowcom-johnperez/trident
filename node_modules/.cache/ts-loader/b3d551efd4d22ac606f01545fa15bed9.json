{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js??ref--17-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/gc/gc.ts","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/gc/gc.ts","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js","mtime":1716430466133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgU0VUVElORyB9IGZyb20gJ0BzaGVsbC9jb25maWcvc2V0dGluZ3MnOwppbXBvcnQgeyBDT1VOVCwgTUFOQUdFTUVOVCB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBHQ19ERUZBVUxUUyB9IGZyb20gJy4vZ2MtdHlwZXMnOwpjbGFzcyBHYXJiYWdlQ29sbGVjdCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmNhY2hlZEdjUHJlZnMgPSBHQ19ERUZBVUxUUzsKICAgICAgICB0aGlzLmNhY2hlZEdjUHJlZnNTdGFtcCA9ICcnOwogICAgICAgIHRoaXMuZGVidWdMb2cgPSAoLi4uYXJncykgPT4gewogICAgICAgICAgICBpZiAoR2FyYmFnZUNvbGxlY3QuRU5BQkxFX0RFQlVHX0xPR0dJTkcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ0dDJywgLi4uYXJncyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUaW1lIHRoZSBHQyBsYXN0IHJhbgogICAgICAgICAqLwogICAgICAgIHRoaXMuZ2NMYXN0UnVuID0gMDsKICAgICAgICAvKioKICAgICAgICAgKiBUbyBhdm9pZCBKU09OLnBhcnNlIG9uIHRoZSBgdWktcGVyZm9ybWFuY2VgIHNldHRpbmcga2VlcCBhIGxvY2FsIGNhY2hlCiAgICAgICAgICovCiAgICAgICAgdGhpcy5nZXRVaVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9IChyb290U3RhdGUpID0+IHsKICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICBjb25zdCB1aVBlcmZTZXR0aW5nID0gKF9hID0gcm9vdFN0YXRlLm1hbmFnZW1lbnQudHlwZXNbTUFOQUdFTUVOVC5TRVRUSU5HXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxpc3QuZmluZCgocykgPT4gcy5pZCA9PT0gU0VUVElORy5VSV9QRVJGT1JNQU5DRSk7CiAgICAgICAgICAgIGlmICghdWlQZXJmU2V0dGluZyB8fCAhdWlQZXJmU2V0dGluZy52YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gQ291bGQgYmUgaW4gdGhlIHByb2Nlc3Mgb2YgbG9nZ2luZyBvdXQKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc3RhbXAgPSBgJHt1aVBlcmZTZXR0aW5nLm1ldGFkYXRhLmdlbmVyYXRpb259LSR7dWlQZXJmU2V0dGluZy5tZXRhZGF0YS5yZXNvdXJjZVZlcnNpb259YDsKICAgICAgICAgICAgaWYgKHRoaXMuY2FjaGVkR2NQcmVmc1N0YW1wICE9PSBzdGFtcCkgewogICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgVXBkYXRpbmcgJHtTRVRUSU5HLlVJX1BFUkZPUk1BTkNFfSBjYWNoZWApOwogICAgICAgICAgICAgICAgdGhpcy5jYWNoZWRHY1ByZWZzU3RhbXAgPSBzdGFtcDsKICAgICAgICAgICAgICAgIGNvbnN0IHVpUGVyZlNldHRpbmdQYXJzZWQgPSBKU09OLnBhcnNlKHVpUGVyZlNldHRpbmcudmFsdWUpOwogICAgICAgICAgICAgICAgdGhpcy5jYWNoZWRHY1ByZWZzID0gdWlQZXJmU2V0dGluZ1BhcnNlZC5nYXJiYWdlQ29sbGVjdGlvbjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZWRHY1ByZWZzOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGxhc3QgdGltZSBhIHJlc291cmNlIHdhcyBhY2Nlc3NlZCBieSBlaXRoZXIgZmluZCBvciBnZXR0ZXJzIHN0eWxlIGZ1bmN0aW9ucwogICAgICAgICAqLwogICAgICAgIHRoaXMubGFzdEFjY2Vzc2VkQ2FjaGUgPSB7fTsKICAgICAgICAvKioKICAgICAgICAgKiBUcmFjayB3aGVuIGEgbG9nZ2VkIGluIHJvdXRlIGNoYW5nZXMuCiAgICAgICAgICovCiAgICAgICAgdGhpcy5sYXN0Um91dGVDaGFuZ2UgPSAwOwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLSBHQyBFbmFibGVkIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZ2NFbmFibGVkQWxsKHBzZXVkb0N0eCwgdHlwZSkgewogICAgICAgIHJldHVybiB0aGlzLmdjRW5hYmxlZEZvclN0b3JlKHBzZXVkb0N0eC5zdGF0ZSkgJiYgdGhpcy5nY0VuYWJsZWRTZXR0aW5nKHBzZXVkb0N0eCkgJiYgdGhpcy5nY0VuYWJsZWRGb3JUeXBlKHBzZXVkb0N0eCwgdHlwZSk7CiAgICB9CiAgICBnY0VuYWJsZWRTZXR0aW5nKHBzZXVkb0N0eCkgewogICAgICAgIGNvbnN0IHsgcm9vdFN0YXRlIH0gPSBwc2V1ZG9DdHg7CiAgICAgICAgLy8gRG9uJ3QgdXNlIGEgZ2V0dGVyLi4uIGFzIHdlJ2xsIGVuZCB1cCB0cmlnZ2VyaW5nIG91cnNlbHZlcyBhZ2FpbgogICAgICAgIGNvbnN0IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uID0gdGhpcy5nZXRVaVBlcmZHYXJiYWdlQ29sbGVjdGlvbihyb290U3RhdGUpOwogICAgICAgIHJldHVybiB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9PT0gbnVsbCB8fCB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24uZW5hYmxlZDsKICAgIH0KICAgIGdjRW5hYmxlZEZvclN0b3JlKHN0YXRlKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiAoX2EgPSBzdGF0ZSA9PT0gbnVsbCB8fCBzdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhdGUuY29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3VwcG9ydHNHYzsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgY2FuIHJlcXVpcmUgY2VydGFpbiB0eXBlcyBhcmUgbm90IEdDJ2QgKGZvciBleGFtcGxlIGBjbHVzdGVyYCBhbmQgYHNjaGVtYWBzLCBgY291bnRzYCwgZXRjKQogICAgICovCiAgICBnY0VuYWJsZWRGb3JUeXBlKHBzZXVkb0N0eCwgdHlwZSkgewogICAgICAgIGNvbnN0IHsgZ2V0dGVycyB9ID0gcHNldWRvQ3R4OwogICAgICAgIGlmICghdHlwZSB8fCBnZXR0ZXJzLmdjSWdub3JlVHlwZXNbdHlwZV0pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGdjRW5hYmxlZEludGVydmFsKHBzZXVkb0N0eCkgewogICAgICAgIGNvbnN0IHsgcm9vdFN0YXRlIH0gPSBwc2V1ZG9DdHg7CiAgICAgICAgLy8gRG9uJ3QgdXNlIGEgZ2V0dGVyLi4uIGFzIHdlJ2xsIGVuZCB1cCB0cmlnZ2VyaW5nIG91cnNlbHZlcyBhZ2FpbgogICAgICAgIGNvbnN0IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uID0gdGhpcy5nZXRVaVBlcmZHYXJiYWdlQ29sbGVjdGlvbihyb290U3RhdGUpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVuYWJsZWQ6IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uID09PSBudWxsIHx8IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbi5lbmFibGVkSW50ZXJ2YWwsCiAgICAgICAgICAgIGludGVydmFsOiAodWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24gPT09IG51bGwgfHwgdWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uLmludGVydmFsKSB8fCAwCiAgICAgICAgfTsKICAgIH0KICAgIGdjRW5hYmxlZFJvdXRlKHBzZXVkb0N0eCkgewogICAgICAgIGNvbnN0IHsgcm9vdFN0YXRlIH0gPSBwc2V1ZG9DdHg7CiAgICAgICAgLy8gRG9uJ3QgdXNlIGEgZ2V0dGVyLi4uIGFzIHdlJ2xsIGVuZCB1cCB0cmlnZ2VyaW5nIG91cnNlbHZlcyBhZ2FpbgogICAgICAgIGNvbnN0IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uID0gdGhpcy5nZXRVaVBlcmZHYXJiYWdlQ29sbGVjdGlvbihyb290U3RhdGUpOwogICAgICAgIHJldHVybiB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9PT0gbnVsbCB8fCB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24uZW5hYmxlZE9uTmF2aWdhdGU7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tIEdDIChhY3R1YWwpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLyoqCiAgICAgKiBSZW1vdmUgc3RhbGUgcmVzb3VyY2UgdHlwZXMgZnJvbSB0aGUgc3RvcmUgYW5kIHN0b3Agd2F0Y2hpbmcgdGhlbSBmb3IgY2hhbmdlcwogICAgICovCiAgICBnYXJiYWdlQ29sbGVjdChjdHgsIGlnbm9yZVR5cGVzID0ge30pIHsKICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAvLyBJcyBnYyBjdXJyZW50bHkgcnVubmluZyBPUiBoYXMgcnVuIGluIHRoZSBwYXN0IEdDX1JFX1JVTl9HQVAgcmV0dXJuIGVhcmx5CiAgICAgICAgaWYgKHRoaXMuZ2NMYXN0UnVuID09PSBudWxsIHx8IG5vdyAtIHRoaXMuZ2NMYXN0UnVuIDwgR2FyYmFnZUNvbGxlY3QuR0NfUkVfUlVOX0dBUCkgewogICAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdTa2lwcGluZyAocnVubmluZyBvciByZWNlbnRseSBydW4pJywgdGhpcy5nY0xhc3RSdW4gPyBuZXcgRGF0ZSh0aGlzLmdjTGFzdFJ1bikgOiAncnVubmluZycpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2NMYXN0UnVuID0gbnVsbDsKICAgICAgICBjb25zdCBnY2QgPSB7fTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IGdldHRlcnMsIHJvb3RTdGF0ZSwgZGlzcGF0Y2ggfSA9IGN0eDsKICAgICAgICAgICAgaWYgKCFyb290U3RhdGUuY2x1c3RlclJlYWR5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdTa2lwcGluZyAoY2x1c3RlciBub3QgcmVhZHkpJyk7CiAgICAgICAgICAgICAgICB0aGlzLmdjTGFzdFJ1biA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYC0tLS0tLSBTdGFydGVkIC0tLS0tLWApOwogICAgICAgICAgICBjb25zdCB1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbiA9IHRoaXMuZ2V0VWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24ocm9vdFN0YXRlKTsKICAgICAgICAgICAgaWYgKCF1aVBlcmZHYXJiYWdlQ29sbGVjdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG1heEFnZSA9IHVpUGVyZkdhcmJhZ2VDb2xsZWN0aW9uLmFnZVRocmVzaG9sZCAqIDEwMDA7CiAgICAgICAgICAgIGNvbnN0IG1heENvdW50ID0gdWlQZXJmR2FyYmFnZUNvbGxlY3Rpb24uY291bnRUaHJlc2hvbGQ7CiAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYE1heCBBZ2U6ICR7bWF4QWdlfS4gTWF4IENvdW50OiAke21heENvdW50fWApOyAvLyAsICdDYWNoZScsIHRoaXMubGFzdEFjY2Vzc2VkQ2FjaGUKICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBjdHguc3RhdGUuY29uZmlnLm5hbWVzcGFjZTsKICAgICAgICAgICAgLy8gdGhpcy5kZWJ1Z0xvZygnQ2FjaGUnLCB0aGlzLmxhc3RBY2Nlc3NlZENhY2hlKTsKICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoKHRoaXMubGFzdEFjY2Vzc2VkQ2FjaGVbc3RvcmVdIHx8IHt9KSkuZm9yRWFjaCgoW3R5cGUsIGxhc3RBY2Nlc3NlZF0pID0+IHsKICAgICAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgICAgIGlmICghbGFzdEFjY2Vzc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUncyBubyBsYXN0IGFjY2Vzc2VkIHRpbWUuLi4gZ2MgaXMgcHJvYmFibHkgZGlzYWJsZWQgaW4gYW5vdGhlciB3YXkKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGAke3R5cGV9OiBTa2lwcGluZyAobm8gYWNjZXNzZWQgdGltZSlgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZ2NFbmFibGVkRm9yVHlwZShjdHgsIHR5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBzcGVjaWZpYyBzdG9yZSBpcyB0ZWxsaW5nIHVzIHRvIGlnbm9yZSB0aGUgdHlwZSAoZm9yIGV4YW1wbGUgYGNsdXN0ZXJgIHN0b3JlIHdpbGwgbm90IEdDIHNjaGVtYSdzLCBjb3VudHMsIGV0YykKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGAke3R5cGV9OiBTa2lwcGluZyAodHlwZSBpZ25vcmVkIGJ5IHN0b3JlKWApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpZ25vcmVUeXBlc1t0eXBlXSkgewogICAgICAgICAgICAgICAgICAgIC8vIFdlJ3JlIGdvaW5nIHRvIGEgcGxhY2UgdGhhdCBuZWVkcyB0aGUgcmVzb3VyY2UKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGAke3R5cGV9OiBTa2lwcGluZyAobmF2aWdhdGluZyB0byB0eXBlKWApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChub3cgLSBsYXN0QWNjZXNzZWQgPD0gbWF4QWdlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHJlc291cmNlIHdhcyByZWNlbnRseSBhY2Nlc3NlZAogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYCR7dHlwZX06IFNraXBwaW5nIChyZWNlbnRseSBhY2Nlc3NlZClgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0Um91dGVDaGFuZ2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxhc3RSb3V0ZUNoYW5nZSA8IGxhc3RBY2Nlc3NlZCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZXNvdXJjZSBpcyBiZWluZyB1c2VkIGluIHRoZSBjdXJyZW50IHJvdXRlL3BhZ2UKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGAke3R5cGV9OiBTa2lwcGluZyAodXNlZCBpbiBjdXJyZW50IHJvdXRlL3BhZ2UpYCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgY291bnRGcm9tUmVzb3VyY2UgPSAoX2EgPSBnZXR0ZXJzLmFsbChDT1VOVClbMF0uY291bnRzW3R5cGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3VtbWFyeS5jb3VudDsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IGNvdW50RnJvbVJlc291cmNlICE9PSBudWxsICYmIGNvdW50RnJvbVJlc291cmNlICE9PSB2b2lkIDAgPyBjb3VudEZyb21SZXNvdXJjZSA6IDA7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENvdW50ID09PSB1bmRlZmluZWQgfHwgY3VycmVudENvdW50IDwgbWF4Q291bnQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIHRvbyBmZXcgcmVzb3VyY2VzLCB3ZSBtaWdodCBhcyB3ZWxsIGtlZXAgdGhlbSB0byBhdm9pZCBhIG5ldHdvcmsgcmVxdWVzdCB3aGVuIHdlIG5lZWQgdGhlbSBhZ2FpbgogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYCR7dHlwZX06IFNraXBwaW5nICh0b28gZmV3IG9mIHJlc291cmNlKWApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYCR7dHlwZX06IFJlbW92aW5nIGZyb20gc3RvcmVgKTsKICAgICAgICAgICAgICAgIGRpc3BhdGNoKCdmb3JnZXRUeXBlJywgdHlwZSk7CiAgICAgICAgICAgICAgICBnY2RbdHlwZV0gPSBjdXJyZW50Q291bnQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmdjTGFzdFJ1biA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGA6IEVycm9yYCwgZSk7CiAgICAgICAgICAgIHRoaXMuZ2NMYXN0UnVuID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgfQogICAgICAgIGlmIChPYmplY3Qua2V5cyhnY2QpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc29sZS5pbmZvKCdHYXJiYWdlIENvbGxlY3RlZCBSZXNvdXJjZXMnLCBnY2QpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICB9CiAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgLS0tLS0tIEZpbmlzaGVkIC0tLS0tLWApOwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLSBHQyBVcGRhdGUgbG9jYWwgY2FjaGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgdGltZSB0aGF0IHRoZSByZXNvdXJjZSB0eXBlIHdhcyBhY2Nlc3NlZAogICAgICogVGhpcyBuZWVkcyB0byBydW4gYWZ0ZXIgYW55IHR5cGUgaW5pdGlhbGlzYXRpb24gKGFrYSByZWdpc3RlclR5cGUpCiAgICAgKi8KICAgIGdjVXBkYXRlTGFzdEFjY2Vzc2VkKHBzZXVkb0N0eCwgdHlwZSkgewogICAgICAgIGlmICghdGhpcy5nY0VuYWJsZWRBbGwocHNldWRvQ3R4LCB0eXBlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN0b3JlID0gcHNldWRvQ3R4LnN0YXRlLmNvbmZpZy5uYW1lc3BhY2U7CiAgICAgICAgaWYgKCF0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXSkgewogICAgICAgICAgICB0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXSA9IHt9OwogICAgICAgIH0KICAgICAgICB0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXVt0eXBlXSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHRpbWUgdGhlIHVzZXIgbGFzdCBjaGFuZ2VkIHJvdXRlcwogICAgICovCiAgICBnY1VwZGF0ZVJvdXRlQ2hhbmdlZCgpIHsKICAgICAgICB0aGlzLmxhc3RSb3V0ZUNoYW5nZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLSBHQyByZXNldCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8qKgogICAgICogUmVtb3ZlIGFsbCBjYWNoZWQgYWNjZXNzIHRpbWVzIGZvciB0aGUgZ2l2ZW4gc3RvcmUKICAgICAqLwogICAgZ2NSZXNldFN0b3JlKHN0YXRlKSB7CiAgICAgICAgY29uc3Qgc3RvcmUgPSBzdGF0ZS5jb25maWcubmFtZXNwYWNlOwogICAgICAgIGRlbGV0ZSB0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXTsKICAgICAgICB0aGlzLmRlYnVnTG9nKCdGb3JnZXR0aW5nIFN0b3JlOicsIHN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGNhY2hlZCBhY2Nlc3MgdGltZSBmb3IgdGhlIGdpdmVuIHJlc291cmNlIHR5cGUKICAgICAqLwogICAgZ2NSZXNldFR5cGUoc3RhdGUsIHR5cGUpIHsKICAgICAgICBjb25zdCBzdG9yZSA9IHN0YXRlLmNvbmZpZy5uYW1lc3BhY2U7CiAgICAgICAgaWYgKCF0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSB0aGlzLmxhc3RBY2Nlc3NlZENhY2hlW3N0b3JlXVt0eXBlXTsKICAgICAgICB0aGlzLmRlYnVnTG9nKCdGb3JnZXR0aW5nIFR5cGU6Jywgc3RvcmUsIHR5cGUpOwogICAgfQp9CkdhcmJhZ2VDb2xsZWN0LkVOQUJMRV9ERUJVR19MT0dHSU5HID0gZmFsc2U7Ci8qKgogKiBEb24ndCBydW4gR0MgaWYgaXQncyBiZWVuIHJ1biB3aXRoaW4gNSBzZWNvbmRzCiAqLwpHYXJiYWdlQ29sbGVjdC5HQ19SRV9SVU5fR0FQID0gMTAwMCAqIDU7CmNvbnN0IGdjID0gbmV3IEdhcmJhZ2VDb2xsZWN0KCk7CmV4cG9ydCBkZWZhdWx0IGdjOwo="},{"version":3,"file":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/gc/gc.ts","sourceRoot":"","sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/gc/gc.ts"],"names":[],"mappings":"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","sourcesContent":["import { SETTING } from '@shell/config/settings';\nimport { COUNT, MANAGEMENT } from '@shell/config/types';\nimport { GC_DEFAULTS, GC_PREFERENCES } from './gc-types';\n\nclass GarbageCollect {\n  private static ENABLE_DEBUG_LOGGING = false;\n\n  /**\n   * Don't run GC if it's been run within 5 seconds\n   */\n  private static GC_RE_RUN_GAP = 1000 * 5;\n\n  private cachedGcPrefs: GC_PREFERENCES = GC_DEFAULTS;\n\n  private cachedGcPrefsStamp = '';\n\n  private debugLog = (...args: any) => {\n    if (GarbageCollect.ENABLE_DEBUG_LOGGING) {\n      console.debug('GC', ...args); // eslint-disable-line no-console\n    }\n  };\n\n  /**\n   * Time the GC last ran\n   */\n  private gcLastRun: number | null = 0;\n\n  /**\n   * To avoid JSON.parse on the `ui-performance` setting keep a local cache\n   */\n  private getUiPerfGarbageCollection = (rootState: any) => {\n    const uiPerfSetting = rootState.management.types[MANAGEMENT.SETTING]?.list.find((s: any) => s.id === SETTING.UI_PERFORMANCE);\n\n    if (!uiPerfSetting || !uiPerfSetting.value) {\n      // Could be in the process of logging out\n      return undefined;\n    }\n    const stamp = `${ uiPerfSetting.metadata.generation }-${ uiPerfSetting.metadata.resourceVersion }`;\n\n    if (this.cachedGcPrefsStamp !== stamp) {\n      this.debugLog(`Updating ${ SETTING.UI_PERFORMANCE } cache`);\n      this.cachedGcPrefsStamp = stamp;\n      const uiPerfSettingParsed = JSON.parse(uiPerfSetting.value);\n\n      this.cachedGcPrefs = uiPerfSettingParsed.garbageCollection;\n    }\n\n    return this.cachedGcPrefs;\n  };\n\n  /**\n   * The last time a resource was accessed by either find or getters style functions\n   */\n  private lastAccessedCache: {\n    [store: string]: {\n      [type: string]: number;\n    }\n  } = {}\n\n  /**\n   * Track when a logged in route changes.\n   */\n  private lastRouteChange = 0;\n\n  // ------------- GC Enabled ---------------------\n\n  gcEnabledAll(pseudoCtx: any, type: string) {\n    return this.gcEnabledForStore(pseudoCtx.state) && this.gcEnabledSetting(pseudoCtx) && this.gcEnabledForType(pseudoCtx, type);\n  }\n\n  gcEnabledSetting(pseudoCtx: any) {\n    const { rootState } = pseudoCtx;\n\n    // Don't use a getter... as we'll end up triggering ourselves again\n    const uiPerfGarbageCollection = this.getUiPerfGarbageCollection(rootState);\n\n    return uiPerfGarbageCollection?.enabled;\n  }\n\n  gcEnabledForStore(state: any) {\n    return state?.config?.supportsGc;\n  }\n\n  /**\n   * Store can require certain types are not GC'd (for example `cluster` and `schema`s, `counts`, etc)\n   */\n  gcEnabledForType(pseudoCtx: any, type: string) {\n    const { getters } = pseudoCtx;\n\n    if (!type || getters.gcIgnoreTypes[type]) {\n      return false;\n    }\n\n    return true;\n  }\n\n  gcEnabledInterval(pseudoCtx: any) {\n    const { rootState } = pseudoCtx;\n\n    // Don't use a getter... as we'll end up triggering ourselves again\n    const uiPerfGarbageCollection = this.getUiPerfGarbageCollection(rootState);\n\n    return {\n      enabled:  uiPerfGarbageCollection?.enabledInterval,\n      interval: uiPerfGarbageCollection?.interval || 0\n    };\n  }\n\n  gcEnabledRoute(pseudoCtx: any) {\n    const { rootState } = pseudoCtx;\n\n    // Don't use a getter... as we'll end up triggering ourselves again\n    const uiPerfGarbageCollection = this.getUiPerfGarbageCollection(rootState);\n\n    return uiPerfGarbageCollection?.enabledOnNavigate;\n  }\n\n  // ------------- GC (actual) ---------------------\n\n  /**\n   * Remove stale resource types from the store and stop watching them for changes\n   */\n  garbageCollect(ctx: any, ignoreTypes: {[type: string]: boolean} = {}) {\n    const now = new Date().getTime();\n\n    // Is gc currently running OR has run in the past GC_RE_RUN_GAP return early\n    if (this.gcLastRun === null || now - this.gcLastRun < GarbageCollect.GC_RE_RUN_GAP) {\n      this.debugLog('Skipping (running or recently run)', this.gcLastRun ? new Date(this.gcLastRun) : 'running');\n\n      return;\n    }\n\n    this.gcLastRun = null;\n    const gcd: {[type: string]: number} = {};\n\n    try {\n      const { getters, rootState, dispatch } = ctx;\n\n      if (!rootState.clusterReady) {\n        this.debugLog('Skipping (cluster not ready)');\n        this.gcLastRun = new Date().getTime();\n\n        return ;\n      }\n      this.debugLog(`------ Started ------`);\n\n      const uiPerfGarbageCollection = this.getUiPerfGarbageCollection(rootState);\n\n      if (!uiPerfGarbageCollection) {\n        return ;\n      }\n      const maxAge = uiPerfGarbageCollection.ageThreshold * 1000;\n      const maxCount = uiPerfGarbageCollection.countThreshold;\n\n      this.debugLog(`Max Age: ${ maxAge }. Max Count: ${ maxCount }`);// , 'Cache', this.lastAccessedCache\n\n      const store = ctx.state.config.namespace;\n\n      // this.debugLog('Cache', this.lastAccessedCache);\n\n      Object.entries((this.lastAccessedCache[store] || {})).forEach(([type, lastAccessed]) => {\n        if (!lastAccessed) {\n          // There's no last accessed time... gc is probably disabled in another way\n          this.debugLog(`${ type }: Skipping (no accessed time)`);\n\n          return;\n        }\n\n        if (!this.gcEnabledForType(ctx, type)) {\n          // This specific store is telling us to ignore the type (for example `cluster` store will not GC schema's, counts, etc)\n          this.debugLog(`${ type }: Skipping (type ignored by store)`);\n\n          return;\n        }\n\n        if (ignoreTypes[type]) {\n          // We're going to a place that needs the resource\n          this.debugLog(`${ type }: Skipping (navigating to type)`);\n\n          return;\n        }\n\n        if (now - lastAccessed <= maxAge) {\n          // The resource was recently accessed\n\n          this.debugLog(`${ type }: Skipping (recently accessed)`);\n\n          return;\n        }\n\n        if (this.lastRouteChange !== undefined && this.lastRouteChange < lastAccessed ) {\n          // The resource is being used in the current route/page\n          this.debugLog(`${ type }: Skipping (used in current route/page)`);\n\n          return;\n        }\n\n        const countFromResource = getters.all(COUNT)[0].counts[type]?.summary.count;\n        const currentCount = countFromResource ?? 0;\n\n        if (currentCount === undefined || currentCount < maxCount) {\n          // There's too few resources, we might as well keep them to avoid a network request when we need them again\n          this.debugLog(`${ type }: Skipping (too few of resource)`);\n\n          return;\n        }\n\n        this.debugLog(`${ type }: Removing from store`);\n        dispatch('forgetType', type);\n        gcd[type] = currentCount;\n      });\n\n      this.gcLastRun = new Date().getTime();\n    } catch (e) {\n      this.debugLog(`: Error`, e);\n      this.gcLastRun = new Date().getTime();\n    }\n\n    if (Object.keys(gcd).length > 0) {\n      console.info('Garbage Collected Resources', gcd); // eslint-disable-line no-console\n    }\n\n    this.debugLog(`------ Finished ------`);\n  }\n\n  // ------------- GC Update local cache ---------------------\n\n  /**\n   * Update the time that the resource type was accessed\n   * This needs to run after any type initialisation (aka registerType)\n   */\n  gcUpdateLastAccessed(pseudoCtx: any, type: string) {\n    if (!this.gcEnabledAll(pseudoCtx, type)) {\n      return;\n    }\n    const store = pseudoCtx.state.config.namespace;\n\n    if (!this.lastAccessedCache[store]) {\n      this.lastAccessedCache[store] = {};\n    }\n\n    this.lastAccessedCache[store][type] = new Date().getTime();\n  }\n\n  /**\n   * Update the time the user last changed routes\n   */\n  gcUpdateRouteChanged() {\n    this.lastRouteChange = new Date().getTime();\n  }\n\n  // ------------- GC reset ---------------------\n\n  /**\n   * Remove all cached access times for the given store\n   */\n  gcResetStore(state: any) {\n    const store = state.config.namespace;\n\n    delete this.lastAccessedCache[store];\n\n    this.debugLog('Forgetting Store:', store);\n  }\n\n  /**\n   * Remove cached access time for the given resource type\n   */\n  gcResetType(state: any, type: string) {\n    const store = state.config.namespace;\n\n    if (!this.lastAccessedCache[store]) {\n      return;\n    }\n    delete this.lastAccessedCache[store][type];\n\n    this.debugLog('Forgetting Type:', store, type);\n  }\n}\n\nconst gc = new GarbageCollect();\n\nexport default gc;\n"]}]}
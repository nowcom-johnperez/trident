{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js??ref--17-1!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/ts-loader/index.js","mtime":1716430466133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgTkFNRVNQQUNFX0ZJTFRFUl9OU19GVUxMX1BSRUZJWCwgTkFNRVNQQUNFX0ZJTFRFUl9QX0ZVTExfUFJFRklYIH0gZnJvbSAnQHNoZWxsL3V0aWxzL25hbWVzcGFjZS1maWx0ZXInOwppbXBvcnQgeyBnZXRQZXJmb3JtYW5jZVNldHRpbmcgfSBmcm9tICdAc2hlbGwvdXRpbHMvc2V0dGluZ3MnOwpjbGFzcyBQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nIHsKICAgIC8qKgogICAgICogRG9lcyB0aGUgcmVxdWVzdCBgb3B0YCBkZWZpbml0aW9uIHJlcXVpcmUgcmVzb3VyY2VzIGFyZSBmZXRjaGVkIGZyb20gYSBzcGVjaWZpYyBzZXQgbmFtZXNwYWNlcy9wcm9qZWN0cz8KICAgICAqLwogICAgaXNBcHBsaWNhYmxlKG9wdCkgewogICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdC5uYW1lc3BhY2VkKTsKICAgIH0KICAgIGlzRW5hYmxlZChyb290R2V0dGVycykgewogICAgICAgIHZhciBfYTsKICAgICAgICBjb25zdCBjdXJyZW50UHJvZHVjdCA9IHJvb3RHZXR0ZXJzWydjdXJyZW50UHJvZHVjdCddOwogICAgICAgIC8vIE9ubHkgZW5hYmxlIGZvciB0aGUgY2x1c3RlciBzdG9yZSBhdCB0aGUgbW9tZW50LiBJbiB0aGVvcnkgdGhpcyBzaG91bGQgd29yayBpbiBtYW5hZ2VtZW50IGFzIHdlbGwsIGFzIHRoZXkncmUgYm90aCAnc3RldmUnIHN0b3JlcwogICAgICAgIGlmICgoY3VycmVudFByb2R1Y3QgPT09IG51bGwgfHwgY3VycmVudFByb2R1Y3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJlbnRQcm9kdWN0LmluU3RvcmUpICE9PSAnY2x1c3RlcicpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoY3VycmVudFByb2R1Y3QgPT09IG51bGwgfHwgY3VycmVudFByb2R1Y3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJlbnRQcm9kdWN0LnNob3dXb3Jrc3BhY2VTd2l0Y2hlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBlcmZDb25maWcgPSBnZXRQZXJmb3JtYW5jZVNldHRpbmcocm9vdEdldHRlcnMpOwogICAgICAgIGlmICghKChfYSA9IHBlcmZDb25maWcuZm9yY2VOc0ZpbHRlclYyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW5hYmxlZCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYG9wdGAgcmVxdWlyZXMgcmVzb3VyY2VzIGZyb20gc3BlY2lmaWMgbnMvcHJvamVjdHMsIGlmIHNvIHJldHVybiB0aGUgcmVxdWlyZWQgcXVlcnkgcGFyYW0gKHg9eSkKICAgICAqLwogICAgY2hlY2tBbmRDcmVhdGVQYXJhbShvcHQpIHsKICAgICAgICBpZiAoIXRoaXMuaXNBcHBsaWNhYmxlKG9wdCkpIHsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVQYXJhbShvcHQubmFtZXNwYWNlZCk7CiAgICB9CiAgICBjcmVhdGVQYXJhbShuYW1lc3BhY2VGaWx0ZXIpIHsKICAgICAgICBpZiAoIW5hbWVzcGFjZUZpbHRlciB8fCAhbmFtZXNwYWNlRmlsdGVyLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHByb2plY3RzT3JOYW1lc3BhY2VzID0gbmFtZXNwYWNlRmlsdGVyCiAgICAgICAgICAgIC5tYXAoKGYpID0+IGYucmVwbGFjZShOQU1FU1BBQ0VfRklMVEVSX05TX0ZVTExfUFJFRklYLCAnJykKICAgICAgICAgICAgLnJlcGxhY2UoTkFNRVNQQUNFX0ZJTFRFUl9QX0ZVTExfUFJFRklYLCAnJykpCiAgICAgICAgICAgIC5qb2luKCcsJyk7CiAgICAgICAgcmV0dXJuIGAke1Byb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcucGFyYW19PSR7cHJvamVjdHNPck5hbWVzcGFjZXN9YDsKICAgIH0KfQpQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nLnBhcmFtID0gJ3Byb2plY3Rzb3JuYW1lc3BhY2VzJzsKZXhwb3J0IGRlZmF1bHQgbmV3IFByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcoKTsK"},{"version":3,"file":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts","sourceRoot":"","sources":["/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/utils/projectAndNamespaceFiltering.utils.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,+BAA+B,EAAE,8BAA8B,EAAE,MAAM,+BAA+B,CAAC;AAChH,OAAO,EAAE,qBAAqB,EAAE,MAAM,uBAAuB,CAAC;AAI9D,MAAM,4BAA4B;IAGhC;;OAEG;IACH,YAAY,CAAC,GAAQ;QACnB,OAAO,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;IACvC,CAAC;IAED,SAAS,CAAC,WAAgB;;QACxB,MAAM,cAAc,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC;QAErD,oIAAoI;QACpI,IAAI,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,OAAO,MAAK,SAAS,EAAE;YACzC,OAAO,KAAK,CAAC;SACd;QAED,IAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,qBAAqB,EAAE;YACzC,OAAO,KAAK,CAAC;SACd;QAED,MAAM,UAAU,GAAG,qBAAqB,CAAC,WAAW,CAAC,CAAC;QAEtD,IAAI,QAAC,UAAU,CAAC,eAAe,0CAAE,OAAO,CAAA,EAAE;YACxC,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;OAEG;IACH,mBAAmB,CAAC,GAAQ;QAC1B,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE;YAC3B,OAAO,EAAE,CAAC;SACX;QAED,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;IAC1C,CAAC;IAEO,WAAW,CAAC,eAAqC;QACvD,IAAI,CAAC,eAAe,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE;YAC/C,OAAO,EAAE,CAAC;SACX;QAED,MAAM,oBAAoB,GAAG,eAAe;aACzC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,+BAA+B,EAAE,EAAE,CAAC;aACvD,OAAO,CAAC,8BAA8B,EAAE,EAAE,CAAC,CAAC;aAC9C,IAAI,CAAC,GAAG,CAAC,CAAC;QAEb,OAAO,GAAI,4BAA4B,CAAC,KAAM,IAAK,oBAAqB,EAAE,CAAC;IAC7E,CAAC;;AApDM,kCAAK,GAAG,sBAAsB,CAAA;AAuDvC,eAAe,IAAI,4BAA4B,EAAE,CAAC","sourcesContent":["import { NAMESPACE_FILTER_NS_FULL_PREFIX, NAMESPACE_FILTER_P_FULL_PREFIX } from '@shell/utils/namespace-filter';\nimport { getPerformanceSetting } from '@shell/utils/settings';\n\ntype Opt = { [key: string]: any, namespaced?: string[]}\n\nclass ProjectAndNamespaceFiltering {\n  static param = 'projectsornamespaces'\n\n  /**\n   * Does the request `opt` definition require resources are fetched from a specific set namespaces/projects?\n   */\n  isApplicable(opt: Opt): boolean {\n    return Array.isArray(opt.namespaced);\n  }\n\n  isEnabled(rootGetters: any): boolean {\n    const currentProduct = rootGetters['currentProduct'];\n\n    // Only enable for the cluster store at the moment. In theory this should work in management as well, as they're both 'steve' stores\n    if (currentProduct?.inStore !== 'cluster') {\n      return false;\n    }\n\n    if (currentProduct?.showWorkspaceSwitcher) {\n      return false;\n    }\n\n    const perfConfig = getPerformanceSetting(rootGetters);\n\n    if (!perfConfig.forceNsFilterV2?.enabled) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if `opt` requires resources from specific ns/projects, if so return the required query param (x=y)\n   */\n  checkAndCreateParam(opt: Opt): string {\n    if (!this.isApplicable(opt)) {\n      return '';\n    }\n\n    return this.createParam(opt.namespaced);\n  }\n\n  private createParam(namespaceFilter: string[] | undefined): string {\n    if (!namespaceFilter || !namespaceFilter.length) {\n      return '';\n    }\n\n    const projectsOrNamespaces = namespaceFilter\n      .map((f) => f.replace(NAMESPACE_FILTER_NS_FULL_PREFIX, '')\n        .replace(NAMESPACE_FILTER_P_FULL_PREFIX, ''))\n      .join(',');\n\n    return `${ ProjectAndNamespaceFiltering.param }=${ projectsOrNamespaces }`;\n  }\n}\n\nexport default new ProjectAndNamespaceFiltering();\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/PromptRestore.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/PromptRestore.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcFN0YXRlLCBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCc7CmltcG9ydCBBc3luY0J1dHRvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Bc3luY0J1dHRvbic7CmltcG9ydCB7IENhcmQgfSBmcm9tICdAY29tcG9uZW50cy9DYXJkJzsKaW1wb3J0IHsgQmFubmVyIH0gZnJvbSAnQGNvbXBvbmVudHMvQmFubmVyJzsKaW1wb3J0IERhdGUgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybWF0dGVyL0RhdGUudnVlJzsKaW1wb3J0IFJhZGlvR3JvdXAgZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9SYWRpby9SYWRpb0dyb3VwLnZ1ZSc7CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdC52dWUnOwppbXBvcnQgeyBleGNlcHRpb25Ub0Vycm9yc0FycmF5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL2Vycm9yJzsKaW1wb3J0IHsgQ0FQSSwgTk9STUFOLCBTTkFQU0hPVCB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBzZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IENoaWxkSG9vaywgeyBCRUZPUkVfU0FWRV9IT09LUyB9IGZyb20gJ0BzaGVsbC9taXhpbnMvY2hpbGQtaG9vayc7CmltcG9ydCB7IERBVEVfRk9STUFULCBUSU1FX0ZPUk1BVCB9IGZyb20gJ0BzaGVsbC9zdG9yZS9wcmVmcyc7CmltcG9ydCB7IGVzY2FwZUh0bWwgfSBmcm9tICdAc2hlbGwvdXRpbHMvc3RyaW5nJzsKaW1wb3J0IGRheSBmcm9tICdkYXlqcyc7CmltcG9ydCB7IHNvcnRCeSB9IGZyb20gJ0BzaGVsbC91dGlscy9zb3J0JzsKaW1wb3J0IHsgU1RBVEVTX0VOVU0gfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9kYXNoYm9hcmQtc3RvcmUvcmVzb3VyY2UtY2xhc3MnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIENhcmQsCiAgICBBc3luY0J1dHRvbiwKICAgIEJhbm5lciwKICAgIERhdGUsCiAgICBMYWJlbGVkU2VsZWN0LAogICAgUmFkaW9Hcm91cCwKICB9LAoKICBuYW1lOiAnUHJvbXB0UmVzdG9yZScsCgogIG1peGluczogWwogICAgQ2hpbGRIb29rLAogIF0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlcnJvcnM6ICAgICAgICAgICBbXSwKICAgICAgbGFiZWxzOiAgICAgICAgICAge30sCiAgICAgIHJlc3RvcmVNb2RlOiAgICAgICdhbGwnLAogICAgICBsb2FkZWQ6ICAgICAgICAgICBmYWxzZSwKICAgICAgYWxsU25hcHNob3RzOiAgICAge30sCiAgICAgIHNvcnRlZFNuYXBzaG90czogIFtdLAogICAgICBzZWxlY3RlZFNuYXBzaG90OiBudWxsLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgLy8gdG9SZXN0b3JlIGNhbiBiZSBhIHByb3Zpc2lvbmluZy5jYXR0bGUuaW8uY2x1c3RlciBvciBhIHJrZS5jYXR0bGUuaW8uZXRjZHNuYXBzaG90IG9yIGFuIGV0Y2RCYWNrdXAgcmVzb3VyY2UKICAgIC4uLm1hcFN0YXRlKCdhY3Rpb24tbWVudScsIFsnc2hvd1Byb21wdFJlc3RvcmUnLCAndG9SZXN0b3JlJ10pLAogICAgLi4ubWFwR2V0dGVycyh7IHQ6ICdpMThuL3QnIH0pLAoKICAgIC8vIFdhcyB0aGUgZGlhbG9nIG9wZW5lZCB0byByZXN0b3JlIGEgc3BlY2lmaWMgc25hcHNob3QsIG9yIG9wZW5lZCBvbiBhIGNsdXN0ZXIgdG8gY2hvb3NlCiAgICBpc0NsdXN0ZXIoKSB7CiAgICAgIGNvbnN0IGlzU25hcHNob3QgPSB0aGlzLnRvUmVzdG9yZVswXT8udHlwZS50b0xvd2VyQ2FzZSgpID09PSBOT1JNQU4uRVRDRF9CQUNLVVAgfHwKICAgICAgdGhpcy50b1Jlc3RvcmVbMF0/LnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gU05BUFNIT1Q7CgogICAgICByZXR1cm4gIWlzU25hcHNob3Q7CiAgICB9LAoKICAgIHNuYXBzaG90KCkgewogICAgICByZXR1cm4gIXRoaXMuaXNDbHVzdGVyID8gdGhpcy50b1Jlc3RvcmVbMF0gOiB0aGlzLmFsbFNuYXBzaG90c1t0aGlzLnNlbGVjdGVkU25hcHNob3RdOwogICAgfSwKCiAgICBoYXNTbmFwc2hvdCgpIHsKICAgICAgcmV0dXJuICEhdGhpcy5zbmFwc2hvdDsKICAgIH0sCgogICAgaXNSa2UyKCkgewogICAgICByZXR1cm4gISF0aGlzLnNuYXBzaG90Py5ya2UyOwogICAgfSwKCiAgICBjbHVzdGVyU25hcHNob3RzKCkgewogICAgICBpZiAodGhpcy5zb3J0ZWRTbmFwc2hvdHMpIHsKICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTbmFwc2hvdHMubWFwKChzbmFwc2hvdCkgPT4gKHsgbGFiZWw6IHRoaXMuc25hcHNob3RMYWJlbChzbmFwc2hvdCksIHZhbHVlOiBzbmFwc2hvdC5uYW1lIH0pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCiAgICByZXN0b3JlTW9kZU9wdGlvbnMoKSB7CiAgICAgIGNvbnN0IGV0Y2RPcHRpb24gPSB0aGlzLmlzUmtlMiA/ICdub25lJyA6ICdldGNkJzsKCiAgICAgIHJldHVybiBbZXRjZE9wdGlvbiwgJ2t1YmVybmV0ZXNWZXJzaW9uJywgJ2FsbCddOwogICAgfQogIH0sCgogIHdhdGNoOiB7CiAgICBhc3luYyBzaG93UHJvbXB0UmVzdG9yZShzaG93KSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlOwogICAgICAgIHRoaXMuJG1vZGFsLnNob3coJ3Byb21wdFJlc3RvcmUnKTsKICAgICAgICBhd2FpdCB0aGlzLmZldGNoU25hcHNob3RzKCk7CiAgICAgICAgdGhpcy5zZWxlY3REZWZhdWx0U25hcHNob3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuJG1vZGFsLmhpZGUoJ3Byb21wdFJlc3RvcmUnKTsKICAgICAgfQogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIGNsb3NlKCkgewogICAgICB0aGlzLmVycm9ycyA9IFtdOwogICAgICB0aGlzLmxhYmVscyA9IHt9OwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ2FjdGlvbi1tZW51L3RvZ2dsZVByb21wdFJlc3RvcmUnKTsKICAgICAgdGhpcy5zZWxlY3RlZFNuYXBzaG90ID0gbnVsbDsKICAgIH0sCgogICAgLy8gSWYgdGhlIHVzZXIgbmVlZHMgdG8gY2hvb3NlIGEgc25hcHNob3QsIGZldGNoIGFsbCBzbmFwc2hvdHMgZm9yIHRoZSBjbHVzdGVyCiAgICBhc3luYyBmZXRjaFNuYXBzaG90cygpIHsKICAgICAgaWYgKCF0aGlzLmlzQ2x1c3RlcikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgY2x1c3RlciA9IHRoaXMudG9SZXN0b3JlPy5bMF07CiAgICAgIGxldCBwcm9taXNlOwoKICAgICAgaWYgKCFjbHVzdGVyPy5pc1JrZTIpIHsKICAgICAgICBwcm9taXNlID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZEFsbCcsIHsgdHlwZTogTk9STUFOLkVUQ0RfQkFDS1VQIH0pLnRoZW4oKHNuYXBzaG90cykgPT4gewogICAgICAgICAgcmV0dXJuIHNuYXBzaG90cy5maWx0ZXIoKHMpID0+IHMuc3RhdGUgPT09IFNUQVRFU19FTlVNLkFDVElWRSAmJiBzLmNsdXN0ZXJJZCA9PT0gY2x1c3Rlci5tZXRhZGF0YS5uYW1lKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9taXNlID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogU05BUFNIT1QgfSkudGhlbigoc25hcHNob3RzKSA9PiB7CiAgICAgICAgICBjb25zdCB0b1Jlc3RvcmVDbHVzdGVyTmFtZSA9IGNsdXN0ZXI/LmNsdXN0ZXJOYW1lIHx8IGNsdXN0ZXI/Lm1ldGFkYXRhPy5uYW1lOwoKICAgICAgICAgIHJldHVybiBzbmFwc2hvdHMuZmlsdGVyKChzKSA9PiBzPy5zbmFwc2hvdEZpbGU/LnN0YXR1cyA9PT0gU1RBVEVTX0VOVU0uU1VDQ0VTU0ZVTCAmJiBzLmNsdXN0ZXJOYW1lID09PSB0b1Jlc3RvcmVDbHVzdGVyTmFtZQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgLy8gTWFwIG9mIHNuYXBzaG90cyBieSBuYW1lCiAgICAgIGNvbnN0IGFsbFNuYXBzaG90cyA9IGF3YWl0IHByb21pc2UudGhlbigoc25hcHNob3RzKSA9PiB7CiAgICAgICAgcmV0dXJuIHNuYXBzaG90cy5yZWR1Y2UoKHYsIHMpID0+IHsKICAgICAgICAgIHZbcy5uYW1lXSA9IHM7CgogICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgfSwge30pOwogICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBleGNlcHRpb25Ub0Vycm9yc0FycmF5KGVycik7CiAgICAgIH0pOwoKICAgICAgdGhpcy5hbGxTbmFwc2hvdHMgPSBhbGxTbmFwc2hvdHM7CiAgICAgIHRoaXMuc29ydGVkU25hcHNob3RzID0gc29ydEJ5KE9iamVjdC52YWx1ZXModGhpcy5hbGxTbmFwc2hvdHMpLCBbJ3NuYXBzaG90RmlsZS5jcmVhdGVkQXQnLCAnY3JlYXRlZCcsICdtZXRhZGF0YS5jcmVhdGlvblRpbWVzdGFtcCddLCB0cnVlKTsKICAgIH0sCgogICAgc2VsZWN0RGVmYXVsdFNuYXBzaG90KCkgewogICAgICBpZiAodGhpcy5zZWxlY3RlZFNuYXBzaG90KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBkZWZhdWx0U25hcHNob3QgPSB0aGlzLnRvUmVzdG9yZVswXT8udHlwZSA9PT0gU05BUFNIT1QgPyB0aGlzLnRvUmVzdG9yZVswXS5uYW1lIDogdGhpcy5jbHVzdGVyU25hcHNob3RzWzBdPy52YWx1ZTsKCiAgICAgIHRoaXMuJHNldCh0aGlzLCAnc2VsZWN0ZWRTbmFwc2hvdCcsIGRlZmF1bHRTbmFwc2hvdCk7CiAgICB9LAoKICAgIGFzeW5jIGFwcGx5KGJ1dHRvbkRvbmUpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIHRoaXMuaXNSa2UyICkgewogICAgICAgICAgY29uc3QgY2x1c3RlciA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYnlJZCddKENBUEkuUkFOQ0hFUl9DTFVTVEVSLCB0aGlzLnNuYXBzaG90LmNsdXN0ZXJJZCk7CgogICAgICAgICAgYXdhaXQgdGhpcy5hcHBseUhvb2tzKEJFRk9SRV9TQVZFX0hPT0tTKTsKCiAgICAgICAgICBjb25zdCBub3cgPSBjbHVzdGVyLnNwZWM/LnJrZUNvbmZpZz8uZXRjZFNuYXBzaG90UmVzdG9yZT8uZ2VuZXJhdGlvbiB8fCAwOwoKICAgICAgICAgIHNldChjbHVzdGVyLCAnc3BlYy5ya2VDb25maWcuZXRjZFNuYXBzaG90UmVzdG9yZScsIHsKICAgICAgICAgICAgZ2VuZXJhdGlvbjogICAgICAgbm93ICsgMSwKICAgICAgICAgICAgbmFtZTogICAgICAgICAgICAgdGhpcy5zbmFwc2hvdC5uYW1lLAogICAgICAgICAgICByZXN0b3JlUktFQ29uZmlnOiB0aGlzLnJlc3RvcmVNb2RlLAogICAgICAgICAgfSk7CgogICAgICAgICAgYXdhaXQgY2x1c3Rlci5zYXZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL3JlcXVlc3QnLCB7CiAgICAgICAgICAgIHVybDogICAgYC92My9jbHVzdGVycy8keyBlc2NhcGUodGhpcy5zbmFwc2hvdC5jbHVzdGVySWQpIH0/YWN0aW9uPXJlc3RvcmVGcm9tRXRjZEJhY2t1cGAsCiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICBkYXRhOiAgIHsKICAgICAgICAgICAgICBldGNkQmFja3VwSWQ6ICAgICB0aGlzLnNuYXBzaG90LmlkLAogICAgICAgICAgICAgIHJlc3RvcmVSa2VDb25maWc6IHRoaXMucmVzdG9yZU1vZGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdncm93bC9zdWNjZXNzJywgewogICAgICAgICAgdGl0bGU6ICAgdGhpcy50KCdwcm9tcHRSZXN0b3JlLm5vdGlmaWNhdGlvbi50aXRsZScpLAogICAgICAgICAgbWVzc2FnZTogdGhpcy50KCdwcm9tcHRSZXN0b3JlLm5vdGlmaWNhdGlvbi5tZXNzYWdlJywgeyBzZWxlY3RlZFNuYXBzaG90OiB0aGlzLnNlbGVjdGVkU25hcHNob3QgfSkKICAgICAgICB9LCB7IHJvb3Q6IHRydWUgfSk7CgogICAgICAgIGJ1dHRvbkRvbmUodHJ1ZSk7CiAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICB0aGlzLmVycm9ycyA9IGV4Y2VwdGlvblRvRXJyb3JzQXJyYXkoZXJyKTsKICAgICAgICBidXR0b25Eb25lKGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIHNuYXBzaG90TGFiZWwoc25hcHNob3QpIHsKICAgICAgY29uc3QgZGF0ZUZvcm1hdCA9IGVzY2FwZUh0bWwodGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJlZnMvZ2V0J10oREFURV9GT1JNQVQpKTsKICAgICAgY29uc3QgdGltZUZvcm1hdCA9IGVzY2FwZUh0bWwoIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3ByZWZzL2dldCddKFRJTUVfRk9STUFUKSk7CgogICAgICBjb25zdCBjcmVhdGVkID0gc25hcHNob3QuY3JlYXRlZEF0IHx8IHNuYXBzaG90LmNyZWF0ZWQgfHwgc25hcHNob3QubWV0YWRhdGEuY3JlYXRpb25UaW1lc3RhbXA7CiAgICAgIGNvbnN0IGQgPSBkYXkoY3JlYXRlZCkuZm9ybWF0KGRhdGVGb3JtYXQpOwogICAgICBjb25zdCB0ID0gZGF5KGNyZWF0ZWQpLmZvcm1hdCh0aW1lRm9ybWF0KTsKCiAgICAgIHJldHVybiBgJHsgZCB9ICR7IHQgfSA6ICR7IHNuYXBzaG90Lm5hbWVEaXNwbGF5IH1gOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["PromptRestore.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"PromptRestore.vue","sourceRoot":"node_modules/@rancher/shell/components","sourcesContent":["<script>\nimport { mapState, mapGetters } from 'vuex';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Card } from '@components/Card';\nimport { Banner } from '@components/Banner';\nimport Date from '@shell/components/formatter/Date.vue';\nimport RadioGroup from '@components/Form/Radio/RadioGroup.vue';\nimport LabeledSelect from '@shell/components/form/LabeledSelect.vue';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport { CAPI, NORMAN, SNAPSHOT } from '@shell/config/types';\nimport { set } from '@shell/utils/object';\nimport ChildHook, { BEFORE_SAVE_HOOKS } from '@shell/mixins/child-hook';\nimport { DATE_FORMAT, TIME_FORMAT } from '@shell/store/prefs';\nimport { escapeHtml } from '@shell/utils/string';\nimport day from 'dayjs';\nimport { sortBy } from '@shell/utils/sort';\nimport { STATES_ENUM } from '@shell/plugins/dashboard-store/resource-class';\n\nexport default {\n  components: {\n    Card,\n    AsyncButton,\n    Banner,\n    Date,\n    LabeledSelect,\n    RadioGroup,\n  },\n\n  name: 'PromptRestore',\n\n  mixins: [\n    ChildHook,\n  ],\n\n  data() {\n    return {\n      errors:           [],\n      labels:           {},\n      restoreMode:      'all',\n      loaded:           false,\n      allSnapshots:     {},\n      sortedSnapshots:  [],\n      selectedSnapshot: null,\n    };\n  },\n\n  computed: {\n    // toRestore can be a provisioning.cattle.io.cluster or a rke.cattle.io.etcdsnapshot or an etcdBackup resource\n    ...mapState('action-menu', ['showPromptRestore', 'toRestore']),\n    ...mapGetters({ t: 'i18n/t' }),\n\n    // Was the dialog opened to restore a specific snapshot, or opened on a cluster to choose\n    isCluster() {\n      const isSnapshot = this.toRestore[0]?.type.toLowerCase() === NORMAN.ETCD_BACKUP ||\n      this.toRestore[0]?.type.toLowerCase() === SNAPSHOT;\n\n      return !isSnapshot;\n    },\n\n    snapshot() {\n      return !this.isCluster ? this.toRestore[0] : this.allSnapshots[this.selectedSnapshot];\n    },\n\n    hasSnapshot() {\n      return !!this.snapshot;\n    },\n\n    isRke2() {\n      return !!this.snapshot?.rke2;\n    },\n\n    clusterSnapshots() {\n      if (this.sortedSnapshots) {\n        return this.sortedSnapshots.map((snapshot) => ({ label: this.snapshotLabel(snapshot), value: snapshot.name }));\n      } else {\n        return [];\n      }\n    },\n    restoreModeOptions() {\n      const etcdOption = this.isRke2 ? 'none' : 'etcd';\n\n      return [etcdOption, 'kubernetesVersion', 'all'];\n    }\n  },\n\n  watch: {\n    async showPromptRestore(show) {\n      if (show) {\n        this.loaded = true;\n        this.$modal.show('promptRestore');\n        await this.fetchSnapshots();\n        this.selectDefaultSnapshot();\n      } else {\n        this.loaded = false;\n        this.$modal.hide('promptRestore');\n      }\n    }\n  },\n\n  methods: {\n    close() {\n      this.errors = [];\n      this.labels = {};\n      this.$store.commit('action-menu/togglePromptRestore');\n      this.selectedSnapshot = null;\n    },\n\n    // If the user needs to choose a snapshot, fetch all snapshots for the cluster\n    async fetchSnapshots() {\n      if (!this.isCluster) {\n        return;\n      }\n\n      const cluster = this.toRestore?.[0];\n      let promise;\n\n      if (!cluster?.isRke2) {\n        promise = this.$store.dispatch('rancher/findAll', { type: NORMAN.ETCD_BACKUP }).then((snapshots) => {\n          return snapshots.filter((s) => s.state === STATES_ENUM.ACTIVE && s.clusterId === cluster.metadata.name);\n        });\n      } else {\n        promise = this.$store.dispatch('management/findAll', { type: SNAPSHOT }).then((snapshots) => {\n          const toRestoreClusterName = cluster?.clusterName || cluster?.metadata?.name;\n\n          return snapshots.filter((s) => s?.snapshotFile?.status === STATES_ENUM.SUCCESSFUL && s.clusterName === toRestoreClusterName\n          );\n        });\n      }\n\n      // Map of snapshots by name\n      const allSnapshots = await promise.then((snapshots) => {\n        return snapshots.reduce((v, s) => {\n          v[s.name] = s;\n\n          return v;\n        }, {});\n      }).catch((err) => {\n        this.errors = exceptionToErrorsArray(err);\n      });\n\n      this.allSnapshots = allSnapshots;\n      this.sortedSnapshots = sortBy(Object.values(this.allSnapshots), ['snapshotFile.createdAt', 'created', 'metadata.creationTimestamp'], true);\n    },\n\n    selectDefaultSnapshot() {\n      if (this.selectedSnapshot) {\n        return;\n      }\n\n      const defaultSnapshot = this.toRestore[0]?.type === SNAPSHOT ? this.toRestore[0].name : this.clusterSnapshots[0]?.value;\n\n      this.$set(this, 'selectedSnapshot', defaultSnapshot);\n    },\n\n    async apply(buttonDone) {\n      try {\n        if ( this.isRke2 ) {\n          const cluster = this.$store.getters['management/byId'](CAPI.RANCHER_CLUSTER, this.snapshot.clusterId);\n\n          await this.applyHooks(BEFORE_SAVE_HOOKS);\n\n          const now = cluster.spec?.rkeConfig?.etcdSnapshotRestore?.generation || 0;\n\n          set(cluster, 'spec.rkeConfig.etcdSnapshotRestore', {\n            generation:       now + 1,\n            name:             this.snapshot.name,\n            restoreRKEConfig: this.restoreMode,\n          });\n\n          await cluster.save();\n        } else {\n          await this.$store.dispatch('rancher/request', {\n            url:    `/v3/clusters/${ escape(this.snapshot.clusterId) }?action=restoreFromEtcdBackup`,\n            method: 'post',\n            data:   {\n              etcdBackupId:     this.snapshot.id,\n              restoreRkeConfig: this.restoreMode,\n            },\n          });\n        }\n\n        this.$store.dispatch('growl/success', {\n          title:   this.t('promptRestore.notification.title'),\n          message: this.t('promptRestore.notification.message', { selectedSnapshot: this.selectedSnapshot })\n        }, { root: true });\n\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    },\n    snapshotLabel(snapshot) {\n      const dateFormat = escapeHtml(this.$store.getters['prefs/get'](DATE_FORMAT));\n      const timeFormat = escapeHtml( this.$store.getters['prefs/get'](TIME_FORMAT));\n\n      const created = snapshot.createdAt || snapshot.created || snapshot.metadata.creationTimestamp;\n      const d = day(created).format(dateFormat);\n      const t = day(created).format(timeFormat);\n\n      return `${ d } ${ t } : ${ snapshot.nameDisplay }`;\n    }\n  }\n};\n</script>\n\n<template>\n  <modal\n    class=\"promptrestore-modal\"\n    name=\"promptRestore\"\n    styles=\"background-color: var(--nav-bg); border-radius: var(--border-radius); max-height: 100vh;\"\n    height=\"auto\"\n    :scrollable=\"true\"\n  >\n    <Card\n      v-if=\"loaded\"\n      class=\"prompt-restore\"\n      :show-highlight-border=\"false\"\n    >\n      <h4\n        slot=\"title\"\n        v-clean-html=\"t('promptRestore.title', null, true)\"\n        class=\"text-default-text\"\n      />\n\n      <div\n        slot=\"body\"\n        class=\"pl-10 pr-10\"\n      >\n        <form>\n          <h3 v-t=\"'promptRestore.name'\" />\n          <div v-if=\"!isCluster\">\n            {{ snapshot.nameDisplay }}\n          </div>\n\n          <LabeledSelect\n            v-if=\"isCluster\"\n            v-model=\"selectedSnapshot\"\n            :label=\"t('promptRestore.label')\"\n            :placeholder=\"t('promptRestore.placeholder')\"\n            :options=\"clusterSnapshots\"\n          />\n\n          <div class=\"spacer\" />\n\n          <h3 v-t=\"'promptRestore.date'\" />\n          <div>\n            <p>\n              <Date\n                v-if=\"snapshot\"\n                :value=\"snapshot.createdAt || snapshot.created || snapshot.metadata.creationTimestamp\"\n              />\n            </p>\n          </div>\n          <div class=\"spacer\" />\n          <RadioGroup\n            v-model=\"restoreMode\"\n            name=\"restoreMode\"\n            label=\"Restore Type\"\n            :labels=\"['Only etcd', 'Kubernetes version and etcd', 'Cluster config, Kubernetes version and etcd']\"\n            :options=\"restoreModeOptions\"\n          />\n        </form>\n      </div>\n\n      <div\n        slot=\"actions\"\n        class=\"dialog-actions\"\n      >\n        <button\n          class=\"btn role-secondary\"\n          @click=\"close\"\n        >\n          {{ t('generic.cancel') }}\n        </button>\n\n        <AsyncButton\n          mode=\"restore\"\n          :disabled=\"!hasSnapshot\"\n          @click=\"apply\"\n        />\n\n        <Banner\n          v-for=\"(err, i) in errors\"\n          :key=\"i\"\n          color=\"error\"\n          :label=\"err\"\n        />\n      </div>\n    </Card>\n  </modal>\n</template>\n\n<style lang='scss' scoped>\n  .promptrestore-modal {\n    border-radius: var(--border-radius);\n    overflow: scroll;\n    max-height: 100vh;\n    & ::-webkit-scrollbar-corner {\n      background: rgba(0,0,0,0);\n    }\n\n    .prompt-restore form p {\n      min-height: 16px;\n    }\n\n    ::v-deep .card-container .card-actions {\n      display: block;\n\n      button:not(:last-child) {\n        margin-right: 10px;\n      }\n\n      .banner {\n        display: flex;\n      }\n    }\n\n    // Position dialog buttons on the right-hand side of the dialog\n    .dialog-actions {\n      display: flex;\n      justify-content: flex-end;\n    }\n  }\n</style>\n"]}]}
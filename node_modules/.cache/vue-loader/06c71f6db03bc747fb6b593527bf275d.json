{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/RegistryMirrors.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/RegistryMirrors.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBBcnJheUxpc3RHcm91cGVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0R3JvdXBlZCc7CmltcG9ydCBLZXlWYWx1ZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0tleVZhbHVlJzsKaW1wb3J0IHsgTGFiZWxlZElucHV0IH0gZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9MYWJlbGVkSW5wdXQnOwppbXBvcnQgeyBzZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBBcnJheUxpc3RHcm91cGVkLCBLZXlWYWx1ZSwgTGFiZWxlZElucHV0CiAgfSwKCiAgcHJvcHM6IHsKICAgIG1vZGU6IHsKICAgICAgdHlwZTogICAgIFN0cmluZywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAoKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6ICAgICBPYmplY3QsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKICB9LAoKICBkYXRhKCkgewogICAgY29uc3QgbWlycm9yTWFwID0gdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZz8ucmVnaXN0cmllcz8ubWlycm9ycyB8fCB7fTsKICAgIGNvbnN0IGVudHJpZXMgPSBbXTsKCiAgICBmb3IgKCBjb25zdCBob3N0bmFtZSBpbiBtaXJyb3JNYXAgKSB7CiAgICAgIGVudHJpZXMucHVzaCh7CiAgICAgICAgaG9zdG5hbWUsCiAgICAgICAgZW5kcG9pbnRzOiAobWlycm9yTWFwW2hvc3RuYW1lXS5lbmRwb2ludCB8fCBbXSkuam9pbignLCAnKSwKICAgICAgICByZXdyaXRlOiAgIG1pcnJvck1hcFtob3N0bmFtZV0ucmV3cml0ZSB8fCB7fSwKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHsgZW50cmllcyB9OwogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICBpZiAoIXRoaXMudmFsdWUuc3BlYy5ya2VDb25maWc/LnJlZ2lzdHJpZXM/Lm1pcnJvcnMpIHsKICAgICAgc2V0KHRoaXMudmFsdWUsICdzcGVjLnJrZUNvbmZpZy5yZWdpc3RyaWVzLm1pcnJvcnMnLCB7fSk7CiAgICB9CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGRlZmF1bHRBZGRWYWx1ZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBob3N0bmFtZTogICcnLAogICAgICAgIGVuZHBvaW50czogJycsCiAgICAgICAgcmV3cml0ZTogICB7fQogICAgICB9OwogICAgfSwKICB9LAoKICBtZXRob2RzOiB7CiAgICB1cGRhdGUoZW50cmllcykgewogICAgICBjb25zdCBtaXJyb3JzID0ge307CgogICAgICBmb3IgKCBjb25zdCBlbnRyeSBvZiBlbnRyaWVzICkgewogICAgICAgIGlmICggIWVudHJ5Lmhvc3RuYW1lIHx8IG1pcnJvcnNbZW50cnkuaG9zdG5hbWVdICkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBtaXJyb3JzW2VudHJ5Lmhvc3RuYW1lXSA9IHsgZW5kcG9pbnQ6IGVudHJ5LmVuZHBvaW50cy5zcGxpdCgvXHMqLFxzKi8pLm1hcCgoeCkgPT4geC50cmltKCkpIH07CiAgICAgICAgaWYgKGVudHJ5LnJld3JpdGUpIHsKICAgICAgICAgIG1pcnJvcnNbZW50cnkuaG9zdG5hbWVdLnJld3JpdGUgPSBlbnRyeS5yZXdyaXRlOwogICAgICAgIH0KICAgICAgfQogICAgICBzZXQodGhpcy52YWx1ZSwgJ3NwZWMucmtlQ29uZmlnLnJlZ2lzdHJpZXMubWlycm9ycycsIG1pcnJvcnMpOwogICAgfSwKICB9Cn07Cg=="},{"version":3,"sources":["RegistryMirrors.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RegistryMirrors.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport KeyValue from '@shell/components/form/KeyValue';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { set } from '@shell/utils/object';\n\nexport default {\n  components: {\n    ArrayListGrouped, KeyValue, LabeledInput\n  },\n\n  props: {\n    mode: {\n      type:     String,\n      required: true,\n    },\n\n    value: {\n      type:     Object,\n      required: true,\n    },\n  },\n\n  data() {\n    const mirrorMap = this.value.spec.rkeConfig?.registries?.mirrors || {};\n    const entries = [];\n\n    for ( const hostname in mirrorMap ) {\n      entries.push({\n        hostname,\n        endpoints: (mirrorMap[hostname].endpoint || []).join(', '),\n        rewrite:   mirrorMap[hostname].rewrite || {},\n      });\n    }\n\n    return { entries };\n  },\n\n  created() {\n    if (!this.value.spec.rkeConfig?.registries?.mirrors) {\n      set(this.value, 'spec.rkeConfig.registries.mirrors', {});\n    }\n  },\n\n  computed: {\n    defaultAddValue() {\n      return {\n        hostname:  '',\n        endpoints: '',\n        rewrite:   {}\n      };\n    },\n  },\n\n  methods: {\n    update(entries) {\n      const mirrors = {};\n\n      for ( const entry of entries ) {\n        if ( !entry.hostname || mirrors[entry.hostname] ) {\n          continue;\n        }\n\n        mirrors[entry.hostname] = { endpoint: entry.endpoints.split(/\\s*,\\s*/).map((x) => x.trim()) };\n        if (entry.rewrite) {\n          mirrors[entry.hostname].rewrite = entry.rewrite;\n        }\n      }\n      set(this.value, 'spec.rkeConfig.registries.mirrors', mirrors);\n    },\n  }\n};\n</script>\n\n<template>\n  <div>\n    <h3>\n      {{ t('registryMirror.header') }}\n      <i\n        v-clean-tooltip=\"t('registryMirror.toolTip')\"\n        class=\"icon icon-info\"\n      />\n    </h3>\n    <p class=\"mb-20\">\n      {{ t('registryMirror.description') }}\n    </p>\n    <ArrayListGrouped\n      v-model=\"entries\"\n      :add-label=\"t('registryMirror.addLabel')\"\n      :default-add-value=\"defaultAddValue\"\n      :initial-empty-row=\"true\"\n      :mode=\"mode\"\n      @input=\"update\"\n    >\n      <template #default=\"{row}\">\n        <div class=\"row\">\n          <div class=\"col span-6\">\n            <LabeledInput\n              v-model=\"row.value.hostname\"\n              :label=\"t('registryMirror.hostnameLabel')\"\n              :placeholder=\"t('registryMirror.hostnamePlaceholder')\"\n              :mode=\"mode\"\n            />\n          </div>\n          <div class=\"col span-6\">\n            <LabeledInput\n              v-model=\"row.value.endpoints\"\n              :label=\"t('registryMirror.endpointsLabel')\"\n              :placeholder=\"t('registryMirror.endpointsPlaceholder')\"\n              :mode=\"mode\"\n            />\n          </div>\n        </div>\n        <div class=\"row mt-20\">\n          <div class=\"col span-12\">\n            <h3>\n              {{ t('registryMirrorRewrite.header') }}\n              <i\n                v-clean-tooltip=\"t('registryMirrorRewrite.toolTip')\"\n                class=\"icon icon-info\"\n              />\n            </h3>\n            <KeyValue\n              v-model=\"row.value.rewrite\"\n              :mode=\"mode\"\n              :add-label=\"t('registryMirrorRewrite.addLabel')\"\n              :read-allowed=\"false\"\n              :key-label=\"t('registryMirrorRewrite.keyLabel')\"\n              :key-placeholder=\"t('registryMirrorRewrite.keyPlaceholder')\"\n              :value-label=\"t('registryMirrorRewrite.valueLabel')\"\n              :value-placeholder=\"t('registryMirrorRewrite.valuePlaceholder')\"\n            />\n          </div>\n        </div>\n      </template>\n    </ArrayListGrouped>\n  </div>\n</template>\n"]}]}
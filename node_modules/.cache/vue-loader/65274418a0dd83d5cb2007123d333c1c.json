{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/AddExtensionRepos.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/AddExtensionRepos.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IENBVEFMT0cgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IERpYWxvZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9EaWFsb2cudnVlJzsKaW1wb3J0IENoZWNrYm94IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gvQ2hlY2tib3gudnVlJzsKaW1wb3J0IHsKICBVSV9QTFVHSU5TX1JFUE9fTkFNRSwKICBVSV9QTFVHSU5TX1JFUE9fVVJMLAogIFVJX1BMVUdJTlNfUkVQT19CUkFOQ0gsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX05BTUUsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX1VSTCwKICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fQlJBTkNILAp9IGZyb20gJ0BzaGVsbC9jb25maWcvdWlwbHVnaW5zJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBDaGVja2JveCwKICAgIERpYWxvZywKICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L3NjaGVtYUZvciddKENBVEFMT0cuQ0xVU1RFUl9SRVBPKSkgewogICAgICB0aGlzLnJlcG9zID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FUQUxPRy5DTFVTVEVSX1JFUE8sIG9wdDogeyBmb3JjZTogdHJ1ZSB9IH0pOwogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlcnJvcnM6ICAgW10sCiAgICAgIHJlcG9zOiAgICBbXSwKICAgICAgYWRkUmVwb3M6IHsKICAgICAgICBvZmZpY2lhbDogdHJ1ZSwKICAgICAgICBwYXJ0bmVyczogdHJ1ZQogICAgICB9LAogICAgICByZXBvc0luZm86IHsKICAgICAgICBvZmZpY2lhbDogewogICAgICAgICAgcmVwbzogICB1bmRlZmluZWQsCiAgICAgICAgICBuYW1lOiAgIFVJX1BMVUdJTlNfUkVQT19OQU1FLAogICAgICAgICAgdXJsOiAgICBVSV9QTFVHSU5TX1JFUE9fVVJMLAogICAgICAgICAgYnJhbmNoOiBVSV9QTFVHSU5TX1JFUE9fQlJBTkNILAogICAgICAgIH0sCiAgICAgICAgcGFydG5lcnM6IHsKICAgICAgICAgIHJlcG86ICAgdW5kZWZpbmVkLAogICAgICAgICAgbmFtZTogICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fTkFNRSwKICAgICAgICAgIHVybDogICAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX1VSTCwKICAgICAgICAgIGJyYW5jaDogVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX0JSQU5DSCwKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGhhc1JhbmNoZXJVSVBsdWdpbnNSZXBvKCkgewogICAgICByZXR1cm4gISF0aGlzLnJlcG9zLmZpbmQoKHIpID0+IHIudXJsRGlzcGxheSA9PT0gVUlfUExVR0lOU19SRVBPX1VSTCk7CiAgICB9LAogICAgaGFzUmFuY2hlclVJUGFydG5lcnNQbHVnaW5zUmVwbygpIHsKICAgICAgcmV0dXJuICEhdGhpcy5yZXBvcy5maW5kKChyKSA9PiByLnVybERpc3BsYXkgPT09IFVJX1BMVUdJTlNfUEFSVE5FUlNfUkVQT19VUkwpOwogICAgfSwKICAgIGlzQW55UmVwb0F2YWlsYWJsZUZvckluc3RhbGwoKSB7CiAgICAgIHJldHVybiAhdGhpcy5oYXNSYW5jaGVyVUlQbHVnaW5zUmVwbyB8fCAhdGhpcy5oYXNSYW5jaGVyVUlQYXJ0bmVyc1BsdWdpbnNSZXBvOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3dEaWFsb2coKSB7CiAgICAgIHRoaXMuYWRkUmVwb3MgPSB7CiAgICAgICAgb2ZmaWNpYWw6ICF0aGlzLmhhc1JhbmNoZXJVSVBsdWdpbnNSZXBvLAogICAgICAgIHBhcnRuZXJzOiAhdGhpcy5oYXNSYW5jaGVyVUlQYXJ0bmVyc1BsdWdpbnNSZXBvLAogICAgICB9OwogICAgICB0aGlzLiRtb2RhbC5zaG93KCdhZGQtZXh0ZW5zaW9ucy1yZXBvcycpOwogICAgfSwKCiAgICBhc3luYyBkb0FkZFJlcG9zKGJ0bkNiKSB7CiAgICAgIHRoaXMuZXJyb3JzID0gW107CiAgICAgIGNvbnN0IHByb21pc2VzID0gW107CgogICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmFkZFJlcG9zKSB7CiAgICAgICAgaWYgKHRoaXMuYWRkUmVwb3Nba2V5XSkgewogICAgICAgICAgY29uc3QgcGx1Z2luQ1IgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9jcmVhdGUnLCB7CiAgICAgICAgICAgIHR5cGU6ICAgICBDQVRBTE9HLkNMVVNURVJfUkVQTywKICAgICAgICAgICAgbWV0YWRhdGE6IHsgbmFtZTogdGhpcy5yZXBvc0luZm9ba2V5XS5uYW1lIH0sCiAgICAgICAgICAgIHNwZWM6ICAgICB7CiAgICAgICAgICAgICAgZ2l0QnJhbmNoOiB0aGlzLnJlcG9zSW5mb1trZXldLmJyYW5jaCwKICAgICAgICAgICAgICBnaXRSZXBvOiAgIHRoaXMucmVwb3NJbmZvW2tleV0udXJsLAogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBwcm9taXNlcy5wdXNoKHBsdWdpbkNSLnNhdmUoKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocHJvbWlzZXMubGVuZ3RoKSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHByb21pc2VzKTsKCiAgICAgICAgcmVzLmZvckVhY2goKHJlc3VsdCkgPT4gewogICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZXN1bHQucmVhc29uKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKHJlc3VsdC5yZWFzb24pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdkb25lJyk7CgogICAgICBidG5DYih0cnVlKTsKICAgIH0sCiAgfQp9Owo="},{"version":3,"sources":["AddExtensionRepos.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA","file":"AddExtensionRepos.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins","sourcesContent":["<script>\nimport { CATALOG } from '@shell/config/types';\nimport Dialog from '@shell/components/Dialog.vue';\nimport Checkbox from '@components/Form/Checkbox/Checkbox.vue';\nimport {\n  UI_PLUGINS_REPO_NAME,\n  UI_PLUGINS_REPO_URL,\n  UI_PLUGINS_REPO_BRANCH,\n  UI_PLUGINS_PARTNERS_REPO_NAME,\n  UI_PLUGINS_PARTNERS_REPO_URL,\n  UI_PLUGINS_PARTNERS_REPO_BRANCH,\n} from '@shell/config/uiplugins';\n\nexport default {\n  components: {\n    Checkbox,\n    Dialog,\n  },\n\n  async fetch() {\n    if (this.$store.getters['management/schemaFor'](CATALOG.CLUSTER_REPO)) {\n      this.repos = await this.$store.dispatch('management/findAll', { type: CATALOG.CLUSTER_REPO, opt: { force: true } });\n    }\n  },\n\n  data() {\n    return {\n      errors:   [],\n      repos:    [],\n      addRepos: {\n        official: true,\n        partners: true\n      },\n      reposInfo: {\n        official: {\n          repo:   undefined,\n          name:   UI_PLUGINS_REPO_NAME,\n          url:    UI_PLUGINS_REPO_URL,\n          branch: UI_PLUGINS_REPO_BRANCH,\n        },\n        partners: {\n          repo:   undefined,\n          name:   UI_PLUGINS_PARTNERS_REPO_NAME,\n          url:    UI_PLUGINS_PARTNERS_REPO_URL,\n          branch: UI_PLUGINS_PARTNERS_REPO_BRANCH,\n        }\n      }\n    };\n  },\n\n  computed: {\n    hasRancherUIPluginsRepo() {\n      return !!this.repos.find((r) => r.urlDisplay === UI_PLUGINS_REPO_URL);\n    },\n    hasRancherUIPartnersPluginsRepo() {\n      return !!this.repos.find((r) => r.urlDisplay === UI_PLUGINS_PARTNERS_REPO_URL);\n    },\n    isAnyRepoAvailableForInstall() {\n      return !this.hasRancherUIPluginsRepo || !this.hasRancherUIPartnersPluginsRepo;\n    }\n  },\n\n  methods: {\n    showDialog() {\n      this.addRepos = {\n        official: !this.hasRancherUIPluginsRepo,\n        partners: !this.hasRancherUIPartnersPluginsRepo,\n      };\n      this.$modal.show('add-extensions-repos');\n    },\n\n    async doAddRepos(btnCb) {\n      this.errors = [];\n      const promises = [];\n\n      for (const key in this.addRepos) {\n        if (this.addRepos[key]) {\n          const pluginCR = await this.$store.dispatch('management/create', {\n            type:     CATALOG.CLUSTER_REPO,\n            metadata: { name: this.reposInfo[key].name },\n            spec:     {\n              gitBranch: this.reposInfo[key].branch,\n              gitRepo:   this.reposInfo[key].url,\n            }\n          });\n\n          promises.push(pluginCR.save());\n        }\n      }\n\n      if (promises.length) {\n        const res = await Promise.allSettled(promises);\n\n        res.forEach((result) => {\n          if (result.status === 'rejected') {\n            console.error(result.reason); // eslint-disable-line no-console\n\n            this.errors.push(result.reason);\n          }\n        });\n      }\n\n      this.$emit('done');\n\n      btnCb(true);\n    },\n  }\n};\n</script>\n<template>\n  <Dialog\n    name=\"add-extensions-repos\"\n    :title=\"t('plugins.addRepos.title')\"\n    mode=\"add\"\n    data-testid=\"add-extensions-repos-modal\"\n    @okay=\"doAddRepos\"\n  >\n    <template>\n      <p class=\"mb-20\">\n        {{ t('plugins.addRepos.prompt', {}, true) }}\n      </p>\n      <!-- Official repo -->\n      <div\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"addRepos.official\"\n          :disabled=\"hasRancherUIPluginsRepo\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.install.addRancherRepo\"\n          data-testid=\"add-extensions-repos-modal-add-official-repo\"\n        />\n        <div\n          v-if=\"hasRancherUIPluginsRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.installed') }})\n        </div>\n      </div>\n      <!-- Partners repo -->\n      <div\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"addRepos.partners\"\n          :disabled=\"hasRancherUIPartnersPluginsRepo\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.install.addPartnersRancherRepo\"\n          data-testid=\"add-extensions-repos-modal-add-partners-repo\"\n        />\n        <div\n          v-if=\"hasRancherUIPartnersPluginsRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.installed') }})\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<style lang=\"scss\" scoped>\n  .enable-plugin-support {\n    font-size: 14px;\n    margin-top: 20px;\n  }\n\n  .plugin-setup-error {\n    font-size: 14px;\n    color: var(--error);\n    margin: 10px 0 0 0;\n  }\n\n  .checkbox-info {\n    margin-left: 20px;\n    opacity: 0.7;\n  }\n</style>\n"]}]}
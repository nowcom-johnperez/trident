{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/form/WorkloadPorts.vue?vue&type=style&index=0&id=e1a2315a&lang=scss&scoped=true","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/form/WorkloadPorts.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1716430467357},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1716430467929},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/postcss-loader/src/index.js","mtime":1716430467882},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/sass-loader/dist/cjs.js","mtime":1716430453705},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiRyZW1vdmU6IDc1OwokY2hlY2tib3g6IDc1OwoKLnRpdGxlIHsKICBtYXJnaW4tYm90dG9tOiAxMHB4OwoKICAucmVhZC1mcm9tLWZpbGUgewogICAgZmxvYXQ6IHJpZ2h0OwogIH0KfQoucG9ydHMtaGVhZGVycywgLnBvcnRzLXJvd3sKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMjglIDI4JSAxNSUgMTAlIDc1cHggMC41ZnI7CiAgZ3JpZC1jb2x1bW4tZ2FwOiAkY29sdW1uLWd1dHRlcjsKICBtYXJnaW4tYm90dG9tOiAxMHB4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgJiAucG9ydHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgfQoKICAmLnNob3ctaG9zdHsKICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMjAlIDIwJSAxNDVweCA5MHB4IDE0MHB4IC41ZnIgLjVmcjsKICB9CgogICYuc2hvdy1pcGFtLmxvYWRCYWxhbmNlci50Y3B7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDIwJSAyMCUgMTQ1cHggOTBweCAuNWZyIDE0MHB4IC41ZnI7CiAgfQoKICAmLnNob3ctaXBhbS5zaG93LWhvc3QubG9hZEJhbGFuY2VyewogICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAyMCUgMTAlIDEzNXB4IDkwcHggMTA1cHggLjVmciAuNWZyIC41ZnI7CiAgfQoKICAmLnNob3ctaXBhbS5zaG93LWhvc3QubG9hZEJhbGFuY2VyLnRjcHsKICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMTIlIDEwJSAxMzVweCA5MHB4IDEwNXB4IC41ZnIgLjVmciAxMDBweCAuNWZyOwogIH0KfQoKLmFkZC1ob3N0IHsKICBqdXN0aWZ5LXNlbGY6IGNlbnRlcjsKfQoKLnByb3RvY29sIHsKICBoZWlnaHQ6IDEwMCU7Cn0KCi5wb3J0cy1oZWFkZXJzIHsKICBjb2xvcjogdmFyKC0taW5wdXQtbGFiZWwpOwp9CgoudG9nZ2xlLWhvc3QtcG9ydHMgewogIGNvbG9yOiB2YXIoLS1wcmltYXJ5KTsKfQoKLnJlbW92ZSBCVVRUT04gewogIHBhZGRpbmc6IDBweDsKfQoKLnBvcnRzLXJvdyBJTlBVVCB7CiAgaGVpZ2h0OiA1MHB4Owp9CgouZm9vdGVyIHsKICAucHJvdGlwIHsKICAgIGZsb2F0OiByaWdodDsKICAgIHBhZGRpbmc6IDVweCAwOwogIH0KfQoucG9ydHMtcm93IC5wcm90b2NvbCA6OnYtZGVlcCAudW5sYWJlbGVkLXNlbGVjdCwKLnBvcnRzLXJvdyAucHJvdG9jb2wgOjp2LWRlZXAgLnVubGFiZWxlZC1zZWxlY3QgLnYtc2VsZWN0IHsKICBoZWlnaHQ6IDEwMCU7Cn0KLnBvcnRzLXJvdyAucHJvdG9jb2wgOjp2LWRlZXAgLnVubGFiZWxlZC1zZWxlY3QgLnZzX19kcm9wZG93bi10b2dnbGUgewogIHBhZGRpbmctdG9wOiAxMnB4Owp9Cg=="},{"version":3,"sources":["WorkloadPorts.vue"],"names":[],"mappings":";AAobA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WorkloadPorts.vue","sourceRoot":"node_modules/@rancher/shell/components/form","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport debounce from 'lodash/debounce';\nimport { _EDIT, _VIEW } from '@shell/config/query-params';\nimport { removeAt, findBy } from '@shell/utils/array';\nimport { clone } from '@shell/utils/object';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { HCI as HCI_LABELS_ANNOTATIONS } from '@shell/config/labels-annotations';\nimport { isHarvesterSatisfiesVersion } from '@shell/utils/cluster';\nimport { HARVESTER_NAME as HARVESTER } from '@shell/config/features';\nimport { CAPI, SERVICE } from '@shell/config/types';\n\nexport default {\n  components: {\n    LabeledInput,\n    LabeledSelect,\n  },\n\n  props: {\n    value: {\n      type:    Array,\n      default: null,\n    },\n\n    mode: {\n      type:    String,\n      default: _EDIT,\n    },\n\n    // array of services auto-created previously (only relevent when mode !== create)\n    services: {\n      type:    Array,\n      default: () => []\n    },\n\n    // workload name\n    name: {\n      type:    String,\n      default: ''\n    }\n  },\n\n  data() {\n    const rows = clone(this.value || []).map((row) => {\n      row._showHost = false;\n      row._serviceType = row._serviceType || '';\n      row._name = row.name ? `${ row.name }` : `${ row.containerPort }${ row.protocol.toLowerCase() }${ row.hostPort || row._listeningPort || '' }`;\n      if (row.hostPort || row.hostIP) {\n        row._showHost = true;\n      }\n\n      row._ipam = '';\n\n      return row;\n    });\n\n    // show host port column if existing port data has any host ports defined\n    const showHostPorts = !!rows.some((row) => !!row.hostPort);\n\n    return {\n      rows,\n      showHostPorts,\n      workloadPortOptions: ['TCP', 'UDP']\n    };\n  },\n\n  computed: {\n    ...mapGetters(['currentCluster']),\n\n    canNotAccessService() {\n      return !this.$store.getters['cluster/schemaFor'](SERVICE);\n    },\n\n    serviceTypeTooltip() {\n      return this.canNotAccessService ? this.t('workload.container.noServiceAccess') : undefined;\n    },\n\n    isView() {\n      return this.mode === _VIEW;\n    },\n\n    showAdd() {\n      return !this.isView;\n    },\n\n    showRemove() {\n      return !this.isView;\n    },\n\n    serviceTypes() {\n      return [\n        {\n          label: this.t('workload.container.ports.noCreateService'),\n          value: ''\n        },\n        {\n          label: this.t('serviceTypes.clusterip'),\n          value: 'ClusterIP'\n        },\n        {\n          label: this.t('serviceTypes.nodeport'),\n          value: 'NodePort'\n        },\n        {\n          label: this.t('serviceTypes.loadbalancer'),\n          value: 'LoadBalancer'\n        },\n      ];\n    },\n\n    clusterIPServicePorts() {\n      return ((this.services.filter((svc) => svc.spec.type === 'ClusterIP') || [])[0] || {})?.spec?.ports;\n    },\n\n    loadBalancerServicePorts() {\n      return ((this.services.filter((svc) => svc.spec.type === 'LoadBalancer') || [])[0] || {})?.spec?.ports;\n    },\n\n    nodePortServicePorts() {\n      return ((this.services.filter((svc) => svc.spec.type === 'NodePort') || [])[0] || {})?.spec?.ports;\n    },\n\n    ipamOptions() {\n      return [{\n        label: 'DHCP',\n        value: 'dhcp',\n      }, {\n        label: 'Pool',\n        value: 'pool',\n      }];\n    },\n\n    ipamIndex() {\n      return this.rows.findIndex((row) => row._serviceType === 'LoadBalancer' && row.protocol === 'TCP');\n    },\n\n    serviceWithIpam() {\n      return this.services.find((s) => s?.metadata?.annotations[HCI_LABELS_ANNOTATIONS.CLOUD_PROVIDER_IPAM]);\n    },\n\n    showIpam() {\n      let cloudProvider;\n      const version = this.provisioningCluster?.kubernetesVersion;\n\n      if (this.provisioningCluster?.isRke2) {\n        const machineSelectorConfig = this.provisioningCluster?.spec?.rkeConfig?.machineSelectorConfig || {};\n        const agentConfig = (machineSelectorConfig[0] || {}).config;\n\n        cloudProvider = agentConfig?.['cloud-provider-name'];\n      } else if (this.provisioningCluster?.isRke1) {\n        const currentCluster = this.$store.getters['currentCluster'];\n\n        cloudProvider = currentCluster?.spec?.rancherKubernetesEngineConfig?.cloudProvider?.name;\n      }\n\n      return cloudProvider === HARVESTER &&\n              isHarvesterSatisfiesVersion(version);\n    },\n\n    provisioningCluster() {\n      const out = this.$store.getters['management/all'](CAPI.RANCHER_CLUSTER).find((c) => c?.status?.clusterName === this.currentCluster.metadata.name);\n\n      return out;\n    },\n  },\n\n  created() {\n    this.queueUpdate = debounce(this.update, 500);\n    this.rows.map((row) => {\n      this.setServiceType(row);\n      this.setIpam(row);\n    });\n  },\n\n  methods: {\n    add() {\n      this.rows.push({\n        name:          '',\n        expose:        true,\n        protocol:      'TCP',\n        containerPort: null,\n        hostPort:      null,\n        hostIP:        null,\n        _showHost:     false,\n        _serviceType:  '',\n        _ipam:         'dhcp',\n      });\n\n      this.queueUpdate();\n\n      this.$nextTick(() => {\n        const inputs = this.$refs.name;\n\n        inputs[inputs.length - 1].focus();\n      });\n    },\n\n    remove(idx) {\n      removeAt(this.rows, idx);\n      this.queueUpdate();\n    },\n\n    update() {\n      if ( this.isView ) {\n        return;\n      }\n      const out = [];\n\n      for ( const row of this.rows ) {\n        const value = clone(row);\n\n        delete value._showHost;\n        out.push(value);\n      }\n      this.$emit('input', out);\n    },\n\n    setServiceType(row) {\n      const { _name } = row;\n\n      if (this.loadBalancerServicePorts) {\n        const portSpec = findBy(this.loadBalancerServicePorts, 'name', _name);\n\n        if (portSpec) {\n          this.$set(row, '_listeningPort', portSpec.port);\n\n          row._serviceType = 'LoadBalancer';\n\n          return;\n        }\n      } if (this.nodePortServicePorts) {\n        const portSpec = findBy(this.nodePortServicePorts, 'name', _name);\n\n        if (portSpec) {\n          this.$set(row, '_listeningPort', portSpec.nodePort);\n\n          row._serviceType = 'NodePort';\n\n          return;\n        }\n      } if (this.clusterIPServicePorts) {\n        if (findBy(this.clusterIPServicePorts, 'name', _name)) {\n          row._serviceType = 'ClusterIP';\n\n          return;\n        }\n      }\n\n      return '';\n    },\n\n    setIpam(row) {\n      if (this.serviceWithIpam && row._serviceType === 'LoadBalancer' && row.protocol === 'TCP') {\n        row._ipam = this.serviceWithIpam?.metadata?.annotations[HCI_LABELS_ANNOTATIONS.CLOUD_PROVIDER_IPAM];\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div :style=\"{'width':'100%'}\">\n    <p\n      v-if=\"rows.length > 0\"\n      class=\"padded\"\n    >\n      {{ t('workload.container.ports.detailedDescription') }}\n    </p>\n    <div\n      v-for=\"(row, idx) in rows\"\n      :key=\"idx\"\n      class=\"ports-row\"\n      :class=\"{\n        'show-host':row._showHost,\n        'loadBalancer': row._serviceType === 'LoadBalancer',\n        'tcp': row.protocol === 'TCP',\n        'show-ipam': showIpam,\n      }\"\n    >\n      <div class=\"service-type\">\n        <LabeledSelect\n          v-model=\"row._serviceType\"\n          :mode=\"mode\"\n          :label=\"t('workload.container.ports.createService')\"\n          :options=\"serviceTypes\"\n          :disabled=\"canNotAccessService\"\n          :tooltip=\"serviceTypeTooltip\"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div class=\"portName\">\n        <LabeledInput\n          ref=\"name\"\n          v-model=\"row.name\"\n          :mode=\"mode\"\n          :label=\"t('workload.container.ports.name')\"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div class=\"port\">\n        <LabeledInput\n          v-model.number=\"row.containerPort\"\n          :mode=\"mode\"\n          type=\"number\"\n          min=\"1\"\n          max=\"65535\"\n          placeholder=\"e.g. 8080\"\n          :label=\"t('workload.container.ports.containerPort')\"\n          :required=\"row._serviceType === 'LoadBalancer' \"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div class=\"protocol col\">\n        <LabeledSelect\n          v-model=\"row.protocol\"\n          :mode=\"mode\"\n          :options=\"workloadPortOptions\"\n          :multiple=\"false\"\n          :label=\"t('workload.container.ports.protocol')\"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div\n        v-if=\"row._showHost\"\n        class=\"targetPort\"\n      >\n        <LabeledInput\n          ref=\"port\"\n          v-model.number=\"row.hostPort\"\n          :mode=\"mode\"\n          type=\"number\"\n          min=\"1\"\n          max=\"65535\"\n          placeholder=\"e.g. 80\"\n          :label=\"t('workload.container.ports.hostPort')\"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div\n        v-if=\"row._showHost\"\n        class=\"hostip\"\n      >\n        <LabeledInput\n          ref=\"port\"\n          v-model=\"row.hostIP\"\n          :mode=\"mode\"\n          placeholder=\"e.g. 1.1.1.1\"\n          :label=\"t('workload.container.ports.hostIP')\"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div\n        v-if=\"!row._showHost && row._serviceType !== 'LoadBalancer' && row._serviceType !== 'NodePort'\"\n        class=\"add-host\"\n      >\n        <button\n          :disabled=\"mode==='view'\"\n          type=\"button\"\n          class=\"btn btn-sm role-tertiary\"\n          @click=\"row._showHost = true\"\n        >\n          {{ t('workloadPorts.addHost') }}\n        </button>\n      </div>\n\n      <div v-if=\"row._serviceType === 'LoadBalancer' || row._serviceType === 'NodePort'\">\n        <LabeledInput\n          ref=\"port\"\n          v-model.number=\"row._listeningPort\"\n          type=\"number\"\n          :mode=\"mode\"\n          :label=\"t('workload.container.ports.listeningPort')\"\n          :required=\"row._serviceType === 'LoadBalancer' \"\n          @input=\"queueUpdate\"\n        />\n      </div>\n\n      <div v-if=\"showIpam && row._serviceType === 'LoadBalancer' && row.protocol === 'TCP'\">\n        <div v-if=\"idx === ipamIndex\">\n          <LabeledSelect\n            v-model=\"row._ipam\"\n            :mode=\"mode\"\n            :options=\"ipamOptions\"\n            :label=\"t('servicesPage.harvester.ipam.label')\"\n            :disabled=\"mode === 'edit'\"\n            @input=\"queueUpdate\"\n          />\n        </div>\n        <div v-else>\n          <LabeledSelect\n            v-model=\"rows[ipamIndex]._ipam\"\n            :mode=\"mode\"\n            :options=\"ipamOptions\"\n            :label=\"t('servicesPage.harvester.ipam.label')\"\n            :disabled=\"true\"\n            @input=\"queueUpdate\"\n          />\n        </div>\n      </div>\n\n      <div\n        v-if=\"showRemove\"\n        class=\"remove\"\n      >\n        <button\n          type=\"button\"\n          class=\"btn role-link\"\n          @click=\"remove(idx)\"\n        >\n          {{ t('workloadPorts.remove') }}\n        </button>\n      </div>\n    </div>\n    <div\n      v-if=\"showAdd\"\n      class=\"footer\"\n    >\n      <button\n        type=\"button\"\n        class=\"btn role-tertiary add\"\n        @click=\"add()\"\n      >\n        {{ t('workloadPorts.addPort') }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n$remove: 75;\n$checkbox: 75;\n\n.title {\n  margin-bottom: 10px;\n\n  .read-from-file {\n    float: right;\n  }\n}\n.ports-headers, .ports-row{\n  display: grid;\n  grid-template-columns: 28% 28% 15% 10% 75px 0.5fr;\n  grid-column-gap: $column-gutter;\n  margin-bottom: 10px;\n  align-items: center;\n  & .port{\n    display: flex;\n    justify-content: space-between;\n  }\n\n  &.show-host{\n    grid-template-columns: 20% 20% 145px 90px 140px .5fr .5fr;\n  }\n\n  &.show-ipam.loadBalancer.tcp{\n    grid-template-columns: 20% 20% 145px 90px .5fr 140px .5fr;\n  }\n\n  &.show-ipam.show-host.loadBalancer{\n    grid-template-columns: 20% 10% 135px 90px 105px .5fr .5fr .5fr;\n  }\n\n  &.show-ipam.show-host.loadBalancer.tcp{\n    grid-template-columns: 12% 10% 135px 90px 105px .5fr .5fr 100px .5fr;\n  }\n}\n\n.add-host {\n  justify-self: center;\n}\n\n.protocol {\n  height: 100%;\n}\n\n.ports-headers {\n  color: var(--input-label);\n}\n\n.toggle-host-ports {\n  color: var(--primary);\n}\n\n.remove BUTTON {\n  padding: 0px;\n}\n\n.ports-row INPUT {\n  height: 50px;\n}\n\n.footer {\n  .protip {\n    float: right;\n    padding: 5px 0;\n  }\n}\n.ports-row .protocol ::v-deep .unlabeled-select,\n.ports-row .protocol ::v-deep .unlabeled-select .v-select {\n  height: 100%;\n}\n.ports-row .protocol ::v-deep .unlabeled-select .vs__dropdown-toggle {\n  padding-top: 12px;\n}\n</style>\n"]}]}
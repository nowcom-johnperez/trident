{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IGlzRW1wdHkgZnJvbSAnbG9kYXNoL2lzRW1wdHknOwoKaW1wb3J0IFJlc291cmNlTWFuYWdlciBmcm9tICdAc2hlbGwvbWl4aW5zL3Jlc291cmNlLW1hbmFnZXInOwppbXBvcnQgeyBTRVJWSUNFLCBXT1JLTE9BRF9UWVBFUyB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBVSV9QTFVHSU5fTEFCRUxTLCBVSV9QTFVHSU5fTkFNRVNQQUNFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy91aXBsdWdpbnMnOwppbXBvcnQgeyBVSV9QTFVHSU5fQ0FUQUxPRyB9IGZyb20gJ0BzaGVsbC9jb25maWcvdGFibGUtaGVhZGVycyc7CgppbXBvcnQgQWN0aW9uTWVudSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9BY3Rpb25NZW51JzsKaW1wb3J0IFJlc291cmNlVGFibGUgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvUmVzb3VyY2VUYWJsZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0NhdGFsb2dMaXN0JywKCiAgY29tcG9uZW50czogeyBBY3Rpb25NZW51LCBSZXNvdXJjZVRhYmxlIH0sCgogIG1peGluczogW1Jlc291cmNlTWFuYWdlcl0sCgogIGRhdGEoKSB7CiAgICBjb25zdCBhY3Rpb25zID0gWwogICAgICB7CiAgICAgICAgYWN0aW9uOiAgJ3Nob3dDYXRhbG9nVW5pbnN0YWxsRGlhbG9nJywKICAgICAgICBsYWJlbDogICB0aGlzLnQoJ3BsdWdpbnMudW5pbnN0YWxsLmxhYmVsJyksCiAgICAgICAgaWNvbjogICAgJ2ljb24gaWNvbi10cmFzaCcsCiAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgfQogICAgXTsKCiAgICByZXR1cm4gewogICAgICBhY3Rpb25zLAogICAgICBjYXRhbG9nSGVhZGVyczogICAgVUlfUExVR0lOX0NBVEFMT0csCiAgICAgIG1lbnVUYXJnZXRFbGVtZW50OiBudWxsLAogICAgICBtZW51VGFyZ2V0RXZlbnQ6ICAgbnVsbCwKICAgICAgbWVudU9wZW46ICAgICAgICAgIGZhbHNlLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyh7IGFsbFJlcG9zOiAnY2F0YWxvZy9yZXBvcycgfSksCgogICAgbmFtZXNwYWNlZERlcGxveW1lbnRzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9hbGwnXShXT1JLTE9BRF9UWVBFUy5ERVBMT1lNRU5UKS5maWx0ZXIoKGRlcCkgPT4gZGVwLm1ldGFkYXRhLm5hbWVzcGFjZSA9PT0gVUlfUExVR0lOX05BTUVTUEFDRSk7CiAgICB9LAoKICAgIG5hbWVzcGFjZWRTZXJ2aWNlcygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYWxsJ10oU0VSVklDRSkuZmlsdGVyKChzdmMpID0+IHN2Yy5tZXRhZGF0YS5uYW1lc3BhY2UgPT09IFVJX1BMVUdJTl9OQU1FU1BBQ0UpOwogICAgfSwKCiAgICBjYXRhbG9nUm93cygpIHsKICAgICAgY29uc3Qgcm93cyA9IFtdOwoKICAgICAgaWYgKCAhaXNFbXB0eSh0aGlzLm5hbWVzcGFjZWREZXBsb3ltZW50cykgKSB7CiAgICAgICAgdGhpcy5uYW1lc3BhY2VkRGVwbG95bWVudHMuZm9yRWFjaCgoZGVwbG95KSA9PiB7CiAgICAgICAgICBjb25zdCByZXNvdXJjZXMgPSBbdGhpcy5uYW1lc3BhY2VkU2VydmljZXMsIHRoaXMuYWxsUmVwb3NdOwogICAgICAgICAgY29uc3QgZGVwbG95TmFtZSA9IGRlcGxveS5tZXRhZGF0YT8ubGFiZWxzPy5bVUlfUExVR0lOX0xBQkVMUy5DQVRBTE9HX0lNQUdFXTsKCiAgICAgICAgICBpZiAoIGRlcGxveU5hbWUgKSB7CiAgICAgICAgICAgIGNvbnN0IG91dCA9IHsKICAgICAgICAgICAgICBuYW1lOiAgICBkZXBsb3lOYW1lLAogICAgICAgICAgICAgIHN0YXRlOiAgIGRlcGxveS5tZXRhZGF0YT8uc3RhdGU/Lm5hbWUsCiAgICAgICAgICAgICAgaW1hZ2U6ICAgZGVwbG95LnNwZWM/LnRlbXBsYXRlPy5zcGVjPy5jb250YWluZXJzWzBdPy5pbWFnZSwKICAgICAgICAgICAgICBzZXJ2aWNlOiBudWxsLAogICAgICAgICAgICAgIHJlcG86ICAgIG51bGwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3Qga2V5cyA9IFsnc2VydmljZScsICdyZXBvJ107CgogICAgICAgICAgICByZXNvdXJjZXMuZm9yRWFjaCgocmVzb3VyY2UsIGkpID0+IHsKICAgICAgICAgICAgICBvdXRba2V5c1tpXV0gPSByZXNvdXJjZT8uZmlsdGVyKChpdGVtKSA9PiBpdGVtLm1ldGFkYXRhPy5sYWJlbHM/LltVSV9QTFVHSU5fTEFCRUxTLkNBVEFMT0dfSU1BR0VdID09PSBkZXBsb3lOYW1lKVswXTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByb3dzLnB1c2gob3V0KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJvd3M7CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgc2V0TWVudShldmVudCkgewogICAgICB0aGlzLm1lbnVPcGVuID0gISFldmVudDsKCiAgICAgIGlmIChldmVudCkgewogICAgICAgIHRoaXMubWVudVRhcmdldEVsZW1lbnQgPSB0aGlzLiRyZWZzLmNhdGFsb2dBY3Rpb25zOwogICAgICAgIHRoaXMubWVudVRhcmdldEV2ZW50ID0gZXZlbnQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tZW51VGFyZ2V0RWxlbWVudCA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm1lbnVUYXJnZXRFdmVudCA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport isEmpty from 'lodash/isEmpty';\n\nimport ResourceManager from '@shell/mixins/resource-manager';\nimport { SERVICE, WORKLOAD_TYPES } from '@shell/config/types';\nimport { UI_PLUGIN_LABELS, UI_PLUGIN_NAMESPACE } from '@shell/config/uiplugins';\nimport { UI_PLUGIN_CATALOG } from '@shell/config/table-headers';\n\nimport ActionMenu from '@shell/components/ActionMenu';\nimport ResourceTable from '@shell/components/ResourceTable';\n\nexport default {\n  name: 'CatalogList',\n\n  components: { ActionMenu, ResourceTable },\n\n  mixins: [ResourceManager],\n\n  data() {\n    const actions = [\n      {\n        action:  'showCatalogUninstallDialog',\n        label:   this.t('plugins.uninstall.label'),\n        icon:    'icon icon-trash',\n        enabled: true,\n      }\n    ];\n\n    return {\n      actions,\n      catalogHeaders:    UI_PLUGIN_CATALOG,\n      menuTargetElement: null,\n      menuTargetEvent:   null,\n      menuOpen:          false,\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allRepos: 'catalog/repos' }),\n\n    namespacedDeployments() {\n      return this.$store.getters['management/all'](WORKLOAD_TYPES.DEPLOYMENT).filter((dep) => dep.metadata.namespace === UI_PLUGIN_NAMESPACE);\n    },\n\n    namespacedServices() {\n      return this.$store.getters['management/all'](SERVICE).filter((svc) => svc.metadata.namespace === UI_PLUGIN_NAMESPACE);\n    },\n\n    catalogRows() {\n      const rows = [];\n\n      if ( !isEmpty(this.namespacedDeployments) ) {\n        this.namespacedDeployments.forEach((deploy) => {\n          const resources = [this.namespacedServices, this.allRepos];\n          const deployName = deploy.metadata?.labels?.[UI_PLUGIN_LABELS.CATALOG_IMAGE];\n\n          if ( deployName ) {\n            const out = {\n              name:    deployName,\n              state:   deploy.metadata?.state?.name,\n              image:   deploy.spec?.template?.spec?.containers[0]?.image,\n              service: null,\n              repo:    null\n            };\n            const keys = ['service', 'repo'];\n\n            resources.forEach((resource, i) => {\n              out[keys[i]] = resource?.filter((item) => item.metadata?.labels?.[UI_PLUGIN_LABELS.CATALOG_IMAGE] === deployName)[0];\n            });\n\n            rows.push(out);\n          }\n        });\n      }\n\n      return rows;\n    }\n  },\n\n  methods: {\n    setMenu(event) {\n      this.menuOpen = !!event;\n\n      if (event) {\n        this.menuTargetElement = this.$refs.catalogActions;\n        this.menuTargetEvent = event;\n      } else {\n        this.menuTargetElement = undefined;\n        this.menuTargetEvent = undefined;\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <div class=\"row mt-20\">\n    <div class=\"col span-12\">\n      <ResourceTable\n        :headers=\"catalogHeaders\"\n        :rows=\"catalogRows\"\n        :paging=\"true\"\n        :rows-per-page=\"10\"\n        :table-actions=\"false\"\n        key-field=\"name\"\n      >\n        <template #header-left>\n          <div>\n            <button\n              class=\"btn bg-primary mr-10\"\n              type=\"button\"\n              aria-haspopup=\"dialog\"\n              data-testid=\"extensions-catalog-load-dialog\"\n              @click=\"$emit('showCatalogLoadDialog')\"\n            >\n              {{ t('plugins.manageCatalog.imageLoad.load') }}\n            </button>\n          </div>\n        </template>\n        <template #row-actions=\"{row}\">\n          <button\n            ref=\"catalogActions\"\n            aria-haspopup=\"true\"\n            type=\"button\"\n            class=\"btn btn-sm role-multi-action actions\"\n            data-testid=\"extensions-page-catalog-row-menu\"\n            @click=\"setMenu\"\n          >\n            <i class=\"icon icon-actions\" />\n          </button>\n          <ActionMenu\n            :custom-actions=\"actions\"\n            :open=\"menuOpen\"\n            :use-custom-target-element=\"true\"\n            :custom-target-element=\"menuTargetElement\"\n            :custom-target-event=\"menuTargetEvent\"\n            @close=\"setMenu(false)\"\n            @showCatalogUninstallDialog=\"e => $emit('showCatalogUninstallDialog', row, e.event)\"\n          />\n        </template>\n      </ResourceTable>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.sub-row {\n  border-bottom: 1px solid var(--sortable-table-top-divider);\n  padding-left: 1rem;\n  padding-right: 1rem;\n}\n\n.col {\n  display: flex;\n  flex-direction: column;\n\n  section {\n    margin-bottom: 1.5rem;\n  }\n\n  .title {\n    margin-bottom: 0.5rem;\n  }\n}\n</style>\n"]}]}
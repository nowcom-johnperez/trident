{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/fleet/FleetSummary.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/fleet/FleetSummary.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBjYXBpdGFsaXplIGZyb20gJ2xvZGFzaC9jYXBpdGFsaXplJzsKaW1wb3J0IHsgU1RBVEVTLCBTVEFURVNfRU5VTSB9IGZyb20gJ0BzaGVsbC9wbHVnaW5zL2Rhc2hib2FyZC1zdG9yZS9yZXNvdXJjZS1jbGFzcyc7CmltcG9ydCBGbGVldFN0YXR1cyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mbGVldC9GbGVldFN0YXR1cyc7Cgpjb25zdCBnZXRSZXNvdXJjZURlZmF1bHRTdGF0ZSA9IChsYWJlbEdldHRlciwgc3RhdGVLZXkpID0+IHsKICByZXR1cm4gewogICAgcmVhZHk6IHsKICAgICAgY291bnQ6IDAsCiAgICAgIGNvbG9yOiBTVEFURVNbU1RBVEVTX0VOVU0uUkVBRFldLmNvbG9yLAogICAgICBsYWJlbDogbGFiZWxHZXR0ZXIoYCR7IHN0YXRlS2V5IH0uJHsgU1RBVEVTX0VOVU0uUkVBRFkgfWAsIG51bGwsIFNUQVRFU1tTVEFURVNfRU5VTS5SRUFEWV0ubGFiZWwgKQogICAgfSwKICAgIGluZm86IHsKICAgICAgY291bnQ6IDAsCiAgICAgIGNvbG9yOiBTVEFURVNbU1RBVEVTX0VOVU0uSU5GT10uY29sb3IsCiAgICAgIGxhYmVsOiBsYWJlbEdldHRlcihgJHsgc3RhdGVLZXkgfS4keyBTVEFURVNfRU5VTS5JTkZPIH1gLCBudWxsLCBTVEFURVNbU1RBVEVTX0VOVU0uSU5GT10ubGFiZWwgKQogICAgfSwKICAgIHdhcm5pbmc6IHsKICAgICAgY291bnQ6IDAsCiAgICAgIGNvbG9yOiBTVEFURVNbU1RBVEVTX0VOVU0uV0FSTklOR10uY29sb3IsCiAgICAgIGxhYmVsOiBsYWJlbEdldHRlcihgJHsgc3RhdGVLZXkgfS4keyBTVEFURVNfRU5VTS5XQVJOSU5HIH1gLCBudWxsLCBTVEFURVNbU1RBVEVTX0VOVU0uV0FSTklOR10ubGFiZWwgKQogICAgfSwKICAgIG5vdHJlYWR5OiB7CiAgICAgIGNvdW50OiAwLAogICAgICBjb2xvcjogU1RBVEVTW1NUQVRFU19FTlVNLk5PVF9SRUFEWV0uY29sb3IsCiAgICAgIGxhYmVsOiBsYWJlbEdldHRlcihgJHsgc3RhdGVLZXkgfS4keyBTVEFURVNfRU5VTS5OT1RfUkVBRFkgfWAsIG51bGwsIFNUQVRFU1tTVEFURVNfRU5VTS5OT1RfUkVBRFldLmxhYmVsICkKICAgIH0sCiAgICBlcnJvcjogewogICAgICBjb3VudDogMCwKICAgICAgY29sb3I6IFNUQVRFU1tTVEFURVNfRU5VTS5FUlJPUl0uY29sb3IsCiAgICAgIGxhYmVsOiBsYWJlbEdldHRlcihgJHsgc3RhdGVLZXkgfS4keyBTVEFURVNfRU5VTS5FUlJPUiB9YCwgbnVsbCwgU1RBVEVTW1NUQVRFU19FTlVNLkVSUk9SXS5sYWJlbCApCgogICAgfSwKICAgIGVycmFwcGxpZWQ6IHsKICAgICAgY291bnQ6IDAsCiAgICAgIGNvbG9yOiBTVEFURVNbU1RBVEVTX0VOVU0uRVJSX0FQUExJRURdLmNvbG9yLAogICAgICBsYWJlbDogbGFiZWxHZXR0ZXIoYCR7IHN0YXRlS2V5IH0uJHsgU1RBVEVTX0VOVU0uRVJSX0FQUExJRUQgfWAsIG51bGwsIFNUQVRFU1tTVEFURVNfRU5VTS5FUlJfQVBQTElFRF0ubGFiZWwgKQoKICAgIH0sCiAgICB3YWl0YXBwbGllZDogewogICAgICBjb3VudDogMCwKICAgICAgY29sb3I6IFNUQVRFU1tTVEFURVNfRU5VTS5XQUlUX0FQUExJRURdLmNvbG9yLAogICAgICBsYWJlbDogbGFiZWxHZXR0ZXIoYCR7IHN0YXRlS2V5IH0uJHsgU1RBVEVTX0VOVU0uV0FJVF9BUFBMSUVEIH1gLCBudWxsLCBTVEFURVNbU1RBVEVTX0VOVU0uV0FJVF9BUFBMSUVEXS5sYWJlbCApCgogICAgfSwKICAgIHVua25vd246IHsKICAgICAgY291bnQ6IDAsCiAgICAgIGNvbG9yOiBTVEFURVNbU1RBVEVTX0VOVU0uVU5LTk9XTl0uY29sb3IsCiAgICAgIGxhYmVsOiBsYWJlbEdldHRlcihgJHsgc3RhdGVLZXkgfS4keyBTVEFURVNfRU5VTS5VTktOT1dOIH1gLCBudWxsLCBTVEFURVNbU1RBVEVTX0VOVU0uVU5LTk9XTl0ubGFiZWwgKQogICAgfQogIH07Cn07CgpleHBvcnQgZGVmYXVsdCB7CgogIG5hbWU6ICdGbGVldFN1bW1hcnknLAoKICBjb21wb25lbnRzOiB7IEZsZWV0U3RhdHVzIH0sCgogIHByb3BzOiB7CiAgICBidW5kbGVzOiB7CiAgICAgIHR5cGU6ICAgIEFycmF5LAogICAgICBkZWZhdWx0OiAoKSA9PiBbXSwKICAgIH0sCiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICAgT2JqZWN0LAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCgogICAgc3RhdGVLZXk6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiAnZmxlZXQuZmxlZXRTdW1tYXJ5LnN0YXRlJwogICAgfSwKICB9LAoKICBjb21wdXRlZDogewoKICAgIHJlcG9OYW1lKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lOwogICAgfSwKCiAgICBidW5kbGVDb3VudHMoKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMuYnVuZGxlcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ubWV0YWRhdGEubmFtZS5zdGFydHNXaXRoKGAkeyB0aGlzLnJlcG9OYW1lIH0tYCkpOwoKICAgICAgaWYgKCFyZXNvdXJjZXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICBjb25zdCBvdXQgPSB7IC4uLmdldFJlc291cmNlRGVmYXVsdFN0YXRlKHRoaXMuJHN0b3JlLmdldHRlcnNbJ2kxOG4vd2l0aEZhbGxiYWNrJ10sIHRoaXMuc3RhdGVLZXkpIH07CgogICAgICByZXNvdXJjZXMuZm9yRWFjaCgoeyBzdGF0dXMsIG1ldGFkYXRhIH0pID0+IHsKICAgICAgICBpZiAoIXN0YXR1cykgewogICAgICAgICAgb3V0W1NUQVRFU19FTlVNLlVOS05PV05dLmNvdW50ICs9IDE7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgayA9IHN0YXR1cz8uc3VtbWFyeS5yZWFkeSA+IDAgJiYgc3RhdHVzPy5zdW1tYXJ5LmRlc2lyZWRSZWFkeSA9PT0gc3RhdHVzLnN1bW1hcnkucmVhZHk7CgogICAgICAgIGlmIChrKSB7CiAgICAgICAgICBvdXQucmVhZHkuY291bnQgKz0gMTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdGF0ZSA9IG1ldGFkYXRhLnN0YXRlPy5uYW1lPy50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAoc3RhdGUgJiYgb3V0W3N0YXRlXSkgewogICAgICAgICAgb3V0W3N0YXRlXS5jb3VudCArPSAxOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHsgY29uZGl0aW9ucyB9ID0gc3RhdHVzOwoKICAgICAgICBjb25zdCBub3RSZWFkeSA9IGNvbmRpdGlvbnMuZmluZCgoeyB0cmFuc2l0aW9uaW5nLCBtZXNzYWdlIH0pID0+IHsKICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uaW5nICYmICFtZXNzYWdlLmluY2x1ZGVzKFNUQVRFU19FTlVNLkVSUk9SKSAmJiAhbWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFNUQVRFU19FTlVNLkVSUl9BUFBMSUVEKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCEhbm90UmVhZHkpIHsKICAgICAgICAgIG91dC5ub3RyZWFkeS5jb3VudCArPSAxOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGNvbmRpdGlvbnMKICAgICAgICBjb25zdCBlcnJBcHBsaWVkID0gY29uZGl0aW9ucy5maW5kKCh7IGVycm9yLCBtZXNzYWdlIH0pID0+ICEhZXJyb3IgJiYgbWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFNUQVRFU19FTlVNLkVSUl9BUFBMSUVEKSk7CgogICAgICAgIGlmIChlcnJBcHBsaWVkKSB7CiAgICAgICAgICBvdXRbU1RBVEVTX0VOVU0uRVJSX0FQUExJRURdLmNvdW50ICs9IDE7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZXJyb3JTdGF0ZSA9IGNvbmRpdGlvbnMuZmluZCgoeyBlcnJvciwgbWVzc2FnZSB9KSA9PiAhIWVycm9yICYmIG1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhTVEFURVNfRU5VTS5FUlJPUikpOwoKICAgICAgICBpZiAob3V0W2Vycm9yU3RhdGVdKSB7CiAgICAgICAgICBvdXRbZXJyb3JTdGF0ZV0uY291bnQgKz0gMTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBvdXQudW5rbm93bi5jb3VudCArPSAxOwogICAgICB9KTsKCiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKG91dCkubWFwKChpdGVtKSA9PiB7CiAgICAgICAgaXRlbS52YWx1ZSA9IGl0ZW0uY291bnQ7CgogICAgICAgIHJldHVybiBpdGVtOwogICAgICB9KTsKICAgIH0sCgogICAgcmVzb3VyY2VDb3VudHMoKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMudmFsdWUuc3RhdHVzLnJlc291cmNlcyB8fCBbXTsKICAgICAgY29uc3Qgb3V0ID0geyAuLi5nZXRSZXNvdXJjZURlZmF1bHRTdGF0ZSh0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddLCB0aGlzLnN0YXRlS2V5KSB9OwoKICAgICAgcmVzb3VyY2VzLmZvckVhY2goKHsgc3RhdGUgfSkgPT4gewogICAgICAgIGNvbnN0IGsgPSBzdGF0ZT8udG9Mb3dlckNhc2UoKTsKCiAgICAgICAgaWYgKG91dFtrXSkgewogICAgICAgICAgb3V0W2tdLmNvdW50ICs9IDE7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBvdXQudW5rbm93bi5jb3VudCArPSAxOwogICAgICB9KTsKCiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKG91dCkubWFwKChpdGVtKSA9PiB7CiAgICAgICAgaXRlbS52YWx1ZSA9IGl0ZW0uY291bnQ7CgogICAgICAgIHJldHVybiBpdGVtOwogICAgICB9KTsKICAgIH0sCgogIH0sCgogIG1ldGhvZHM6IHsgY2FwaXRhbGl6ZSB9LAp9Owo="},{"version":3,"sources":["FleetSummary.vue"],"names":[],"mappings":";AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA","file":"FleetSummary.vue","sourceRoot":"node_modules/@rancher/shell/components/fleet","sourcesContent":["<script>\nimport capitalize from 'lodash/capitalize';\nimport { STATES, STATES_ENUM } from '@shell/plugins/dashboard-store/resource-class';\nimport FleetStatus from '@shell/components/fleet/FleetStatus';\n\nconst getResourceDefaultState = (labelGetter, stateKey) => {\n  return {\n    ready: {\n      count: 0,\n      color: STATES[STATES_ENUM.READY].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.READY }`, null, STATES[STATES_ENUM.READY].label )\n    },\n    info: {\n      count: 0,\n      color: STATES[STATES_ENUM.INFO].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.INFO }`, null, STATES[STATES_ENUM.INFO].label )\n    },\n    warning: {\n      count: 0,\n      color: STATES[STATES_ENUM.WARNING].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.WARNING }`, null, STATES[STATES_ENUM.WARNING].label )\n    },\n    notready: {\n      count: 0,\n      color: STATES[STATES_ENUM.NOT_READY].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.NOT_READY }`, null, STATES[STATES_ENUM.NOT_READY].label )\n    },\n    error: {\n      count: 0,\n      color: STATES[STATES_ENUM.ERROR].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.ERROR }`, null, STATES[STATES_ENUM.ERROR].label )\n\n    },\n    errapplied: {\n      count: 0,\n      color: STATES[STATES_ENUM.ERR_APPLIED].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.ERR_APPLIED }`, null, STATES[STATES_ENUM.ERR_APPLIED].label )\n\n    },\n    waitapplied: {\n      count: 0,\n      color: STATES[STATES_ENUM.WAIT_APPLIED].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.WAIT_APPLIED }`, null, STATES[STATES_ENUM.WAIT_APPLIED].label )\n\n    },\n    unknown: {\n      count: 0,\n      color: STATES[STATES_ENUM.UNKNOWN].color,\n      label: labelGetter(`${ stateKey }.${ STATES_ENUM.UNKNOWN }`, null, STATES[STATES_ENUM.UNKNOWN].label )\n    }\n  };\n};\n\nexport default {\n\n  name: 'FleetSummary',\n\n  components: { FleetStatus },\n\n  props: {\n    bundles: {\n      type:    Array,\n      default: () => [],\n    },\n    value: {\n      type:     Object,\n      required: true,\n    },\n\n    stateKey: {\n      type:    String,\n      default: 'fleet.fleetSummary.state'\n    },\n  },\n\n  computed: {\n\n    repoName() {\n      return this.value.metadata.name;\n    },\n\n    bundleCounts() {\n      const resources = this.bundles.filter((item) => item.metadata.name.startsWith(`${ this.repoName }-`));\n\n      if (!resources.length) {\n        return [];\n      }\n\n      const out = { ...getResourceDefaultState(this.$store.getters['i18n/withFallback'], this.stateKey) };\n\n      resources.forEach(({ status, metadata }) => {\n        if (!status) {\n          out[STATES_ENUM.UNKNOWN].count += 1;\n\n          return;\n        }\n\n        const k = status?.summary.ready > 0 && status?.summary.desiredReady === status.summary.ready;\n\n        if (k) {\n          out.ready.count += 1;\n\n          return;\n        }\n\n        const state = metadata.state?.name?.toLowerCase();\n\n        if (state && out[state]) {\n          out[state].count += 1;\n\n          return;\n        }\n\n        const { conditions } = status;\n\n        const notReady = conditions.find(({ transitioning, message }) => {\n          return transitioning && !message.includes(STATES_ENUM.ERROR) && !message.toLowerCase().includes(STATES_ENUM.ERR_APPLIED);\n        });\n\n        if (!!notReady) {\n          out.notready.count += 1;\n\n          return;\n        }\n\n        // check conditions\n        const errApplied = conditions.find(({ error, message }) => !!error && message.toLowerCase().includes(STATES_ENUM.ERR_APPLIED));\n\n        if (errApplied) {\n          out[STATES_ENUM.ERR_APPLIED].count += 1;\n\n          return;\n        }\n\n        const errorState = conditions.find(({ error, message }) => !!error && message.toLowerCase().includes(STATES_ENUM.ERROR));\n\n        if (out[errorState]) {\n          out[errorState].count += 1;\n\n          return;\n        }\n\n        out.unknown.count += 1;\n      });\n\n      return Object.values(out).map((item) => {\n        item.value = item.count;\n\n        return item;\n      });\n    },\n\n    resourceCounts() {\n      const resources = this.value.status.resources || [];\n      const out = { ...getResourceDefaultState(this.$store.getters['i18n/withFallback'], this.stateKey) };\n\n      resources.forEach(({ state }) => {\n        const k = state?.toLowerCase();\n\n        if (out[k]) {\n          out[k].count += 1;\n\n          return;\n        }\n        out.unknown.count += 1;\n      });\n\n      return Object.values(out).map((item) => {\n        item.value = item.count;\n\n        return item;\n      });\n    },\n\n  },\n\n  methods: { capitalize },\n};\n</script>\n\n<template>\n  <div class=\"row flexwrap\">\n    <FleetStatus\n      v-if=\"bundleCounts.length\"\n      title=\"Bundles\"\n      :values=\"bundleCounts\"\n      value-key=\"count\"\n    />\n    <FleetStatus\n      title=\"Resources\"\n      :values=\"resourceCounts\"\n      value-key=\"count\"\n    />\n  </div>\n</template>\n<style lang=\"scss\" scoped>\n   .flexwrap .fleet-status {\n    max-width: 50%;\n    margin-right: 15px;\n\n    &:last-child {\n      margin: 0\n    }\n  }\n  .countbox {\n    min-width: 150px;\n    width: 12.5%;\n    margin-bottom: 10px;\n  }\n</style>\n"]}]}
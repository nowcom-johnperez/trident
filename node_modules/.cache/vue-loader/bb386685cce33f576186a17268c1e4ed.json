{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/RegistryConfigs.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/RegistryConfigs.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBBcnJheUxpc3RHcm91cGVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0R3JvdXBlZCc7CmltcG9ydCB7IHNldCB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgeyBMYWJlbGVkSW5wdXQgfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0xhYmVsZWRJbnB1dCc7CmltcG9ydCB7IENoZWNrYm94IH0gZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9DaGVja2JveCc7CmltcG9ydCBTZWxlY3RPckNyZWF0ZUF1dGhTZWNyZXQgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9TZWxlY3RPckNyZWF0ZUF1dGhTZWNyZXQnOwppbXBvcnQgQ3JlYXRlRWRpdFZpZXcgZnJvbSAnQHNoZWxsL21peGlucy9jcmVhdGUtZWRpdC12aWV3JzsKaW1wb3J0IFNlY3JldFNlbGVjdG9yIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vU2VjcmV0U2VsZWN0b3InOwppbXBvcnQgeyBTRUNSRVRfVFlQRVMgYXMgVFlQRVMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3NlY3JldCc7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQXJyYXlMaXN0R3JvdXBlZCwKICAgIExhYmVsZWRJbnB1dCwKICAgIENoZWNrYm94LAogICAgU2VsZWN0T3JDcmVhdGVBdXRoU2VjcmV0LAogICAgU2VjcmV0U2VsZWN0b3IsCiAgfSwKCiAgbWl4aW5zOiBbQ3JlYXRlRWRpdFZpZXddLAoKICBwcm9wczogewogICAgbW9kZTogewogICAgICB0eXBlOiAgICAgU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCgogICAgdmFsdWU6IHsKICAgICAgdHlwZTogICAgIE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAoKICAgIGNsdXN0ZXJSZWdpc3RlckJlZm9yZUhvb2s6IHsKICAgICAgLy8gV2UgdXNlIHRoaXMgaG9vayBpbnN0ZWFkIG9mIHRoZSBjcmVhdGUgaG9vayBmcm9tIHRoZSBDcmVhdGVFZGl0VmlldwogICAgICAvLyBtaXhpbiBiZWNhdXNlIHRoaXMgaXMgYSBmb3JtIHdpdGhpbiBhIGZvcm0sIHRoZXJlZm9yZSB3ZQogICAgICAvLyBuZWVkIHRoZSBob29rIGZyb20gdGhlIHBhcmVudCBjb21wb25lbnQuCiAgICAgIHR5cGU6ICAgICBGdW5jdGlvbiwKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgY29uc3QgY29uZmlnTWFwID0gdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZz8ucmVnaXN0cmllcz8uY29uZmlncyB8fCB7fTsKICAgIGNvbnN0IGVudHJpZXMgPSBbXTsKCiAgICBjb25zdCBkZWZhdWx0QWRkVmFsdWUgPSB7CiAgICAgIGhvc3RuYW1lOiAgICAgICAgICAgICAnJywKICAgICAgYXV0aENvbmZpZ1NlY3JldE5hbWU6IG51bGwsCiAgICAgIGNhQnVuZGxlOiAgICAgICAgICAgICAnJywKICAgICAgaW5zZWN1cmVTa2lwVmVyaWZ5OiAgIGZhbHNlLAogICAgICB0bHNTZWNyZXROYW1lOiAgICAgICAgbnVsbCwKICAgIH07CgogICAgZm9yICggY29uc3QgaG9zdG5hbWUgaW4gY29uZmlnTWFwICkgewogICAgICBpZiAoY29uZmlnTWFwW2hvc3RuYW1lXSkgewogICAgICAgIGNvbmZpZ01hcFtob3N0bmFtZV0uaW5zZWN1cmVTa2lwVmVyaWZ5ID0gY29uZmlnTWFwW2hvc3RuYW1lXS5pbnNlY3VyZVNraXBWZXJpZnkgPz8gZGVmYXVsdEFkZFZhbHVlLmluc2VjdXJlU2tpcFZlcmlmeTsKICAgICAgICBjb25maWdNYXBbaG9zdG5hbWVdLmF1dGhDb25maWdTZWNyZXROYW1lID0gY29uZmlnTWFwW2hvc3RuYW1lXS5hdXRoQ29uZmlnU2VjcmV0TmFtZSA/PyBkZWZhdWx0QWRkVmFsdWUuYXV0aENvbmZpZ1NlY3JldE5hbWU7CiAgICAgICAgY29uZmlnTWFwW2hvc3RuYW1lXS5jYUJ1bmRsZSA9IGNvbmZpZ01hcFtob3N0bmFtZV0uY2FCdW5kbGUgPz8gZGVmYXVsdEFkZFZhbHVlLmNhQnVuZGxlOwogICAgICAgIGNvbmZpZ01hcFtob3N0bmFtZV0udGxzU2VjcmV0TmFtZSA9IGNvbmZpZ01hcFtob3N0bmFtZV0udGxzU2VjcmV0TmFtZSA/PyBkZWZhdWx0QWRkVmFsdWUudGxzU2VjcmV0TmFtZTsKICAgICAgfQogICAgICBlbnRyaWVzLnB1c2goewogICAgICAgIGhvc3RuYW1lLAogICAgICAgIC4uLmNvbmZpZ01hcFtob3N0bmFtZV0sCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiB7IGVudHJpZXMsIGRlZmF1bHRBZGRWYWx1ZSB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBUTFM6IHsKICAgICAgZ2V0KCkgewogICAgICAgIHJldHVybiBUWVBFUy5UTFM7CiAgICAgIH0sCiAgICB9LAogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB3aW5kb3cueiA9IHRoaXM7CiAgfSwKCiAgLy8gY3JlYXRlZCgpIHsKICAvLyAgIHNldCh0aGlzLnZhbHVlLCAnc3BlYy5ya2VDb25maWcucmVnaXN0cmllcy5jb25maWdzJywge30pOwogIC8vIH0sCgogIG1ldGhvZHM6IHsKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgY29uZmlncyA9IHt9OwoKICAgICAgZm9yICggY29uc3QgZW50cnkgb2YgdGhpcy5lbnRyaWVzICkgewogICAgICAgIGNvbnN0IGggPSBlbnRyeS5ob3N0bmFtZTsKCiAgICAgICAgaWYgKCAhaCB8fCBjb25maWdzW2hdICkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBjb25maWdzW2hdID0geyAuLi5lbnRyeSB9OwogICAgICAgIGRlbGV0ZSBjb25maWdzW2hdLmhvc3RuYW1lOwogICAgICB9CgogICAgICBzZXQodGhpcy52YWx1ZSwgJ3NwZWMucmtlQ29uZmlnLnJlZ2lzdHJpZXMuY29uZmlncycsIGNvbmZpZ3MpOwogICAgICB0aGlzLiRlbWl0KCd1cGRhdGVDb25maWdzJywgY29uZmlncyk7CiAgICB9LAoKICAgIHdyYXBSZWdpc3RlckJlZm9yZUhvb2soZm4sIC4uLmFyZ3MpIHsKICAgICAgYXN5bmMgZnVuY3Rpb24gd3JhcEZuKC4uLnBhcmFtcykgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKC4uLnBhcmFtcyk7CgogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgIH0sIDUwKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmNsdXN0ZXJSZWdpc3RlckJlZm9yZUhvb2sod3JhcEZuLCAuLi5hcmdzKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["RegistryConfigs.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RegistryConfigs.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport { set } from '@shell/utils/object';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport SelectOrCreateAuthSecret from '@shell/components/form/SelectOrCreateAuthSecret';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport SecretSelector from '@shell/components/form/SecretSelector';\nimport { SECRET_TYPES as TYPES } from '@shell/config/secret';\n\nexport default {\n  components: {\n    ArrayListGrouped,\n    LabeledInput,\n    Checkbox,\n    SelectOrCreateAuthSecret,\n    SecretSelector,\n  },\n\n  mixins: [CreateEditView],\n\n  props: {\n    mode: {\n      type:     String,\n      required: true,\n    },\n\n    value: {\n      type:     Object,\n      required: true,\n    },\n\n    clusterRegisterBeforeHook: {\n      // We use this hook instead of the create hook from the CreateEditView\n      // mixin because this is a form within a form, therefore we\n      // need the hook from the parent component.\n      type:     Function,\n      required: true\n    }\n  },\n\n  data() {\n    const configMap = this.value.spec.rkeConfig?.registries?.configs || {};\n    const entries = [];\n\n    const defaultAddValue = {\n      hostname:             '',\n      authConfigSecretName: null,\n      caBundle:             '',\n      insecureSkipVerify:   false,\n      tlsSecretName:        null,\n    };\n\n    for ( const hostname in configMap ) {\n      if (configMap[hostname]) {\n        configMap[hostname].insecureSkipVerify = configMap[hostname].insecureSkipVerify ?? defaultAddValue.insecureSkipVerify;\n        configMap[hostname].authConfigSecretName = configMap[hostname].authConfigSecretName ?? defaultAddValue.authConfigSecretName;\n        configMap[hostname].caBundle = configMap[hostname].caBundle ?? defaultAddValue.caBundle;\n        configMap[hostname].tlsSecretName = configMap[hostname].tlsSecretName ?? defaultAddValue.tlsSecretName;\n      }\n      entries.push({\n        hostname,\n        ...configMap[hostname],\n      });\n    }\n\n    return { entries, defaultAddValue };\n  },\n\n  computed: {\n    TLS: {\n      get() {\n        return TYPES.TLS;\n      },\n    },\n  },\n\n  mounted() {\n    window.z = this;\n  },\n\n  // created() {\n  //   set(this.value, 'spec.rkeConfig.registries.configs', {});\n  // },\n\n  methods: {\n    update() {\n      const configs = {};\n\n      for ( const entry of this.entries ) {\n        const h = entry.hostname;\n\n        if ( !h || configs[h] ) {\n          continue;\n        }\n\n        configs[h] = { ...entry };\n        delete configs[h].hostname;\n      }\n\n      set(this.value, 'spec.rkeConfig.registries.configs', configs);\n      this.$emit('updateConfigs', configs);\n    },\n\n    wrapRegisterBeforeHook(fn, ...args) {\n      async function wrapFn(...params) {\n        const result = await fn(...params);\n\n        return new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(result);\n          }, 50);\n        });\n      }\n      this.clusterRegisterBeforeHook(wrapFn, ...args);\n    }\n  }\n};\n</script>\n\n<template>\n  <div>\n    <h3>\n      {{ t('registryConfig.header') }}\n      <i\n        v-clean-tooltip=\"t('registryConfig.toolTip')\"\n        class=\"icon icon-info\"\n      />\n    </h3>\n    <p class=\"mb-20\">\n      {{ t('registryConfig.description') }}\n    </p>\n    <ArrayListGrouped\n      v-model=\"entries\"\n      :add-label=\"t('registryConfig.addLabel')\"\n      :default-add-value=\"defaultAddValue\"\n      :initial-empty-row=\"true\"\n      :mode=\"mode\"\n      @input=\"update\"\n    >\n      <template #default=\"{row}\">\n        <div class=\"row\">\n          <div class=\"col span-6\">\n            <LabeledInput\n              v-model=\"row.value.hostname\"\n              label=\"Registry Hostname\"\n              :mode=\"mode\"\n            />\n\n            <SelectOrCreateAuthSecret\n              v-model=\"row.value.authConfigSecretName\"\n              :register-before-hook=\"wrapRegisterBeforeHook\"\n              :append-unique-id-to-hook=\"true\"\n              in-store=\"management\"\n              :allow-ssh=\"false\"\n              :allow-rke=\"true\"\n              :vertical=\"true\"\n              :namespace=\"value.metadata.namespace\"\n              :mode=\"mode\"\n              generate-name=\"registryconfig-auth-\"\n            />\n          </div>\n          <div class=\"col span-6\">\n            <SecretSelector\n              v-model=\"row.value.tlsSecretName\"\n              in-store=\"management\"\n              :mode=\"mode\"\n              :types=\"[TLS]\"\n              :namespace=\"value.metadata.namespace\"\n              secret-name-label=\"TLS Secret\"\n            />\n\n            <LabeledInput\n              v-model=\"row.value.caBundle\"\n              class=\"mt-20\"\n              type=\"multiline\"\n              label=\"CA Cert Bundle\"\n              :mode=\"mode\"\n            />\n\n            <div>\n              <Checkbox\n                v-model=\"row.value.insecureSkipVerify\"\n                class=\"mt-10\"\n                :mode=\"mode\"\n                label=\"Skip TLS Verifications\"\n              />\n            </div>\n          </div>\n        </div>\n      </template>\n    </ArrayListGrouped>\n  </div>\n</template>\n"]}]}
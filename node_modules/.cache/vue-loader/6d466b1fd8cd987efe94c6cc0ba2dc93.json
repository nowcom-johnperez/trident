{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/detail/helm.cattle.io.projecthelmchart.vue?vue&type=style&index=0&id=2f1930f0&lang=scss&scoped=true","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/detail/helm.cattle.io.projecthelmchart.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1716430467357},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1716430467929},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/postcss-loader/src/index.js","mtime":1716430467882},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/sass-loader/dist/cjs.js","mtime":1716430453705},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50YWItcm93LWZvb3RlciB7CiAgbGlzdC1zdHlsZTogbm9uZTsKICBwYWRkaW5nOiAwOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IHJvdzsKCiAgQSwgLnJlc291cmNlcy1kcm9wZG93biB7CiAgICBjb2xvcjogdmFyKC0tbGluayk7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBhZGRpbmc6IDEwcHggMTVweDsKICAgICYuZGlzYWJsZWQgewogICAgICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgZmlsdGVyOiBncmF5c2NhbGUoMSk7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgICB9CiAgfQp9Ci5yZXNvdXJjZXMtZHJvcGRvd24gewogICAgbGkgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgIG1hcmdpbjogMTBweCA1cHg7CiAgICB9CgogICAgLmxpc3QtY291bnQgewogICAgICAgIG1hcmdpbi1sZWZ0OiAzMHB4OwogICAgfQp9Cg=="},{"version":3,"sources":["helm.cattle.io.projecthelmchart.vue"],"names":[],"mappings":";AA6PA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"helm.cattle.io.projecthelmchart.vue","sourceRoot":"node_modules/@rancher/shell/detail","sourcesContent":["<script>\nimport isEmpty from 'lodash/isEmpty';\nimport Tabbed from '@shell/components/Tabbed';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport DashboardMetrics from '@shell/components/DashboardMetrics';\nimport AlertTable from '@shell/components/AlertTable';\nimport { Banner } from '@components/Banner';\nimport { ENDPOINTS } from '@shell/config/types';\nimport { allHash } from '@shell/utils/promise';\n\nexport default {\n  components: {\n    Tabbed,\n    Tab,\n    DashboardMetrics,\n    AlertTable,\n    Banner\n  },\n  props: {\n    value: {\n      type:     Object,\n      required: true,\n    },\n  },\n  async fetch() {\n    await this.fetchDeps();\n  },\n  data() {\n    return {\n      endpointsHash:    [],\n      loadingEndpoints: true\n    };\n  },\n  computed: {\n    // there is a since-fixed bug in some versions of prom federator where this url is missing the trailing slash, which causes a redirect to an invalid grafana url\n    grafanaURL() {\n      const { grafanaURL } = this.value.status.dashboardValues;\n\n      if (!grafanaURL.endsWith('/')) {\n        return `${ grafanaURL }/`;\n      }\n\n      return grafanaURL;\n    },\n    monitoringNamespace() {\n      // picking the prometheusURL here, they're all going to be the same, but alertmanager and grafana can be deactivated\n      return this.pullKeyFromUrl(this.value.status.dashboardValues.prometheusURL, 'namespaces');\n    },\n    alertServiceEndpoint() {\n      return this.pullServiceEndpointFromUrl(this.value.status.dashboardValues.alertmanagerURL);\n    },\n    alertServiceEndpointEnabled() {\n      return this.checkEndpointEnabled(this.alertServiceEndpoint);\n    },\n    grafanaServiceEndpoint() {\n      return this.pullServiceEndpointFromUrl(this.value.status.dashboardValues.grafanaURL);\n    },\n    grafanaServiceEndpointEnabled() {\n      return this.checkEndpointEnabled(this.grafanaServiceEndpoint);\n    },\n    prometheusServiceEndpoint() {\n      return this.pullServiceEndpointFromUrl(this.value.status.dashboardValues.prometheusURL);\n    },\n    prometheusServiceEndpointEnabled() {\n      return this.checkEndpointEnabled(this.prometheusServiceEndpoint);\n    }\n  },\n  methods: {\n    async fetchDeps() {\n      const hash = await allHash({ endpoints: this.$store.dispatch('cluster/findAll', { type: ENDPOINTS }) });\n\n      this.endpointsHash = hash.endpoints;\n\n      this.loadingEndpoints = false;\n    },\n    checkEndpointEnabled(endpointString) {\n      if (this.endpointsHash.length === 0) {\n        return false;\n      }\n      const endpoint = this.endpointsHash.find((endpoint) => {\n        return endpoint.id === `${ this.monitoringNamespace }/${ endpointString }`;\n      });\n\n      return !isEmpty(endpoint) && !isEmpty(endpoint?.subsets);\n    },\n\n    pullKeyFromUrl(url = '', key) {\n      const splitUrl = url.split('/');\n      const keyIndex = splitUrl.indexOf(key);\n\n      // the value we're looking for is going to be at the index immediately after the key\n      return splitUrl[keyIndex + 1];\n    },\n    pullServiceEndpointFromUrl(url = '') {\n      const serviceString = this.pullKeyFromUrl(url, 'services');\n\n      // string is going to come back as \"<protocol>:<serviceEndPoint>:<port>\", we don't need the protocol or the port\n      return serviceString.split(':')[1];\n    },\n    showMenu(show) {\n      if (this.$refs.popover) {\n        if (show) {\n          this.$refs.popover.show();\n        } else {\n          this.$refs.popover.hide();\n        }\n      }\n    },\n  }\n};\n</script>\n\n<template>\n  <div>\n    <Tabbed\n      v-if=\"value.status.dashboardValues\"\n      class=\"mt-30\"\n    >\n      <Tab\n        name=\"project-metrics\"\n        :label=\"t('monitoring.tabs.projectMetrics')\"\n        :weight=\"3\"\n      >\n        <template #default=\"props\">\n          <DashboardMetrics\n            v-if=\"props.active && grafanaServiceEndpointEnabled\"\n            :detail-url=\"`${value.status.dashboardValues.grafanaURL}/d/rancher-pod-1/rancher-pod?orgId=1&kiosk`\"\n            :summary-url=\"`${value.status.dashboardValues.grafanaURL}/d/rancher-workload-1/rancher-workload?orgId=1&kiosk`\"\n            graph-height=\"825px\"\n            project\n            :modify-prefix=\"false\"\n          />\n        </template>\n      </Tab>\n      <Tab\n        name=\"active-alarms\"\n        :label=\"t('monitoring.overview.alertsList.label')\"\n        :weight=\"2\"\n      >\n        <template>\n          <AlertTable\n            :monitoring-namespace=\"monitoringNamespace\"\n            :alert-service-endpoint=\"alertServiceEndpoint\"\n          />\n        </template>\n      </Tab>\n      <template #tab-row-extras>\n        <div class=\"tab-row-footer\">\n          <div\n            class=\"resources-dropdown\"\n            :class=\"{disabled: !prometheusServiceEndpointEnabled}\"\n            tabindex=\"0\"\n            @blur=\"showMenu(false)\"\n            @click=\"showMenu(true)\"\n            @focus.capture=\"showMenu(true)\"\n          >\n            <v-popover\n              ref=\"popover\"\n              placement=\"bottom-end\"\n              offset=\"-10\"\n              trigger=\"manual\"\n              :delay=\"{show: 0, hide: 0}\"\n              :popper-options=\"{modifiers: { flip: { enabled: false } } }\"\n              :container=\"false\"\n            >\n              <div class=\"meta-title\">\n                {{ t('monitoring.tabs.prometheus') }} <i class=\"icon icon-chevron-down\" />\n              </div>\n              <template\n                slot=\"popover\"\n                class=\"resources-status-list\"\n              >\n                <ul\n                  class=\"list-unstyled dropdown\"\n                  @click.stop=\"showMenu(false)\"\n                >\n                  <li>\n                    <a\n                      :href=\"`${value.status.dashboardValues.prometheusURL}/graph`\"\n                      target=\"_blank\"\n                    >{{ t('monitoring.overview.linkedList.prometheusPromQl.label') }} <i class=\"icon icon-external-link\" /></a>\n                  </li>\n                  <li>\n                    <a\n                      :href=\"`${value.status.dashboardValues.prometheusURL}/rules`\"\n                      target=\"_blank\"\n                    >{{ t('monitoring.overview.linkedList.prometheusRules.label') }} <i class=\"icon icon-external-link\" /></a>\n                  </li>\n                  <li>\n                    <a\n                      :href=\"`${value.status.dashboardValues.prometheusURL}/targets`\"\n                      target=\"_blank\"\n                    >{{ t('monitoring.overview.linkedList.prometheusTargets.label') }} <i class=\"icon icon-external-link\" /></a>\n                  </li>\n                </ul>\n              </template>\n            </v-popover>\n          </div>\n          <a\n            :class=\"{disabled: !grafanaServiceEndpointEnabled}\"\n            :href=\"grafanaURL\"\n            target=\"_blank\"\n          > {{ t('monitoring.overview.linkedList.grafana.label') }} <i class=\"icon icon-external-link\" /></a>\n          <a\n            :class=\"{disabled: !alertServiceEndpointEnabled}\"\n            :href=\"value.status.dashboardValues.alertmanagerURL\"\n            target=\"_blank\"\n          > {{ t('monitoring.overview.linkedList.alertManager.label') }} <i class=\"icon icon-external-link\" /></a>\n        </div>\n      </template>\n    </Tabbed>\n    <div v-else>\n      <Banner color=\"error\">\n        {{ `${ t('monitoring.projectMonitoring.detail.error') }${ value.status.statusMessage || t('generic.unknown') }` }}\n      </Banner>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n  .tab-row-footer {\n    list-style: none;\n    padding: 0;\n    margin-left: auto;\n    display: flex;\n    flex-direction: row;\n\n    A, .resources-dropdown {\n      color: var(--link);\n      display: flex;\n      align-items: center;\n      padding: 10px 15px;\n      &.disabled {\n        cursor: not-allowed;\n        pointer-events: none;\n        filter: grayscale(1);\n        color: var(--muted);\n      }\n    }\n  }\n  .resources-dropdown {\n      li {\n          display: flex;\n          justify-content: space-between;\n          margin: 10px 5px;\n      }\n\n      .list-count {\n          margin-left: 30px;\n      }\n  }\n</style>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgQ0FUQUxPRywgVUlfUExVR0lOIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCBEaWFsb2cgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvRGlhbG9nLnZ1ZSc7CmltcG9ydCBDaGVja2JveCBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0NoZWNrYm94L0NoZWNrYm94LnZ1ZSc7CmltcG9ydCB7CiAgVUlfUExVR0lOX05BTUVTUEFDRSwKICBVSV9QTFVHSU5fQ0hBUlRTLAogIFVJX1BMVUdJTl9PUEVSQVRPUl9DUkRfQ0hBUlRfTkFNRSwKICBVSV9QTFVHSU5TX1JFUE9fTkFNRSwKICBVSV9QTFVHSU5TX1JFUE9fVVJMLAogIFVJX1BMVUdJTlNfUkVQT19CUkFOQ0gsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX05BTUUsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX1VSTCwKICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fQlJBTkNILAp9IGZyb20gJ0BzaGVsbC9jb25maWcvdWlwbHVnaW5zJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBDaGVja2JveCwKICAgIERpYWxvZywKICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L3NjaGVtYUZvciddKENBVEFMT0cuQ0xVU1RFUl9SRVBPKSkgewogICAgICAvLyB3ZSBuZWVkIHRvIGZvcmNlIHRoZSByZXF1ZXN0LCBzbyB0aGF0IHdlIGtub3cgYXQgYWxsIHRpbWVzIGlmIHdoYXQncyB0aGUgc3RhdHVzIG9mIHRoZSBvZmZpY2FsIGFuZCBwYXJ0bmVycyByZXBvcyAoaW5zdGFsbGVkIG9yIG5vdCkKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FUQUxPRy5DTFVTVEVSX1JFUE8sIG9wdDogeyBmb3JjZTogdHJ1ZSB9IH0pOwogICAgfQoKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L3NjaGVtYUZvciddKFVJX1BMVUdJTikpIHsKICAgICAgY29uc3QgcGx1Z2lucyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IFVJX1BMVUdJTiB9KTsKCiAgICAgIC8vIEFyZSB0aGVyZSBhbnkgcGx1Z2lucyBpbnN0YWxsZWQ/CiAgICAgIHRoaXMuaGFzUGx1Z2luc0luc3RhbGxlZCA9IChwbHVnaW5zIHx8IFtdKS5sZW5ndGggPiAwOwogICAgICB0aGlzLnJlbW92ZUNSRCA9ICF0aGlzLmhhc1BsdWdpbnNJbnN0YWxsZWQ7CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yczogICAgICBbXSwKICAgICAgcmVtb3ZlUmVwb3M6IHsKICAgICAgICBvZmZpY2lhbDogdHJ1ZSwKICAgICAgICBwYXJ0bmVyczogdHJ1ZQogICAgICB9LAogICAgICByZXBvc0luZm86IHsKICAgICAgICBvZmZpY2lhbDogewogICAgICAgICAgbmFtZTogICBVSV9QTFVHSU5TX1JFUE9fTkFNRSwKICAgICAgICAgIHVybDogICAgVUlfUExVR0lOU19SRVBPX1VSTCwKICAgICAgICAgIGJyYW5jaDogVUlfUExVR0lOU19SRVBPX0JSQU5DSCwKICAgICAgICB9LAogICAgICAgIHBhcnRuZXJzOiB7CiAgICAgICAgICBuYW1lOiAgIFVJX1BMVUdJTlNfUEFSVE5FUlNfUkVQT19OQU1FLAogICAgICAgICAgdXJsOiAgICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fVVJMLAogICAgICAgICAgYnJhbmNoOiBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fQlJBTkNILAogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVtb3ZlQ1JEOiAgICAgICAgICAgdHJ1ZSwKICAgICAgaGFzUGx1Z2luc0luc3RhbGxlZDogZmFsc2UsCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKHsgcmVwb3M6ICdjYXRhbG9nL3JlcG9zJyB9KSwKICAgIG9mZmljaWFsUmVwbygpIHsKICAgICAgY29uc3QgcmVwbyA9IHRoaXMucmVwb3MuZmluZCgocikgPT4gci51cmxEaXNwbGF5ID09PSBVSV9QTFVHSU5TX1JFUE9fVVJMKTsKCiAgICAgIHJldHVybiByZXBvPy5pZCA/IHJlcG8gOiB1bmRlZmluZWQ7CiAgICB9LAogICAgcGFydG5lcnNSZXBvKCkgewogICAgICBjb25zdCByZXBvID0gdGhpcy5yZXBvcy5maW5kKChyKSA9PiByLnVybERpc3BsYXkgPT09IFVJX1BMVUdJTlNfUEFSVE5FUlNfUkVQT19VUkwpOwoKICAgICAgcmV0dXJuIHJlcG8/LmlkID8gcmVwbyA6IHVuZGVmaW5lZDsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyByZW1vdmVDaGFydChuYW1lKSB7CiAgICAgIGNvbnN0IGFwcHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBDQVRBTE9HLkFQUCB9KTsKICAgICAgY29uc3QgZm91bmQgPSBhcHBzLmZpbmQoKGFwcCkgPT4gewogICAgICAgIHJldHVybiBhcHAubmFtZXNwYWNlID09PSBVSV9QTFVHSU5fTkFNRVNQQUNFICYmIGFwcC5uYW1lID09PSBuYW1lOwogICAgICB9KTsKCiAgICAgIGlmIChmb3VuZCkgewogICAgICAgIHJldHVybiBmb3VuZC5yZW1vdmUoKTsKICAgICAgfQoKICAgICAgLy8gUmV0dXJuIHJlamVjdGVkIHByb21pc2UgLSBjb3VsZCBub3QgZmluZCB0aGUgcmVxdWlyZWQgY2hhcnQKICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgY2hhcnQgwqd7IG5hbWUgfWApKTsKICAgIH0sCgogICAgc2hvd0RpYWxvZygpIHsKICAgICAgdGhpcy5yZW1vdmVSZXBvcyA9IHsKICAgICAgICBvZmZpY2lhbDogISF0aGlzLm9mZmljaWFsUmVwbywKICAgICAgICBwYXJ0bmVyczogISF0aGlzLnBhcnRuZXJzUmVwbywKICAgICAgfTsKICAgICAgdGhpcy4kbW9kYWwuc2hvdygnY29uZmlybS11aXBsdWdpbnMtcmVtb3ZlJyk7CiAgICB9LAoKICAgIGFzeW5jIGRvUmVtb3ZlKGJ0bkNiKSB7CiAgICAgIHRoaXMuZXJyb3JzID0gW107CgogICAgICAvLyBSZW1vdmUgdGhlIGNoYXJ0cyBpbiB0aGUgcmV2ZXJzZSBvcmRlciB0aGF0IHdlIGluc3RhbGwgdGhlbSBpbgogICAgICBsZXQgdW5pbnN0YWxsID0gWy4uLlVJX1BMVUdJTl9DSEFSVFNdLnJldmVyc2UoKTsKCiAgICAgIGlmICghdGhpcy5yZW1vdmVDUkQpIHsKICAgICAgICAvLyBVc2VyIGRvZXMgbm90IHdhbnQgdG8gdW5pbnN0YWxsIHRoZSBDUkQsIHNvIHJlbW92ZSB0aGUgY2hhcnQKICAgICAgICB1bmluc3RhbGwgPSB1bmluc3RhbGwuZmlsdGVyKChjaGFydCkgPT4gY2hhcnQgIT09IFVJX1BMVUdJTl9PUEVSQVRPUl9DUkRfQ0hBUlRfTkFNRSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pbnN0YWxsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hhcnQgPSB1bmluc3RhbGxbaV07CgogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCB0aGlzLnJlbW92ZUNoYXJ0KGNoYXJ0KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGUubWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyByZW1vdmUgZXh0ZW5zaW9uIHJlcG9zIHRoYXQgaGF2ZSBiZWVuIHBpY2tlZAogICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwoKICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5yZW1vdmVSZXBvcykgewogICAgICAgIGlmICh0aGlzLnJlbW92ZVJlcG9zW2tleV0gJiYgdGhpc1tgJHsga2V5IH1SZXBvYF0pIHsKICAgICAgICAgIHByb21pc2VzLnB1c2godGhpc1tgJHsga2V5IH1SZXBvYF0ucmVtb3ZlKCkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgcmVzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHByb21pc2VzKTsKCiAgICAgIHJlcy5mb3JFYWNoKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gJ3JlamVjdGVkJykgewogICAgICAgICAgY29uc29sZS5lcnJvcihyZXN1bHQucmVhc29uKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChyZXN1bHQucmVhc29uKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gZm9yZ2V0IFBMVUdJTlMgdHlwZSBmcm9tIHN0b3JlIGFzIGl0J3Mgbm90IG5lZWRlZAogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9mb3JnZXRUeXBlJywgVUlfUExVR0lOKTsKCiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwMDApKTsKCiAgICAgIHRoaXMuJGVtaXQoJ2RvbmUnKTsKCiAgICAgIGJ0bkNiKHRydWUpOwogICAgfSwKICB9Cn07Cg=="},{"version":3,"sources":["RemoveUIPlugins.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA","file":"RemoveUIPlugins.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport { CATALOG, UI_PLUGIN } from '@shell/config/types';\nimport Dialog from '@shell/components/Dialog.vue';\nimport Checkbox from '@components/Form/Checkbox/Checkbox.vue';\nimport {\n  UI_PLUGIN_NAMESPACE,\n  UI_PLUGIN_CHARTS,\n  UI_PLUGIN_OPERATOR_CRD_CHART_NAME,\n  UI_PLUGINS_REPO_NAME,\n  UI_PLUGINS_REPO_URL,\n  UI_PLUGINS_REPO_BRANCH,\n  UI_PLUGINS_PARTNERS_REPO_NAME,\n  UI_PLUGINS_PARTNERS_REPO_URL,\n  UI_PLUGINS_PARTNERS_REPO_BRANCH,\n} from '@shell/config/uiplugins';\n\nexport default {\n  components: {\n    Checkbox,\n    Dialog,\n  },\n\n  async fetch() {\n    if (this.$store.getters['management/schemaFor'](CATALOG.CLUSTER_REPO)) {\n      // we need to force the request, so that we know at all times if what's the status of the offical and partners repos (installed or not)\n      await this.$store.dispatch('management/findAll', { type: CATALOG.CLUSTER_REPO, opt: { force: true } });\n    }\n\n    if (this.$store.getters['management/schemaFor'](UI_PLUGIN)) {\n      const plugins = await this.$store.dispatch('management/findAll', { type: UI_PLUGIN });\n\n      // Are there any plugins installed?\n      this.hasPluginsInstalled = (plugins || []).length > 0;\n      this.removeCRD = !this.hasPluginsInstalled;\n    }\n  },\n\n  data() {\n    return {\n      errors:      [],\n      removeRepos: {\n        official: true,\n        partners: true\n      },\n      reposInfo: {\n        official: {\n          name:   UI_PLUGINS_REPO_NAME,\n          url:    UI_PLUGINS_REPO_URL,\n          branch: UI_PLUGINS_REPO_BRANCH,\n        },\n        partners: {\n          name:   UI_PLUGINS_PARTNERS_REPO_NAME,\n          url:    UI_PLUGINS_PARTNERS_REPO_URL,\n          branch: UI_PLUGINS_PARTNERS_REPO_BRANCH,\n        }\n      },\n      removeCRD:           true,\n      hasPluginsInstalled: false,\n    };\n  },\n\n  computed: {\n    ...mapGetters({ repos: 'catalog/repos' }),\n    officialRepo() {\n      const repo = this.repos.find((r) => r.urlDisplay === UI_PLUGINS_REPO_URL);\n\n      return repo?.id ? repo : undefined;\n    },\n    partnersRepo() {\n      const repo = this.repos.find((r) => r.urlDisplay === UI_PLUGINS_PARTNERS_REPO_URL);\n\n      return repo?.id ? repo : undefined;\n    }\n  },\n\n  methods: {\n    async removeChart(name) {\n      const apps = await this.$store.dispatch('management/findAll', { type: CATALOG.APP });\n      const found = apps.find((app) => {\n        return app.namespace === UI_PLUGIN_NAMESPACE && app.name === name;\n      });\n\n      if (found) {\n        return found.remove();\n      }\n\n      // Return rejected promise - could not find the required chart\n      return Promise.reject(new Error(`Could not find chart §{ name }`));\n    },\n\n    showDialog() {\n      this.removeRepos = {\n        official: !!this.officialRepo,\n        partners: !!this.partnersRepo,\n      };\n      this.$modal.show('confirm-uiplugins-remove');\n    },\n\n    async doRemove(btnCb) {\n      this.errors = [];\n\n      // Remove the charts in the reverse order that we install them in\n      let uninstall = [...UI_PLUGIN_CHARTS].reverse();\n\n      if (!this.removeCRD) {\n        // User does not want to uninstall the CRD, so remove the chart\n        uninstall = uninstall.filter((chart) => chart !== UI_PLUGIN_OPERATOR_CRD_CHART_NAME);\n      }\n\n      for (let i = 0; i < uninstall.length; i++) {\n        const chart = uninstall[i];\n\n        try {\n          await this.removeChart(chart);\n        } catch (e) {\n          this.errors.push(e.message);\n        }\n      }\n\n      // remove extension repos that have been picked\n      const promises = [];\n\n      for (const key in this.removeRepos) {\n        if (this.removeRepos[key] && this[`${ key }Repo`]) {\n          promises.push(this[`${ key }Repo`].remove());\n        }\n      }\n\n      const res = await Promise.allSettled(promises);\n\n      res.forEach((result) => {\n        if (result.status === 'rejected') {\n          console.error(result.reason); // eslint-disable-line no-console\n\n          this.errors.push(result.reason);\n        }\n      });\n\n      // forget PLUGINS type from store as it's not needed\n      this.$store.dispatch('management/forgetType', UI_PLUGIN);\n\n      await new Promise((resolve) => setTimeout(resolve, 5000));\n\n      this.$emit('done');\n\n      btnCb(true);\n    },\n  }\n};\n</script>\n<template>\n  <Dialog\n    name=\"confirm-uiplugins-remove\"\n    :title=\"t('plugins.setup.remove.title')\"\n    mode=\"disable\"\n    data-testid=\"disable-ext-modal\"\n    @okay=\"doRemove\"\n  >\n    <template>\n      <p class=\"mb-20\">\n        {{ t('plugins.setup.remove.prompt') }}\n      </p>\n      <!-- Official repo -->\n      <div\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"removeRepos.official\"\n          :primary=\"true\"\n          :disabled=\"!officialRepo\"\n          label-key=\"plugins.setup.remove.registry.official.title\"\n          data-testid=\"disable-ext-modal-remove-official-repo\"\n        />\n        <div\n          v-if=\"!officialRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.uninstalled') }})\n        </div>\n      </div>\n      <!-- Partners repo -->\n      <div\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"removeRepos.partners\"\n          :primary=\"true\"\n          :disabled=\"!partnersRepo\"\n          label-key=\"plugins.setup.remove.registry.partners.title\"\n          data-testid=\"disable-ext-modal-remove-partners-repo\"\n        />\n        <div\n          v-if=\"!partnersRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.uninstalled') }})\n        </div>\n      </div>\n      <div\n        v-if=\"hasPluginsInstalled\"\n        class=\"mt-20\"\n      >\n        <Checkbox\n          v-model=\"removeCRD\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.remove.crd.title\"\n        />\n        <div class=\"checkbox-info\">\n          {{ t('plugins.setup.remove.crd.prompt') }}\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<style lang=\"scss\" scoped>\n  .enable-plugin-support {\n    font-size: 14px;\n    margin-top: 20px;\n  }\n\n  .plugin-setup-error {\n    font-size: 14px;\n    color: var(--error);\n    margin: 10px 0 0 0;\n  }\n\n  .checkbox-info {\n    margin-left: 20px;\n    opacity: 0.7;\n  }\n</style>\n"]}]}
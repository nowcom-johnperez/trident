{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/cloud-credential/azure.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/cloud-credential/azure.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgeyBMYWJlbGVkSW5wdXQgfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0xhYmVsZWRJbnB1dCc7CmltcG9ydCB7IGF6dXJlRW52aXJvbm1lbnRzIH0gZnJvbSAnQHNoZWxsL21hY2hpbmUtY29uZmlnL2F6dXJlJzsKaW1wb3J0IExhYmVsZWRTZWxlY3QgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9MYWJlbGVkU2VsZWN0JzsKCmNvbnN0IEFaVVJFX0VSUk9SX01TR19SRUdFWCA9IC9eLipNZXNzYWdlPVwiKC4qKVwiJC87CmNvbnN0IEFaVVJFX0VSUk9SX0pTT05fUkVHRVggPSAvXi4qUmVzcG9uc2UgYm9keTogKHsuKn0pLzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IExhYmVsZWRJbnB1dCwgTGFiZWxlZFNlbGVjdCB9LAogIG1peGluczogICAgIFtDcmVhdGVFZGl0Vmlld10sCgogIGRhdGEoKSB7CiAgICBpZiAoICF0aGlzLnZhbHVlLmRlY29kZWREYXRhLmVudmlyb25tZW50ICkgewogICAgICB0aGlzLnZhbHVlLnNldERhdGEoJ2Vudmlyb25tZW50JywgJ0F6dXJlUHVibGljQ2xvdWQnKTsKICAgIH0KCiAgICByZXR1cm4geyBhenVyZUVudmlyb25tZW50cyB9OwogIH0sCgogIHdhdGNoOiB7CiAgICAndmFsdWUuZGVjb2RlZERhdGEuY2xpZW50SWQnKG5ldSkgewogICAgICB0aGlzLiRlbWl0KCd2YWxpZGF0aW9uQ2hhbmdlZCcsICEhbmV1KTsKICAgIH0sCiAgICAndmFsdWUuZGVjb2RlZERhdGEuY2xpZW50U2VjcmV0JyhuZXUpIHsKICAgICAgdGhpcy4kZW1pdCgndmFsaWRhdGlvbkNoYW5nZWQnLCAhIW5ldSk7CiAgICB9LAogICAgJ3ZhbHVlLmRlY29kZWREYXRhLnN1YnNjcmlwdGlvbklkJyhuZXUpIHsKICAgICAgdGhpcy4kZW1pdCgndmFsaWRhdGlvbkNoYW5nZWQnLCAhIW5ldSk7CiAgICB9LAogICAgJ3ZhbHVlLmRlY29kZWREYXRhLmVudmlyb25tZW50JyhuZXUpIHsKICAgICAgdGhpcy4kZW1pdCgndmFsaWRhdGlvbkNoYW5nZWQnLCAhIW5ldSk7CiAgICB9LAogIH0sCgogIG1ldGhvZHM6IHsKICAgIGFzeW5jIHRlc3QoKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBjbGllbnRJZCwKICAgICAgICBjbGllbnRTZWNyZXQsCiAgICAgICAgc3Vic2NyaXB0aW9uSWQsCiAgICAgICAgZW52aXJvbm1lbnQsCiAgICAgIH0gPSB0aGlzLnZhbHVlLmRlY29kZWREYXRhOwoKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgewogICAgICAgICAgdXJsOiAgICAnL21ldGEvYWtzQ2hlY2tDcmVkZW50aWFscycsCiAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgIGRhdGE6ICAgewogICAgICAgICAgICBjbGllbnRJZCwKICAgICAgICAgICAgY2xpZW50U2VjcmV0LAogICAgICAgICAgICBzdWJzY3JpcHRpb25JZCwKICAgICAgICAgICAgZW52aXJvbm1lbnQsCiAgICAgICAgICB9LAogICAgICAgICAgcmVkaXJlY3RVbmF1dGhvcml6ZWQ6IGZhbHNlLAogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChlLmVycm9yKSB7CiAgICAgICAgICAvLyBUcnkgYW5kIHBhcnNlIHRoZSByZXNwb25zZSBmcm9tIEF6dXJlIGEgY291cGxlIG9mIHdheXMKICAgICAgICAgIGNvbnN0IG1zZ01hdGNoID0gZS5lcnJvci5tYXRjaChBWlVSRV9FUlJPUl9NU0dfUkVHRVgpOwoKICAgICAgICAgIGlmIChtc2dNYXRjaD8ubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgIHJldHVybiB7IGVycm9yczogW21zZ01hdGNoWzFdXSB9OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QganNvbk1hdGNoID0gZS5lcnJvci5tYXRjaChBWlVSRV9FUlJPUl9KU09OX1JFR0VYKTsKCiAgICAgICAgICAgIGlmIChqc29uTWF0Y2g/Lmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvck9iaiA9IEpTT04ucGFyc2UoanNvbk1hdGNoWzFdKTsKCiAgICAgICAgICAgICAgICByZXR1cm4geyBlcnJvcnM6IFtlcnJvck9iai5lcnJvcl9kZXNjcmlwdGlvbl0gfTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDYW4ndCBwYXJzZSBlcnJvciwgc28gZ28gd2l0aCB0aGUgZ2VuZXJpYyAnYXV0aCBmYWlsZWQnIGVycm9yIG1lc3NhZ2UKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["azure.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"azure.vue","sourceRoot":"node_modules/@rancher/shell/cloud-credential","sourcesContent":["<script>\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { azureEnvironments } from '@shell/machine-config/azure';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\n\nconst AZURE_ERROR_MSG_REGEX = /^.*Message=\\\"(.*)\\\"$/;\nconst AZURE_ERROR_JSON_REGEX = /^.*Response body: ({.*})/;\n\nexport default {\n  components: { LabeledInput, LabeledSelect },\n  mixins:     [CreateEditView],\n\n  data() {\n    if ( !this.value.decodedData.environment ) {\n      this.value.setData('environment', 'AzurePublicCloud');\n    }\n\n    return { azureEnvironments };\n  },\n\n  watch: {\n    'value.decodedData.clientId'(neu) {\n      this.$emit('validationChanged', !!neu);\n    },\n    'value.decodedData.clientSecret'(neu) {\n      this.$emit('validationChanged', !!neu);\n    },\n    'value.decodedData.subscriptionId'(neu) {\n      this.$emit('validationChanged', !!neu);\n    },\n    'value.decodedData.environment'(neu) {\n      this.$emit('validationChanged', !!neu);\n    },\n  },\n\n  methods: {\n    async test() {\n      const {\n        clientId,\n        clientSecret,\n        subscriptionId,\n        environment,\n      } = this.value.decodedData;\n\n      try {\n        await this.$store.dispatch('management/request', {\n          url:    '/meta/aksCheckCredentials',\n          method: 'POST',\n          data:   {\n            clientId,\n            clientSecret,\n            subscriptionId,\n            environment,\n          },\n          redirectUnauthorized: false,\n        });\n\n        return true;\n      } catch (e) {\n        if (e.error) {\n          // Try and parse the response from Azure a couple of ways\n          const msgMatch = e.error.match(AZURE_ERROR_MSG_REGEX);\n\n          if (msgMatch?.length === 2) {\n            return { errors: [msgMatch[1]] };\n          } else {\n            const jsonMatch = e.error.match(AZURE_ERROR_JSON_REGEX);\n\n            if (jsonMatch?.length === 2) {\n              try {\n                const errorObj = JSON.parse(jsonMatch[1]);\n\n                return { errors: [errorObj.error_description] };\n              } catch (e) {}\n            }\n          }\n        }\n\n        // Can't parse error, so go with the generic 'auth failed' error message\n        return false;\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <section>\n    <div class=\"row mb-10\">\n      <div class=\"col span-6\">\n        <LabeledSelect\n          :value=\"value.decodedData.environment\"\n          :mode=\"mode\"\n          :options=\"azureEnvironments\"\n          option-key=\"value\"\n          option-label=\"value\"\n          :searchable=\"false\"\n          :required=\"true\"\n          :label=\"t('cluster.credential.azure.environment.label')\"\n          data-testid=\"azure-cloud-credentials-environment\"\n          @input=\"value.setData('environment', $event)\"\n        />\n      </div>\n      <div class=\"col span-6\">\n        <LabeledInput\n          :value=\"value.decodedData.subscriptionId\"\n          label-key=\"cluster.credential.azure.subscriptionId.label\"\n          type=\"text\"\n          :mode=\"mode\"\n          :required=\"true\"\n          data-testid=\"azure-cloud-credentials-subscription-id\"\n          @input=\"value.setData('subscriptionId', $event)\"\n        />\n      </div>\n    </div>\n    <div class=\"row mb-10\">\n      <div class=\"col span-6\">\n        <LabeledInput\n          :value=\"value.decodedData.clientId\"\n          label-key=\"cluster.credential.azure.clientId.label\"\n          type=\"text\"\n          :mode=\"mode\"\n          :required=\"true\"\n          data-testid=\"azure-cloud-credentials-client-id\"\n          @input=\"value.setData('clientId', $event)\"\n        />\n      </div>\n      <div class=\"col span-6\">\n        <LabeledInput\n          :value=\"value.decodedData.clientSecret\"\n          label-key=\"cluster.credential.azure.clientSecret.label\"\n          type=\"password\"\n          :mode=\"mode\"\n          :required=\"true\"\n          data-testid=\"azure-cloud-credentials-client-secret\"\n          @input=\"value.setData('clientSecret', $event)\"\n        />\n      </div>\n    </div>\n  </section>\n</template>\n"]}]}
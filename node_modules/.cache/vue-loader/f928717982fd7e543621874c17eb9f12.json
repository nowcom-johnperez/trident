{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/explorer/tools/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/explorer/tools/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IExvYWRpbmcgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTG9hZGluZyc7CmltcG9ydCB7IF9GTEFHR0VELCBERVBSRUNBVEVELCBISURERU4sIEZST01fVE9PTFMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IGZpbHRlckFuZEFycmFuZ2VDaGFydHMgfSBmcm9tICdAc2hlbGwvc3RvcmUvY2F0YWxvZyc7CmltcG9ydCB7IENBVEFMT0csIE1BTkFHRU1FTlQsIE5PUk1BTiB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBDQVRBTE9HIGFzIENBVEFMT0dfQU5OT1RBVElPTlMgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCBMYXp5SW1hZ2UgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTGF6eUltYWdlJzsKaW1wb3J0IEFwcFN1bW1hcnlHcmFwaCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtYXR0ZXIvQXBwU3VtbWFyeUdyYXBoJzsKaW1wb3J0IHsgc29ydEJ5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NvcnQnOwppbXBvcnQgeyBMRUdBQ1kgfSBmcm9tICdAc2hlbGwvc3RvcmUvZmVhdHVyZXMnOwppbXBvcnQgeyBpc0FsdGVybmF0ZSB9IGZyb20gJ0BzaGVsbC91dGlscy9wbGF0Zm9ybSc7CmltcG9ydCBJY29uTWVzc2FnZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9JY29uTWVzc2FnZSc7CmltcG9ydCBUeXBlRGVzY3JpcHRpb24gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvVHlwZURlc2NyaXB0aW9uJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBBcHBTdW1tYXJ5R3JhcGgsIExhenlJbWFnZSwgTG9hZGluZywgSWNvbk1lc3NhZ2UsIFR5cGVEZXNjcmlwdGlvbgogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NhdGFsb2cvbG9hZCcsIHsgZm9yY2U6IHRydWUsIHJlc2V0OiB0cnVlIH0pOwoKICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy4kcm91dGUucXVlcnk7CiAgICBjb25zdCBwcm9qZWN0cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuUFJPSkVDVCB9KTsKCiAgICB0aGlzLnNob3dEZXByZWNhdGVkID0gcXVlcnlbREVQUkVDQVRFRF0gPT09IF9GTEFHR0VEOwogICAgdGhpcy5zaG93SGlkZGVuID0gcXVlcnlbSElEREVOXSA9PT0gX0ZMQUdHRUQ7CgogICAgdGhpcy5hbGxJbnN0YWxsZWQgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2x1c3Rlci9maW5kQWxsJywgeyB0eXBlOiBDQVRBTE9HLkFQUCB9KTsKCiAgICAvLyBJZiBsZWdhY3kgZmVhdHVyZSBmbGFnIGVuYWJsZWQKICAgIGlmICh0aGlzLmxlZ2FjeUVuYWJsZWQpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZE1hdGNoaW5nJywgewogICAgICAgIHR5cGU6ICAgICBNQU5BR0VNRU5ULkNBVEFMT0dfVEVNUExBVEUsCiAgICAgICAgc2VsZWN0b3I6ICdjYXRhbG9nLmNhdHRsZS5pby9uYW1lPXN5c3RlbS1saWJyYXJ5JwogICAgICB9KTsKCiAgICAgIGlmIChyZXMpIHsKICAgICAgICB0aGlzLnYxU3lzdGVtQ2F0YWxvZyA9IHJlcy5yZWR1Y2UoKG1hcCwgdGVtcGxhdGUpID0+IHsKICAgICAgICAgIG1hcFt0ZW1wbGF0ZS5zcGVjLmRpc3BsYXlOYW1lXSA9IHRlbXBsYXRlOwoKICAgICAgICAgIHJldHVybiBtYXA7CiAgICAgICAgfSwge30pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudjFTeXN0ZW1DYXRhbG9nID0ge307CiAgICAgIH0KCiAgICAgIC8vIE5lZWQgdGhlIHByb2plY3QgSUQgb2YgdGhlIHN5c3RlbSBwcm9qZWN0IGluIG9yZGVyIHRvIGdldCB0aGUgYXBwcwogICAgICBjb25zdCBzeXN0ZW1Qcm9qZWN0ID0gcHJvamVjdHMuZmluZCgocCkgPT4gcC5zcGVjPy5kaXNwbGF5TmFtZSA9PT0gJ1N5c3RlbScpOwoKICAgICAgaWYgKHN5c3RlbVByb2plY3QpIHsKICAgICAgICBjb25zdCBpZCA9IHN5c3RlbVByb2plY3QuaWQucmVwbGFjZSgnLycsICc6Jyk7CgogICAgICAgIHRoaXMuc3lzdGVtUHJvamVjdCA9IGlkOwogICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2ZpbmRBbGwnLCB7CiAgICAgICAgICB0eXBlOiBOT1JNQU4uQVBQLAogICAgICAgICAgb3B0OiAgeyB1cmw6IGAvdjMvcHJvamVjdC8keyBpZCB9L2FwcHNgLCBmb3JjZTogdHJ1ZSB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgY29uc3QgbGVnYWN5RW5hYmxlZCA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2ZlYXR1cmVzL2dldCddKExFR0FDWSk7CgogICAgcmV0dXJuIHsKICAgICAgYWxsSW5zdGFsbGVkOiAgICBudWxsLAogICAgICB2MVN5c3RlbUNhdGFsb2c6IG51bGwsCiAgICAgIHN5c3RlbVByb2plY3Q6ICAgbnVsbCwKICAgICAgbGVnYWN5RW5hYmxlZCwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWydjdXJyZW50Q2x1c3RlciddKSwKICAgIC4uLm1hcEdldHRlcnMoeyBhbGxDaGFydHM6ICdjYXRhbG9nL2NoYXJ0cycsIGxvYWRpbmdFcnJvcnM6ICdjYXRhbG9nL2Vycm9ycycgfSksCiAgICAuLi5tYXBHZXR0ZXJzKHsgdDogJ2kxOG4vdCcgfSksCgogICAgdjFBcHBzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1sncmFuY2hlci9hbGwnXShOT1JNQU4uQVBQKTsKICAgIH0sCgogICAgbmFtZXNwYWNlcygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ2FjdGl2ZU5hbWVzcGFjZUNhY2hlJ107CiAgICB9LAoKICAgIHJhbmNoZXJDYXRhbG9nKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY2F0YWxvZy9yZXBvcyddLmZpbmQoKHgpID0+IHguaXNSYW5jaGVyKTsKICAgIH0sCgogICAgaW5zdGFsbGVkQXBwcygpIHsKICAgICAgcmV0dXJuIHRoaXMuYWxsSW5zdGFsbGVkOwogICAgfSwKCiAgICBpbnN0YWxsZWRBcHBGb3JDaGFydCgpIHsKICAgICAgY29uc3Qgb3V0ID0ge307CgogICAgICBmb3IgKCBjb25zdCBhcHAgb2YgdGhpcy5pbnN0YWxsZWRBcHBzICkgewogICAgICAgIGNvbnN0IG1hdGNoaW5nID0gYXBwLm1hdGNoaW5nQ2hhcnQoKTsKCiAgICAgICAgaWYgKCAhbWF0Y2hpbmcgKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIG91dFttYXRjaGluZy5pZF0gPSBhcHA7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIG9wdGlvbnMoKSB7CiAgICAgIGNvbnN0IGNsdXN0ZXJQcm92aWRlciA9IHRoaXMuY3VycmVudENsdXN0ZXIuc3RhdHVzLnByb3ZpZGVyIHx8ICdvdGhlcic7CiAgICAgIGNvbnN0IGVuYWJsZWRDaGFydHMgPSAodGhpcy5hbGxDaGFydHMgfHwgW10pOwoKICAgICAgbGV0IGNoYXJ0cyA9IGZpbHRlckFuZEFycmFuZ2VDaGFydHMoZW5hYmxlZENoYXJ0cywgewogICAgICAgIGNsdXN0ZXJQcm92aWRlciwKICAgICAgICBzaG93RGVwcmVjYXRlZDogdGhpcy5zaG93RGVwcmVjYXRlZCwKICAgICAgICBzaG93SGlkZGVuOiAgICAgdGhpcy5zaG93SGlkZGVuLAogICAgICAgIHNob3dSZXBvczogICAgICBbdGhpcy5yYW5jaGVyQ2F0YWxvZz8uX2tleV0sCiAgICAgICAgc2hvd1R5cGVzOiAgICAgIFtDQVRBTE9HX0FOTk9UQVRJT05TLl9DTFVTVEVSX1RPT0xdLAogICAgICB9KTsKCiAgICAgIGNoYXJ0cyA9IGNoYXJ0cy5maWx0ZXIoKGMpID0+IGMuc2lkZUxhYmVsICE9PSAnRXhwZXJpbWVudGFsJyk7CgogICAgICAvLyAgSWYgbGVnYWN5IHN1cHBvcnQgaXMgZW5hYmxlZCwgc2hvdyBWMSBjaGFydHMgZm9yIHNvbWUgVjEgQ2x1c3RlciB0b29scwogICAgICBpZiAodGhpcy5sZWdhY3lFbmFibGVkKSB7CiAgICAgICAgY2hhcnRzID0gY2hhcnRzLmNvbmNhdCh0aGlzLmxlZ2FjeUNoYXJ0cyk7CiAgICAgICAgY2hhcnRzID0gc29ydEJ5KGNoYXJ0cywgWydjZXJ0aWZpZWRTb3J0JywgJ2NoYXJ0TmFtZURpc3BsYXknXSk7CiAgICAgIH0KCiAgICAgIGxldCBjaGFydHNXaXRoQXBwcyA9IGNoYXJ0cy5tYXAoKGNoYXJ0KSA9PiB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGNoYXJ0LAogICAgICAgICAgYXBwOiB0aGlzLmluc3RhbGxlZEFwcEZvckNoYXJ0W2NoYXJ0LmlkXSwKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIC8vIFYxIExlZ2FjeSBzdXBwb3J0CiAgICAgIGlmICh0aGlzLmxlZ2FjeUVuYWJsZWQpIHsKICAgICAgICBjaGFydHNXaXRoQXBwcyA9IHRoaXMuY2hlY2tMZWdhY3lBcHAoY2hhcnRzV2l0aEFwcHMsIHRoaXMudjFBcHBzLCAndjEtbW9uaXRvcmluZycsICdyYW5jaGVyLW1vbml0b3JpbmcnLCAnY2x1c3Rlci1tb25pdG9yaW5nJywgZmFsc2UpOwogICAgICAgIGNoYXJ0c1dpdGhBcHBzID0gdGhpcy5jaGVja0xlZ2FjeUFwcChjaGFydHNXaXRoQXBwcywgdGhpcy52MUFwcHMsICd2MS1pc3RpbycsICdyYW5jaGVyLWlzdGlvJywgJ2NsdXN0ZXItaXN0aW8nLCB0cnVlKTsKICAgICAgICBjaGFydHNXaXRoQXBwcyA9IHRoaXMuY2hlY2tMZWdhY3lBcHAoY2hhcnRzV2l0aEFwcHMsIHRoaXMudjFBcHBzLCAndjEtbG9nZ2luZycsICdyYW5jaGVyLWxvZ2dpbmcnLCAncmFuY2hlci1sb2dnaW5nJywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGFydHNXaXRoQXBwczsKICAgIH0sCgogICAgbGVnYWN5Q2hhcnRzKCkgewogICAgICAvLyBGYWtlIGNoYXJ0cyBmb3IgdGhlIGxlZ2FjeSBWMSB0b29scwogICAgICByZXR1cm4gWwogICAgICAgIHRoaXMuX2xlZ2FjeUNoYXJ0KCdtb25pdG9yaW5nJyksCiAgICAgICAgdGhpcy5fbGVnYWN5Q2hhcnQoJ2xvZ2dpbmcnKSwKICAgICAgICB0aGlzLl9sZWdhY3lDaGFydCgnaXN0aW8nKSwKICAgICAgXTsKICAgIH0KICB9LAoKICB3YXRjaDogewogICAgbmFtZXNwYWNlcygpIHsKICAgICAgLy8gV2hlbiB0aGUgbmFtZXNwYWNlcyBjaGFuZ2UsIGNoZWNrIHRoZSB2MSBhcHBzIC0gbWlnaHQgaW5kaWNhdGUgYWRkIG9yIHJlbW92YWwgb2YgYSB2MSBhcHAKICAgICAgaWYgKHRoaXMubGVnYWN5RW5hYmxlZCAmJiB0aGlzLnN5c3RlbVByb2plY3QpIHsKICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncmFuY2hlci9maW5kQWxsJywgewogICAgICAgICAgdHlwZTogTk9STUFOLkFQUCwKICAgICAgICAgIG9wdDogIHsgdXJsOiBgL3YzL3Byb2plY3QvJHsgdGhpcy5zeXN0ZW1Qcm9qZWN0IH0vYXBwc2AsIGZvcmNlOiB0cnVlIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB3aW5kb3cuYyA9IHRoaXM7CiAgfSwKCiAgbWV0aG9kczogewogICAgX2xlZ2FjeUNoYXJ0KGlkKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2VydGlmaWVkU29ydDogICAgMSwKICAgICAgICBjaGFydE5hbWVEaXNwbGF5OiB0aGlzLnQoYHYxQ2x1c3RlclRvb2xzLiR7IGlkIH0ubGFiZWxgKSwKICAgICAgICBjaGFydERlc2NyaXB0aW9uOiB0aGlzLnQoYHYxQ2x1c3RlclRvb2xzLiR7IGlkIH0uZGVzY3JpcHRpb25gKSwKICAgICAgICBpZDogICAgICAgICAgICAgICBgdjEtJHsgaWQgfWAsCiAgICAgICAgY2hhcnROYW1lOiAgICAgICAgYHYxLSR7IGlkIH1gLAogICAgICAgIGtleTogICAgICAgICAgICAgIGB2MS0keyBpZCB9YCwKICAgICAgICB2ZXJzaW9uczogICAgICAgICB0aGlzLmdldExlZ2FjeVZlcnNpb25zKGByYW5jaGVyLSR7IGlkIH1gKSwKICAgICAgICByZXBvS2V5OiAgICAgICAgICB0aGlzLnJhbmNoZXJDYXRhbG9nPy5fa2V5LAogICAgICAgIGxlZ2FjeTogICAgICAgICAgIHRydWUsCiAgICAgICAgbGVnYWN5UGFnZTogICAgICAgaWQsCiAgICAgICAgaWNvbk5hbWU6ICAgICAgICAgYGljb24tJHsgaWQgfWAsCiAgICAgIH07CiAgICB9LAoKICAgIGVkaXQoYXBwLCB2ZXJzaW9uKSB7CiAgICAgIGFwcC5nb1RvVXBncmFkZSh2ZXJzaW9uLCB0cnVlKTsKICAgIH0sCgogICAgcmVtb3ZlKGFwcCwgZXZlbnQpIHsKICAgICAgY29uc3QgYWx0ID0gaXNBbHRlcm5hdGUoZXZlbnQpOwoKICAgICAgaWYgKCFhbHQpIHsKICAgICAgICBhcHAucHJvbXB0UmVtb3ZlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVXNlciBoZWxkIGFsdCBrZXksIHNvIGRvbid0IHByb21wdAogICAgICAgIGFwcC5yZW1vdmUoKTsKICAgICAgfQogICAgfSwKCiAgICBpbnN0YWxsKGNoYXJ0KSB7CiAgICAgIGNoYXJ0LmdvVG9JbnN0YWxsKEZST01fVE9PTFMpOwogICAgfSwKCiAgICBvcGVuVjFUb29sKGlkKSB7CiAgICAgIGNvbnN0IGNsdXN0ZXIgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjdXJyZW50Q2x1c3RlciddOwogICAgICBjb25zdCByb3V0ZSA9IHsKICAgICAgICBuYW1lOiAgICdjLWNsdXN0ZXItZXhwbG9yZXItdG9vbHMtcGFnZXMtcGFnZScsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBjbHVzdGVyOiBjbHVzdGVyLmlkLAogICAgICAgICAgcHJvZHVjdDogJ2V4cGxvcmVyJywKICAgICAgICAgIHBhZ2U6ICAgIGlkLAogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHJvdXRlKTsKICAgIH0sCgogICAgZ2V0TGVnYWN5VmVyc2lvbnMoaWQpIHsKICAgICAgY29uc3QgdmVyc2lvbnMgPSBbXTsKICAgICAgY29uc3QgYyA9IHRoaXMudjFTeXN0ZW1DYXRhbG9nPy5baWRdOwoKICAgICAgaWYgKGM/LnNwZWM/LnZlcnNpb25zKSB7CiAgICAgICAgYy5zcGVjLnZlcnNpb25zLmZvckVhY2goKHYpID0+IHZlcnNpb25zLnB1c2goeyB2ZXJzaW9uOiB2LnZlcnNpb24gfSkpOwogICAgICB9CgogICAgICByZXR1cm4gdmVyc2lvbnM7CiAgICB9LAoKICAgIGNoZWNrTGVnYWN5QXBwKGNoYXJ0c1dpdGhBcHBzLCB2MUFwcHMsIHYxQ2hhcnROYW1lLCB2MkNoYXJ0TmFtZSwgdjFBcHBOYW1lLCBzaG93T25seUlmSW5zdGFsbGVkKSB7CiAgICAgIGNvbnN0IHYxID0gY2hhcnRzV2l0aEFwcHMuZmluZCgoYSkgPT4gYS5jaGFydC5jaGFydE5hbWUgPT09IHYxQ2hhcnROYW1lKTsKICAgICAgY29uc3QgdjIgPSBjaGFydHNXaXRoQXBwcy5maW5kKChhKSA9PiBhLmNoYXJ0LmNoYXJ0TmFtZSA9PT0gdjJDaGFydE5hbWUpOwoKICAgICAgaWYgKHYxKSB7CiAgICAgICAgY29uc3QgdjFBcHAgPSB2MUFwcHMuZmluZCgoYSkgPT4gYS5pZC5pbmRleE9mKHYxQXBwTmFtZSkgPiAwKTsKCiAgICAgICAgdjEuYXBwID0gdjFBcHA7CgogICAgICAgIC8vIEFkZCBpbiB0aGUgdXBncmFkZSB2ZXJzaW9uIGluZm9ybWF0aW9uIGZvciBhIGxlZ2FjeSB2MSBhcHAKICAgICAgICBpZiAodjEuYXBwKSB7CiAgICAgICAgICB2MS5hcHAudXBncmFkZUF2YWlsYWJsZSA9IHVuZGVmaW5lZDsKICAgICAgICAgIC8vIENoZWNrIGlmIGFuIHVwZ3JhZGUgaXMgYXZhaWxhYmxlCiAgICAgICAgICBpZiAodjEuY2hhcnQudmVyc2lvbnM/Lmxlbmd0aCkgewogICAgICAgICAgICBjb25zdCBsYXRlc3QgPSB2MS5jaGFydC52ZXJzaW9uc1swXT8udmVyc2lvbjsKCiAgICAgICAgICAgIGlmICh2MS5hcHAuY3VycmVudFZlcnNpb24gIT09IGxhdGVzdCkgewogICAgICAgICAgICAgIHYxLmFwcC51cGdyYWRlQXZhaWxhYmxlID0gbGF0ZXN0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChzaG93T25seUlmSW5zdGFsbGVkKSB7CiAgICAgICAgICAvLyBSZW1vdmUgdGhlIHYxIGNoYXJ0IGlmIGl0IGlzIG5vdCBhbHJlYWR5IGluc3RhbGxlZCBmb3IgY2hhcnRzIHdoaWNoIHdlIG5vIGxvbmdlciBzdXBwb3J0CiAgICAgICAgICBjaGFydHNXaXRoQXBwcyA9IGNoYXJ0c1dpdGhBcHBzLmZpbHRlcigoYykgPT4gYyAhPT0gdjEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHYyKSB7CiAgICAgICAgICBpZiAodjEuYXBwKSB7CiAgICAgICAgICAgIHYyLmFwcCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdjIuYmxvY2tlZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHYyLmFwcCkgewogICAgICAgICAgICB2MS5ibG9ja2VkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGFydHNXaXRoQXBwczsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/explorer/tools","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport Loading from '@shell/components/Loading';\nimport { _FLAGGED, DEPRECATED, HIDDEN, FROM_TOOLS } from '@shell/config/query-params';\nimport { filterAndArrangeCharts } from '@shell/store/catalog';\nimport { CATALOG, MANAGEMENT, NORMAN } from '@shell/config/types';\nimport { CATALOG as CATALOG_ANNOTATIONS } from '@shell/config/labels-annotations';\nimport LazyImage from '@shell/components/LazyImage';\nimport AppSummaryGraph from '@shell/components/formatter/AppSummaryGraph';\nimport { sortBy } from '@shell/utils/sort';\nimport { LEGACY } from '@shell/store/features';\nimport { isAlternate } from '@shell/utils/platform';\nimport IconMessage from '@shell/components/IconMessage';\nimport TypeDescription from '@shell/components/TypeDescription';\n\nexport default {\n  components: {\n    AppSummaryGraph, LazyImage, Loading, IconMessage, TypeDescription\n  },\n\n  async fetch() {\n    await this.$store.dispatch('catalog/load', { force: true, reset: true });\n\n    const query = this.$route.query;\n    const projects = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.PROJECT });\n\n    this.showDeprecated = query[DEPRECATED] === _FLAGGED;\n    this.showHidden = query[HIDDEN] === _FLAGGED;\n\n    this.allInstalled = await this.$store.dispatch('cluster/findAll', { type: CATALOG.APP });\n\n    // If legacy feature flag enabled\n    if (this.legacyEnabled) {\n      const res = await this.$store.dispatch('management/findMatching', {\n        type:     MANAGEMENT.CATALOG_TEMPLATE,\n        selector: 'catalog.cattle.io/name=system-library'\n      });\n\n      if (res) {\n        this.v1SystemCatalog = res.reduce((map, template) => {\n          map[template.spec.displayName] = template;\n\n          return map;\n        }, {});\n      } else {\n        this.v1SystemCatalog = {};\n      }\n\n      // Need the project ID of the system project in order to get the apps\n      const systemProject = projects.find((p) => p.spec?.displayName === 'System');\n\n      if (systemProject) {\n        const id = systemProject.id.replace('/', ':');\n\n        this.systemProject = id;\n        await this.$store.dispatch('rancher/findAll', {\n          type: NORMAN.APP,\n          opt:  { url: `/v3/project/${ id }/apps`, force: true }\n        });\n      }\n    }\n  },\n\n  data() {\n    const legacyEnabled = this.$store.getters['features/get'](LEGACY);\n\n    return {\n      allInstalled:    null,\n      v1SystemCatalog: null,\n      systemProject:   null,\n      legacyEnabled,\n    };\n  },\n\n  computed: {\n    ...mapGetters(['currentCluster']),\n    ...mapGetters({ allCharts: 'catalog/charts', loadingErrors: 'catalog/errors' }),\n    ...mapGetters({ t: 'i18n/t' }),\n\n    v1Apps() {\n      return this.$store.getters['rancher/all'](NORMAN.APP);\n    },\n\n    namespaces() {\n      return this.$store.getters['activeNamespaceCache'];\n    },\n\n    rancherCatalog() {\n      return this.$store.getters['catalog/repos'].find((x) => x.isRancher);\n    },\n\n    installedApps() {\n      return this.allInstalled;\n    },\n\n    installedAppForChart() {\n      const out = {};\n\n      for ( const app of this.installedApps ) {\n        const matching = app.matchingChart();\n\n        if ( !matching ) {\n          continue;\n        }\n\n        out[matching.id] = app;\n      }\n\n      return out;\n    },\n\n    options() {\n      const clusterProvider = this.currentCluster.status.provider || 'other';\n      const enabledCharts = (this.allCharts || []);\n\n      let charts = filterAndArrangeCharts(enabledCharts, {\n        clusterProvider,\n        showDeprecated: this.showDeprecated,\n        showHidden:     this.showHidden,\n        showRepos:      [this.rancherCatalog?._key],\n        showTypes:      [CATALOG_ANNOTATIONS._CLUSTER_TOOL],\n      });\n\n      charts = charts.filter((c) => c.sideLabel !== 'Experimental');\n\n      //  If legacy support is enabled, show V1 charts for some V1 Cluster tools\n      if (this.legacyEnabled) {\n        charts = charts.concat(this.legacyCharts);\n        charts = sortBy(charts, ['certifiedSort', 'chartNameDisplay']);\n      }\n\n      let chartsWithApps = charts.map((chart) => {\n        return {\n          chart,\n          app: this.installedAppForChart[chart.id],\n        };\n      });\n\n      // V1 Legacy support\n      if (this.legacyEnabled) {\n        chartsWithApps = this.checkLegacyApp(chartsWithApps, this.v1Apps, 'v1-monitoring', 'rancher-monitoring', 'cluster-monitoring', false);\n        chartsWithApps = this.checkLegacyApp(chartsWithApps, this.v1Apps, 'v1-istio', 'rancher-istio', 'cluster-istio', true);\n        chartsWithApps = this.checkLegacyApp(chartsWithApps, this.v1Apps, 'v1-logging', 'rancher-logging', 'rancher-logging', true);\n      }\n\n      return chartsWithApps;\n    },\n\n    legacyCharts() {\n      // Fake charts for the legacy V1 tools\n      return [\n        this._legacyChart('monitoring'),\n        this._legacyChart('logging'),\n        this._legacyChart('istio'),\n      ];\n    }\n  },\n\n  watch: {\n    namespaces() {\n      // When the namespaces change, check the v1 apps - might indicate add or removal of a v1 app\n      if (this.legacyEnabled && this.systemProject) {\n        this.$store.dispatch('rancher/findAll', {\n          type: NORMAN.APP,\n          opt:  { url: `/v3/project/${ this.systemProject }/apps`, force: true }\n        });\n      }\n    }\n  },\n\n  mounted() {\n    window.c = this;\n  },\n\n  methods: {\n    _legacyChart(id) {\n      return {\n        certifiedSort:    1,\n        chartNameDisplay: this.t(`v1ClusterTools.${ id }.label`),\n        chartDescription: this.t(`v1ClusterTools.${ id }.description`),\n        id:               `v1-${ id }`,\n        chartName:        `v1-${ id }`,\n        key:              `v1-${ id }`,\n        versions:         this.getLegacyVersions(`rancher-${ id }`),\n        repoKey:          this.rancherCatalog?._key,\n        legacy:           true,\n        legacyPage:       id,\n        iconName:         `icon-${ id }`,\n      };\n    },\n\n    edit(app, version) {\n      app.goToUpgrade(version, true);\n    },\n\n    remove(app, event) {\n      const alt = isAlternate(event);\n\n      if (!alt) {\n        app.promptRemove();\n      } else {\n        // User held alt key, so don't prompt\n        app.remove();\n      }\n    },\n\n    install(chart) {\n      chart.goToInstall(FROM_TOOLS);\n    },\n\n    openV1Tool(id) {\n      const cluster = this.$store.getters['currentCluster'];\n      const route = {\n        name:   'c-cluster-explorer-tools-pages-page',\n        params: {\n          cluster: cluster.id,\n          product: 'explorer',\n          page:    id,\n        }\n      };\n\n      this.$router.replace(route);\n    },\n\n    getLegacyVersions(id) {\n      const versions = [];\n      const c = this.v1SystemCatalog?.[id];\n\n      if (c?.spec?.versions) {\n        c.spec.versions.forEach((v) => versions.push({ version: v.version }));\n      }\n\n      return versions;\n    },\n\n    checkLegacyApp(chartsWithApps, v1Apps, v1ChartName, v2ChartName, v1AppName, showOnlyIfInstalled) {\n      const v1 = chartsWithApps.find((a) => a.chart.chartName === v1ChartName);\n      const v2 = chartsWithApps.find((a) => a.chart.chartName === v2ChartName);\n\n      if (v1) {\n        const v1App = v1Apps.find((a) => a.id.indexOf(v1AppName) > 0);\n\n        v1.app = v1App;\n\n        // Add in the upgrade version information for a legacy v1 app\n        if (v1.app) {\n          v1.app.upgradeAvailable = undefined;\n          // Check if an upgrade is available\n          if (v1.chart.versions?.length) {\n            const latest = v1.chart.versions[0]?.version;\n\n            if (v1.app.currentVersion !== latest) {\n              v1.app.upgradeAvailable = latest;\n            }\n          }\n        } else if (showOnlyIfInstalled) {\n          // Remove the v1 chart if it is not already installed for charts which we no longer support\n          chartsWithApps = chartsWithApps.filter((c) => c !== v1);\n        }\n\n        if (v2) {\n          if (v1.app) {\n            v2.app = undefined;\n            v2.blocked = true;\n          } else if (v2.app) {\n            v1.blocked = true;\n          }\n        }\n      }\n\n      return chartsWithApps;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  $margin: 10px;\n  $logo: 50px;\n\n  .grid {\n    display: flex;\n    justify-content: flex-start;\n    flex-wrap: wrap;\n    margin: 0 -1*$margin;\n\n    @media only screen and (min-width: map-get($breakpoints, '--viewport-4')) {\n      .item {\n        width: 100%;\n      }\n    }\n    @media only screen and (min-width: map-get($breakpoints, '--viewport-7')) {\n      .item {\n        width: 100%;\n      }\n    }\n    @media only screen and (min-width: map-get($breakpoints, '--viewport-9')) {\n      .item {\n        width: calc(50% - 2 * #{$margin});\n      }\n    }\n    @media only screen and (min-width: map-get($breakpoints, '--viewport-12')) {\n      .item {\n        width: calc(33.33333% - 2 * #{$margin});\n      }\n    }\n\n    .item {\n      display: grid;\n      grid-template-areas:  \"logo name-version name-version\"\n                            \"description description description\"\n                            \"state state action\";\n      grid-template-columns: $logo auto min-content;\n      grid-template-rows: 50px 55px 35px;\n      row-gap: $margin;\n      column-gap: $margin;\n\n      margin: $margin;\n      padding: $margin;\n      position: relative;\n      border: 1px solid var(--border);\n      border-radius: calc( 1.5 * var(--border-radius));\n\n      .logo {\n        grid-area: logo;\n        text-align: center;\n        width: $logo;\n        height: $logo;\n        border-radius: calc(2 * var(--border-radius));\n        overflow: hidden;\n        background-color: white;\n\n        &.legacy {\n          background-color: transparent;\n        }\n\n        img {\n          width: $logo - 4px;\n          height: $logo - 4px;\n          object-fit: contain;\n          position: relative;\n          top: 2px;\n        }\n\n        > i {\n          background-color: var(--box-bg);\n          border-radius: 50%;\n          font-size: 32px;\n          line-height: 50px;\n          width: 50px;\n        }\n      }\n\n      .name-version {\n        grid-area: name-version;\n        padding: 10px 0 0 0;\n      }\n\n      .name {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        margin: 0;\n      }\n\n      .os-label {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        padding: 3px;\n        font-size: 12px;\n        line-height: 12px;\n        background-color: var(--primary);\n        color: var(--primary-text);\n      }\n\n      .version {\n        color: var(--muted);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        font-size: 0.9em;\n        margin-top: 4px;\n      }\n\n      .description {\n        grid-area: description;\n      }\n\n      .description-content {\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 3;\n        line-clamp: 3;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        color: var(--text-muted);\n      }\n\n      .state {\n        grid-area: state;\n      }\n\n      .action {\n        grid-area: action;\n        white-space: nowrap;\n\n        button {\n          height: 30px;\n        }\n      }\n    }\n  }\n</style>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div v-else-if=\"options.length\">\n    <h1 v-clean-html=\"t('catalog.tools.header')\" />\n    <TypeDescription\n      v-if=\"!legacyEnabled\"\n      resource=\"chart\"\n    />\n\n    <div class=\"grid\">\n      <div\n        v-for=\"opt in options\"\n        :key=\"opt.chart.id\"\n        class=\"item\"\n      >\n        <div\n          class=\"logo\"\n          :class=\"{'legacy': opt.chart.legacy}\"\n        >\n          <i\n            v-if=\"opt.chart.iconName\"\n            class=\"icon\"\n            :class=\"opt.chart.iconName\"\n          />\n          <LazyImage\n            v-else\n            :src=\"opt.chart.icon\"\n          />\n        </div>\n        <div class=\"name-version\">\n          <div>\n            <h3 class=\"name\">\n              {{ opt.chart.chartNameDisplay }}\n            </h3>\n            <label\n              v-if=\"opt.chart.deploysOnWindows\"\n              class=\"os-label\"\n            >{{ t('catalog.charts.deploysOnWindows') }}</label>\n          </div>\n          <div class=\"version\">\n            <template v-if=\"opt.app && opt.app.upgradeAvailable\">\n              v{{ opt.app.currentVersion }} <b><i class=\"icon icon-chevron-right\" /> v{{ opt.app.upgradeAvailable }}</b>\n            </template>\n            <template v-else-if=\"opt.app\">\n              v{{ opt.app.currentVersion }}\n            </template>\n            <template v-else-if=\"opt.chart.versions.length\">\n              v{{ opt.chart.versions[0].version }}\n            </template>\n          </div>\n        </div>\n        <div class=\"description\">\n          <div\n            v-clean-html=\"opt.chart.chartDescription\"\n            class=\"description-content\"\n          />\n        </div>\n        <div\n          v-if=\"opt.app && !opt.chart.legacy\"\n          class=\"state\"\n        >\n          <AppSummaryGraph\n            :row=\"opt.app\"\n            label-key=\"generic.resourceCount\"\n            :link-to=\"opt.app.detailLocation\"\n          />\n        </div>\n        <div class=\"action\">\n          <template v-if=\"opt.blocked\">\n            <button\n              v-clean-html=\"t('catalog.tools.action.install')\"\n              disabled=\"true\"\n              class=\"btn btn-sm role-primary\"\n            />\n          </template>\n          <template v-else-if=\"opt.app && opt.chart.legacy\">\n            <button\n              v-clean-html=\"t('catalog.tools.action.manage')\"\n              class=\"btn btn-sm role-secondary\"\n              @click=\"openV1Tool(opt.chart.legacyPage)\"\n            />\n          </template>\n          <template v-else-if=\"opt.app && opt.upgradeAvailable && !opt.chart.legacy\">\n            <button\n              class=\"btn btn-sm role-secondary\"\n              @click=\"remove(opt.app, $event)\"\n            >\n              <i class=\"icon icon-delete icon-lg\" />\n            </button>\n            <button\n              v-clean-html=\"t('catalog.tools.action.upgrade')\"\n              class=\"btn btn-sm role-secondary\"\n              @click=\"edit(opt.app, opt.app.upgradeAvailable)\"\n            />\n          </template>\n          <template v-else-if=\"opt.app\">\n            <button\n              class=\"btn btn-sm role-secondary\"\n              @click=\"remove(opt.app, $event)\"\n            >\n              <i class=\"icon icon-delete icon-lg\" />\n            </button>\n            <button\n              v-clean-html=\"t('catalog.tools.action.edit')\"\n              class=\"btn btn-sm role-secondary\"\n              @click=\"edit(opt.app)\"\n            />\n          </template>\n          <template v-else-if=\"opt.chart.legacy\">\n            <button\n              v-clean-html=\"t('catalog.tools.action.install')\"\n              class=\"btn btn-sm role-primary\"\n              @click=\"openV1Tool(opt.chart.legacyPage)\"\n            />\n          </template>\n          <template v-else>\n            <button\n              v-clean-html=\"t('catalog.tools.action.install')\"\n              class=\"btn btn-sm role-primary\"\n              @click=\"install(opt.chart)\"\n            />\n          </template>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div v-else>\n    <IconMessage\n      icon=\"icon-warning\"\n      message-key=\"catalog.tools.noTools\"\n    />\n  </div>\n</template>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/dialog/RotateCertificatesDialog.vue?vue&type=style&index=0&id=3d9549f0&lang=scss&scoped=true","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/dialog/RotateCertificatesDialog.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1716430467357},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1716430467929},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/postcss-loader/src/index.js","mtime":1716430467882},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/sass-loader/dist/cjs.js","mtime":1716430453705},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgLnByb21wdC1yb3RhdGUgewogICAgbWFyZ2luOiAwOwogIH0KICAuYnV0dG9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKICAgIHdpZHRoOiAxMDAlOwogIH0KICAub3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKCiAgICAuc2VydmljZS1zZWxlY3QgewogICAgICBtYXJnaW4tbGVmdDogMjBweDsKICAgICAgbWFyZ2luLXRvcDogMTBweDsKICAgICAgd2lkdGg6IGZpdC1jb250ZW50OwogICAgICBtaW4td2lkdGg6IDI2MHB4OwogICAgfQogIH0KCi5yb3RhdGUtbW9kYWwgOjp2LWRlZXAudi0tbW9kYWwtYm94ewogIGJvcmRlcjpub25lOwoKICAmIC5jYXJkLWNvbnRhaW5lcnsKICAgIG1hcmdpbjogMDsKCiAgICAmIC5jYXJkLXdyYXAgewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIH0KCiAgICAmIC5jYXJkLWJvZHkgewogICAgICBmbGV4OiAxOwogICAgfQoKICAgICYgLmNhcmQtYWN0aW9uc3sKICAgICAgYWxpZ24tc2VsZjogY2VudGVyCiAgICB9OwogIH0KfQo="},{"version":3,"sources":["RotateCertificatesDialog.vue"],"names":[],"mappings":";AAwLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"RotateCertificatesDialog.vue","sourceRoot":"node_modules/@rancher/shell/dialog","sourcesContent":["<script>\nimport { Card } from '@components/Card';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Banner } from '@components/Banner';\n\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\n\nimport { get, set } from '@shell/utils/object';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nexport default {\n  components: {\n    Select,\n    RadioGroup,\n    Card,\n    AsyncButton,\n    Banner\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  data() {\n    return {\n      selectedService:   '',\n      rotateAllServices: true,\n      errors:            []\n    };\n  },\n\n  computed: {\n    serviceOptions() {\n      if (this.cluster.isRke2) {\n        const options = [\n          'admin',\n          'api-server',\n          'controller-manager',\n          'scheduler',\n          'cloud-controller',\n          'etcd',\n          'auth-proxy',\n          'kubelet',\n          'kube-proxy'\n        ];\n\n        if ( this.cluster.isK3s ) {\n          options.push('k3s-controller', 'k3s-server');\n        } else {\n          options.push('rke2-controller', 'rke2-server');\n        }\n\n        return options.sort();\n      }\n      // For RKE1 clusters, Norman provides the list of service options:\n      // type RotateCertificateInput struct {\n      //   CACertificates bool     `json:\"caCertificates,omitempty\"`\n      //   Services       []string `json:\"services,omitempty\" norman:\"type=enum,options=etcd|kubelet|kube-apiserver|kube-proxy|kube-scheduler|kube-controller-manager\"`\n      // }\n      const schema = this.$store.getters['rancher/schemaFor']('rotatecertificateinput');\n\n      return get(schema, 'resourceFields.services.options') || [];\n    },\n\n    actionParams() {\n      if (this.rotateAllServices) {\n        return {\n          // To rotate all services, RKE1 clusters need services\n          // to be null, while RKE2 requires an empty array.\n          services:       this.cluster.isRke2 ? [] : null,\n          caCertificates: false,\n        };\n      } else {\n        return {\n          services:       this.selectedService,\n          caCertificates: false,\n        };\n      }\n    }\n  },\n\n  mounted() {\n    this.selectedService = this.serviceOptions[0] || '';\n  },\n\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n\n    async rotate(buttonDone) {\n      const params = this.actionParams;\n\n      try {\n        if (this.cluster.isRke2) {\n        // The Steve API doesn't support actions, so for RKE2 cluster cert rotation, we patch the cluster.\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateCertificates?.generation || 0;\n\n          set(this.cluster, 'spec.rkeConfig.rotateCertificates', {\n            generation: currentGeneration + 1,\n            services:   (this.selectedService && !this.rotateAllServices) ? [this.selectedService] : []\n          });\n\n          await this.cluster.save();\n        } else {\n          await this.cluster.mgmt.doAction('rotateCertificates', params);\n        }\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n    :style=\"{'height':'100%'}\"\n  >\n    <template #title>\n      <h3>{{ t('cluster.rotateCertificates.modalTitle') }}</h3>\n    </template>\n    <template #body>\n      <Banner\n        v-for=\"(error, i) in errors\"\n        :key=\"i\"\n        class=\"\"\n        color=\"error\"\n        :label=\"error\"\n      />\n      <div class=\"options\">\n        <RadioGroup\n          v-model=\"rotateAllServices\"\n          name=\"service-mode\"\n          :options=\"[\n            {\n              value: true,\n              label:t('cluster.rotateCertificates.allServices')\n            },\n            {\n              value: false,\n              label:t('cluster.rotateCertificates.selectService')\n            }\n          ]\"\n        />\n        <Select\n          v-model=\"selectedService\"\n          :options=\"serviceOptions\"\n          class=\"service-select\"\n          :class=\"{'invisible': rotateAllServices}\"\n        />\n      </div>\n    </template>\n    <div\n      slot=\"actions\"\n      class=\"buttons\"\n    >\n      <button\n        class=\"btn role-secondary mr-20\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n      <AsyncButton\n        mode=\"rotate\"\n        :disabled=\"!rotateAllServices && !selectedService\"\n        @click=\"rotate\"\n      />\n    </div>\n  </Card>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n  .options {\n    display: flex;\n    flex-direction: column;\n\n    .service-select {\n      margin-left: 20px;\n      margin-top: 10px;\n      width: fit-content;\n      min-width: 260px;\n    }\n  }\n\n.rotate-modal ::v-deep.v--modal-box{\n  border:none;\n\n  & .card-container{\n    margin: 0;\n\n    & .card-wrap {\n      display:flex;\n      flex-direction:column;\n    }\n\n    & .card-body {\n      flex: 1;\n    }\n\n    & .card-actions{\n      align-self: center\n    };\n  }\n}\n</style>\n"]}]}
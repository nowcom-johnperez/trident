{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/cis.cattle.io.clusterscanprofile.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/cis.cattle.io.clusterscanprofile.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBOYW1lTnNEZXNjcmlwdGlvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL05hbWVOc0Rlc2NyaXB0aW9uJzsKaW1wb3J0IExhYmVsZWRTZWxlY3QgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9MYWJlbGVkU2VsZWN0JzsKaW1wb3J0IEFycmF5TGlzdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0FycmF5TGlzdCc7CmltcG9ydCBjcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgQ3J1UmVzb3VyY2UgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ3J1UmVzb3VyY2UnOwppbXBvcnQgeyBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IENJUyB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwpjb25zdCBzZW12ZXIgPSByZXF1aXJlKCdzZW12ZXInKTsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBOYW1lTnNEZXNjcmlwdGlvbiwKICAgIExhYmVsZWRTZWxlY3QsCiAgICBBcnJheUxpc3QsCiAgICBDcnVSZXNvdXJjZQogIH0sCgogIG1peGluczogW2NyZWF0ZUVkaXRWaWV3XSwKCiAgcHJvcHM6IHsKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6ICAgIE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4gewogICAgICAgIHJldHVybiB7fTsKICAgICAgfQogICAgfSwKCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NyZWF0ZScKICAgIH0KICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIHRoaXMuYWxsQmVuY2htYXJrcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmRBbGwnLCB7IHR5cGU6IENJUy5CRU5DSE1BUksgfSk7CiAgfSwKCiAgZGF0YSgpIHsKICAgIGlmICghdGhpcy52YWx1ZS5zcGVjKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLCAnc3BlYycsIHt9KTsKICAgIH0KCiAgICByZXR1cm4geyBhbGxCZW5jaG1hcmtzOiBbXSwgbmFtZTogdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoeyBjdXJyZW50Q2x1c3RlcjogJ2N1cnJlbnRDbHVzdGVyJywgdDogJ2kxOG4vdCcgfSksCgogICAgcHJvdmlkZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDbHVzdGVyLnN0YXR1cy5wcm92aWRlcjsKICAgIH0sCgogICAgY29tcGF0aWJsZUJlbmNobWFya05hbWVzKCkgewogICAgICByZXR1cm4gdGhpcy5hbGxCZW5jaG1hcmtzLmZpbHRlcigoYmVuY2htYXJrKSA9PiB7CiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVCZW5jaG1hcmsoYmVuY2htYXJrKTsKICAgICAgfSkucmVkdWNlKChuYW1lcywgYmVuY2htYXJrKSA9PiB7CiAgICAgICAgbmFtZXMucHVzaChiZW5jaG1hcmsuaWQpOwoKICAgICAgICByZXR1cm4gbmFtZXM7CiAgICAgIH0sIFtdKTsKICAgIH0sCgogIH0sCgogIHdhdGNoOiB7CiAgICBjb21wYXRpYmxlQmVuY2htYXJrTmFtZXMobmV1KSB7CiAgICAgIGlmIChuZXUubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy52YWx1ZS5zcGVjLmJlbmNobWFya1ZlcnNpb24gPSBuZXVbMF07CiAgICAgIH0KICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyBmaWx0ZXIgYmVuY2htYXJrcyBieSBzcGVjLmNsdXN0ZXJQcm92aWRlciBhbmQga3ViZXJuZXRlcyBtaW4vbWF4IHZlcnNpb24KICAgIC8vIGluY2x1ZGUgYmVuY2htYXJrcyB3aXRoIG5vIGNsdXN0ZXJQcm92aWRlciBkZWZpbmVkCiAgICB2YWxpZGF0ZUJlbmNobWFyayhiZW5jaG1hcmspIHsKICAgICAgaWYgKCEhYmVuY2htYXJrPy5zcGVjPy5jbHVzdGVyUHJvdmlkZXIpIHsKICAgICAgICByZXR1cm4gYmVuY2htYXJrPy5zcGVjPy5jbHVzdGVyUHJvdmlkZXIgPT09IHRoaXMucHJvdmlkZXI7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgY2x1c3RlclZlcnNpb24gPSB0aGlzLmN1cnJlbnRDbHVzdGVyLmt1YmVybmV0ZXNWZXJzaW9uRGlzcGxheTsKCiAgICAgICAgaWYgKGJlbmNobWFyaz8uc3BlYz8ubWluS3ViZXJuZXRlc1ZlcnNpb24pIHsKICAgICAgICAgIGlmIChzZW12ZXIuZ3QoYmVuY2htYXJrPy5zcGVjPy5taW5LdWJlcm5ldGVzVmVyc2lvbiwgY2x1c3RlclZlcnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGJlbmNobWFyaz8uc3BlYz8ubWF4S3ViZXJuZXRlc1ZlcnNpb24pIHsKICAgICAgICAgIGlmIChzZW12ZXIuZ3QoY2x1c3RlclZlcnNpb24sIGJlbmNobWFyaz8uc3BlYz8ubWF4S3ViZXJuZXRlc1ZlcnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gSWYgYSB2ZXJzaW9uIGRvZXNuJ3QgcGFyc2UsIHNob3cgaXQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["cis.cattle.io.clusterscanprofile.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"cis.cattle.io.clusterscanprofile.vue","sourceRoot":"node_modules/@rancher/shell/edit","sourcesContent":["<script>\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport createEditView from '@shell/mixins/create-edit-view';\nimport CruResource from '@shell/components/CruResource';\nimport { mapGetters } from 'vuex';\nimport { CIS } from '@shell/config/types';\nconst semver = require('semver');\n\nexport default {\n  components: {\n    NameNsDescription,\n    LabeledSelect,\n    ArrayList,\n    CruResource\n  },\n\n  mixins: [createEditView],\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    },\n\n    mode: {\n      type:    String,\n      default: 'create'\n    }\n  },\n\n  async fetch() {\n    this.allBenchmarks = await this.$store.dispatch('cluster/findAll', { type: CIS.BENCHMARK });\n  },\n\n  data() {\n    if (!this.value.spec) {\n      this.$set(this.value, 'spec', {});\n    }\n\n    return { allBenchmarks: [], name: this.value.metadata.name };\n  },\n\n  computed: {\n    ...mapGetters({ currentCluster: 'currentCluster', t: 'i18n/t' }),\n\n    provider() {\n      return this.currentCluster.status.provider;\n    },\n\n    compatibleBenchmarkNames() {\n      return this.allBenchmarks.filter((benchmark) => {\n        return this.validateBenchmark(benchmark);\n      }).reduce((names, benchmark) => {\n        names.push(benchmark.id);\n\n        return names;\n      }, []);\n    },\n\n  },\n\n  watch: {\n    compatibleBenchmarkNames(neu) {\n      if (neu.length === 1) {\n        this.value.spec.benchmarkVersion = neu[0];\n      }\n    },\n  },\n  methods: {\n    // filter benchmarks by spec.clusterProvider and kubernetes min/max version\n    // include benchmarks with no clusterProvider defined\n    validateBenchmark(benchmark) {\n      if (!!benchmark?.spec?.clusterProvider) {\n        return benchmark?.spec?.clusterProvider === this.provider;\n      }\n\n      try {\n        const clusterVersion = this.currentCluster.kubernetesVersionDisplay;\n\n        if (benchmark?.spec?.minKubernetesVersion) {\n          if (semver.gt(benchmark?.spec?.minKubernetesVersion, clusterVersion)) {\n            return false;\n          }\n        }\n        if (benchmark?.spec?.maxKubernetesVersion) {\n          if (semver.gt(clusterVersion, benchmark?.spec?.maxKubernetesVersion)) {\n            return false;\n          }\n        }\n\n        return true;\n      } catch (e) {\n        // If a version doesn't parse, show it\n        return true;\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <div>\n    <CruResource\n      :validation-passed=\"!!name && !!value.spec.benchmarkVersion\"\n      :done-route=\"doneRoute\"\n      :resource=\"value\"\n      :mode=\"mode\"\n      :errors=\"errors\"\n      @finish=\"save\"\n      @error=\"e=>errors = e\"\n    >\n      <template>\n        <div class=\"spacer\" />\n        <div class=\"row\">\n          <div class=\"col span-12\">\n            <NameNsDescription\n              :mode=\"mode\"\n              :value=\"value\"\n              :namespaced=\"false\"\n              @change=\"name=value.metadata.name\"\n            />\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col span-6\">\n            <LabeledSelect\n              v-model=\"value.spec.benchmarkVersion\"\n              :mode=\"mode\"\n              :label=\"t('cis.benchmarkVersion')\"\n              :options=\"compatibleBenchmarkNames\"\n            />\n          </div>\n        </div>\n        <div class=\"spacer\" />\n        <div class=\"row\">\n          <div class=\"col span-6\">\n            <ArrayList\n              v-model=\"value.spec.skipTests\"\n              :title=\"t('cis.testsToSkip')\"\n              :value-placeholder=\"t('cis.testID')\"\n              :mode=\"mode\"\n            />\n          </div>\n        </div>\n      </template>\n    </CruResource>\n  </div>\n</template>\n"]}]}
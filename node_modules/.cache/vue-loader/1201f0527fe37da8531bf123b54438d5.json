{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/form/NodeScheduling.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/form/NodeScheduling.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgUmFkaW9Hcm91cCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vUmFkaW8nOwppbXBvcnQgTGFiZWxlZFNlbGVjdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0xhYmVsZWRTZWxlY3QnOwppbXBvcnQgTm9kZUFmZmluaXR5IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTm9kZUFmZmluaXR5JzsKaW1wb3J0IHsgSEFSVkVTVEVSX05BTUUgYXMgVklSVFVBTCB9IGZyb20gJ0BzaGVsbC9jb25maWcvZmVhdHVyZXMnOwppbXBvcnQgeyBfVklFVyB9IGZyb20gJ0BzaGVsbC9jb25maWcvcXVlcnktcGFyYW1zJzsKaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgeyBIT1NUTkFNRSB9IGZyb20gJ0BzaGVsbC9jb25maWcvbGFiZWxzLWFubm90YXRpb25zJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBSYWRpb0dyb3VwLAogICAgTGFiZWxlZFNlbGVjdCwKICAgIE5vZGVBZmZpbml0eSwKICB9LAoKICBwcm9wczogewogICAgdmFsdWU6IHsKICAgICAgdHlwZTogICAgT2JqZWN0LAogICAgICBkZWZhdWx0OiAoKSA9PiB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CiAgICB9LAoKICAgIG5vZGVzOiB7CiAgICAgIHR5cGU6ICAgIEFycmF5LAogICAgICBkZWZhdWx0OiAoKSA9PiBbXQogICAgfSwKCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NyZWF0ZScKICAgIH0sCiAgICBsb2FkaW5nOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiAgICBCb29sZWFuCiAgICB9LAogIH0sCgogIGRhdGEoKSB7CiAgICBjb25zdCBpc0hhcnZlc3RlciA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2N1cnJlbnRQcm9kdWN0J10uaW5TdG9yZSA9PT0gVklSVFVBTDsKCiAgICBsZXQgeyBub2RlTmFtZSA9ICcnIH0gPSB0aGlzLnZhbHVlOwogICAgY29uc3QgeyBhZmZpbml0eSA9IHt9LCBub2RlU2VsZWN0b3IgPSB7fSB9ID0gdGhpcy52YWx1ZTsKCiAgICBjb25zdCB7IG5vZGVBZmZpbml0eSA9IHt9IH0gPSBhZmZpbml0eTsKCiAgICBsZXQgc2VsZWN0Tm9kZSA9IG51bGw7CgogICAgaWYgKHRoaXMudmFsdWUubm9kZU5hbWUpIHsKICAgICAgc2VsZWN0Tm9kZSA9ICdub2RlU2VsZWN0b3InOwogICAgfSBlbHNlIGlmIChpc0hhcnZlc3RlciAmJiB0aGlzLnZhbHVlPy5ub2RlU2VsZWN0b3I/LltIT1NUTkFNRV0pIHsKICAgICAgc2VsZWN0Tm9kZSA9ICdub2RlU2VsZWN0b3InOwogICAgICBub2RlTmFtZSA9IG5vZGVTZWxlY3RvcltIT1NUTkFNRV07CiAgICB9IGVsc2UgaWYgKCFpc0VtcHR5KG5vZGVBZmZpbml0eSkpIHsKICAgICAgc2VsZWN0Tm9kZSA9ICdhZmZpbml0eSc7CiAgICB9CgogICAgaWYgKCFub2RlQWZmaW5pdHkucmVxdWlyZWREdXJpbmdTY2hlZHVsaW5nSWdub3JlZER1cmluZ0V4ZWN1dGlvbikgewogICAgICB0aGlzLiRzZXQobm9kZUFmZmluaXR5LCAncmVxdWlyZWREdXJpbmdTY2hlZHVsaW5nSWdub3JlZER1cmluZ0V4ZWN1dGlvbicsIHsgbm9kZVNlbGVjdG9yVGVybXM6IFtdIH0gKTsKICAgIH0KICAgIGlmICghbm9kZUFmZmluaXR5LnByZWZlcnJlZER1cmluZ1NjaGVkdWxpbmdJZ25vcmVkRHVyaW5nRXhlY3V0aW9uKSB7CiAgICAgIHRoaXMuJHNldChub2RlQWZmaW5pdHksICdwcmVmZXJyZWREdXJpbmdTY2hlZHVsaW5nSWdub3JlZER1cmluZ0V4ZWN1dGlvbicsIFtdKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBzZWxlY3ROb2RlLCBub2RlTmFtZSwgbm9kZUFmZmluaXR5LCBub2RlU2VsZWN0b3IKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoeyB0OiAnaTE4bi90JyB9KSwKICAgIGlzVmlldygpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gX1ZJRVc7CiAgICB9LAoKICAgIGlzSGFydmVzdGVyKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY3VycmVudFByb2R1Y3QnXS5pblN0b3JlID09PSBWSVJUVUFMOwogICAgfSwKCiAgICBzZWxlY3ROb2RlT3B0aW9ucygpIHsKICAgICAgY29uc3QgcHJlZml4ID0gdGhpcy5pc0hhcnZlc3RlciA/ICdoYXJ2ZXN0ZXIudmlydHVhbE1hY2hpbmUnIDogJ3dvcmtsb2FkJzsKICAgICAgY29uc3Qgb3V0ID0gW3sKICAgICAgICBsYWJlbDogdGhpcy50KGAkeyBwcmVmaXggfS5zY2hlZHVsaW5nLmFmZmluaXR5LmFueU5vZGVgKSwKICAgICAgICB2YWx1ZTogbnVsbAogICAgICB9LAogICAgICB7CiAgICAgICAgbGFiZWw6IHRoaXMudChgJHsgcHJlZml4IH0uc2NoZWR1bGluZy5hZmZpbml0eS5zcGVjaWZpY05vZGVgKSwKICAgICAgICB2YWx1ZTogJ25vZGVTZWxlY3RvcicKICAgICAgfSwKICAgICAgewogICAgICAgIGxhYmVsOiB0aGlzLnQoYCR7IHByZWZpeCB9LnNjaGVkdWxpbmcuYWZmaW5pdHkuc2NoZWR1bGluZ1J1bGVzYCksCiAgICAgICAgdmFsdWU6ICdhZmZpbml0eScKICAgICAgfV07CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgfSwKICBtZXRob2RzOiB7CiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IHsgbm9kZU5hbWUsIG5vZGVTZWxlY3Rvciwgbm9kZUFmZmluaXR5IH0gPSB0aGlzOwoKICAgICAgc3dpdGNoICh0aGlzLnNlbGVjdE5vZGUpIHsKICAgICAgY2FzZSAnbm9kZVNlbGVjdG9yJzoKICAgICAgICBpZiAodGhpcy5pc0hhcnZlc3RlcikgewogICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnZhbHVlLCB7IG5vZGVTZWxlY3RvcjogeyBbSE9TVE5BTUVdOiBub2RlTmFtZSB9IH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMudmFsdWUsIHsgbm9kZVNlbGVjdG9yLCBub2RlTmFtZSB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudmFsdWU/LmFmZmluaXR5Py5ub2RlQWZmaW5pdHkpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLmFmZmluaXR5Lm5vZGVBZmZpbml0eTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FmZmluaXR5JzoKICAgICAgICBkZWxldGUgdGhpcy52YWx1ZS5ub2RlTmFtZTsKICAgICAgICBkZWxldGUgdGhpcy52YWx1ZS5ub2RlU2VsZWN0b3I7CiAgICAgICAgaWYgKCF0aGlzLnZhbHVlLmFmZmluaXR5KSB7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMudmFsdWUsIHsgYWZmaW5pdHk6IHsgbm9kZUFmZmluaXR5IH0gfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy52YWx1ZS5hZmZpbml0eSwgeyBub2RlQWZmaW5pdHkgfSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLm5vZGVOYW1lOwogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLm5vZGVTZWxlY3RvcjsKICAgICAgICBpZiAodGhpcy52YWx1ZT8uYWZmaW5pdHk/Lm5vZGVBZmZpbml0eSkgewogICAgICAgICAgZGVsZXRlIHRoaXMudmFsdWUuYWZmaW5pdHkubm9kZUFmZmluaXR5OwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGlzRW1wdHkKICB9LAoKICB3YXRjaDogewogICAgJ3ZhbHVlLm5vZGVTZWxlY3Rvcic6IHsKICAgICAgaGFuZGxlcihub2RlU2VsZWN0b3IpIHsKICAgICAgICBpZiAodGhpcy5pc0hhcnZlc3RlciAmJiBub2RlU2VsZWN0b3I/LltIT1NUTkFNRV0pIHsKICAgICAgICAgIHRoaXMuc2VsZWN0Tm9kZSA9ICdub2RlU2VsZWN0b3InOwogICAgICAgICAgY29uc3Qgbm9kZU5hbWUgPSBub2RlU2VsZWN0b3JbSE9TVE5BTUVdOwoKICAgICAgICAgIHRoaXMubm9kZU5hbWUgPSBub2RlTmFtZTsKCiAgICAgICAgICBjb25zdCBhcnJheSA9IHRoaXMubm9kZXMubWFwKChuKSA9PiBuLnZhbHVlKTsKCiAgICAgICAgICBpZiAobm9kZU5hbWUgJiYgIWFycmF5LmluY2x1ZGVzKG5vZGVOYW1lKSkgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnZ3Jvd2wvZXJyb3InLCB7CiAgICAgICAgICAgICAgdGl0bGU6ICAgdGhpcy4kc3RvcmUuZ2V0dGVyc1snaTE4bi90J10oJ2hhcnZlc3Rlci52bVRlbXBsYXRlLnRpcHMubm90RXhpc3ROb2RlLnRpdGxlJywgeyBuYW1lOiBub2RlTmFtZSB9KSwKICAgICAgICAgICAgICBtZXNzYWdlOiB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3QnXSgnaGFydmVzdGVyLnZtVGVtcGxhdGUudGlwcy5ub3RFeGlzdE5vZGUubWVzc2FnZScpCiAgICAgICAgICAgIH0sIHsgcm9vdDogdHJ1ZSB9KTsKCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLm5vZGVTZWxlY3RvcjsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdub2RlTmFtZScsICcnKTsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdzZWxlY3ROb2RlJywgbnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["NodeScheduling.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"NodeScheduling.vue","sourceRoot":"node_modules/@rancher/shell/components/form","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport { RadioGroup } from '@components/Form/Radio';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport NodeAffinity from '@shell/components/form/NodeAffinity';\nimport { HARVESTER_NAME as VIRTUAL } from '@shell/config/features';\nimport { _VIEW } from '@shell/config/query-params';\nimport { isEmpty } from '@shell/utils/object';\nimport { HOSTNAME } from '@shell/config/labels-annotations';\n\nexport default {\n  components: {\n    RadioGroup,\n    LabeledSelect,\n    NodeAffinity,\n  },\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    },\n\n    nodes: {\n      type:    Array,\n      default: () => []\n    },\n\n    mode: {\n      type:    String,\n      default: 'create'\n    },\n    loading: {\n      default: false,\n      type:    Boolean\n    },\n  },\n\n  data() {\n    const isHarvester = this.$store.getters['currentProduct'].inStore === VIRTUAL;\n\n    let { nodeName = '' } = this.value;\n    const { affinity = {}, nodeSelector = {} } = this.value;\n\n    const { nodeAffinity = {} } = affinity;\n\n    let selectNode = null;\n\n    if (this.value.nodeName) {\n      selectNode = 'nodeSelector';\n    } else if (isHarvester && this.value?.nodeSelector?.[HOSTNAME]) {\n      selectNode = 'nodeSelector';\n      nodeName = nodeSelector[HOSTNAME];\n    } else if (!isEmpty(nodeAffinity)) {\n      selectNode = 'affinity';\n    }\n\n    if (!nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution) {\n      this.$set(nodeAffinity, 'requiredDuringSchedulingIgnoredDuringExecution', { nodeSelectorTerms: [] } );\n    }\n    if (!nodeAffinity.preferredDuringSchedulingIgnoredDuringExecution) {\n      this.$set(nodeAffinity, 'preferredDuringSchedulingIgnoredDuringExecution', []);\n    }\n\n    return {\n      selectNode, nodeName, nodeAffinity, nodeSelector\n    };\n  },\n\n  computed: {\n    ...mapGetters({ t: 'i18n/t' }),\n    isView() {\n      return this.mode === _VIEW;\n    },\n\n    isHarvester() {\n      return this.$store.getters['currentProduct'].inStore === VIRTUAL;\n    },\n\n    selectNodeOptions() {\n      const prefix = this.isHarvester ? 'harvester.virtualMachine' : 'workload';\n      const out = [{\n        label: this.t(`${ prefix }.scheduling.affinity.anyNode`),\n        value: null\n      },\n      {\n        label: this.t(`${ prefix }.scheduling.affinity.specificNode`),\n        value: 'nodeSelector'\n      },\n      {\n        label: this.t(`${ prefix }.scheduling.affinity.schedulingRules`),\n        value: 'affinity'\n      }];\n\n      return out;\n    },\n\n  },\n  methods: {\n    update() {\n      const { nodeName, nodeSelector, nodeAffinity } = this;\n\n      switch (this.selectNode) {\n      case 'nodeSelector':\n        if (this.isHarvester) {\n          Object.assign(this.value, { nodeSelector: { [HOSTNAME]: nodeName } });\n        } else {\n          Object.assign(this.value, { nodeSelector, nodeName });\n        }\n        if (this.value?.affinity?.nodeAffinity) {\n          delete this.value.affinity.nodeAffinity;\n        }\n        break;\n      case 'affinity':\n        delete this.value.nodeName;\n        delete this.value.nodeSelector;\n        if (!this.value.affinity) {\n          Object.assign(this.value, { affinity: { nodeAffinity } });\n        } else {\n          Object.assign(this.value.affinity, { nodeAffinity });\n        }\n        break;\n      default:\n        delete this.value.nodeName;\n        delete this.value.nodeSelector;\n        if (this.value?.affinity?.nodeAffinity) {\n          delete this.value.affinity.nodeAffinity;\n        }\n      }\n    },\n    isEmpty\n  },\n\n  watch: {\n    'value.nodeSelector': {\n      handler(nodeSelector) {\n        if (this.isHarvester && nodeSelector?.[HOSTNAME]) {\n          this.selectNode = 'nodeSelector';\n          const nodeName = nodeSelector[HOSTNAME];\n\n          this.nodeName = nodeName;\n\n          const array = this.nodes.map((n) => n.value);\n\n          if (nodeName && !array.includes(nodeName)) {\n            this.$store.dispatch('growl/error', {\n              title:   this.$store.getters['i18n/t']('harvester.vmTemplate.tips.notExistNode.title', { name: nodeName }),\n              message: this.$store.getters['i18n/t']('harvester.vmTemplate.tips.notExistNode.message')\n            }, { root: true });\n\n            delete this.value.nodeSelector;\n            this.$set(this, 'nodeName', '');\n            this.$set(this, 'selectNode', null);\n          }\n        }\n      },\n    },\n  },\n};\n</script>\n\n<template>\n  <div>\n    <div class=\"row mb-20\">\n      <RadioGroup\n        v-model=\"selectNode\"\n        name=\"selectNode\"\n        :options=\"selectNodeOptions\"\n        :mode=\"mode\"\n        @input=\"update\"\n      />\n    </div>\n    <template v-if=\"selectNode === 'nodeSelector'\">\n      <div class=\"row\">\n        <div class=\"col span-6\">\n          <LabeledSelect\n            v-model=\"nodeName\"\n            :label=\"t('workload.scheduling.affinity.nodeName')\"\n            :options=\"nodes || []\"\n            :mode=\"mode\"\n            :multiple=\"false\"\n            :loading=\"loading\"\n            @input=\"update\"\n          />\n        </div>\n      </div>\n    </template>\n    <template v-else-if=\"selectNode === 'affinity'\">\n      <NodeAffinity\n        v-model=\"nodeAffinity\"\n        :mode=\"mode\"\n        @input=\"update\"\n      />\n    </template>\n  </div>\n</template>\n"]}]}
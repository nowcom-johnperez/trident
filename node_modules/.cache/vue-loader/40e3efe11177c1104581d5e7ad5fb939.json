{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/constraints.gatekeeper.sh.constraint/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/constraints.gatekeeper.sh.constraint/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IG1lcmdlIGZyb20gJ2xvZGFzaC9tZXJnZSc7CmltcG9ydCB7IHVjRmlyc3QgfSBmcm9tICdAc2hlbGwvdXRpbHMvc3RyaW5nJzsKaW1wb3J0IHsgaXNTaW1wbGVLZXlWYWx1ZSB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgeyBfQ1JFQVRFLCBfVklFVyB9IGZyb20gJ0BzaGVsbC9jb25maWcvcXVlcnktcGFyYW1zJzsKaW1wb3J0IHsgU0NIRU1BLCBOQU1FU1BBQ0UgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IENyZWF0ZUVkaXRWaWV3IGZyb20gJ0BzaGVsbC9taXhpbnMvY3JlYXRlLWVkaXQtdmlldyc7CmltcG9ydCBOYW1lTnNEZXNjcmlwdGlvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL05hbWVOc0Rlc2NyaXB0aW9uJzsKaW1wb3J0IHsgUmFkaW9Hcm91cCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vUmFkaW8nOwppbXBvcnQgUnVsZVNlbGVjdG9yIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vUnVsZVNlbGVjdG9yJzsKaW1wb3J0IFRhYiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9UYWJiZWQvVGFiJzsKaW1wb3J0IFRhYmJlZCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9UYWJiZWQnOwppbXBvcnQgWWFtbEVkaXRvciwgeyBFRElUT1JfTU9ERVMgfSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9ZYW1sRWRpdG9yJzsKaW1wb3J0IENydVJlc291cmNlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0NydVJlc291cmNlJzsKaW1wb3J0IHsgRU5GT1JDRU1FTlRfQUNUSU9OX1ZBTFVFUyB9IGZyb20gJ0BzaGVsbC9tb2RlbHMvY29uc3RyYWludHMuZ2F0ZWtlZXBlci5zaC5jb25zdHJhaW50JzsKaW1wb3J0IHsgc2FmZXJEdW1wIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2NyZWF0ZS15YW1sJzsKaW1wb3J0IE5hbWVzcGFjZUxpc3QsIHsgTkFNRVNQQUNFX0ZJTFRFUlNfSEVMUEVSIH0gZnJvbSAnLi9OYW1lc3BhY2VMaXN0JzsKaW1wb3J0IE1hdGNoS2luZHMgZnJvbSAnLi9NYXRjaEtpbmRzJzsKaW1wb3J0IFNjb3BlLCB7IFNDT1BFX09QVElPTlMgfSBmcm9tICcuL1Njb3BlJzsKCmZ1bmN0aW9uIGZpbmRDb25zdHJhaW50VHlwZXMoc2NoZW1hcykgewogIHJldHVybiBzY2hlbWFzCiAgICAuZmlsdGVyKChzY2hlbWEpID0+IHNjaGVtYT8uYXR0cmlidXRlcz8uZ3JvdXAgPT09ICdjb25zdHJhaW50cy5nYXRla2VlcGVyLnNoJyk7Cn0KCmZ1bmN0aW9uIGZpbmRDb25zdHJhaW50VHlwZXNJZHMoc2NoZW1hcykgewogIHJldHVybiBmaW5kQ29uc3RyYWludFR5cGVzKHNjaGVtYXMpCiAgICAubWFwKChzY2hlbWEpID0+IHNjaGVtYS5pZCk7Cn0KCmNvbnN0IENPTlNUUkFJTlRfUFJFRklYID0gJ2NvbnN0cmFpbnRzLmdhdGVrZWVwZXIuc2guJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBDcnVSZXNvdXJjZSwKICAgIE1hdGNoS2luZHMsCiAgICBOYW1lTnNEZXNjcmlwdGlvbiwKICAgIE5hbWVzcGFjZUxpc3QsCiAgICBSdWxlU2VsZWN0b3IsCiAgICBSYWRpb0dyb3VwLAogICAgU2NvcGUsCiAgICBUYWIsCiAgICBUYWJiZWQsCiAgICBZYW1sRWRpdG9yCiAgfSwKCiAgbWl4aW5zOiBbQ3JlYXRlRWRpdFZpZXddLAoKICBwcm9wczogewogICAgdmFsdWU6IHsKICAgICAgdHlwZTogICAgIE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgY29uc3QgZW1wdHlTcGVjID0gewogICAgICBlbmZvcmNlbWVudEFjdGlvbjogRU5GT1JDRU1FTlRfQUNUSU9OX1ZBTFVFUy5ERU5ZLAogICAgICBwYXJhbWV0ZXJzOiAgICAgICAge30sCiAgICAgIG1hdGNoOiAgICAgICAgICAgICB7CiAgICAgICAga2luZHM6ICAgICAgICAgICAgICBbe31dLAogICAgICAgIG5hbWVzcGFjZXM6ICAgICAgICAgW10sCiAgICAgICAgZXhjbHVkZWROYW1lc3BhY2VzOiBbXSwKICAgICAgICBsYWJlbFNlbGVjdG9yOiAgICAgIHsgbWF0Y2hFeHByZXNzaW9uczogW10gfSwKICAgICAgICBuYW1lc3BhY2VTZWxlY3RvcjogIHsgbWF0Y2hFeHByZXNzaW9uczogW10gfQogICAgICB9CiAgICB9OwoKICAgIGlmICh0aGlzLm1vZGUgPT09IF9DUkVBVEUpIHsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUsICdzcGVjJywgbWVyZ2UodGhpcy52YWx1ZS5zcGVjLCBlbXB0eVNwZWMpKTsKCiAgICAgIGlmICghdGhpcy52YWx1ZS5zcGVjLm1hdGNoLnNjb3BlKSB7CiAgICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5tYXRjaCwgJ3Njb3BlJywgU0NPUEVfT1BUSU9OU1swXS52YWx1ZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdtYXRjaCcsIHRoaXMudmFsdWUuc3BlYy5tYXRjaCB8fCB7fSk7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMubWF0Y2gsICdraW5kcycsIHRoaXMudmFsdWUuc3BlYy5tYXRjaC5raW5kcyB8fCBbe31dKTsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5tYXRjaCwgJ2xhYmVsU2VsZWN0b3InLCB0aGlzLnZhbHVlLnNwZWMubWF0Y2gubGFiZWxTZWxlY3RvciB8fCB7fSk7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMubWF0Y2gubGFiZWxTZWxlY3RvciwgJ21hdGNoRXhwcmVzc2lvbnMnLCB0aGlzLnZhbHVlLnNwZWMubWF0Y2gubGFiZWxTZWxlY3Rvci5tYXRjaEV4cHJlc3Npb25zIHx8IFtdKTsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5tYXRjaCwgJ25hbWVzcGFjZVNlbGVjdG9yJywgdGhpcy52YWx1ZS5zcGVjLm1hdGNoLm5hbWVzcGFjZVNlbGVjdG9yIHx8IHt9KTsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5tYXRjaC5uYW1lc3BhY2VTZWxlY3RvciwgJ2xhYmVsU2VsZWN0b3InLCB0aGlzLnZhbHVlLnNwZWMubWF0Y2gubmFtZXNwYWNlU2VsZWN0b3IubGFiZWxTZWxlY3RvciB8fCBbXSk7CiAgICB9CgogICAgY29uc3QgcGFyYW1ldGVyc1lhbWwgPSBzYWZlckR1bXAodGhpcy52YWx1ZT8uc3BlYz8ucGFyYW1ldGVycyk7CgogICAgcmV0dXJuIHsKICAgICAgZW1wdHlTcGVjLAogICAgICBwYXJhbWV0ZXJzWWFtbCwKICAgICAgZW5mb3JjZW1lbnRBY3Rpb25PcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgbGFiZWw6IGAkeyBFTkZPUkNFTUVOVF9BQ1RJT05fVkFMVUVTLkRFTlkgfSAtIGRlbnkgYWRtaXNzaW9uIHJlcXVlc3RzIHdpdGggYW55IHZpb2xhdGlvbmAsCiAgICAgICAgICB2YWx1ZTogRU5GT1JDRU1FTlRfQUNUSU9OX1ZBTFVFUy5ERU5ZCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBsYWJlbDogYCR7IEVORk9SQ0VNRU5UX0FDVElPTl9WQUxVRVMuRFJZUlVOIH0gLSBlbmFibGVzIGNvbnN0cmFpbnRzIHRvIGJlIGRlcGxveWVkIGluIHRoZSBjbHVzdGVyIHdpdGhvdXQgbWFraW5nIGFjdHVhbCBjaGFuZ2VzYCwKICAgICAgICAgIHZhbHVlOiBFTkZPUkNFTUVOVF9BQ1RJT05fVkFMVUVTLkRSWVJVTgogICAgICAgIH0KICAgICAgXSwKICAgICAgZW5mb3JjZW1lbnRBY3Rpb25MYWJlbHM6IE9iamVjdC52YWx1ZXMoRU5GT1JDRU1FTlRfQUNUSU9OX1ZBTFVFUykubWFwKHVjRmlyc3QpLAogICAgICBOQU1FU1BBQ0VfRklMVEVSU19IRUxQRVIsCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICB0ZW1wbGF0ZU9wdGlvbnMoKSB7CiAgICAgIGNvbnN0IHNjaGVtYXMgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjbHVzdGVyL2FsbCddKFNDSEVNQSk7CiAgICAgIGNvbnN0IGNvbnN0cmFpbnRUeXBlcyA9IGZpbmRDb25zdHJhaW50VHlwZXNJZHMoc2NoZW1hcyk7CgogICAgICBjb25zdHJhaW50VHlwZXMuc29ydCgpOwoKICAgICAgcmV0dXJuIGNvbnN0cmFpbnRUeXBlcy5tYXAoKHR5cGUpID0+IHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGFiZWw6IHR5cGUucmVwbGFjZShDT05TVFJBSU5UX1BSRUZJWCwgJycpLAogICAgICAgICAgdmFsdWU6IHR5cGUKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sCiAgICB0ZW1wbGF0ZVN1YnR5cGVzKCkgewogICAgICBjb25zdCBzY2hlbWFzID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY2x1c3Rlci9hbGwnXShTQ0hFTUEpOwogICAgICBjb25zdCBjb25zdHJhaW50VHlwZXMgPSBmaW5kQ29uc3RyYWludFR5cGVzKHNjaGVtYXMpOwoKICAgICAgY29uc3RyYWludFR5cGVzLnNvcnQoKTsKCiAgICAgIHJldHVybiBjb25zdHJhaW50VHlwZXMubWFwKCh0eXBlKSA9PiB7CiAgICAgICAgY29uc3Qgc3BsaXRJZCA9IHR5cGUuaWQuc3BsaXQoJy4nKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxhYmVsOiAgICAgICB0eXBlLmlkLnJlcGxhY2UoQ09OU1RSQUlOVF9QUkVGSVgsICcnKSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICAgIGlkOiAgICAgICAgICBzcGxpdElkW3NwbGl0SWQubGVuZ3RoIC0gMV0sCiAgICAgICAgICBiYW5uZXJBYmJydjogJ0NUJwogICAgICAgIH07CiAgICAgIH0pOwogICAgfSwKICAgIGVkaXRvck1vZGUoKSB7CiAgICAgIGlmICggdGhpcy5tb2RlID09PSBfVklFVyApIHsKICAgICAgICByZXR1cm4gRURJVE9SX01PREVTLlZJRVdfQ09ERTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gRURJVE9SX01PREVTLkVESVRfQ09ERTsKICAgICAgfQogICAgfSwKICAgIGNhblNob3dGb3JtKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZT8uc3BlYz8ucGFyYW1ldGVycyAmJiBpc1NpbXBsZUtleVZhbHVlKHRoaXMudmFsdWUuc3BlYy5wYXJhbWV0ZXJzKSAmJiAhdGhpcy5pc1ZpZXc7CiAgICB9LAogICAgc3lzdGVtTmFtZXNwYWNlSWRzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY2x1c3Rlci9hbGwnXShOQU1FU1BBQ0UpCiAgICAgICAgLmZpbHRlcigobmFtZXNwYWNlKSA9PiBuYW1lc3BhY2UuaXNTeXN0ZW0pCiAgICAgICAgLm1hcCgobmFtZXNwYWNlKSA9PiBuYW1lc3BhY2UuaWQpOwogICAgfSwKICAgIGVtcHR5RGVmYXVsdHMoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogdGhpcy50ZW1wbGF0ZU9wdGlvbnNbMF0udmFsdWUsCiAgICAgICAgc3BlYzogdGhpcy5lbXB0eVNwZWMKICAgICAgfTsKICAgIH0sCiAgICBpc1RlbXBsYXRlU2VsZWN0b3JEaXNhYmxlZCgpIHsKICAgICAgcmV0dXJuICF0aGlzLmlzQ3JlYXRlOwogICAgfSwKICAgIHNob3dOYW1lc3BhY2VMaXN0cygpIHsKICAgICAgcmV0dXJuIHRoaXMudmFsdWUuc3BlYy5tYXRjaC5zY29wZSAhPT0gJ0NsdXN0ZXInOwogICAgfQogIH0sCgogIHdhdGNoOiB7CiAgICB2YWx1ZTogewogICAgICBoYW5kbGVyKHZhbHVlKSB7CiAgICAgICAgLy8gV2UgaGF2ZSB0byBzZXQgdGhlIHR5cGUgZm9yIHRoZSBDcmVhdGVFZGl0VmlldyBtaXhpbiB0byBrbm93IHdoYXQgdGhlIHR5cGUgaXMgd2hlbiBjcmVhdGluZwogICAgICAgIHRoaXMudHlwZSA9IHZhbHVlLnR5cGU7CiAgICAgICAgdGhpcy5wdXJnZU5hbWVzcGFjZXNGaWVsZCh0aGlzLnZhbHVlKTsKICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfSwKICB9LAoKICBjcmVhdGVkKCkgewogICAgdGhpcy5yZWdpc3RlckJlZm9yZUhvb2sodGhpcy53aWxsU2F2ZSwgJ3dpbGxTYXZlJyk7CiAgICBpZiAoIXRoaXMudmFsdWUuc2F2ZSkgewogICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIG1lcmdlKHRoaXMudmFsdWUsIHRoaXMuZW1wdHlEZWZhdWx0cykpOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIHdpbGxTYXZlKCkgewogICAgICB0aGlzLnZhbHVlLnNwZWMubWF0Y2gua2luZHMuZm9yRWFjaCgoa2luZCkgPT4gewogICAgICAgIGNvbnN0IGFwaUdyb3VwcyA9IGtpbmQuYXBpR3JvdXBzIHx8IFtdOwoKICAgICAgICBpZiAoYXBpR3JvdXBzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAga2luZC5hcGlHcm91cHMgPSBbJyonXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8qKgogICAgICogVGhlcmUncyBhbiB1cHN0cmVhbSBpc3N1ZSB3aGljaCBwcmV2ZW50cyBnYXRla2VlcGVyIGZyb20gcHJvY2Vzc2luZyBuYW1lc3BhY2VzIHdpdGggZW1wdHkgbGlzdHMgaW5jb3JyZWN0bHkuCiAgICAgKiBXZSBuZWVkIHRvIHJlbW92ZSB0aGUgbmFtZXNwYWNlcyBmaWVsZCBpZiBpdCdzIGVtcHR5LgogICAgICogaHR0cHM6Ly9naXRodWIuY29tL29wZW4tcG9saWN5LWFnZW50L2dhdGVrZWVwZXIvaXNzdWVzLzUwOAogICAgICovCiAgICBwdXJnZU5hbWVzcGFjZXNGaWVsZCh2YWx1ZSkgewogICAgICBpZiAodmFsdWU/LnNwZWM/Lm1hdGNoPy5uYW1lc3BhY2VzICYmICh2YWx1ZS5zcGVjLm1hdGNoLm5hbWVzcGFjZXMubGVuZ3RoID09PSAwKSkgewogICAgICAgIFZ1ZS5kZWxldGUodmFsdWUuc3BlYy5tYXRjaCwgJ25hbWVzcGFjZXMnKTsKICAgICAgfQogICAgfSwKCiAgICB1cGRhdGVUeXBlKHR5cGUpIHsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUsICd0eXBlJywgdHlwZSk7CiAgICB9LAogICAgb25UYWJDaGFuZ2VkKHsgdGFiIH0pIHsKICAgICAgLy8gVGhpcyBpcyBuZWNlc3NhcnkgdG8gZm9yY2UgdGhlIHlhbWxFZGl0b3IgdG8gYWRqdXN0IHRoZSBzaXplIG9uY2UgaXQgaGFzIHNwYWNlIHRvIGZpbGwuCiAgICAgIGlmICh0YWIubmFtZSA9PT0gJ3BhcmFtZXRlcnMnICYmIHRoaXMuJHJlZnMueWFtbEVkaXRvcj8ucmVmcmVzaCkgewogICAgICAgIHRoaXMuJHJlZnMueWFtbEVkaXRvci5yZWZyZXNoKCk7CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RUZW1wbGF0ZVN1YnR5cGUoc3ViVHlwZSkgewogICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZSwgJ2tpbmQnLCBzdWJUeXBlKTsKICAgICAgdGhpcy4kZW1pdCgnc2V0LXN1YnR5cGUnLCBzdWJUeXBlKTsKICAgIH0sCiAgICBvblNjb3BlQ2hhbmdlKG5ld1Njb3BlKSB7CiAgICAgIGlmIChuZXdTY29wZSA9PT0gJ0NsdXN0ZXInKSB7CiAgICAgICAgdGhpcy52YWx1ZS5zcGVjLm1hdGNoLm5hbWVzcGFjZXMgPSBbXTsKICAgICAgICB0aGlzLnZhbHVlLnNwZWMubWF0Y2guZXhjbHVkZWROYW1lc3BhY2VzID0gW107CiAgICAgIH0KICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/constraints.gatekeeper.sh.constraint","sourcesContent":["<script>\nimport Vue from 'vue';\nimport merge from 'lodash/merge';\nimport { ucFirst } from '@shell/utils/string';\nimport { isSimpleKeyValue } from '@shell/utils/object';\nimport { _CREATE, _VIEW } from '@shell/config/query-params';\nimport { SCHEMA, NAMESPACE } from '@shell/config/types';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport { RadioGroup } from '@components/Form/Radio';\nimport RuleSelector from '@shell/components/form/RuleSelector';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport Tabbed from '@shell/components/Tabbed';\nimport YamlEditor, { EDITOR_MODES } from '@shell/components/YamlEditor';\nimport CruResource from '@shell/components/CruResource';\nimport { ENFORCEMENT_ACTION_VALUES } from '@shell/models/constraints.gatekeeper.sh.constraint';\nimport { saferDump } from '@shell/utils/create-yaml';\nimport NamespaceList, { NAMESPACE_FILTERS_HELPER } from './NamespaceList';\nimport MatchKinds from './MatchKinds';\nimport Scope, { SCOPE_OPTIONS } from './Scope';\n\nfunction findConstraintTypes(schemas) {\n  return schemas\n    .filter((schema) => schema?.attributes?.group === 'constraints.gatekeeper.sh');\n}\n\nfunction findConstraintTypesIds(schemas) {\n  return findConstraintTypes(schemas)\n    .map((schema) => schema.id);\n}\n\nconst CONSTRAINT_PREFIX = 'constraints.gatekeeper.sh.';\n\nexport default {\n  components: {\n    CruResource,\n    MatchKinds,\n    NameNsDescription,\n    NamespaceList,\n    RuleSelector,\n    RadioGroup,\n    Scope,\n    Tab,\n    Tabbed,\n    YamlEditor\n  },\n\n  mixins: [CreateEditView],\n\n  props: {\n    value: {\n      type:     Object,\n      required: true\n    }\n  },\n\n  data() {\n    const emptySpec = {\n      enforcementAction: ENFORCEMENT_ACTION_VALUES.DENY,\n      parameters:        {},\n      match:             {\n        kinds:              [{}],\n        namespaces:         [],\n        excludedNamespaces: [],\n        labelSelector:      { matchExpressions: [] },\n        namespaceSelector:  { matchExpressions: [] }\n      }\n    };\n\n    if (this.mode === _CREATE) {\n      this.$set(this.value, 'spec', merge(this.value.spec, emptySpec));\n\n      if (!this.value.spec.match.scope) {\n        this.$set(this.value.spec.match, 'scope', SCOPE_OPTIONS[0].value);\n      }\n    } else {\n      this.$set(this.value.spec, 'match', this.value.spec.match || {});\n      this.$set(this.value.spec.match, 'kinds', this.value.spec.match.kinds || [{}]);\n      this.$set(this.value.spec.match, 'labelSelector', this.value.spec.match.labelSelector || {});\n      this.$set(this.value.spec.match.labelSelector, 'matchExpressions', this.value.spec.match.labelSelector.matchExpressions || []);\n      this.$set(this.value.spec.match, 'namespaceSelector', this.value.spec.match.namespaceSelector || {});\n      this.$set(this.value.spec.match.namespaceSelector, 'labelSelector', this.value.spec.match.namespaceSelector.labelSelector || []);\n    }\n\n    const parametersYaml = saferDump(this.value?.spec?.parameters);\n\n    return {\n      emptySpec,\n      parametersYaml,\n      enforcementActionOptions: [\n        {\n          label: `${ ENFORCEMENT_ACTION_VALUES.DENY } - deny admission requests with any violation`,\n          value: ENFORCEMENT_ACTION_VALUES.DENY\n        },\n        {\n          label: `${ ENFORCEMENT_ACTION_VALUES.DRYRUN } - enables constraints to be deployed in the cluster without making actual changes`,\n          value: ENFORCEMENT_ACTION_VALUES.DRYRUN\n        }\n      ],\n      enforcementActionLabels: Object.values(ENFORCEMENT_ACTION_VALUES).map(ucFirst),\n      NAMESPACE_FILTERS_HELPER,\n    };\n  },\n\n  computed: {\n    templateOptions() {\n      const schemas = this.$store.getters['cluster/all'](SCHEMA);\n      const constraintTypes = findConstraintTypesIds(schemas);\n\n      constraintTypes.sort();\n\n      return constraintTypes.map((type) => {\n        return {\n          label: type.replace(CONSTRAINT_PREFIX, ''),\n          value: type\n        };\n      });\n    },\n    templateSubtypes() {\n      const schemas = this.$store.getters['cluster/all'](SCHEMA);\n      const constraintTypes = findConstraintTypes(schemas);\n\n      constraintTypes.sort();\n\n      return constraintTypes.map((type) => {\n        const splitId = type.id.split('.');\n\n        return {\n          label:       type.id.replace(CONSTRAINT_PREFIX, ''),\n          description: '',\n          id:          splitId[splitId.length - 1],\n          bannerAbbrv: 'CT'\n        };\n      });\n    },\n    editorMode() {\n      if ( this.mode === _VIEW ) {\n        return EDITOR_MODES.VIEW_CODE;\n      } else {\n        return EDITOR_MODES.EDIT_CODE;\n      }\n    },\n    canShowForm() {\n      return this.value?.spec?.parameters && isSimpleKeyValue(this.value.spec.parameters) && !this.isView;\n    },\n    systemNamespaceIds() {\n      return this.$store.getters['cluster/all'](NAMESPACE)\n        .filter((namespace) => namespace.isSystem)\n        .map((namespace) => namespace.id);\n    },\n    emptyDefaults() {\n      return {\n        type: this.templateOptions[0].value,\n        spec: this.emptySpec\n      };\n    },\n    isTemplateSelectorDisabled() {\n      return !this.isCreate;\n    },\n    showNamespaceLists() {\n      return this.value.spec.match.scope !== 'Cluster';\n    }\n  },\n\n  watch: {\n    value: {\n      handler(value) {\n        // We have to set the type for the CreateEditView mixin to know what the type is when creating\n        this.type = value.type;\n        this.purgeNamespacesField(this.value);\n      },\n      deep: true\n    },\n  },\n\n  created() {\n    this.registerBeforeHook(this.willSave, 'willSave');\n    if (!this.value.save) {\n      this.$emit('input', merge(this.value, this.emptyDefaults));\n    }\n  },\n\n  methods: {\n    willSave() {\n      this.value.spec.match.kinds.forEach((kind) => {\n        const apiGroups = kind.apiGroups || [];\n\n        if (apiGroups.length === 0) {\n          kind.apiGroups = ['*'];\n        }\n      });\n    },\n    /**\n     * There's an upstream issue which prevents gatekeeper from processing namespaces with empty lists incorrectly.\n     * We need to remove the namespaces field if it's empty.\n     * https://github.com/open-policy-agent/gatekeeper/issues/508\n     */\n    purgeNamespacesField(value) {\n      if (value?.spec?.match?.namespaces && (value.spec.match.namespaces.length === 0)) {\n        Vue.delete(value.spec.match, 'namespaces');\n      }\n    },\n\n    updateType(type) {\n      this.$set(this.value, 'type', type);\n    },\n    onTabChanged({ tab }) {\n      // This is necessary to force the yamlEditor to adjust the size once it has space to fill.\n      if (tab.name === 'parameters' && this.$refs.yamlEditor?.refresh) {\n        this.$refs.yamlEditor.refresh();\n      }\n    },\n    selectTemplateSubtype(subType) {\n      this.$set(this.value, 'kind', subType);\n      this.$emit('set-subtype', subType);\n    },\n    onScopeChange(newScope) {\n      if (newScope === 'Cluster') {\n        this.value.spec.match.namespaces = [];\n        this.value.spec.match.excludedNamespaces = [];\n      }\n    }\n  }\n};\n</script>\n<template>\n  <CruResource\n    :done-route=\"doneRoute\"\n    :mode=\"mode\"\n    :resource=\"value\"\n    :selected-subtype=\"value.kind\"\n    :subtypes=\"templateSubtypes\"\n    :validation-passed=\"true\"\n    :errors=\"errors\"\n    @error=\"e=>errors = e\"\n    @finish=\"save\"\n    @select-type=\"selectTemplateSubtype\"\n  >\n    <div\n      v-if=\"value\"\n      class=\"gatekeeper-constraint\"\n    >\n      <div>\n        <NameNsDescription\n          v-if=\"!isView\"\n          :value=\"value\"\n          :mode=\"mode\"\n          :namespaced=\"false\"\n        />\n      </div>\n      <div class=\"row mb-40\">\n        <div class=\"col span-12\">\n          <h3>Enforcement Action</h3>\n          <RadioGroup\n            v-model=\"value.spec.enforcementAction\"\n            name=\"enforcementAction\"\n            class=\"enforcement-action\"\n            :options=\"enforcementActionOptions\"\n            :labels=\"enforcementActionLabels\"\n            :mode=\"mode\"\n          />\n        </div>\n      </div>\n      <Tabbed\n        :side-tabs=\"true\"\n        @changed=\"onTabChanged\"\n      >\n        <Tab\n          name=\"namespaces\"\n          :label=\"t('gatekeeperConstraint.tab.namespaces.title')\"\n          :weight=\"3\"\n        >\n          <div class=\"row\">\n            <div class=\"col span-6\">\n              <Scope\n                v-model=\"value.spec.match.scope\"\n                :mode=\"mode\"\n                @input=\"onScopeChange($event)\"\n              />\n            </div>\n          </div>\n          <div\n            v-if=\"showNamespaceLists\"\n            class=\"row mt-20\"\n          >\n            <div class=\"col span-12\">\n              <NamespaceList\n                v-model=\"value.spec.match.namespaces\"\n                :label=\"t('gatekeeperConstraint.tab.namespaces.sub.namespaces')\"\n                tooltip=\"If defined, a constraint will only apply to resources in a listed namespace.\"\n                :mode=\"mode\"\n                :namespace-filter=\"NAMESPACE_FILTERS_HELPER.nonSystem\"\n                add-label=\"Add Namespace\"\n              />\n            </div>\n          </div>\n          <div\n            v-if=\"showNamespaceLists\"\n            class=\"row mt-20\"\n          >\n            <div class=\"col span-12\">\n              <NamespaceList\n                v-model=\"value.spec.match.excludedNamespaces\"\n                :label=\"t('gatekeeperConstraint.tab.namespaces.sub.excludedNamespaces')\"\n                tooltip=\"If defined, a constraint will only apply to resources not in a listed namespace.\"\n                :mode=\"mode\"\n                add-label=\"Add Excluded Namespace\"\n              />\n            </div>\n          </div>\n          <div class=\"row mt-40\">\n            <div class=\"col span-12\">\n              <h3>{{ t('gatekeeperConstraint.tab.namespaces.sub.namespaceSelector.title') }}</h3>\n              <RuleSelector\n                v-model=\"value.spec.match.namespaceSelector.matchExpressions\"\n                add-label=\"Add Namespace Selector\"\n                :mode=\"mode\"\n              />\n            </div>\n          </div>\n        </Tab>\n        <Tab\n          name=\"rules\"\n          :label=\"t('gatekeeperConstraint.tab.rules.title')\"\n          :weight=\"2\"\n        >\n          <div class=\"row\">\n            <div class=\"col span-12\">\n              <MatchKinds\n                v-model=\"value.spec.match.kinds\"\n                :mode=\"mode\"\n              />\n            </div>\n          </div>\n          <div class=\"row mt-40\">\n            <div class=\"col span-12\">\n              <h3>{{ t('gatekeeperConstraint.tab.rules.sub.labelSelector.title') }}</h3>\n              <RuleSelector\n                v-model=\"value.spec.match.labelSelector.matchExpressions\"\n                :add-label=\"t('gatekeeperConstraint.tab.rules.sub.labelSelector.addLabel')\"\n                :mode=\"mode\"\n              />\n            </div>\n          </div>\n        </Tab>\n        <Tab\n          name=\"parameters\"\n          :label=\"t('gatekeeperConstraint.tab.parameters.title')\"\n          :weight=\"1\"\n        >\n          <YamlEditor\n            ref=\"yamlEditor\"\n            v-model=\"parametersYaml\"\n            class=\"yaml-editor\"\n            :editor-mode=\"editorMode\"\n            @newObject=\"$set(value.spec, 'parameters', $event)\"\n          />\n        </Tab>\n      </Tabbed>\n    </div>\n  </CruResource>\n</template>\n"]}]}
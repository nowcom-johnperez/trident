{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/logging-flow/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/logging-flow/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgQ3J1UmVzb3VyY2UgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ3J1UmVzb3VyY2UnOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IE5hbWVOc0Rlc2NyaXB0aW9uIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTmFtZU5zRGVzY3JpcHRpb24nOwppbXBvcnQgVGFiYmVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYmJlZCc7CmltcG9ydCBUYWIgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvVGFiYmVkL1RhYic7CmltcG9ydCB7CiAgTE9HR0lORywgTkFNRVNQQUNFLCBOT0RFLCBQT0QsIFNDSEVNQQp9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQganN5YW1sIGZyb20gJ2pzLXlhbWwnOwppbXBvcnQgeyBjcmVhdGVZYW1sIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2NyZWF0ZS15YW1sJzsKaW1wb3J0IFlhbWxFZGl0b3IsIHsgRURJVE9SX01PREVTIH0gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvWWFtbEVkaXRvcic7CmltcG9ydCB7IGFsbEhhc2ggfSBmcm9tICdAc2hlbGwvdXRpbHMvcHJvbWlzZSc7CmltcG9ydCB7IGlzQXJyYXksIHVuaXEgfSBmcm9tICdAc2hlbGwvdXRpbHMvYXJyYXknOwppbXBvcnQgeyBtYXRjaFJ1bGVJc1BvcHVsYXRlZCB9IGZyb20gJ0BzaGVsbC9tb2RlbHMvbG9nZ2luZy5iYW56YWljbG91ZC5pby5mbG93JzsKaW1wb3J0IExhYmVsZWRTZWxlY3QgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9MYWJlbGVkU2VsZWN0JzsKaW1wb3J0IHsgY2xvbmUsIHNldCB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgaXNFbXB0eSBmcm9tICdsb2Rhc2gvaXNFbXB0eSc7CmltcG9ydCBBcnJheUxpc3RHcm91cGVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0R3JvdXBlZCc7CmltcG9ydCB7IGV4Y2VwdGlvblRvRXJyb3JzQXJyYXkgfSBmcm9tICdAc2hlbGwvdXRpbHMvZXJyb3InOwppbXBvcnQgTWF0Y2ggZnJvbSAnLi9NYXRjaCc7CgpmdW5jdGlvbiBlbXB0eU1hdGNoKGluY2x1ZGUgPSB0cnVlKSB7CiAgY29uc3QgcnVsZSA9IHsKICAgIHNlbGVjdDogICAgICAgICAgISFpbmNsdWRlLAogICAgZXhjbHVkZTogICAgICAgICAhaW5jbHVkZSwKICAgIGxhYmVsczogICAgICAgICAge30sCiAgICBob3N0czogICAgICAgICAgIFtdLAogICAgY29udGFpbmVyX25hbWVzOiBbXQogIH07CgogIHJldHVybiBydWxlOwp9CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQmFubmVyLAogICAgQ3J1UmVzb3VyY2UsCiAgICBMYWJlbGVkU2VsZWN0LAogICAgTG9hZGluZywKICAgIE5hbWVOc0Rlc2NyaXB0aW9uLAogICAgVGFiLAogICAgVGFiYmVkLAogICAgWWFtbEVkaXRvciwKICAgIE1hdGNoLAogICAgQXJyYXlMaXN0R3JvdXBlZAogIH0sCgogIG1peGluczogW0NyZWF0ZUVkaXRWaWV3XSwKCiAgYXN5bmMgZmV0Y2goKSB7CiAgICBjb25zdCBoYXNBY2Nlc3NUb0NsdXN0ZXJPdXRwdXRzID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1tgY2x1c3Rlci9zY2hlbWFGb3JgXShMT0dHSU5HLkNMVVNURVJfT1VUUFVUKTsKICAgIGNvbnN0IGhhc0FjY2Vzc1RvT3V0cHV0cyA9IHRoaXMuJHN0b3JlLmdldHRlcnNbYGNsdXN0ZXIvc2NoZW1hRm9yYF0oTE9HR0lORy5PVVRQVVQpOwogICAgY29uc3QgaGFzQWNjZXNzVG9OYW1lc3BhY2VzID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1tgY2x1c3Rlci9zY2hlbWFGb3JgXShOQU1FU1BBQ0UpOwogICAgY29uc3QgaGFzQWNjZXNzVG9Ob2RlcyA9IHRoaXMuJHN0b3JlLmdldHRlcnNbYGNsdXN0ZXIvc2NoZW1hRm9yYF0oTk9ERSk7CiAgICBjb25zdCBoYXNBY2Nlc3NUb1BvZHMgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzW2BjbHVzdGVyL3NjaGVtYUZvcmBdKFBPRCk7CiAgICBjb25zdCBpc0Zsb3cgPSB0aGlzLnZhbHVlLnR5cGUgPT09IExPR0dJTkcuRkxPVzsKCiAgICBjb25zdCBnZXRBbGxPckRlZmF1bHQgPSAodHlwZSwgaGFzQWNjZXNzKSA9PiB7CiAgICAgIHJldHVybiBoYXNBY2Nlc3MgPyB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2x1c3Rlci9maW5kQWxsJywgeyB0eXBlIH0pIDogUHJvbWlzZS5yZXNvbHZlKFtdKTsKICAgIH07CgogICAgY29uc3QgaGFzaCA9IGF3YWl0IGFsbEhhc2goewogICAgICBhbGxPdXRwdXRzOiAgICAgICAgZ2V0QWxsT3JEZWZhdWx0KExPR0dJTkcuT1VUUFVULCBpc0Zsb3cgJiYgaGFzQWNjZXNzVG9PdXRwdXRzKSwKICAgICAgYWxsQ2x1c3Rlck91dHB1dHM6IGdldEFsbE9yRGVmYXVsdChMT0dHSU5HLkNMVVNURVJfT1VUUFVULCBoYXNBY2Nlc3NUb0NsdXN0ZXJPdXRwdXRzKSwKICAgICAgYWxsTmFtZXNwYWNlczogICAgIGdldEFsbE9yRGVmYXVsdChOQU1FU1BBQ0UsIGhhc0FjY2Vzc1RvTmFtZXNwYWNlcyksCiAgICAgIGFsbE5vZGVzOiAgICAgICAgICBnZXRBbGxPckRlZmF1bHQoTk9ERSwgaGFzQWNjZXNzVG9Ob2RlcyksCiAgICAgIGFsbFBvZHM6ICAgICAgICAgICBnZXRBbGxPckRlZmF1bHQoUE9ELCBoYXNBY2Nlc3NUb1BvZHMpLAogICAgfSk7CgogICAgZm9yICggY29uc3QgayBvZiBPYmplY3Qua2V5cyhoYXNoKSApIHsKICAgICAgdGhpc1trXSA9IGhhc2hba10gfHwgW107CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIGNvbnN0IHNjaGVtYXMgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjbHVzdGVyL2FsbCddKFNDSEVNQSk7CiAgICBsZXQgZmlsdGVyc1lhbWw7CgogICAgc2V0KHRoaXMudmFsdWUsICdzcGVjJywgdGhpcy52YWx1ZS5zcGVjIHx8IHt9KTsKCiAgICBpZiAoIHRoaXMudmFsdWUuc3BlYy5maWx0ZXJzPy5sZW5ndGggKSB7CiAgICAgIGZpbHRlcnNZYW1sID0ganN5YW1sLmR1bXAodGhpcy52YWx1ZS5zcGVjLmZpbHRlcnMpOwogICAgfSBlbHNlIHsKICAgICAgZmlsdGVyc1lhbWwgPSBjcmVhdGVZYW1sKHNjaGVtYXMsIExPR0dJTkcuU1BPT0ZFRC5GSUxURVJTLCBbXSk7CiAgICAgIC8vIGNyZWF0ZVlhbWwgZG9lc24ndCBzdXBwb3J0IHBhc3NpbmcgcmVmZXJlbmNlIHR5cGVzIChhcnJheSwgbWFwKSBhcyB0aGUgZmlyc3QgdHlwZS4gQXMgc3VjaAogICAgICAvLyBJJ20gbWFuaXB1bGF0aW5nIHRoZSBvdXRwdXQgc2luY2UgSSdtIG5vdCBzdXJlIGl0J3Mgc29tZXRoaW5nIHdlIHdhbnQgdG8gYWN0dWFsbHkgc3VwcG9ydAogICAgICAvLyBzZWVpbmcgYXMgaXQncyByZWFsbHkgY3JlYXRlUmVzb3VyY2VZYW1sIGFuZCB0aGlzIGhlcmUgaXMgYSBncmF5IGFyZWEgYmV0d2VlbiBzcG9vZmVkIHR5cGVzCiAgICAgIC8vIGFuZCBqdXN0IGEgZmllbGQgd2l0aGluIGEgc3BlYy4KICAgICAgZmlsdGVyc1lhbWwgPSBmaWx0ZXJzWWFtbC5zdWJzdHJpbmcoZmlsdGVyc1lhbWwuaW5kZXhPZignXG4nKSArIDEpLnJlcGxhY2VBbGwoJyMgICcsICcjJyk7CiAgICB9CgogICAgY29uc3QgbWF0Y2hlcyA9IFtdOwogICAgbGV0IGZvcm1TdXBwb3J0ZWQgPSAhdGhpcy52YWx1ZS5pZCB8fCB0aGlzLnZhbHVlLmNhbkN1c3RvbUVkaXQ7CgogICAgaWYgKCB0aGlzLnZhbHVlLnNwZWMubWF0Y2g/Lmxlbmd0aCApIHsKICAgICAgZm9yICggY29uc3QgbWF0Y2ggb2YgdGhpcy52YWx1ZS5zcGVjLm1hdGNoICkgewogICAgICAgIGlmICggbWF0Y2hSdWxlSXNQb3B1bGF0ZWQobWF0Y2guc2VsZWN0KSAmJiBtYXRjaFJ1bGVJc1BvcHVsYXRlZChtYXRjaC5leGNsdWRlKSApIHsKICAgICAgICAgIGZvcm1TdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKCBtYXRjaFJ1bGVJc1BvcHVsYXRlZChtYXRjaC5zZWxlY3QpICkgewogICAgICAgICAgbWF0Y2hlcy5wdXNoKHsgc2VsZWN0OiB0cnVlLCAuLi5tYXRjaC5zZWxlY3QgfSk7CiAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hSdWxlSXNQb3B1bGF0ZWQobWF0Y2guZXhjbHVkZSkgKSB7CiAgICAgICAgICBtYXRjaGVzLnB1c2goeyBleGNsdWRlOiB0cnVlLCAuLi5tYXRjaC5leGNsdWRlIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbWF0Y2hlcy5wdXNoKGVtcHR5TWF0Y2godHJ1ZSkpOwogICAgfQoKICAgIGNvbnN0IGdsb2JhbE91dHB1dFJlZnMgPSAodGhpcy52YWx1ZS5zcGVjLmdsb2JhbE91dHB1dFJlZnMgfHwgW10pLm1hcCgocmVmKSA9PiAoeyBsYWJlbDogcmVmLCB2YWx1ZTogcmVmIH0pKTsKICAgIGNvbnN0IGxvY2FsT3V0cHV0UmVmcyA9ICh0aGlzLnZhbHVlLnNwZWMubG9jYWxPdXRwdXRSZWZzIHx8IFtdKS5tYXAoKHJlZikgPT4gKHsgbGFiZWw6IHJlZiwgdmFsdWU6IHJlZiB9KSk7CgogICAgcmV0dXJuIHsKICAgICAgZm9ybVN1cHBvcnRlZCwKICAgICAgbWF0Y2hlcywKICAgICAgYWxsT3V0cHV0czogICAgICAgICBudWxsLAogICAgICBhbGxDbHVzdGVyT3V0cHV0czogIG51bGwsCiAgICAgIGFsbE5hbWVzcGFjZXM6ICAgICAgbnVsbCwKICAgICAgYWxsTm9kZXM6ICAgICAgICAgICBudWxsLAogICAgICBhbGxQb2RzOiAgICAgICAgICAgIG51bGwsCiAgICAgIGZpbHRlcnNZYW1sLAogICAgICBpbml0aWFsRmlsdGVyc1lhbWw6IGZpbHRlcnNZYW1sLAogICAgICBnbG9iYWxPdXRwdXRSZWZzLAogICAgICBsb2NhbE91dHB1dFJlZnMKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIEVESVRPUl9NT0RFUygpIHsKICAgICAgcmV0dXJuIEVESVRPUl9NT0RFUzsKICAgIH0sCgogICAgTE9HR0lORygpIHsKICAgICAgcmV0dXJuIExPR0dJTkc7CiAgICB9LAoKICAgIG91dHB1dENob2ljZXMoKSB7CiAgICAgIGlmICghdGhpcy5hbGxPdXRwdXRzKSB7CiAgICAgICAgLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uCiAgICAgICAgLy8gdG8gc2VlIE91dHB1dHMKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIC8vIFllcyBjbHVzdGVyIG91dHB1dHMgYXJlIHN0aWxsIG5hbWVzcGFjZWQgYmVjYXVzZSByZWFzb25zLi4uCiAgICAgIHJldHVybiB0aGlzLmFsbE91dHB1dHMuZmlsdGVyKChvdXRwdXQpID0+IHsKICAgICAgICBpZiAoICFvdXRwdXQubmFtZXNwYWNlKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvdXRwdXQubmFtZXNwYWNlID09PSB0aGlzLnZhbHVlLm5hbWVzcGFjZTsKICAgICAgfSkubWFwKCh4KSA9PiB7CiAgICAgICAgcmV0dXJuIHsgbGFiZWw6IHgubWV0YWRhdGEubmFtZSwgdmFsdWU6IHgubWV0YWRhdGEubmFtZSB9OwogICAgICB9KTsKICAgIH0sCgogICAgY2x1c3Rlck91dHB1dENob2ljZXMoKSB7CiAgICAgIGlmICghdGhpcy5hbGxDbHVzdGVyT3V0cHV0cykgewogICAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgdXNlciBkb2Vzbid0IGhhdmUgcGVybWlzc2lvbgogICAgICAgIC8vIHRvIHNlZSBDbHVzdGVyT3V0cHV0cwogICAgICAgIHJldHVybiBbXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuYWxsQ2x1c3Rlck91dHB1dHMKICAgICAgICAuZmlsdGVyKChjbHVzdGVyT3V0cHV0KSA9PiB7CiAgICAgICAgICByZXR1cm4gY2x1c3Rlck91dHB1dC5uYW1lc3BhY2UgPT09ICdjYXR0bGUtbG9nZ2luZy1zeXN0ZW0nOwogICAgICAgIH0pCiAgICAgICAgLm1hcCgoY2x1c3Rlck91dHB1dCkgPT4gewogICAgICAgICAgcmV0dXJuIHsgbGFiZWw6IGNsdXN0ZXJPdXRwdXQubWV0YWRhdGEubmFtZSwgdmFsdWU6IGNsdXN0ZXJPdXRwdXQubWV0YWRhdGEubmFtZSB9OwogICAgICAgIH0pOwogICAgfSwKCiAgICBuYW1lc3BhY2VDaG9pY2VzKCkgewogICAgICBpZiAoIXRoaXMuYWxsTmFtZXNwYWNlcykgewogICAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgdXNlciBkb2Vzbid0IGhhdmUgcGVybWlzc2lvbgogICAgICAgIC8vIHRvIHNlZSBuYW1lc3BhY2VzCiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IG91dCA9IHRoaXMuYWxsTmFtZXNwYWNlcy5tYXAoKG5hbWVzcGFjZSkgPT4gewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsYWJlbDogbmFtZXNwYWNlLm5hbWVEaXNwbGF5LAogICAgICAgICAgdmFsdWU6IG5hbWVzcGFjZS5tZXRhZGF0YS5uYW1lCiAgICAgICAgfTsKICAgICAgfSk7CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICBub2RlQ2hvaWNlcygpIHsKICAgICAgaWYgKCF0aGlzLmFsbE5vZGVzKSB7CiAgICAgICAgLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uCiAgICAgICAgLy8gdG8gc2VlIG5vZGVzCiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IG91dCA9IHRoaXMuYWxsTm9kZXMubWFwKChub2RlKSA9PiB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxhYmVsOiBub2RlLm5hbWVEaXNwbGF5LAogICAgICAgICAgdmFsdWU6IG5vZGUubWV0YWRhdGEubmFtZQogICAgICAgIH07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG91dDsKICAgIH0sCgogICAgY29udGFpbmVyQ2hvaWNlcygpIHsKICAgICAgY29uc3Qgb3V0ID0gW107CgogICAgICBmb3IgKCBjb25zdCBwb2Qgb2YgdGhpcy5hbGxQb2RzICkgewogICAgICAgIGZvciAoIGNvbnN0IGMgb2YgKHBvZC5zcGVjPy5jb250YWluZXJzIHx8IFtdKSApIHsKICAgICAgICAgIG91dC5wdXNoKGMubmFtZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdW5pcShvdXQpLnNvcnQoKTsKICAgIH0sCiAgfSwKCiAgd2F0Y2g6IHsKICAgIG1hdGNoZXM6IHsKICAgICAgZGVlcDogdHJ1ZSwKICAgICAgaGFuZGxlcigpIHsKICAgICAgICBjb25zdCBtYXRjaGVzID0gdGhpcy5tYXRjaGVzLm1hcCgobWF0Y2gpID0+IHsKICAgICAgICAgIGNvbnN0IGNvcHkgPSBjbG9uZShtYXRjaCk7CgogICAgICAgICAgZGVsZXRlIGNvcHkuZXhjbHVkZTsKICAgICAgICAgIGRlbGV0ZSBjb3B5LnNlbGVjdDsKCiAgICAgICAgICBpZiAoIG1hdGNoLmV4Y2x1ZGUgKSB7CiAgICAgICAgICAgIHJldHVybiB7IGV4Y2x1ZGU6IGNvcHkgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB7IHNlbGVjdDogY29weSB9OwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnbWF0Y2gnLCBtYXRjaGVzKTsKICAgICAgfQogICAgfSwKICAgIGZpbHRlcnNZYW1sOiB7CiAgICAgIGRlZXA6IHRydWUsCiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGZpbHRlckpzb24gPSBqc3lhbWwubG9hZCh0aGlzLmZpbHRlcnNZYW1sKTsKCiAgICAgICAgICBpZiAoIGlzQXJyYXkoZmlsdGVySnNvbikgKSB7CiAgICAgICAgICAgIHNldCh0aGlzLnZhbHVlLnNwZWMsICdmaWx0ZXJzJywgZmlsdGVySnNvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnZmlsdGVycycsIHVuZGVmaW5lZCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhpcy5lcnJvcnMgPSBleGNlcHRpb25Ub0Vycm9yc0FycmF5KGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdsb2JhbE91dHB1dFJlZnM6IHsKICAgICAgZGVlcDogdHJ1ZSwKICAgICAgaGFuZGxlcigpIHsKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnZ2xvYmFsT3V0cHV0UmVmcycsIHRoaXMuZ2xvYmFsT3V0cHV0UmVmcyk7CiAgICAgIH0KICAgIH0sCiAgICBsb2NhbE91dHB1dFJlZnM6IHsKICAgICAgZGVlcDogdHJ1ZSwKICAgICAgaGFuZGxlcigpIHsKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnbG9jYWxPdXRwdXRSZWZzJywgdGhpcy5sb2NhbE91dHB1dFJlZnMpOwogICAgICB9CiAgICB9CiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIGlmICh0aGlzLmlzQ3JlYXRlICYmIHRoaXMudmFsdWUudHlwZSA9PT0gTE9HR0lORy5DTFVTVEVSX0ZMT1cpIHsKICAgICAgdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lc3BhY2UgPSAnY2F0dGxlLWxvZ2dpbmctc3lzdGVtJzsKICAgIH0KCiAgICB0aGlzLnJlZ2lzdGVyQmVmb3JlSG9vayh0aGlzLndpbGxTYXZlLCAnd2lsbFNhdmUnKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBhZGRNYXRjaChpbmNsdWRlKSB7CiAgICAgIHRoaXMubWF0Y2hlcy5wdXNoKGVtcHR5TWF0Y2goaW5jbHVkZSkpOwogICAgfSwKCiAgICByZW1vdmVNYXRjaChpZHgpIHsKICAgICAgdGhpcy5tYXRjaGVzLnNwbGljZShpZHgsIDEpOwogICAgfSwKCiAgICB1cGRhdGVNYXRjaChuZXUsIGlkeCkgewogICAgICB0aGlzLiRzZXQodGhpcy5tYXRjaGVzLCBpZHgsIG5ldSk7CiAgICB9LAoKICAgIHRhYkNoYW5nZWQoeyB0YWIgfSkgewogICAgICBpZiAoIHRhYi5uYW1lID09PSAnZmlsdGVycycgKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgaWYgKCB0aGlzLiRyZWZzLnlhbWwgKSB7CiAgICAgICAgICAgIHRoaXMuJHJlZnMueWFtbC5yZWZyZXNoKCk7CiAgICAgICAgICAgIHRoaXMuJHJlZnMueWFtbC5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgaXNNYXRjaEVtcHR5KG1hdGNoZXMpIHsKICAgICAgaWYgKGlzRW1wdHkobWF0Y2hlcykpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1hdGNoZXMuZXZlcnkoKG1hdGNoKSA9PiB7CiAgICAgICAgaWYgKGlzRW1wdHkobWF0Y2guc2VsZWN0KSAmJiBpc0VtcHR5KG1hdGNoLmV4Y2x1ZGUpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHNlbGVjdCA9IG1hdGNoLnNlbGVjdCB8fCB7fTsKICAgICAgICBjb25zdCBleGNsdWRlID0gbWF0Y2guZXhjbHVkZSB8fCB7fTsKICAgICAgICBjb25zdCBhbGxWYWx1ZXNBcmVFbXB0eSA9IChvKSA9PiBPYmplY3QudmFsdWVzKG8pLmV2ZXJ5KGlzRW1wdHkpOwoKICAgICAgICByZXR1cm4gYWxsVmFsdWVzQXJlRW1wdHkoc2VsZWN0KSAmJiBhbGxWYWx1ZXNBcmVFbXB0eShleGNsdWRlKTsKICAgICAgfSk7CiAgICB9LAogICAgd2lsbFNhdmUoKSB7CiAgICAgIGlmICh0aGlzLnZhbHVlLnNwZWMuZmlsdGVycyAmJiBpc0VtcHR5KHRoaXMudmFsdWUuc3BlYy5maWx0ZXJzKSkgewogICAgICAgIHRoaXMuJGRlbGV0ZSh0aGlzLnZhbHVlLnNwZWMsICdmaWx0ZXJzJyk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnZhbHVlLnNwZWMubWF0Y2ggJiYgdGhpcy5pc01hdGNoRW1wdHkodGhpcy52YWx1ZS5zcGVjLm1hdGNoKSkgewogICAgICAgIHRoaXMuJGRlbGV0ZSh0aGlzLnZhbHVlLnNwZWMsICdtYXRjaCcpOwogICAgICB9CiAgICB9LAogICAgb25ZYW1sRWRpdG9yUmVhZHkoY20pIHsKICAgICAgY20uZ2V0TW9kZSgpLmZvbGQgPSAneWFtbGNvbW1lbnRzJzsKICAgICAgY20uZXhlY0NvbW1hbmQoJ2ZvbGRBbGwnKTsKICAgICAgY20uZXhlY0NvbW1hbmQoJ3VuZm9sZCcpOwogICAgfSwKICAgIGlzVGFnKG9wdGlvbnMsIG9wdGlvbikgewogICAgICByZXR1cm4gIW9wdGlvbnMuZmluZCgobykgPT4gby52YWx1ZSA9PT0gb3B0aW9uLnZhbHVlKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/logging-flow","sourcesContent":["<script>\nimport { Banner } from '@components/Banner';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport CruResource from '@shell/components/CruResource';\nimport Loading from '@shell/components/Loading';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport Tabbed from '@shell/components/Tabbed';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport {\n  LOGGING, NAMESPACE, NODE, POD, SCHEMA\n} from '@shell/config/types';\nimport jsyaml from 'js-yaml';\nimport { createYaml } from '@shell/utils/create-yaml';\nimport YamlEditor, { EDITOR_MODES } from '@shell/components/YamlEditor';\nimport { allHash } from '@shell/utils/promise';\nimport { isArray, uniq } from '@shell/utils/array';\nimport { matchRuleIsPopulated } from '@shell/models/logging.banzaicloud.io.flow';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { clone, set } from '@shell/utils/object';\nimport isEmpty from 'lodash/isEmpty';\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport Match from './Match';\n\nfunction emptyMatch(include = true) {\n  const rule = {\n    select:          !!include,\n    exclude:         !include,\n    labels:          {},\n    hosts:           [],\n    container_names: []\n  };\n\n  return rule;\n}\n\nexport default {\n  components: {\n    Banner,\n    CruResource,\n    LabeledSelect,\n    Loading,\n    NameNsDescription,\n    Tab,\n    Tabbed,\n    YamlEditor,\n    Match,\n    ArrayListGrouped\n  },\n\n  mixins: [CreateEditView],\n\n  async fetch() {\n    const hasAccessToClusterOutputs = this.$store.getters[`cluster/schemaFor`](LOGGING.CLUSTER_OUTPUT);\n    const hasAccessToOutputs = this.$store.getters[`cluster/schemaFor`](LOGGING.OUTPUT);\n    const hasAccessToNamespaces = this.$store.getters[`cluster/schemaFor`](NAMESPACE);\n    const hasAccessToNodes = this.$store.getters[`cluster/schemaFor`](NODE);\n    const hasAccessToPods = this.$store.getters[`cluster/schemaFor`](POD);\n    const isFlow = this.value.type === LOGGING.FLOW;\n\n    const getAllOrDefault = (type, hasAccess) => {\n      return hasAccess ? this.$store.dispatch('cluster/findAll', { type }) : Promise.resolve([]);\n    };\n\n    const hash = await allHash({\n      allOutputs:        getAllOrDefault(LOGGING.OUTPUT, isFlow && hasAccessToOutputs),\n      allClusterOutputs: getAllOrDefault(LOGGING.CLUSTER_OUTPUT, hasAccessToClusterOutputs),\n      allNamespaces:     getAllOrDefault(NAMESPACE, hasAccessToNamespaces),\n      allNodes:          getAllOrDefault(NODE, hasAccessToNodes),\n      allPods:           getAllOrDefault(POD, hasAccessToPods),\n    });\n\n    for ( const k of Object.keys(hash) ) {\n      this[k] = hash[k] || [];\n    }\n  },\n\n  data() {\n    const schemas = this.$store.getters['cluster/all'](SCHEMA);\n    let filtersYaml;\n\n    set(this.value, 'spec', this.value.spec || {});\n\n    if ( this.value.spec.filters?.length ) {\n      filtersYaml = jsyaml.dump(this.value.spec.filters);\n    } else {\n      filtersYaml = createYaml(schemas, LOGGING.SPOOFED.FILTERS, []);\n      // createYaml doesn't support passing reference types (array, map) as the first type. As such\n      // I'm manipulating the output since I'm not sure it's something we want to actually support\n      // seeing as it's really createResourceYaml and this here is a gray area between spoofed types\n      // and just a field within a spec.\n      filtersYaml = filtersYaml.substring(filtersYaml.indexOf('\\n') + 1).replaceAll('#  ', '#');\n    }\n\n    const matches = [];\n    let formSupported = !this.value.id || this.value.canCustomEdit;\n\n    if ( this.value.spec.match?.length ) {\n      for ( const match of this.value.spec.match ) {\n        if ( matchRuleIsPopulated(match.select) && matchRuleIsPopulated(match.exclude) ) {\n          formSupported = false;\n        } else if ( matchRuleIsPopulated(match.select) ) {\n          matches.push({ select: true, ...match.select });\n        } else if ( matchRuleIsPopulated(match.exclude) ) {\n          matches.push({ exclude: true, ...match.exclude });\n        }\n      }\n    } else {\n      matches.push(emptyMatch(true));\n    }\n\n    const globalOutputRefs = (this.value.spec.globalOutputRefs || []).map((ref) => ({ label: ref, value: ref }));\n    const localOutputRefs = (this.value.spec.localOutputRefs || []).map((ref) => ({ label: ref, value: ref }));\n\n    return {\n      formSupported,\n      matches,\n      allOutputs:         null,\n      allClusterOutputs:  null,\n      allNamespaces:      null,\n      allNodes:           null,\n      allPods:            null,\n      filtersYaml,\n      initialFiltersYaml: filtersYaml,\n      globalOutputRefs,\n      localOutputRefs\n    };\n  },\n\n  computed: {\n    EDITOR_MODES() {\n      return EDITOR_MODES;\n    },\n\n    LOGGING() {\n      return LOGGING;\n    },\n\n    outputChoices() {\n      if (!this.allOutputs) {\n        // Handle the case where the user doesn't have permission\n        // to see Outputs\n        return [];\n      }\n\n      // Yes cluster outputs are still namespaced because reasons...\n      return this.allOutputs.filter((output) => {\n        if ( !output.namespace) {\n          return true;\n        }\n\n        return output.namespace === this.value.namespace;\n      }).map((x) => {\n        return { label: x.metadata.name, value: x.metadata.name };\n      });\n    },\n\n    clusterOutputChoices() {\n      if (!this.allClusterOutputs) {\n        // Handle the case where the user doesn't have permission\n        // to see ClusterOutputs\n        return [];\n      }\n\n      return this.allClusterOutputs\n        .filter((clusterOutput) => {\n          return clusterOutput.namespace === 'cattle-logging-system';\n        })\n        .map((clusterOutput) => {\n          return { label: clusterOutput.metadata.name, value: clusterOutput.metadata.name };\n        });\n    },\n\n    namespaceChoices() {\n      if (!this.allNamespaces) {\n        // Handle the case where the user doesn't have permission\n        // to see namespaces\n        return [];\n      }\n      const out = this.allNamespaces.map((namespace) => {\n        return {\n          label: namespace.nameDisplay,\n          value: namespace.metadata.name\n        };\n      });\n\n      return out;\n    },\n\n    nodeChoices() {\n      if (!this.allNodes) {\n        // Handle the case where the user doesn't have permission\n        // to see nodes\n        return [];\n      }\n      const out = this.allNodes.map((node) => {\n        return {\n          label: node.nameDisplay,\n          value: node.metadata.name\n        };\n      });\n\n      return out;\n    },\n\n    containerChoices() {\n      const out = [];\n\n      for ( const pod of this.allPods ) {\n        for ( const c of (pod.spec?.containers || []) ) {\n          out.push(c.name);\n        }\n      }\n\n      return uniq(out).sort();\n    },\n  },\n\n  watch: {\n    matches: {\n      deep: true,\n      handler() {\n        const matches = this.matches.map((match) => {\n          const copy = clone(match);\n\n          delete copy.exclude;\n          delete copy.select;\n\n          if ( match.exclude ) {\n            return { exclude: copy };\n          } else {\n            return { select: copy };\n          }\n        });\n\n        set(this.value.spec, 'match', matches);\n      }\n    },\n    filtersYaml: {\n      deep: true,\n      handler() {\n        try {\n          const filterJson = jsyaml.load(this.filtersYaml);\n\n          if ( isArray(filterJson) ) {\n            set(this.value.spec, 'filters', filterJson);\n          } else {\n            set(this.value.spec, 'filters', undefined);\n          }\n        } catch (e) {\n          this.errors = exceptionToErrorsArray(e);\n        }\n      }\n    },\n    globalOutputRefs: {\n      deep: true,\n      handler() {\n        set(this.value.spec, 'globalOutputRefs', this.globalOutputRefs);\n      }\n    },\n    localOutputRefs: {\n      deep: true,\n      handler() {\n        set(this.value.spec, 'localOutputRefs', this.localOutputRefs);\n      }\n    }\n  },\n\n  created() {\n    if (this.isCreate && this.value.type === LOGGING.CLUSTER_FLOW) {\n      this.value.metadata.namespace = 'cattle-logging-system';\n    }\n\n    this.registerBeforeHook(this.willSave, 'willSave');\n  },\n\n  methods: {\n    addMatch(include) {\n      this.matches.push(emptyMatch(include));\n    },\n\n    removeMatch(idx) {\n      this.matches.splice(idx, 1);\n    },\n\n    updateMatch(neu, idx) {\n      this.$set(this.matches, idx, neu);\n    },\n\n    tabChanged({ tab }) {\n      if ( tab.name === 'filters' ) {\n        this.$nextTick(() => {\n          if ( this.$refs.yaml ) {\n            this.$refs.yaml.refresh();\n            this.$refs.yaml.focus();\n          }\n        });\n      }\n    },\n    isMatchEmpty(matches) {\n      if (isEmpty(matches)) {\n        return true;\n      }\n\n      return matches.every((match) => {\n        if (isEmpty(match.select) && isEmpty(match.exclude)) {\n          return true;\n        }\n\n        const select = match.select || {};\n        const exclude = match.exclude || {};\n        const allValuesAreEmpty = (o) => Object.values(o).every(isEmpty);\n\n        return allValuesAreEmpty(select) && allValuesAreEmpty(exclude);\n      });\n    },\n    willSave() {\n      if (this.value.spec.filters && isEmpty(this.value.spec.filters)) {\n        this.$delete(this.value.spec, 'filters');\n      }\n\n      if (this.value.spec.match && this.isMatchEmpty(this.value.spec.match)) {\n        this.$delete(this.value.spec, 'match');\n      }\n    },\n    onYamlEditorReady(cm) {\n      cm.getMode().fold = 'yamlcomments';\n      cm.execCommand('foldAll');\n      cm.execCommand('unfold');\n    },\n    isTag(options, option) {\n      return !options.find((o) => o.value === option.value);\n    }\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <CruResource\n    v-else-if=\"formSupported\"\n    class=\"flow\"\n    :done-route=\"doneRoute\"\n    :mode=\"mode\"\n    :resource=\"value\"\n    :subtypes=\"[]\"\n    :validation-passed=\"true\"\n    :errors=\"errors\"\n    :apply-hooks=\"applyHooks\"\n    @error=\"e=>errors = e\"\n    @finish=\"save\"\n    @cancel=\"done\"\n  >\n    <NameNsDescription\n      v-if=\"!isView\"\n      v-model=\"value\"\n      :mode=\"mode\"\n      :namespaced=\"value.type !== LOGGING.CLUSTER_FLOW\"\n    />\n\n    <Tabbed\n      :side-tabs=\"true\"\n      @changed=\"tabChanged($event)\"\n    >\n      <Tab\n        name=\"match\"\n        :label=\"t('logging.flow.matches.label')\"\n        :weight=\"3\"\n      >\n        <Banner\n          color=\"info\"\n          class=\"mt-0\"\n          :label=\"t('logging.flow.matches.banner')\"\n        />\n        <ArrayListGrouped\n          v-model=\"matches\"\n          :add-label=\"t('ingress.rules.addRule')\"\n          :default-add-value=\"{}\"\n          :mode=\"mode\"\n        >\n          <template #default=\"props\">\n            <Match\n              class=\"rule mb-20\"\n              :value=\"props.row.value\"\n              :mode=\"mode\"\n              :namespaces=\"namespaceChoices\"\n              :nodes=\"nodeChoices\"\n              :containers=\"containerChoices\"\n              :is-cluster-flow=\"value.type === LOGGING.CLUSTER_FLOW\"\n              @remove=\"e=>removeMatch(props.row.i)\"\n              @input=\"e=>updateMatch(e,props.row.i)\"\n            />\n          </template>\n          <template #add>\n            <button\n              class=\"btn role-tertiary add\"\n              type=\"button\"\n              @click=\"addMatch(true)\"\n            >\n              {{ t('logging.flow.matches.addSelect') }}\n            </button>\n            <button\n              class=\"btn role-tertiary add\"\n              type=\"button\"\n              @click=\"addMatch(false)\"\n            >\n              {{ t('logging.flow.matches.addExclude') }}\n            </button>\n          </template>\n        </ArrayListGrouped>\n      </Tab>\n\n      <Tab\n        name=\"outputs\"\n        :label=\"t('logging.flow.outputs.label')\"\n        :weight=\"2\"\n      >\n        <Banner\n          v-if=\"value.type !== LOGGING.CLUSTER_FLOW\"\n          :label=\"t('logging.flow.outputs.sameNamespaceError')\"\n          color=\"info\"\n        />\n        <LabeledSelect\n          v-model=\"globalOutputRefs\"\n          :label=\"t('logging.flow.clusterOutputs.label')\"\n          :options=\"clusterOutputChoices\"\n          :multiple=\"true\"\n          :taggable=\"true\"\n          :clearable=\"true\"\n          :close-on-select=\"false\"\n          :reduce=\"opt=>opt.value\"\n        >\n          <template #selected-option=\"option\">\n            <i\n              v-if=\"isTag(clusterOutputChoices, option)\"\n              v-clean-tooltip=\"t('logging.flow.clusterOutputs.doesntExistTooltip')\"\n              class=\"icon icon-info status-icon text-warning\"\n            />\n            {{ option.label }}\n          </template>\n        </LabeledSelect>\n        <LabeledSelect\n          v-if=\"value.type === LOGGING.FLOW\"\n          v-model=\"localOutputRefs\"\n          :label=\"t('logging.flow.outputs.label')\"\n          class=\"mt-10\"\n          :options=\"outputChoices\"\n          :multiple=\"true\"\n          :taggable=\"true\"\n          :clearable=\"true\"\n          :close-on-select=\"false\"\n          :reduce=\"opt=>opt.value\"\n        >\n          <template #selected-option=\"option\">\n            <i\n              v-if=\"isTag(outputChoices, option)\"\n              v-clean-tooltip=\"t('logging.flow.outputs.doesntExistTooltip')\"\n              class=\"icon icon-info status-icon text-warning\"\n            />\n            {{ option.label }}\n          </template>\n        </LabeledSelect>\n      </Tab>\n\n      <Tab\n        name=\"filters\"\n        :label=\"t('logging.flow.filters.label')\"\n        :weight=\"1\"\n      >\n        <YamlEditor\n          ref=\"yaml\"\n          v-model=\"filtersYaml\"\n          :scrolling=\"false\"\n          :initial-yaml-values=\"initialFiltersYaml\"\n          :editor-mode=\"isView ? EDITOR_MODES.VIEW_CODE : EDITOR_MODES.EDIT_CODE\"\n          @onReady=\"onYamlEditorReady\"\n        />\n      </Tab>\n    </Tabbed>\n  </CruResource>\n  <Banner\n    v-else\n    :label=\"t('logging.flow.matches.unsupportedConfig')\"\n    color=\"error\"\n  />\n</template>\n\n<style lang=\"scss\" scoped>\n::v-deep {\n  .icon-info {\n    margin-top: -3px;\n    margin-right: 4px;\n  }\n}\n</style>\n"]}]}
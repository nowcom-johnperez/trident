{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/auth/SelectPrincipal.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/auth/SelectPrincipal.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdCc7CmltcG9ydCBQcmluY2lwYWwgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvYXV0aC9QcmluY2lwYWwnOwppbXBvcnQgZGVib3VuY2UgZnJvbSAnbG9kYXNoL2RlYm91bmNlJzsKaW1wb3J0IHsgX0VESVQgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IE5PUk1BTiB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIExhYmVsZWRTZWxlY3QsCiAgICBQcmluY2lwYWwsCiAgfSwKCiAgcHJvcHM6IHsKICAgIG1vZGU6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiBfRURJVCwKICAgIH0sCgogICAgc2hvd015R3JvdXBUeXBlczogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gWydncm91cCcsICd1c2VyJ107CiAgICAgIH0sCiAgICB9LAoKICAgIHNlYXJjaEdyb3VwVHlwZXM6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB2YWxpZGF0b3IodmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09ICdncm91cCcgfHwgdmFsID09PSAndXNlcic7CiAgICAgIH0KICAgIH0sCgogICAgcmV0YWluU2VsZWN0aW9uOiB7CiAgICAgIHR5cGU6ICAgIEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIHByb2plY3Q6IHsKICAgICAgdHlwZTogICAgQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIHRoaXMucHJpbmNpcGFscyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2ZpbmRBbGwnLCB7CiAgICAgIHR5cGU6IE5PUk1BTi5QUklOQ0lQQUwsCiAgICAgIG9wdDogIHsgdXJsOiAnL3YzL3ByaW5jaXBhbHMnIH0KICAgIH0pOwoKICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuc3VnZ2VzdGVkOwogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwcmluY2lwYWxzOiAgICAgbnVsbCwKICAgICAgc2VhcmNoU3RyOiAgICAgICcnLAogICAgICBvcHRpb25zOiAgICAgICAgW10sCiAgICAgIG5ld1ZhbHVlOiAgICAgICAnJywKICAgICAgdG9vbHRpcENvbnRlbnQ6IG51bGwsCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBzdWdnZXN0ZWQoKSB7CiAgICAgIGNvbnN0IG91dCA9IHRoaXMucHJpbmNpcGFscy5maWx0ZXIoKHgpID0+IHsKICAgICAgICBpZiAoICF4Lm1lbWJlck9mICkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAhdGhpcy5zaG93TXlHcm91cFR5cGVzLmluY2x1ZGVzKHgucHJpbmNpcGFsVHlwZSkgKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSkKICAgICAgICAubWFwKCh4KSA9PiB4LmlkKTsKCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIGxhYmVsKCkgewogICAgICByZXR1cm4gdGhpcy5yZXRhaW5TZWxlY3Rpb24gPyB0aGlzLnQoJ2NsdXN0ZXIubWVtYmVyUm9sZXMuYWRkQ2x1c3Rlck1lbWJlci5sYWJlbFNlbGVjdCcpIDogdGhpcy50KCdjbHVzdGVyLm1lbWJlclJvbGVzLmFkZENsdXN0ZXJNZW1iZXIubGFiZWxBZGQnKTsKICAgIH0sCgogICAgcGxhY2Vob2xkZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnByb2plY3QgPyB0aGlzLnQoJ3Byb2plY3RNZW1iZXJzLnByb2plY3RQZXJtaXNzaW9ucy5zZWFyY2hGb3JNZW1iZXInKSA6IHRoaXMudCgnY2x1c3Rlci5tZW1iZXJSb2xlcy5hZGRDbHVzdGVyTWVtYmVyLnBsYWNlaG9sZGVyJyk7CiAgICB9CiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZGVib3VuY2VkU2VhcmNoID0gZGVib3VuY2UodGhpcy5zZWFyY2gsIDIwMCk7CiAgfSwKCiAgbWV0aG9kczogewogICAgc2V0VG9vbHRpcENvbnRlbnQoKSB7CiAgICAgIGlmICghdGhpcy5yZXRhaW5TZWxlY3Rpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMucHJpbmNpcGFscykgewogICAgICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5wcmluY2lwYWxzLmZpbmQoKHApID0+IHAuaWQgPT09IHRoaXMubmV3VmFsdWUpOwoKICAgICAgICB0aGlzLnRvb2x0aXBDb250ZW50ID0gc2VsZWN0ZWQ/Lm5hbWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b29sdGlwQ29udGVudCA9IG51bGw7CiAgICAgIH0KICAgIH0sCiAgICByZXNldFRvb2x0aXBDb250ZW50KCkgewogICAgICBpZiAoIXRoaXMucmV0YWluU2VsZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudG9vbHRpcENvbnRlbnQgPSBudWxsOwogICAgfSwKICAgIGFkZChpZCkgewogICAgICBpZiAoIWlkKSB7CiAgICAgICAgLy8gSWdub3JlIGF0dGVtcHRzIHRvIHNlbGVjdCBhbiBpbnZhbGlkIHByaW5jaXBhbAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy4kZW1pdCgnYWRkJywgaWQpOwogICAgICBpZiAoIXRoaXMucmV0YWluU2VsZWN0aW9uKSB7CiAgICAgICAgdGhpcy5uZXdWYWx1ZSA9ICcnOwogICAgICB9CiAgICB9LAoKICAgIG9uU2VhcmNoKHN0ciwgbG9hZGluZywgdm0pIHsKICAgICAgc3RyID0gKHN0ciB8fCAnJykudHJpbSgpOwoKICAgICAgdGhpcy5zZWFyY2hTdHIgPSBzdHI7CgogICAgICBpZiAoIHN0ciApIHsKICAgICAgICBsb2FkaW5nKHRydWUpOwogICAgICAgIHRoaXMuZGVib3VuY2VkU2VhcmNoKHN0ciwgbG9hZGluZyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWFyY2gobnVsbCwgbG9hZGluZyk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgc2VhcmNoKHN0ciwgbG9hZGluZykgewogICAgICBpZiAoICFzdHIgKSB7CiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5zdWdnZXN0ZWQuc2xpY2UoKTsKICAgICAgICBsb2FkaW5nKGZhbHNlKTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2NvbGxlY3Rpb25BY3Rpb24nLCB7CiAgICAgICAgICB0eXBlOiAgICAgICBOT1JNQU4uUFJJTkNJUEFMLAogICAgICAgICAgYWN0aW9uTmFtZTogJ3NlYXJjaCcsCiAgICAgICAgICBvcHQ6ICAgICAgICB7IHVybDogJy92My9wcmluY2lwYWxzP2FjdGlvbj1zZWFyY2gnIH0sCiAgICAgICAgICBib2R5OiAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICAgICAgICAgIHN0ciwKICAgICAgICAgICAgcHJpbmNpcGFsVHlwZTogdGhpcy5zZWFyY2hHcm91cFR5cGVzCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmICggdGhpcy5zZWFyY2hTdHIgPT09IHN0ciApIHsKICAgICAgICAgIC8vIElmIG5vdCwgdGhleSd2ZSBhbHJlYWR5IHR5cGVkIHNvbWV0aGluZyBlbHNlCiAgICAgICAgICB0aGlzLm9wdGlvbnMgPSByZXMubWFwKCh4KSA9PiB4LmlkKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBbXTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBsb2FkaW5nKGZhbHNlKTsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["SelectPrincipal.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SelectPrincipal.vue","sourceRoot":"node_modules/@rancher/shell/components/auth","sourcesContent":["<script>\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport Principal from '@shell/components/auth/Principal';\nimport debounce from 'lodash/debounce';\nimport { _EDIT } from '@shell/config/query-params';\nimport { NORMAN } from '@shell/config/types';\n\nexport default {\n  components: {\n    LabeledSelect,\n    Principal,\n  },\n\n  props: {\n    mode: {\n      type:    String,\n      default: _EDIT,\n    },\n\n    showMyGroupTypes: {\n      type: Array,\n      default() {\n        return ['group', 'user'];\n      },\n    },\n\n    searchGroupTypes: {\n      type:    String,\n      default: null,\n      validator(val) {\n        return val === null || val === 'group' || val === 'user';\n      }\n    },\n\n    retainSelection: {\n      type:    Boolean,\n      default: false\n    },\n\n    project: {\n      type:    Boolean,\n      default: false\n    }\n  },\n\n  async fetch() {\n    this.principals = await this.$store.dispatch('rancher/findAll', {\n      type: NORMAN.PRINCIPAL,\n      opt:  { url: '/v3/principals' }\n    });\n\n    this.options = this.suggested;\n  },\n\n  data() {\n    return {\n      principals:     null,\n      searchStr:      '',\n      options:        [],\n      newValue:       '',\n      tooltipContent: null,\n    };\n  },\n\n  computed: {\n    suggested() {\n      const out = this.principals.filter((x) => {\n        if ( !x.memberOf ) {\n          return false;\n        }\n\n        if ( !this.showMyGroupTypes.includes(x.principalType) ) {\n          return false;\n        }\n\n        return true;\n      })\n        .sort((a, b) => a.name.localeCompare(b.name))\n        .map((x) => x.id);\n\n      return out;\n    },\n\n    label() {\n      return this.retainSelection ? this.t('cluster.memberRoles.addClusterMember.labelSelect') : this.t('cluster.memberRoles.addClusterMember.labelAdd');\n    },\n\n    placeholder() {\n      return this.project ? this.t('projectMembers.projectPermissions.searchForMember') : this.t('cluster.memberRoles.addClusterMember.placeholder');\n    }\n  },\n\n  created() {\n    this.debouncedSearch = debounce(this.search, 200);\n  },\n\n  methods: {\n    setTooltipContent() {\n      if (!this.retainSelection) {\n        return;\n      }\n      if (this.principals) {\n        const selected = this.principals.find((p) => p.id === this.newValue);\n\n        this.tooltipContent = selected?.name;\n      } else {\n        this.tooltipContent = null;\n      }\n    },\n    resetTooltipContent() {\n      if (!this.retainSelection) {\n        return;\n      }\n      this.tooltipContent = null;\n    },\n    add(id) {\n      if (!id) {\n        // Ignore attempts to select an invalid principal\n        return;\n      }\n\n      this.$emit('add', id);\n      if (!this.retainSelection) {\n        this.newValue = '';\n      }\n    },\n\n    onSearch(str, loading, vm) {\n      str = (str || '').trim();\n\n      this.searchStr = str;\n\n      if ( str ) {\n        loading(true);\n        this.debouncedSearch(str, loading);\n      } else {\n        this.search(null, loading);\n      }\n    },\n\n    async search(str, loading) {\n      if ( !str ) {\n        this.options = this.suggested.slice();\n        loading(false);\n\n        return;\n      }\n\n      try {\n        const res = await this.$store.dispatch('rancher/collectionAction', {\n          type:       NORMAN.PRINCIPAL,\n          actionName: 'search',\n          opt:        { url: '/v3/principals?action=search' },\n          body:       {\n            name:          str,\n            principalType: this.searchGroupTypes\n          }\n        });\n\n        if ( this.searchStr === str ) {\n          // If not, they've already typed something else\n          this.options = res.map((x) => x.id);\n        }\n      } catch (e) {\n        this.options = [];\n      } finally {\n        loading(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <LabeledSelect\n    ref=\"labeled-select\"\n    v-model=\"newValue\"\n    v-clean-tooltip=\"{\n      content: tooltipContent,\n      placement: 'bottom',\n      classes: ['select-principal-tooltip']\n    }\"\n    :mode=\"mode\"\n    :label=\"label\"\n    :placeholder=\"placeholder\"\n    :options=\"options\"\n    :searchable=\"true\"\n    :filterable=\"false\"\n    class=\"select-principal\"\n    :class=\"{'retain-selection': retainSelection}\"\n    @input=\"add\"\n    @search=\"onSearch\"\n    @on-open=\"resetTooltipContent()\"\n    @on-close=\"setTooltipContent()\"\n  >\n    <template v-slot:no-options=\"{ searching }\">\n      <template v-if=\"searching\">\n        <span class=\"search-slot\">\n          {{ t('cluster.memberRoles.addClusterMember.noResults') }}\n        </span>\n      </template>\n      <div v-else>\n        <em class=\"search-slot\">\n          {{ t('cluster.memberRoles.addClusterMember.searchPlaceholder') }}\n        </em>\n      </div>\n    </template>\n\n    <template #option=\"option\">\n      <Principal\n        :key=\"option.label\"\n        :value=\"option.label\"\n        :use-muted=\"false\"\n      />\n    </template>\n\n    <template\n      v-if=\"retainSelection\"\n      #selected-option=\"option\"\n    >\n      <Principal\n        :key=\"option.label\"\n        :value=\"option.label\"\n        :use-muted=\"false\"\n        class=\"mt-10 mb-10\"\n      />\n    </template>\n  </LabeledSelect>\n</template>\n\n<style lang=\"scss\" scoped>\n  .search-slot{\n    color: var(--body-text);\n  }\n\n  .select-principal {\n    &.retain-selection {\n      min-height: 91px;\n      &.focused {\n        .principal {\n          display: none;\n        }\n      }\n    }\n  }\n</style>\n<style lang=\"scss\">\n  .vs__dropdown-menu {\n    width: 0%;\n    * {\n      overflow-x: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n\n  .select-principal-tooltip {\n    max-width: 580px;\n    word-wrap: break-word;\n  }\n</style>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/persistentvolume/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/persistentvolume/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IENyZWF0ZUVkaXRWaWV3IGZyb20gJ0BzaGVsbC9taXhpbnMvY3JlYXRlLWVkaXQtdmlldyc7CmltcG9ydCBDcnVSZXNvdXJjZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9DcnVSZXNvdXJjZSc7CmltcG9ydCBOYW1lTnNEZXNjcmlwdGlvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL05hbWVOc0Rlc2NyaXB0aW9uJzsKaW1wb3J0IEFycmF5TGlzdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0FycmF5TGlzdCc7CmltcG9ydCBBcnJheUxpc3RHcm91cGVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0R3JvdXBlZCc7CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdCc7CmltcG9ydCBNYXRjaEV4cHJlc3Npb25zIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTWF0Y2hFeHByZXNzaW9ucyc7CmltcG9ydCBUYWIgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvVGFiYmVkL1RhYic7CmltcG9ydCBUYWJiZWQgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvVGFiYmVkJzsKaW1wb3J0IE5vZGVBZmZpbml0eSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL05vZGVBZmZpbml0eSc7CmltcG9ydCB7IENoZWNrYm94IH0gZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9DaGVja2JveCc7CmltcG9ydCB1bmlxIGZyb20gJ2xvZGFzaC91bmlxJzsKaW1wb3J0IFVuaXRJbnB1dCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL1VuaXRJbnB1dCc7CmltcG9ydCB7IFZPTFVNRV9QTFVHSU5TLCBMT05HSE9STl9QTFVHSU4gfSBmcm9tICdAc2hlbGwvY29uZmlnL3BlcnNpc3RlbnRWb2x1bWUnOwppbXBvcnQgeyBOT0RFLCBQVkMsIFNUT1JBR0VfQ0xBU1MgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IExvYWRpbmcgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTG9hZGluZyc7CmltcG9ydCB7IF9DUkVBVEUsIF9WSUVXIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9xdWVyeS1wYXJhbXMnOwppbXBvcnQgeyBjbG9uZSB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgSW5mb0JveCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9JbmZvQm94JzsKaW1wb3J0IHsgbWFwRmVhdHVyZSwgVU5TVVBQT1JURURfU1RPUkFHRV9EUklWRVJTIH0gZnJvbSAnQHNoZWxsL3N0b3JlL2ZlYXR1cmVzJzsKaW1wb3J0IFJlc291cmNlTWFuYWdlciBmcm9tICdAc2hlbGwvbWl4aW5zL3Jlc291cmNlLW1hbmFnZXInOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdQZXJzaXN0ZW50Vm9sdW1lJywKCiAgY29tcG9uZW50czogewogICAgQXJyYXlMaXN0LAogICAgQXJyYXlMaXN0R3JvdXBlZCwKICAgIENoZWNrYm94LAogICAgQ3J1UmVzb3VyY2UsCiAgICBJbmZvQm94LAogICAgTGFiZWxlZFNlbGVjdCwKICAgIExvYWRpbmcsCiAgICBNYXRjaEV4cHJlc3Npb25zLAogICAgTmFtZU5zRGVzY3JpcHRpb24sCiAgICBOb2RlQWZmaW5pdHksCiAgICBUYWIsCiAgICBUYWJiZWQsCiAgICBVbml0SW5wdXQKICB9LAoKICBtaXhpbnM6IFtDcmVhdGVFZGl0VmlldywgUmVzb3VyY2VNYW5hZ2VyXSwKCiAgZmV0Y2goKSB7CiAgICBpZiAodGhpcy5tb2RlICE9PSBfQ1JFQVRFKSB7CiAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzb3VyY2VEYXRhLm5hbWVzcGFjZSA9IHRoaXMudmFsdWU/LnNwZWM/LmNsYWltUmVmPy5uYW1lc3BhY2UgfHwgbnVsbDsKCiAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzb3VyY2VEYXRhLmRhdGFbUFZDXSA9IHsKICAgICAgICBhcHBseVRvOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHZhcjogICAgICAgICAnY3VycmVudENsYWltJywKICAgICAgICAgICAgY2xhc3NpZnk6ICAgIHRydWUsCiAgICAgICAgICAgIHBhcnNpbmdGdW5jOiAoZGF0YSkgPT4gewogICAgICAgICAgICAgIHJldHVybiBkYXRhLmZpbmQoKGNsYWltKSA9PiBjbGFpbS5zcGVjLnZvbHVtZU5hbWUgPT09IHRoaXMudmFsdWUubmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICBdCiAgICAgIH07CiAgICB9CgogICAgdGhpcy5yZXNvdXJjZU1hbmFnZXJGZXRjaFNlY29uZGFyeVJlc291cmNlcyh0aGlzLnNlY29uZGFyeVJlc291cmNlRGF0YSk7CiAgfSwKCiAgZGF0YSgpIHsKICAgIGNvbnN0IE5PTkVfT1BUSU9OID0gewogICAgICBsYWJlbDogdGhpcy50KCdnZW5lcmljLm5vbmUnKSwKICAgICAgdmFsdWU6ICcnCiAgICB9OwogICAgY29uc3QgZGVmYXVsdEFjY2Vzc01vZGVzID0gWydSZWFkV3JpdGVPbmNlJ107CgogICAgdGhpcy4kc2V0KHRoaXMudmFsdWUsICdzcGVjJywgdGhpcy52YWx1ZS5zcGVjIHx8IHt9KTsKICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdhY2Nlc3NNb2RlcycsIHRoaXMudmFsdWUuc3BlYy5hY2Nlc3NNb2RlcyB8fCBkZWZhdWx0QWNjZXNzTW9kZXMpOwogICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYywgJ2NhcGFjaXR5JywgdGhpcy52YWx1ZS5zcGVjLmNhcGFjaXR5IHx8IHt9KTsKICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMuY2FwYWNpdHksICdzdG9yYWdlJywgdGhpcy52YWx1ZS5zcGVjLmNhcGFjaXR5LnN0b3JhZ2UgfHwgJzEwR2knKTsKICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdzdG9yYWdlQ2xhc3NOYW1lJywgdGhpcy52YWx1ZS5zcGVjLnN0b3JhZ2VDbGFzc05hbWUgfHwgTk9ORV9PUFRJT04udmFsdWUpOwoKICAgIGNvbnN0IGZvdW5kUGx1Z2luID0gdGhpcy52YWx1ZS5pc0xvbmdob3JuID8gTE9OR0hPUk5fUExVR0lOIDogVk9MVU1FX1BMVUdJTlMuZmluZCgocGx1Z2luKSA9PiB0aGlzLnZhbHVlLnNwZWNbcGx1Z2luLnZhbHVlXSk7CiAgICBjb25zdCBwbHVnaW4gPSAoZm91bmRQbHVnaW4gfHwgVk9MVU1FX1BMVUdJTlNbMF0pLnZhbHVlOwoKICAgIHJldHVybiB7CiAgICAgIHNlY29uZGFyeVJlc291cmNlRGF0YTogdGhpcy5zZWNvbmRhcnlSZXNvdXJjZURhdGFDb25maWcoKSwKICAgICAgc3RvcmFnZUNsYXNzT3B0aW9uczogICBbXSwKICAgICAgY3VycmVudENsYWltOiAgICAgICAgICBudWxsLAogICAgICBwbHVnaW4sCiAgICAgIE5PTkVfT1BUSU9OLAogICAgICBOT0RFLAogICAgICBpbml0aWFsTm9kZUFmZmluaXR5OiAgIGNsb25lKHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHkpLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgc2hvd1Vuc3VwcG9ydGVkU3RvcmFnZTogbWFwRmVhdHVyZShVTlNVUFBPUlRFRF9TVE9SQUdFX0RSSVZFUlMpLAogICAgLi4ubWFwR2V0dGVycyhbJ2N1cnJlbnRQcm9kdWN0JywgJ2N1cnJlbnRDbHVzdGVyJ10pLAoKICAgIHJlYWRXcml0ZU9uY2U6IHsKICAgICAgZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwZWMuYWNjZXNzTW9kZXMuaW5jbHVkZXMoJ1JlYWRXcml0ZU9uY2UnKTsKICAgICAgfSwKICAgICAgc2V0KHZhbHVlKSB7CiAgICAgICAgdGhpcy5jaGVja2JveFNldHRlcignUmVhZFdyaXRlT25jZScsIHZhbHVlKTsKICAgICAgfQogICAgfSwKICAgIHJlYWRPbmx5TWFueTogewogICAgICBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUuc3BlYy5hY2Nlc3NNb2Rlcy5pbmNsdWRlcygnUmVhZE9ubHlNYW55Jyk7CiAgICAgIH0sCiAgICAgIHNldCh2YWx1ZSkgewogICAgICAgIHRoaXMuY2hlY2tib3hTZXR0ZXIoJ1JlYWRPbmx5TWFueScsIHZhbHVlKTsKICAgICAgfQogICAgfSwKICAgIHJlYWRXcml0ZU1hbnk6IHsKICAgICAgZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwZWMuYWNjZXNzTW9kZXMuaW5jbHVkZXMoJ1JlYWRXcml0ZU1hbnknKTsKICAgICAgfSwKICAgICAgc2V0KHZhbHVlKSB7CiAgICAgICAgdGhpcy5jaGVja2JveFNldHRlcignUmVhZFdyaXRlTWFueScsIHZhbHVlKTsKICAgICAgfQogICAgfSwKICAgIG1vZGVPdmVycmlkZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNDcmVhdGUgPyBfQ1JFQVRFIDogX1ZJRVc7CiAgICB9LAogICAgbm9kZVNlbGVjdG9yVGVybXM6IHsKICAgICAgZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwZWMubm9kZUFmZmluaXR5Py5yZXF1aXJlZD8ubm9kZVNlbGVjdG9yVGVybXMgfHwgW107CiAgICAgIH0sCiAgICAgIHNldCh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB7IHJlcXVpcmVkOiB7IG5vZGVTZWxlY3RvclRlcm1zOiBbXSB9IH07CgogICAgICAgICAgaWYgKCF0aGlzLnZhbHVlLnNwZWMubm9kZUFmZmluaXR5Py5yZXF1aXJlZD8ubm9kZVNlbGVjdG9yVGVybXMpIHsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYywgJ25vZGVBZmZpbml0eScsIHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHkgfHwgZGVmYXVsdFZhbHVlKTsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHksICdyZXF1aXJlZCcsIHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHkucmVxdWlyZWQgfHwgZGVmYXVsdFZhbHVlLnJlcXVpcmVkKTsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHkucmVxdWlyZWQsICdub2RlU2VsZWN0b3JUZXJtcycsIHRoaXMudmFsdWUuc3BlYy5ub2RlQWZmaW5pdHkucmVxdWlyZWQubm9kZVNlbGVjdG9yVGVybXMgfHwgZGVmYXVsdFZhbHVlLnJlcXVpcmVkLm5vZGVTZWxlY3RvclRlcm1zKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZS5zcGVjLm5vZGVBZmZpbml0eS5yZXF1aXJlZCwgJ25vZGVTZWxlY3RvclRlcm1zJywgdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZS5zcGVjLm5vZGVBZmZpbml0eSwgJ25vZGVBZmZpbml0eScsIHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYXJlTm9kZVNlbGVjdG9yc1JlcXVpcmVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbHVnaW4gPT09ICdsb2NhbCc7CiAgICB9LAogICAgcGx1Z2lucygpIHsKICAgICAgcmV0dXJuIFZPTFVNRV9QTFVHSU5TLmZpbHRlcigocGx1Z2luKSA9PiB0aGlzLnNob3dVbnN1cHBvcnRlZFN0b3JhZ2UgfHwgcGx1Z2luLnN1cHBvcnRlZCk7CiAgICB9CiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMucmVnaXN0ZXJCZWZvcmVIb29rKHRoaXMud2lsbFNhdmUsICd3aWxsU2F2ZScpOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNlY29uZGFyeVJlc291cmNlRGF0YUNvbmZpZygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lc3BhY2U6IG51bGwsCiAgICAgICAgZGF0YTogICAgICB7CiAgICAgICAgICBbU1RPUkFHRV9DTEFTU106IHsKICAgICAgICAgICAgYXBwbHlUbzogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhcjogICAgICAgICAnc3RvcmFnZUNsYXNzT3B0aW9ucycsCiAgICAgICAgICAgICAgICBwYXJzaW5nRnVuYzogKGRhdGEpID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmFnZUNsYXNzT3B0aW9ucyA9IGRhdGEubWFwKChzKSA9PiAoewogICAgICAgICAgICAgICAgICAgIGxhYmVsOiBzLm1ldGFkYXRhLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHMubWV0YWRhdGEubmFtZQogICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICBzdG9yYWdlQ2xhc3NPcHRpb25zLnVuc2hpZnQodGhpcy5OT05FX09QVElPTik7CgogICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcmFnZUNsYXNzT3B0aW9uczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIGNoZWNrYm94U2V0dGVyKGtleSwgdmFsdWUpIHsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgdGhpcy52YWx1ZS5zcGVjLmFjY2Vzc01vZGVzLnB1c2goa2V5KTsKICAgICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZSwgJ2FjY2Vzc01vZGVzJywgdW5pcSh0aGlzLnZhbHVlLnNwZWMuYWNjZXNzTW9kZXMpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBpbmRleE9mID0gdGhpcy52YWx1ZS5zcGVjLmFjY2Vzc01vZGVzLmluZGV4T2Yoa2V5KTsKCiAgICAgICAgaWYgKGluZGV4T2YgPj0gMCkgewogICAgICAgICAgdGhpcy52YWx1ZS5zcGVjLmFjY2Vzc01vZGVzLnNwbGljZShpbmRleE9mLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZXRDb21wb25lbnQobmFtZSkgewogICAgICByZXR1cm4gcmVxdWlyZShgLi9wbHVnaW5zLyR7IG5hbWUgfWApLmRlZmF1bHQ7CiAgICB9LAogICAgd2lsbFNhdmUoKSB7CiAgICAgIGlmICh0aGlzLnZhbHVlLnNwZWMuc3RvcmFnZUNsYXNzTmFtZSA9PT0gdGhpcy5OT05FX09QVElPTi52YWx1ZSkgewogICAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdzdG9yYWdlQ2xhc3NOYW1lJywgbnVsbCk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5pc0NyZWF0ZSkgewogICAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdub2RlQWZmaW5pdHknLCB0aGlzLmluaXRpYWxOb2RlQWZmaW5pdHkpOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlUGx1Z2luKHZhbHVlKSB7CiAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMucGx1Z2luID09PSBMT05HSE9STl9QTFVHSU4udmFsdWUgPyAnY3NpJyA6IHRoaXMucGx1Z2luOwoKICAgICAgZGVsZXRlIHRoaXMudmFsdWUuc3BlY1twbHVnaW5dOwogICAgICB0aGlzLiRzZXQodGhpcywgJ3BsdWdpbicsIHZhbHVlKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/persistentvolume","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport CruResource from '@shell/components/CruResource';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport MatchExpressions from '@shell/components/form/MatchExpressions';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport Tabbed from '@shell/components/Tabbed';\nimport NodeAffinity from '@shell/components/form/NodeAffinity';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport uniq from 'lodash/uniq';\nimport UnitInput from '@shell/components/form/UnitInput';\nimport { VOLUME_PLUGINS, LONGHORN_PLUGIN } from '@shell/config/persistentVolume';\nimport { NODE, PVC, STORAGE_CLASS } from '@shell/config/types';\nimport Loading from '@shell/components/Loading';\nimport { _CREATE, _VIEW } from '@shell/config/query-params';\nimport { clone } from '@shell/utils/object';\nimport InfoBox from '@shell/components/InfoBox';\nimport { mapFeature, UNSUPPORTED_STORAGE_DRIVERS } from '@shell/store/features';\nimport ResourceManager from '@shell/mixins/resource-manager';\n\nexport default {\n  name: 'PersistentVolume',\n\n  components: {\n    ArrayList,\n    ArrayListGrouped,\n    Checkbox,\n    CruResource,\n    InfoBox,\n    LabeledSelect,\n    Loading,\n    MatchExpressions,\n    NameNsDescription,\n    NodeAffinity,\n    Tab,\n    Tabbed,\n    UnitInput\n  },\n\n  mixins: [CreateEditView, ResourceManager],\n\n  fetch() {\n    if (this.mode !== _CREATE) {\n      this.secondaryResourceData.namespace = this.value?.spec?.claimRef?.namespace || null;\n\n      this.secondaryResourceData.data[PVC] = {\n        applyTo: [\n          {\n            var:         'currentClaim',\n            classify:    true,\n            parsingFunc: (data) => {\n              return data.find((claim) => claim.spec.volumeName === this.value.name);\n            }\n          }\n        ]\n      };\n    }\n\n    this.resourceManagerFetchSecondaryResources(this.secondaryResourceData);\n  },\n\n  data() {\n    const NONE_OPTION = {\n      label: this.t('generic.none'),\n      value: ''\n    };\n    const defaultAccessModes = ['ReadWriteOnce'];\n\n    this.$set(this.value, 'spec', this.value.spec || {});\n    this.$set(this.value.spec, 'accessModes', this.value.spec.accessModes || defaultAccessModes);\n    this.$set(this.value.spec, 'capacity', this.value.spec.capacity || {});\n    this.$set(this.value.spec.capacity, 'storage', this.value.spec.capacity.storage || '10Gi');\n    this.$set(this.value.spec, 'storageClassName', this.value.spec.storageClassName || NONE_OPTION.value);\n\n    const foundPlugin = this.value.isLonghorn ? LONGHORN_PLUGIN : VOLUME_PLUGINS.find((plugin) => this.value.spec[plugin.value]);\n    const plugin = (foundPlugin || VOLUME_PLUGINS[0]).value;\n\n    return {\n      secondaryResourceData: this.secondaryResourceDataConfig(),\n      storageClassOptions:   [],\n      currentClaim:          null,\n      plugin,\n      NONE_OPTION,\n      NODE,\n      initialNodeAffinity:   clone(this.value.spec.nodeAffinity),\n    };\n  },\n\n  computed: {\n    showUnsupportedStorage: mapFeature(UNSUPPORTED_STORAGE_DRIVERS),\n    ...mapGetters(['currentProduct', 'currentCluster']),\n\n    readWriteOnce: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadWriteOnce');\n      },\n      set(value) {\n        this.checkboxSetter('ReadWriteOnce', value);\n      }\n    },\n    readOnlyMany: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadOnlyMany');\n      },\n      set(value) {\n        this.checkboxSetter('ReadOnlyMany', value);\n      }\n    },\n    readWriteMany: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadWriteMany');\n      },\n      set(value) {\n        this.checkboxSetter('ReadWriteMany', value);\n      }\n    },\n    modeOverride() {\n      return this.isCreate ? _CREATE : _VIEW;\n    },\n    nodeSelectorTerms: {\n      get() {\n        return this.value.spec.nodeAffinity?.required?.nodeSelectorTerms || [];\n      },\n      set(value) {\n        if (value.length > 0) {\n          const defaultValue = { required: { nodeSelectorTerms: [] } };\n\n          if (!this.value.spec.nodeAffinity?.required?.nodeSelectorTerms) {\n            this.$set(this.value.spec, 'nodeAffinity', this.value.spec.nodeAffinity || defaultValue);\n            this.$set(this.value.spec.nodeAffinity, 'required', this.value.spec.nodeAffinity.required || defaultValue.required);\n            this.$set(this.value.spec.nodeAffinity.required, 'nodeSelectorTerms', this.value.spec.nodeAffinity.required.nodeSelectorTerms || defaultValue.required.nodeSelectorTerms);\n          }\n\n          this.$set(this.value.spec.nodeAffinity.required, 'nodeSelectorTerms', value);\n        } else {\n          this.$set(this.value.spec.nodeAffinity, 'nodeAffinity', undefined);\n        }\n      }\n    },\n    areNodeSelectorsRequired() {\n      return this.plugin === 'local';\n    },\n    plugins() {\n      return VOLUME_PLUGINS.filter((plugin) => this.showUnsupportedStorage || plugin.supported);\n    }\n  },\n\n  created() {\n    this.registerBeforeHook(this.willSave, 'willSave');\n  },\n\n  methods: {\n    secondaryResourceDataConfig() {\n      return {\n        namespace: null,\n        data:      {\n          [STORAGE_CLASS]: {\n            applyTo: [\n              {\n                var:         'storageClassOptions',\n                parsingFunc: (data) => {\n                  const storageClassOptions = data.map((s) => ({\n                    label: s.metadata.name,\n                    value: s.metadata.name\n                  }));\n\n                  storageClassOptions.unshift(this.NONE_OPTION);\n\n                  return storageClassOptions;\n                }\n              }\n            ]\n          },\n        }\n      };\n    },\n    checkboxSetter(key, value) {\n      if (value) {\n        this.value.spec.accessModes.push(key);\n        this.$set(this.value, 'accessModes', uniq(this.value.spec.accessModes));\n      } else {\n        const indexOf = this.value.spec.accessModes.indexOf(key);\n\n        if (indexOf >= 0) {\n          this.value.spec.accessModes.splice(indexOf, 1);\n        }\n      }\n    },\n    getComponent(name) {\n      return require(`./plugins/${ name }`).default;\n    },\n    willSave() {\n      if (this.value.spec.storageClassName === this.NONE_OPTION.value) {\n        this.$set(this.value.spec, 'storageClassName', null);\n      }\n\n      if (!this.isCreate) {\n        this.$set(this.value.spec, 'nodeAffinity', this.initialNodeAffinity);\n      }\n    },\n    updatePlugin(value) {\n      const plugin = this.plugin === LONGHORN_PLUGIN.value ? 'csi' : this.plugin;\n\n      delete this.value.spec[plugin];\n      this.$set(this, 'plugin', value);\n    }\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <CruResource\n    v-else\n    :done-route=\"doneRoute\"\n    :mode=\"mode\"\n    :resource=\"value\"\n    :subtypes=\"[]\"\n    :validation-passed=\"true\"\n    :errors=\"errors\"\n    @error=\"e=>errors = e\"\n    @finish=\"save\"\n    @cancel=\"done\"\n  >\n    <NameNsDescription\n      :value=\"value\"\n      :mode=\"mode\"\n      :register-before-hook=\"registerBeforeHook\"\n      :namespaced=\"false\"\n    />\n\n    <InfoBox v-if=\"currentClaim\">\n      <div class=\"row\">\n        <div class=\"col span-6 text-center\">\n          <label class=\"text-muted\">Persistent Volume Claim:</label>&nbsp;\n          <n-link :to=\"currentClaim.detailLocation\">\n            {{ currentClaim.namespacedName }}\n          </n-link>\n        </div>\n        <div class=\"col span-6 text-center\">\n          <label class=\"text-muted\">Age:</label>&nbsp;\n          <LiveDate\n            class=\"live-date\"\n            :value=\"value.metadata.creationTimestamp\"\n          />\n        </div>\n      </div>\n    </InfoBox>\n\n    <div class=\"row mb-20 top-level\">\n      <div class=\"col span-6\">\n        <LabeledSelect\n          :value=\"plugin\"\n          :label=\"t('persistentVolume.plugin.label')\"\n          :localized-label=\"true\"\n          option-label=\"labelKey\"\n          data-testid=\"persistent-volume-plugin-select\"\n          :options=\"plugins\"\n          :mode=\"modeOverride\"\n          :required=\"true\"\n          @input=\"updatePlugin($event)\"\n        />\n      </div>\n      <div class=\"col span-6\">\n        <UnitInput\n          v-model=\"value.spec.capacity.storage\"\n          :required=\"true\"\n          :label=\"t('persistentVolume.capacity.label')\"\n          :increment=\"1024\"\n          :input-exponent=\"3\"\n          :output-modifier=\"true\"\n          :mode=\"mode\"\n        />\n      </div>\n    </div>\n    <Tabbed :side-tabs=\"true\">\n      <Tab\n        name=\"plugin-configuration\"\n        :label=\"t('persistentVolume.pluginConfiguration.label')\"\n        :weight=\"1\"\n      >\n        <component\n          :is=\"getComponent(plugin)\"\n          :key=\"plugin\"\n          :value=\"value\"\n          :mode=\"modeOverride\"\n        />\n      </Tab>\n      <Tab\n        name=\"customize\"\n        :label=\"t('persistentVolume.customize.label')\"\n        :weight=\"0\"\n      >\n        <div class=\"row mb-20\">\n          <div class=\"col span-6\">\n            <h3>{{ t('persistentVolume.customize.accessModes.label') }}</h3>\n            <div>\n              <Checkbox\n                v-model=\"readWriteOnce\"\n                :label=\"t('persistentVolume.customize.accessModes.readWriteOnce')\"\n                :mode=\"mode\"\n              />\n            </div>\n            <div>\n              <Checkbox\n                v-model=\"readOnlyMany\"\n                :label=\"t('persistentVolume.customize.accessModes.readOnlyMany')\"\n                :mode=\"mode\"\n              />\n            </div>\n            <div>\n              <Checkbox\n                v-model=\"readWriteMany\"\n                :label=\"t('persistentVolume.customize.accessModes.readWriteMany')\"\n                :mode=\"mode\"\n              />\n            </div>\n          </div>\n          <div class=\"col span-6\">\n            <ArrayList\n              v-model=\"value.spec.mountOptions\"\n              :mode=\"mode\"\n              :title=\"t('persistentVolume.customize.mountOptions.label')\"\n              :add-label=\"t('persistentVolume.customize.mountOptions.addLabel')\"\n            />\n          </div>\n        </div>\n        <div class=\"row mb-20\">\n          <div class=\"col span-6\">\n            <LabeledSelect\n              v-model=\"value.spec.storageClassName\"\n              :label=\"t('persistentVolume.customize.assignToStorageClass.label')\"\n              :options=\"storageClassOptions\"\n              :loading=\"isLoadingSecondaryResources\"\n            />\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col span-12\">\n            <h3>\n              {{ t('persistentVolume.customize.affinity.label') }} <span\n                v-if=\"areNodeSelectorsRequired\"\n                class=\"required text-small\"\n              >*</span>\n            </h3>\n            <ArrayListGrouped\n              v-model=\"nodeSelectorTerms\"\n              :mode=\"modeOverride\"\n              :default-add-value=\"{matchExpressions:[]}\"\n              :add-label=\"t('workload.scheduling.affinity.addNodeSelector')\"\n            >\n              <template #default=\"props\">\n                <MatchExpressions\n                  v-model=\"props.row.value.matchExpressions\"\n                  :mode=\"modeOverride\"\n                  class=\"col span-12\"\n                  :type=\"NODE\"\n                  :show-remove=\"false\"\n                />\n              </template>\n            </ArrayListGrouped>\n          </div>\n        </div>\n      </Tab>\n    </Tabbed>\n  </CruResource>\n</template>\n<style lang=\"scss\" scoped>\n.top-level .col > .labeled-select:not(.taggable) {\n  max-height: 100%;\n  height: 100%;\n}\n.info-box {\n  flex-grow: 0;\n}\n</style>\n"]}]}
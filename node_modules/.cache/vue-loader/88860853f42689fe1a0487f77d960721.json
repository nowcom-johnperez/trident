{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/persistentvolume/index.vue?vue&type=style&index=0&id=c014323a&lang=scss&scoped=true","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/persistentvolume/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1716430467357},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1716430467929},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/postcss-loader/src/index.js","mtime":1716430467882},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/sass-loader/dist/cjs.js","mtime":1716430453705},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50b3AtbGV2ZWwgLmNvbCA+IC5sYWJlbGVkLXNlbGVjdDpub3QoLnRhZ2dhYmxlKSB7CiAgbWF4LWhlaWdodDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7Cn0KLmluZm8tYm94IHsKICBmbGV4LWdyb3c6IDA7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAoXA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/persistentvolume","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport CruResource from '@shell/components/CruResource';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport MatchExpressions from '@shell/components/form/MatchExpressions';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport Tabbed from '@shell/components/Tabbed';\nimport NodeAffinity from '@shell/components/form/NodeAffinity';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport uniq from 'lodash/uniq';\nimport UnitInput from '@shell/components/form/UnitInput';\nimport { VOLUME_PLUGINS, LONGHORN_PLUGIN } from '@shell/config/persistentVolume';\nimport { NODE, PVC, STORAGE_CLASS } from '@shell/config/types';\nimport Loading from '@shell/components/Loading';\nimport { _CREATE, _VIEW } from '@shell/config/query-params';\nimport { clone } from '@shell/utils/object';\nimport InfoBox from '@shell/components/InfoBox';\nimport { mapFeature, UNSUPPORTED_STORAGE_DRIVERS } from '@shell/store/features';\nimport ResourceManager from '@shell/mixins/resource-manager';\n\nexport default {\n  name: 'PersistentVolume',\n\n  components: {\n    ArrayList,\n    ArrayListGrouped,\n    Checkbox,\n    CruResource,\n    InfoBox,\n    LabeledSelect,\n    Loading,\n    MatchExpressions,\n    NameNsDescription,\n    NodeAffinity,\n    Tab,\n    Tabbed,\n    UnitInput\n  },\n\n  mixins: [CreateEditView, ResourceManager],\n\n  fetch() {\n    if (this.mode !== _CREATE) {\n      this.secondaryResourceData.namespace = this.value?.spec?.claimRef?.namespace || null;\n\n      this.secondaryResourceData.data[PVC] = {\n        applyTo: [\n          {\n            var:         'currentClaim',\n            classify:    true,\n            parsingFunc: (data) => {\n              return data.find((claim) => claim.spec.volumeName === this.value.name);\n            }\n          }\n        ]\n      };\n    }\n\n    this.resourceManagerFetchSecondaryResources(this.secondaryResourceData);\n  },\n\n  data() {\n    const NONE_OPTION = {\n      label: this.t('generic.none'),\n      value: ''\n    };\n    const defaultAccessModes = ['ReadWriteOnce'];\n\n    this.$set(this.value, 'spec', this.value.spec || {});\n    this.$set(this.value.spec, 'accessModes', this.value.spec.accessModes || defaultAccessModes);\n    this.$set(this.value.spec, 'capacity', this.value.spec.capacity || {});\n    this.$set(this.value.spec.capacity, 'storage', this.value.spec.capacity.storage || '10Gi');\n    this.$set(this.value.spec, 'storageClassName', this.value.spec.storageClassName || NONE_OPTION.value);\n\n    const foundPlugin = this.value.isLonghorn ? LONGHORN_PLUGIN : VOLUME_PLUGINS.find((plugin) => this.value.spec[plugin.value]);\n    const plugin = (foundPlugin || VOLUME_PLUGINS[0]).value;\n\n    return {\n      secondaryResourceData: this.secondaryResourceDataConfig(),\n      storageClassOptions:   [],\n      currentClaim:          null,\n      plugin,\n      NONE_OPTION,\n      NODE,\n      initialNodeAffinity:   clone(this.value.spec.nodeAffinity),\n    };\n  },\n\n  computed: {\n    showUnsupportedStorage: mapFeature(UNSUPPORTED_STORAGE_DRIVERS),\n    ...mapGetters(['currentProduct', 'currentCluster']),\n\n    readWriteOnce: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadWriteOnce');\n      },\n      set(value) {\n        this.checkboxSetter('ReadWriteOnce', value);\n      }\n    },\n    readOnlyMany: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadOnlyMany');\n      },\n      set(value) {\n        this.checkboxSetter('ReadOnlyMany', value);\n      }\n    },\n    readWriteMany: {\n      get() {\n        return this.value.spec.accessModes.includes('ReadWriteMany');\n      },\n      set(value) {\n        this.checkboxSetter('ReadWriteMany', value);\n      }\n    },\n    modeOverride() {\n      return this.isCreate ? _CREATE : _VIEW;\n    },\n    nodeSelectorTerms: {\n      get() {\n        return this.value.spec.nodeAffinity?.required?.nodeSelectorTerms || [];\n      },\n      set(value) {\n        if (value.length > 0) {\n          const defaultValue = { required: { nodeSelectorTerms: [] } };\n\n          if (!this.value.spec.nodeAffinity?.required?.nodeSelectorTerms) {\n            this.$set(this.value.spec, 'nodeAffinity', this.value.spec.nodeAffinity || defaultValue);\n            this.$set(this.value.spec.nodeAffinity, 'required', this.value.spec.nodeAffinity.required || defaultValue.required);\n            this.$set(this.value.spec.nodeAffinity.required, 'nodeSelectorTerms', this.value.spec.nodeAffinity.required.nodeSelectorTerms || defaultValue.required.nodeSelectorTerms);\n          }\n\n          this.$set(this.value.spec.nodeAffinity.required, 'nodeSelectorTerms', value);\n        } else {\n          this.$set(this.value.spec.nodeAffinity, 'nodeAffinity', undefined);\n        }\n      }\n    },\n    areNodeSelectorsRequired() {\n      return this.plugin === 'local';\n    },\n    plugins() {\n      return VOLUME_PLUGINS.filter((plugin) => this.showUnsupportedStorage || plugin.supported);\n    }\n  },\n\n  created() {\n    this.registerBeforeHook(this.willSave, 'willSave');\n  },\n\n  methods: {\n    secondaryResourceDataConfig() {\n      return {\n        namespace: null,\n        data:      {\n          [STORAGE_CLASS]: {\n            applyTo: [\n              {\n                var:         'storageClassOptions',\n                parsingFunc: (data) => {\n                  const storageClassOptions = data.map((s) => ({\n                    label: s.metadata.name,\n                    value: s.metadata.name\n                  }));\n\n                  storageClassOptions.unshift(this.NONE_OPTION);\n\n                  return storageClassOptions;\n                }\n              }\n            ]\n          },\n        }\n      };\n    },\n    checkboxSetter(key, value) {\n      if (value) {\n        this.value.spec.accessModes.push(key);\n        this.$set(this.value, 'accessModes', uniq(this.value.spec.accessModes));\n      } else {\n        const indexOf = this.value.spec.accessModes.indexOf(key);\n\n        if (indexOf >= 0) {\n          this.value.spec.accessModes.splice(indexOf, 1);\n        }\n      }\n    },\n    getComponent(name) {\n      return require(`./plugins/${ name }`).default;\n    },\n    willSave() {\n      if (this.value.spec.storageClassName === this.NONE_OPTION.value) {\n        this.$set(this.value.spec, 'storageClassName', null);\n      }\n\n      if (!this.isCreate) {\n        this.$set(this.value.spec, 'nodeAffinity', this.initialNodeAffinity);\n      }\n    },\n    updatePlugin(value) {\n      const plugin = this.plugin === LONGHORN_PLUGIN.value ? 'csi' : this.plugin;\n\n      delete this.value.spec[plugin];\n      this.$set(this, 'plugin', value);\n    }\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <CruResource\n    v-else\n    :done-route=\"doneRoute\"\n    :mode=\"mode\"\n    :resource=\"value\"\n    :subtypes=\"[]\"\n    :validation-passed=\"true\"\n    :errors=\"errors\"\n    @error=\"e=>errors = e\"\n    @finish=\"save\"\n    @cancel=\"done\"\n  >\n    <NameNsDescription\n      :value=\"value\"\n      :mode=\"mode\"\n      :register-before-hook=\"registerBeforeHook\"\n      :namespaced=\"false\"\n    />\n\n    <InfoBox v-if=\"currentClaim\">\n      <div class=\"row\">\n        <div class=\"col span-6 text-center\">\n          <label class=\"text-muted\">Persistent Volume Claim:</label>&nbsp;\n          <n-link :to=\"currentClaim.detailLocation\">\n            {{ currentClaim.namespacedName }}\n          </n-link>\n        </div>\n        <div class=\"col span-6 text-center\">\n          <label class=\"text-muted\">Age:</label>&nbsp;\n          <LiveDate\n            class=\"live-date\"\n            :value=\"value.metadata.creationTimestamp\"\n          />\n        </div>\n      </div>\n    </InfoBox>\n\n    <div class=\"row mb-20 top-level\">\n      <div class=\"col span-6\">\n        <LabeledSelect\n          :value=\"plugin\"\n          :label=\"t('persistentVolume.plugin.label')\"\n          :localized-label=\"true\"\n          option-label=\"labelKey\"\n          data-testid=\"persistent-volume-plugin-select\"\n          :options=\"plugins\"\n          :mode=\"modeOverride\"\n          :required=\"true\"\n          @input=\"updatePlugin($event)\"\n        />\n      </div>\n      <div class=\"col span-6\">\n        <UnitInput\n          v-model=\"value.spec.capacity.storage\"\n          :required=\"true\"\n          :label=\"t('persistentVolume.capacity.label')\"\n          :increment=\"1024\"\n          :input-exponent=\"3\"\n          :output-modifier=\"true\"\n          :mode=\"mode\"\n        />\n      </div>\n    </div>\n    <Tabbed :side-tabs=\"true\">\n      <Tab\n        name=\"plugin-configuration\"\n        :label=\"t('persistentVolume.pluginConfiguration.label')\"\n        :weight=\"1\"\n      >\n        <component\n          :is=\"getComponent(plugin)\"\n          :key=\"plugin\"\n          :value=\"value\"\n          :mode=\"modeOverride\"\n        />\n      </Tab>\n      <Tab\n        name=\"customize\"\n        :label=\"t('persistentVolume.customize.label')\"\n        :weight=\"0\"\n      >\n        <div class=\"row mb-20\">\n          <div class=\"col span-6\">\n            <h3>{{ t('persistentVolume.customize.accessModes.label') }}</h3>\n            <div>\n              <Checkbox\n                v-model=\"readWriteOnce\"\n                :label=\"t('persistentVolume.customize.accessModes.readWriteOnce')\"\n                :mode=\"mode\"\n              />\n            </div>\n            <div>\n              <Checkbox\n                v-model=\"readOnlyMany\"\n                :label=\"t('persistentVolume.customize.accessModes.readOnlyMany')\"\n                :mode=\"mode\"\n              />\n            </div>\n            <div>\n              <Checkbox\n                v-model=\"readWriteMany\"\n                :label=\"t('persistentVolume.customize.accessModes.readWriteMany')\"\n                :mode=\"mode\"\n              />\n            </div>\n          </div>\n          <div class=\"col span-6\">\n            <ArrayList\n              v-model=\"value.spec.mountOptions\"\n              :mode=\"mode\"\n              :title=\"t('persistentVolume.customize.mountOptions.label')\"\n              :add-label=\"t('persistentVolume.customize.mountOptions.addLabel')\"\n            />\n          </div>\n        </div>\n        <div class=\"row mb-20\">\n          <div class=\"col span-6\">\n            <LabeledSelect\n              v-model=\"value.spec.storageClassName\"\n              :label=\"t('persistentVolume.customize.assignToStorageClass.label')\"\n              :options=\"storageClassOptions\"\n              :loading=\"isLoadingSecondaryResources\"\n            />\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col span-12\">\n            <h3>\n              {{ t('persistentVolume.customize.affinity.label') }} <span\n                v-if=\"areNodeSelectorsRequired\"\n                class=\"required text-small\"\n              >*</span>\n            </h3>\n            <ArrayListGrouped\n              v-model=\"nodeSelectorTerms\"\n              :mode=\"modeOverride\"\n              :default-add-value=\"{matchExpressions:[]}\"\n              :add-label=\"t('workload.scheduling.affinity.addNodeSelector')\"\n            >\n              <template #default=\"props\">\n                <MatchExpressions\n                  v-model=\"props.row.value.matchExpressions\"\n                  :mode=\"modeOverride\"\n                  class=\"col span-12\"\n                  :type=\"NODE\"\n                  :show-remove=\"false\"\n                />\n              </template>\n            </ArrayListGrouped>\n          </div>\n        </div>\n      </Tab>\n    </Tabbed>\n  </CruResource>\n</template>\n<style lang=\"scss\" scoped>\n.top-level .col > .labeled-select:not(.taggable) {\n  max-height: 100%;\n  height: 100%;\n}\n.info-box {\n  flex-grow: 0;\n}\n</style>\n"]}]}
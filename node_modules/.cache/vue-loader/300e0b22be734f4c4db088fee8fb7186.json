{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/AssignTo.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/AssignTo.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcFN0YXRlLCBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IEZMRUVULCBOT1JNQU4gfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IExhYmVsZWRTZWxlY3QgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9MYWJlbGVkU2VsZWN0JzsKaW1wb3J0IEtleVZhbHVlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vS2V5VmFsdWUnOwppbXBvcnQgQXN5bmNCdXR0b24gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQXN5bmNCdXR0b24nOwppbXBvcnQgeyBDYXJkIH0gZnJvbSAnQGNvbXBvbmVudHMvQ2FyZCc7CmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCB7IGV4Y2VwdGlvblRvRXJyb3JzQXJyYXkgfSBmcm9tICdAc2hlbGwvdXRpbHMvZXJyb3InOwppbXBvcnQgeyBzZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBDYXJkLAogICAgTGFiZWxlZFNlbGVjdCwKICAgIEtleVZhbHVlLAogICAgQXN5bmNCdXR0b24sCiAgICBCYW5uZXIsCiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yczogICAgICAgIFtdLAogICAgICBsYWJlbHM6ICAgICAgICB7fSwKICAgICAgbW92ZVRvOiAgICAgICAgdGhpcy53b3Jrc3BhY2UsCiAgICAgIGxvYWRlZDogICAgICAgIGZhbHNlLAogICAgICBhbGxXb3Jrc3BhY2VzOiBbXSwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKCdhY3Rpb24tbWVudScsIFsnc2hvd0Fzc2lnblRvJywgJ3RvQXNzaWduJ10pLAogICAgLi4ubWFwR2V0dGVycyh7IHQ6ICdpMThuL3QnIH0pLAogICAgLi4ubWFwR2V0dGVycyhbJ3dvcmtzcGFjZSddKSwKCiAgICB3b3Jrc3BhY2VPcHRpb25zKCkgewogICAgICBjb25zdCBvdXQgPSB0aGlzLmFsbFdvcmtzcGFjZXMubWFwKCh4KSA9PiB4Lm1ldGFkYXRhPy5uYW1lKS5maWx0ZXIoKHgpID0+ICEheCAmJiB4ICE9PSAnZmxlZXQtbG9jYWwnKTsKCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIHJlc291cmNlQ291bnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnRvQXNzaWduPy5sZW5ndGggfHwgMDsKICAgIH0KICB9LAoKICB3YXRjaDogewogICAgYXN5bmMgc2hvd0Fzc2lnblRvKHNob3cpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncmFuY2hlci9maW5kQWxsJywgeyB0eXBlOiBOT1JNQU4uQ0xVU1RFUiB9KTsKICAgICAgICB0aGlzLmFsbFdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBGTEVFVC5XT1JLU1BBQ0UgfSk7CiAgICAgICAgdGhpcy5tb3ZlVG8gPSB0aGlzLndvcmtzcGFjZTsKICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7CiAgICAgICAgdGhpcy4kbW9kYWwuc2hvdygnYXNzaWduVG8nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRtb2RhbC5oaWRlKCdhc3NpZ25UbycpOwogICAgICB9CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgY2xvc2UoKSB7CiAgICAgIHRoaXMuZXJyb3JzID0gW107CiAgICAgIHRoaXMubGFiZWxzID0ge307CiAgICAgIHRoaXMubW92ZVRvID0gdGhpcy53b3Jrc3BhY2U7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnYWN0aW9uLW1lbnUvdG9nZ2xlQXNzaWduVG8nKTsKICAgIH0sCgogICAgYXN5bmMgYXBwbHkoYnV0dG9uRG9uZSkgewogICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwoKICAgICAgdGhpcy5lcnJvcnMgPSBbXTsKCiAgICAgIGZvciAoIGNvbnN0IGZsZWV0Q2x1c3RlciBvZiB0aGlzLnRvQXNzaWduICkgewogICAgICAgIGNvbnN0IGMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaChgcmFuY2hlci9jbG9uZWAsIHsgcmVzb3VyY2U6IGZsZWV0Q2x1c3Rlci5ub3JtYW4gfSk7CgogICAgICAgIGlmICggIWMgKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGMuZmxlZXRXb3Jrc3BhY2VOYW1lID0gdGhpcy5tb3ZlVG87CgogICAgICAgIGZvciAoIGNvbnN0IGsgb2YgT2JqZWN0LmtleXModGhpcy5sYWJlbHMpICkgewogICAgICAgICAgaWYgKCAhYy5fbGFiZWxzICkgewogICAgICAgICAgICBzZXQoYywgJ19sYWJlbHMnLCB7fSk7CiAgICAgICAgICB9CgogICAgICAgICAgc2V0KGMuX2xhYmVscywgaywgdGhpcy5sYWJlbHNba10pOwogICAgICAgIH0KCiAgICAgICAgcHJvbWlzZXMucHVzaChjLnNhdmUoKSk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICAgIGJ1dHRvbkRvbmUodHJ1ZSk7CiAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBleGNlcHRpb25Ub0Vycm9yc0FycmF5KGUpOwogICAgICAgIGJ1dHRvbkRvbmUoZmFsc2UpOwogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["AssignTo.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AssignTo.vue","sourceRoot":"node_modules/@rancher/shell/components","sourcesContent":["<script>\nimport { mapState, mapGetters } from 'vuex';\nimport { FLEET, NORMAN } from '@shell/config/types';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport KeyValue from '@shell/components/form/KeyValue';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Card } from '@components/Card';\nimport { Banner } from '@components/Banner';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport { set } from '@shell/utils/object';\n\nexport default {\n  components: {\n    Card,\n    LabeledSelect,\n    KeyValue,\n    AsyncButton,\n    Banner,\n  },\n\n  data() {\n    return {\n      errors:        [],\n      labels:        {},\n      moveTo:        this.workspace,\n      loaded:        false,\n      allWorkspaces: [],\n    };\n  },\n\n  computed: {\n    ...mapState('action-menu', ['showAssignTo', 'toAssign']),\n    ...mapGetters({ t: 'i18n/t' }),\n    ...mapGetters(['workspace']),\n\n    workspaceOptions() {\n      const out = this.allWorkspaces.map((x) => x.metadata?.name).filter((x) => !!x && x !== 'fleet-local');\n\n      return out;\n    },\n\n    resourceCount() {\n      return this.toAssign?.length || 0;\n    }\n  },\n\n  watch: {\n    async showAssignTo(show) {\n      if (show) {\n        await this.$store.dispatch('rancher/findAll', { type: NORMAN.CLUSTER });\n        this.allWorkspaces = await this.$store.dispatch('management/findAll', { type: FLEET.WORKSPACE });\n        this.moveTo = this.workspace;\n        this.loaded = true;\n        this.$modal.show('assignTo');\n      } else {\n        this.$modal.hide('assignTo');\n      }\n    }\n  },\n\n  methods: {\n    close() {\n      this.errors = [];\n      this.labels = {};\n      this.moveTo = this.workspace;\n      this.$store.commit('action-menu/toggleAssignTo');\n    },\n\n    async apply(buttonDone) {\n      const promises = [];\n\n      this.errors = [];\n\n      for ( const fleetCluster of this.toAssign ) {\n        const c = await this.$store.dispatch(`rancher/clone`, { resource: fleetCluster.norman });\n\n        if ( !c ) {\n          continue;\n        }\n\n        c.fleetWorkspaceName = this.moveTo;\n\n        for ( const k of Object.keys(this.labels) ) {\n          if ( !c._labels ) {\n            set(c, '_labels', {});\n          }\n\n          set(c._labels, k, this.labels[k]);\n        }\n\n        promises.push(c.save());\n      }\n\n      try {\n        await Promise.all(promises);\n        buttonDone(true);\n        this.close();\n      } catch (e) {\n        this.errors = exceptionToErrorsArray(e);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <modal\n    class=\"assign-modal\"\n    name=\"assignTo\"\n    styles=\"background-color: var(--nav-bg); border-radius: var(--border-radius); max-height: 100vh;\"\n    height=\"auto\"\n    :scrollable=\"true\"\n  >\n    <Card\n      v-if=\"loaded\"\n      :show-highlight-border=\"false\"\n    >\n      <h4\n        slot=\"title\"\n        v-clean-html=\"t('assignTo.title', {count: resourceCount}, true)\"\n        class=\"text-default-text\"\n      />\n\n      <div\n        slot=\"body\"\n        class=\"pl-10 pr-10\"\n      >\n        <form>\n          <LabeledSelect\n            v-model=\"moveTo\"\n            :label=\"t('assignTo.workspace')\"\n            :options=\"workspaceOptions\"\n            placement=\"bottom\"\n          />\n\n          <KeyValue\n            key=\"labels\"\n            v-model=\"labels\"\n            class=\"mt-20\"\n            :add-label=\"t('labels.addSetLabel')\"\n            :read-allowed=\"false\"\n          />\n\n          <Banner\n            v-for=\"(err, i) in errors\"\n            :key=\"i\"\n            color=\"error\"\n            :label=\"err\"\n          />\n        </form>\n      </div>\n\n      <div slot=\"actions\">\n        <button\n          class=\"btn role-secondary\"\n          @click=\"close\"\n        >\n          {{ t('generic.cancel') }}\n        </button>\n\n        <AsyncButton\n          mode=\"apply\"\n          @click=\"apply\"\n        />\n      </div>\n    </Card>\n  </modal>\n</template>\n\n<style lang='scss'>\n  .assign-modal {\n    border-radius: var(--border-radius);\n    overflow: scroll;\n    max-height: 100vh;\n    & ::-webkit-scrollbar-corner {\n      background: rgba(0,0,0,0);\n    }\n  }\n</style>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/cis.cattle.io.clusterscan.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/edit/cis.cattle.io.clusterscan.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDcnVSZXNvdXJjZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9DcnVSZXNvdXJjZSc7CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdCc7CmltcG9ydCB7IExhYmVsZWRJbnB1dCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vTGFiZWxlZElucHV0JzsKaW1wb3J0IFVuaXRJbnB1dCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL1VuaXRJbnB1dCc7CmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCBMb2FkaW5nIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0xvYWRpbmcnOwppbXBvcnQgeyBDSVMsIENPTkZJR19NQVAgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgY3JlYXRlRWRpdFZpZXcgZnJvbSAnQHNoZWxsL21peGlucy9jcmVhdGUtZWRpdC12aWV3JzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKaW1wb3J0IHsgQ2hlY2tib3ggfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0NoZWNrYm94JzsKaW1wb3J0IHsgUmFkaW9Hcm91cCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vUmFkaW8nOwppbXBvcnQgeyBnZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgX1ZJRVcsIF9DUkVBVEUgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IGlzVmFsaWRDcm9uIH0gZnJvbSAnY3Jvbi12YWxpZGF0b3InOwoKY29uc3Qgc2VtdmVyID0gcmVxdWlyZSgnc2VtdmVyJyk7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQ3J1UmVzb3VyY2UsIExhYmVsZWRTZWxlY3QsIEJhbm5lciwgTG9hZGluZywgQ2hlY2tib3gsIExhYmVsZWRJbnB1dCwgUmFkaW9Hcm91cCwgVW5pdElucHV0CiAgfSwKCiAgbWl4aW5zOiBbY3JlYXRlRWRpdFZpZXddLAoKICBwcm9wczogewogICAgdmFsdWU6IHsKICAgICAgdHlwZTogICAgT2JqZWN0LAogICAgICBkZWZhdWx0OiAoKSA9PiB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CiAgICB9LAogICAgbW9kZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdjcmVhdGUnCiAgICB9CiAgfSwKCiAgYXN5bmMgZmV0Y2goKSB7CiAgICBjb25zdCBoYXNoID0gYXdhaXQgYWxsSGFzaCh7CiAgICAgIHByb2ZpbGVzOiAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmRBbGwnLCB7IHR5cGU6IENJUy5DTFVTVEVSX1NDQU5fUFJPRklMRSB9KSwKICAgICAgYmVuY2htYXJrczogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsgdHlwZTogQ0lTLkJFTkNITUFSSyB9KSwKICAgIH0pOwoKICAgIHRyeSB7CiAgICAgIHRoaXMuZGVmYXVsdENvbmZpZ01hcCA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmQnLCB7IHR5cGU6IENPTkZJR19NQVAsIGlkOiAnY2lzLW9wZXJhdG9yLXN5c3RlbS9kZWZhdWx0LWNsdXN0ZXJzY2FucHJvZmlsZXMnIH0pOwogICAgfSBjYXRjaCB7fQoKICAgIHRoaXMuYWxsUHJvZmlsZXMgPSBoYXNoLnByb2ZpbGVzOwogICAgY29uc3QgeyBzY2FuUHJvZmlsZU5hbWUgfSA9IHRoaXMudmFsdWUuc3BlYzsKCiAgICAvLyBpZiBtb2RlIGlzIF9DUkVBVEUgYW5kIHNjYW5Qcm9maWxlTmFtZSBpcyBkZWZpbmVkLCB0aGlzIGlzIGEgY2xvbmUKICAgIC8vIGNoZWNrIGlmIHRoZSBwcm9maWxlIHJlZmVycmVkIHRvIGluIHRoZSBvcmlnaW5hbCBzcGVjIHN0aWxsIGV4aXN0cwogICAgaWYgKHNjYW5Qcm9maWxlTmFtZSAmJiB0aGlzLm1vZGUgPT09IF9DUkVBVEUpIHsKICAgICAgY29uc3QgcHJveHlPYmogPSB0aGlzLmFsbFByb2ZpbGVzLmZpbHRlcigocHJvZmlsZSkgPT4gcHJvZmlsZS5pZCA9PT0gc2NhblByb2ZpbGVOYW1lKVswXTsKCiAgICAgIGlmICghcHJveHlPYmopIHsKICAgICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZS5zcGVjLCAnc2NhblByb2ZpbGVOYW1lJywgJycpOwogICAgICB9CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIGlmICghdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lKSB7CiAgICAgIHRoaXMudmFsdWUubWV0YWRhdGEuZ2VuZXJhdGVOYW1lID0gJ3NjYW4tJzsKICAgIH0KICAgIGlmICghdGhpcy52YWx1ZS5zcGVjLnNjaGVkdWxlZFNjYW5Db25maWcpIHsKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUuc3BlYywgJ3NjaGVkdWxlZFNjYW5Db25maWcnLCB7IHNjYW5BbGVydFJ1bGU6IHt9IH0pOwogICAgfQogICAgaWYgKCF0aGlzLnZhbHVlLnNwZWMuc2NoZWR1bGVkU2NhbkNvbmZpZy5zY2FuQWxlcnRSdWxlKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMuc2NoZWR1bGVkU2NhbkNvbmZpZywgJ3NjYW5BbGVydFJ1bGUnLCB7IH0pOwogICAgfQogICAgY29uc3QgaXNTY2hlZHVsZWQgPSAhIWdldCh0aGlzLnZhbHVlLCAnc3BlYy5zY2hlZHVsZWRTY2FuQ29uZmlnLmNyb25TY2hlZHVsZScpOwoKICAgIHJldHVybiB7CiAgICAgIGFsbFByb2ZpbGVzOiAgICAgICAgIFtdLAogICAgICBkZWZhdWx0Q29uZmlnTWFwOiAgICBudWxsLAogICAgICBzY2hlZHVsZWRTY2FuQ29uZmlnOiB0aGlzLnZhbHVlLnNwZWMuc2NoZWR1bGVkU2NhbkNvbmZpZywKICAgICAgc2NhbkFsZXJ0UnVsZTogICAgICAgdGhpcy52YWx1ZS5zcGVjLnNjaGVkdWxlZFNjYW5Db25maWcuc2NhbkFsZXJ0UnVsZSwKICAgICAgaGFzQWxlcnRNYW5hZ2VyOiAgICAgZmFsc2UsCiAgICAgIGlzU2NoZWR1bGVkCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKHsgY3VycmVudENsdXN0ZXI6ICdjdXJyZW50Q2x1c3RlcicsIHQ6ICdpMThuL3QnIH0pLAoKICAgIGNhbkJlU2NoZWR1bGVkKCkgewogICAgICAvLyBjaGVjayBpZiBzY2FuIHdhcyBjcmVhdGVkIGFuZCBydW4gd2l0aCBhbiBvbGRlciBjaXMgaW5zdGFsbCB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBzY2hlZHVsaW5nL2FsZXJ0aW5nL3dhcm4gc3RhdGUKICAgICAgaWYgKHRoaXMubW9kZSA9PT0gX1ZJRVcpIHsKICAgICAgICBjb25zdCB3YXJuID0gZ2V0KHRoaXMudmFsdWUsICdzdGF0dXMuc3VtbWFyeS53YXJuJyk7CgogICAgICAgIHJldHVybiAhIXdhcm4gfHwgd2FybiA9PT0gMDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMudmFsdWUuY2FuQmVTY2hlZHVsZWQoKTsKICAgIH0sCgogICAgdmFsaWRQcm9maWxlcygpIHsKICAgICAgY29uc3QgcHJvZmlsZU5hbWVzID0gdGhpcy5hbGxQcm9maWxlcy5maWx0ZXIoKHByb2ZpbGUpID0+IHsKICAgICAgICBjb25zdCBiZW5jaG1hcmtWZXJzaW9uID0gcHJvZmlsZT8uc3BlYz8uYmVuY2htYXJrVmVyc2lvbjsKICAgICAgICBjb25zdCBiZW5jaG1hcmsgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjbHVzdGVyL2J5SWQnXShDSVMuQkVOQ0hNQVJLLCBiZW5jaG1hcmtWZXJzaW9uKTsKCiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVCZW5jaG1hcmsoYmVuY2htYXJrLCB0aGlzLmN1cnJlbnRDbHVzdGVyICk7CiAgICAgIH0pLm1hcCgocHJvZmlsZSkgPT4gewogICAgICAgIHJldHVybiB7IGxhYmVsOiBwcm9maWxlLmlkLCB2YWx1ZTogcHJvZmlsZS5pZCB9OwogICAgICB9KTsKCiAgICAgIHJldHVybiBwcm9maWxlTmFtZXM7CiAgICB9LAoKICAgIGRlZmF1bHRQcm9maWxlKCkgewogICAgICBpZiAodGhpcy5kZWZhdWx0Q29uZmlnTWFwKSB7CiAgICAgICAgY29uc3QgcHJvZmlsZXMgPSB0aGlzLmRlZmF1bHRDb25maWdNYXAuZGF0YTsKICAgICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuY3VycmVudENsdXN0ZXIuc3RhdHVzLnByb3ZpZGVyOwoKICAgICAgICBsZXQgbmFtZSA9IHByb2ZpbGVzW3Byb3ZpZGVyXSB8fCBwcm9maWxlcy5kZWZhdWx0OwoKICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygnOicpKSB7CiAgICAgICAgICBjb25zdCBwYWlycyA9IG5hbWUuc3BsaXQoJ1xuJyk7CiAgICAgICAgICBjb25zdCBjbHVzdGVyVmVyc2lvbiA9IHRoaXMuY3VycmVudENsdXN0ZXIua3ViZXJuZXRlc1ZlcnNpb247CgogICAgICAgICAgcGFpcnMuZm9yRWFjaCgocGFpcikgPT4gewogICAgICAgICAgICBjb25zdCB2ZXJzaW9uID0gKHBhaXIubWF0Y2goL1s8Pj1dK1stLl9hLXpBLVowLTldKy8pIHx8IFtdKVswXTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKHNlbXZlci5zYXRpc2ZpZXMoY2x1c3RlclZlcnNpb24sIHZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gcGFpci5yZXBsYWNlKC9bPD49XStbLS5fYS16QS1aMC05XSs6IC8sICcnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAvLyBJZ25vcmUgZW50cmllcyB3aXRoIGludmFsaWQgc2VtdmVyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuYWxsUHJvZmlsZXMuZmluZCgocHJvZmlsZSkgPT4gcHJvZmlsZS5pZCA9PT0gbmFtZSk7CiAgICAgICAgICBjb25zdCBiZW5jaG1hcmtWZXJzaW9uID0gcHJvZmlsZT8uc3BlYz8uYmVuY2htYXJrVmVyc2lvbjsKICAgICAgICAgIGNvbnN0IGJlbmNobWFyayA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2NsdXN0ZXIvYnlJZCddKENJUy5CRU5DSE1BUkssIGJlbmNobWFya1ZlcnNpb24pOwoKICAgICAgICAgIGlmICh0aGlzLnZhbGlkYXRlQmVuY2htYXJrKGJlbmNobWFyaywgdGhpcy5jdXJyZW50Q2x1c3RlciApKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9maWxlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBjaXMxNiA9IHRoaXMudmFsaWRQcm9maWxlcy5maW5kKChwcm9maWxlKSA9PiBwcm9maWxlLnZhbHVlID09PSAnY2lzLTEuNi1wcm9maWxlJyk7CgogICAgICAgIGlmIChjaXMxNikgewogICAgICAgICAgcmV0dXJuIHRoaXMuYWxsUHJvZmlsZXMuZmluZCgocHJvZmlsZSkgPT4gcHJvZmlsZS5pZCA9PT0gJ2Npcy0xLjYtcHJvZmlsZScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hbGxQcm9maWxlcy5maW5kKChwcm9maWxlKSA9PiBwcm9maWxlLmlkID09PSAnY2lzLTEuNS1wcm9maWxlJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgbW9uaXRvcmluZ1VybCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlci5yZXNvbHZlKHsKICAgICAgICBuYW1lOiAgICdjLWNsdXN0ZXItbW9uaXRvcmluZycsCiAgICAgICAgcGFyYW1zOiB7IGNsdXN0ZXI6IHRoaXMuJHJvdXRlLnBhcmFtcy5jbHVzdGVyIH0KICAgICAgfSkuaHJlZjsKICAgIH0sCgogICAgdmFsaWRhdGVkKCkgewogICAgICBpZiAodGhpcy5pc1NjaGVkdWxlZCkgewogICAgICAgIGNvbnN0IHNjaGVkdWxlID0gZ2V0KHRoaXMudmFsdWUsICdzcGVjLnNjaGVkdWxlZFNjYW5Db25maWcuY3JvblNjaGVkdWxlJyk7CgogICAgICAgIGlmICghc2NoZWR1bGUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGlzVmFsaWRDcm9uKHNjaGVkdWxlKSAmJiAhIXRoaXMudmFsdWUuc3BlYy5zY2FuUHJvZmlsZU5hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gISF0aGlzLnZhbHVlLnNwZWMuc2NhblByb2ZpbGVOYW1lOwogICAgfQoKICB9LAoKICB3YXRjaDogewogICAgZGVmYXVsdFByb2ZpbGUobmV1KSB7CiAgICAgIGlmIChuZXUgJiYgIXRoaXMudmFsdWUuc3BlYy5zY2FuUHJvZmlsZU5hbWUpIHsKICAgICAgICBjb25zdCBiZW5jaG1hcmtWZXJzaW9uID0gbmV1Py5zcGVjPy5iZW5jaG1hcmtWZXJzaW9uOwogICAgICAgIGNvbnN0IGJlbmNobWFyayA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2NsdXN0ZXIvYnlJZCddKENJUy5CRU5DSE1BUkssIGJlbmNobWFya1ZlcnNpb24pOwoKICAgICAgICBpZiAoIXRoaXMudmFsaWRhdGVCZW5jaG1hcmsoYmVuY2htYXJrLCB0aGlzLmN1cnJlbnRDbHVzdGVyKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnZhbHVlLnNwZWMuc2NhblByb2ZpbGVOYW1lID0gbmV1Py5pZDsKICAgICAgfQogICAgfSwKICB9LAoKICBtZXRob2RzOiB7CiAgICB2YWxpZGF0ZUJlbmNobWFyayhiZW5jaG1hcmssIGN1cnJlbnRDbHVzdGVyKSB7CiAgICAgIGlmICghIWJlbmNobWFyaz8uc3BlYz8uY2x1c3RlclByb3ZpZGVyKSB7CiAgICAgICAgaWYgKCBiZW5jaG1hcms/LnNwZWM/LmNsdXN0ZXJQcm92aWRlciAhPT0gY3VycmVudENsdXN0ZXIuc3RhdHVzLnByb3ZpZGVyKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IGNsdXN0ZXJWZXJzaW9uID0gY3VycmVudENsdXN0ZXIua3ViZXJuZXRlc1ZlcnNpb25EaXNwbGF5OwoKICAgICAgICBpZiAoYmVuY2htYXJrPy5zcGVjPy5taW5LdWJlcm5ldGVzVmVyc2lvbikgewogICAgICAgICAgaWYgKHNlbXZlci5ndChiZW5jaG1hcms/LnNwZWM/Lm1pbkt1YmVybmV0ZXNWZXJzaW9uLCBjbHVzdGVyVmVyc2lvbikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYmVuY2htYXJrPy5zcGVjPy5tYXhLdWJlcm5ldGVzVmVyc2lvbikgewogICAgICAgICAgaWYgKHNlbXZlci5ndChjbHVzdGVyVmVyc2lvbiwgYmVuY2htYXJrPy5zcGVjPy5tYXhLdWJlcm5ldGVzVmVyc2lvbikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIElnbm9yZSBlcnJvciBpZiBzb21ldGhpbmcgaXMgaW52YWxpZCBzZW12ZXIKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIHNhdmVTY2FuKGNiKSB7CiAgICAgIGlmICghdGhpcy52YWx1ZS5pc1NjaGVkdWxlZCB8fCAhdGhpcy5pc1NjaGVkdWxlZCkgewogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLnNwZWMuc2NoZWR1bGVkU2NhbkNvbmZpZzsKICAgICAgfQogICAgICB0aGlzLnNhdmUoY2IpOwogICAgfSwKICB9Cn07Cg=="},{"version":3,"sources":["cis.cattle.io.clusterscan.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"cis.cattle.io.clusterscan.vue","sourceRoot":"node_modules/@rancher/shell/edit","sourcesContent":["<script>\nimport CruResource from '@shell/components/CruResource';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport UnitInput from '@shell/components/form/UnitInput';\nimport { Banner } from '@components/Banner';\nimport Loading from '@shell/components/Loading';\nimport { CIS, CONFIG_MAP } from '@shell/config/types';\nimport { mapGetters } from 'vuex';\nimport createEditView from '@shell/mixins/create-edit-view';\nimport { allHash } from '@shell/utils/promise';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { RadioGroup } from '@components/Form/Radio';\nimport { get } from '@shell/utils/object';\nimport { _VIEW, _CREATE } from '@shell/config/query-params';\nimport { isValidCron } from 'cron-validator';\n\nconst semver = require('semver');\n\nexport default {\n  components: {\n    CruResource, LabeledSelect, Banner, Loading, Checkbox, LabeledInput, RadioGroup, UnitInput\n  },\n\n  mixins: [createEditView],\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    },\n    mode: {\n      type:    String,\n      default: 'create'\n    }\n  },\n\n  async fetch() {\n    const hash = await allHash({\n      profiles:   this.$store.dispatch('cluster/findAll', { type: CIS.CLUSTER_SCAN_PROFILE }),\n      benchmarks: this.$store.dispatch('cluster/findAll', { type: CIS.BENCHMARK }),\n    });\n\n    try {\n      this.defaultConfigMap = await this.$store.dispatch('cluster/find', { type: CONFIG_MAP, id: 'cis-operator-system/default-clusterscanprofiles' });\n    } catch {}\n\n    this.allProfiles = hash.profiles;\n    const { scanProfileName } = this.value.spec;\n\n    // if mode is _CREATE and scanProfileName is defined, this is a clone\n    // check if the profile referred to in the original spec still exists\n    if (scanProfileName && this.mode === _CREATE) {\n      const proxyObj = this.allProfiles.filter((profile) => profile.id === scanProfileName)[0];\n\n      if (!proxyObj) {\n        this.$set(this.value.spec, 'scanProfileName', '');\n      }\n    }\n  },\n\n  data() {\n    if (!this.value.metadata.name) {\n      this.value.metadata.generateName = 'scan-';\n    }\n    if (!this.value.spec.scheduledScanConfig) {\n      this.$set(this.value.spec, 'scheduledScanConfig', { scanAlertRule: {} });\n    }\n    if (!this.value.spec.scheduledScanConfig.scanAlertRule) {\n      this.$set(this.value.spec.scheduledScanConfig, 'scanAlertRule', { });\n    }\n    const isScheduled = !!get(this.value, 'spec.scheduledScanConfig.cronSchedule');\n\n    return {\n      allProfiles:         [],\n      defaultConfigMap:    null,\n      scheduledScanConfig: this.value.spec.scheduledScanConfig,\n      scanAlertRule:       this.value.spec.scheduledScanConfig.scanAlertRule,\n      hasAlertManager:     false,\n      isScheduled\n    };\n  },\n\n  computed: {\n    ...mapGetters({ currentCluster: 'currentCluster', t: 'i18n/t' }),\n\n    canBeScheduled() {\n      // check if scan was created and run with an older cis install that doesn't support scheduling/alerting/warn state\n      if (this.mode === _VIEW) {\n        const warn = get(this.value, 'status.summary.warn');\n\n        return !!warn || warn === 0;\n      }\n\n      return this.value.canBeScheduled();\n    },\n\n    validProfiles() {\n      const profileNames = this.allProfiles.filter((profile) => {\n        const benchmarkVersion = profile?.spec?.benchmarkVersion;\n        const benchmark = this.$store.getters['cluster/byId'](CIS.BENCHMARK, benchmarkVersion);\n\n        return this.validateBenchmark(benchmark, this.currentCluster );\n      }).map((profile) => {\n        return { label: profile.id, value: profile.id };\n      });\n\n      return profileNames;\n    },\n\n    defaultProfile() {\n      if (this.defaultConfigMap) {\n        const profiles = this.defaultConfigMap.data;\n        const provider = this.currentCluster.status.provider;\n\n        let name = profiles[provider] || profiles.default;\n\n        if (name.includes(':')) {\n          const pairs = name.split('\\n');\n          const clusterVersion = this.currentCluster.kubernetesVersion;\n\n          pairs.forEach((pair) => {\n            const version = (pair.match(/[<>=]+[-._a-zA-Z0-9]+/) || [])[0];\n\n            try {\n              if (semver.satisfies(clusterVersion, version)) {\n                name = pair.replace(/[<>=]+[-._a-zA-Z0-9]+: /, '');\n              }\n            } catch (e) {\n              // Ignore entries with invalid semver\n            }\n          });\n        }\n        if (name) {\n          const profile = this.allProfiles.find((profile) => profile.id === name);\n          const benchmarkVersion = profile?.spec?.benchmarkVersion;\n          const benchmark = this.$store.getters['cluster/byId'](CIS.BENCHMARK, benchmarkVersion);\n\n          if (this.validateBenchmark(benchmark, this.currentCluster )) {\n            return profile;\n          }\n        }\n        const cis16 = this.validProfiles.find((profile) => profile.value === 'cis-1.6-profile');\n\n        if (cis16) {\n          return this.allProfiles.find((profile) => profile.id === 'cis-1.6-profile');\n        } else {\n          return this.allProfiles.find((profile) => profile.id === 'cis-1.5-profile');\n        }\n      }\n\n      return null;\n    },\n\n    monitoringUrl() {\n      return this.$router.resolve({\n        name:   'c-cluster-monitoring',\n        params: { cluster: this.$route.params.cluster }\n      }).href;\n    },\n\n    validated() {\n      if (this.isScheduled) {\n        const schedule = get(this.value, 'spec.scheduledScanConfig.cronSchedule');\n\n        if (!schedule) {\n          return false;\n        } else {\n          return isValidCron(schedule) && !!this.value.spec.scanProfileName;\n        }\n      }\n\n      return !!this.value.spec.scanProfileName;\n    }\n\n  },\n\n  watch: {\n    defaultProfile(neu) {\n      if (neu && !this.value.spec.scanProfileName) {\n        const benchmarkVersion = neu?.spec?.benchmarkVersion;\n        const benchmark = this.$store.getters['cluster/byId'](CIS.BENCHMARK, benchmarkVersion);\n\n        if (!this.validateBenchmark(benchmark, this.currentCluster)) {\n          return;\n        }\n        this.value.spec.scanProfileName = neu?.id;\n      }\n    },\n  },\n\n  methods: {\n    validateBenchmark(benchmark, currentCluster) {\n      if (!!benchmark?.spec?.clusterProvider) {\n        if ( benchmark?.spec?.clusterProvider !== currentCluster.status.provider) {\n          return false;\n        }\n      }\n\n      try {\n        const clusterVersion = currentCluster.kubernetesVersionDisplay;\n\n        if (benchmark?.spec?.minKubernetesVersion) {\n          if (semver.gt(benchmark?.spec?.minKubernetesVersion, clusterVersion)) {\n            return false;\n          }\n        }\n        if (benchmark?.spec?.maxKubernetesVersion) {\n          if (semver.gt(clusterVersion, benchmark?.spec?.maxKubernetesVersion)) {\n            return false;\n          }\n        }\n      } catch (e) {\n        // Ignore error if something is invalid semver\n      }\n\n      return true;\n    },\n\n    saveScan(cb) {\n      if (!this.value.isScheduled || !this.isScheduled) {\n        delete this.value.spec.scheduledScanConfig;\n      }\n      this.save(cb);\n    },\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n\n  <CruResource\n    v-else\n    :validation-passed=\"validated\"\n    :done-route=\"doneRoute\"\n    :resource=\"value\"\n    :mode=\"mode\"\n    :errors=\"errors\"\n    @finish=\"saveScan\"\n    @error=\"e=>errors = e\"\n  >\n    <template>\n      <Banner\n        v-if=\"!validProfiles.length\"\n        color=\"warning\"\n        :label=\"t('cis.noProfiles')\"\n      />\n\n      <div\n        v-else\n        class=\"row mb-20\"\n      >\n        <div class=\"col span-6\">\n          <LabeledSelect\n            v-model=\"value.spec.scanProfileName\"\n            :mode=\"mode\"\n            :label=\"t('cis.profile')\"\n            :options=\"validProfiles\"\n          />\n        </div>\n        <div\n          v-if=\"canBeScheduled\"\n          class=\"col span-6\"\n        >\n          <span>{{ t('cis.scoreWarning.label') }}</span> <i\n            v-clean-tooltip=\"t('cis.scoreWarning.protip')\"\n            class=\"icon icon-info\"\n          />\n          <RadioGroup\n            v-model=\"value.spec.scoreWarning\"\n            :mode=\"mode\"\n            name=\"scoreWarning\"\n            :options=\"['pass', 'fail']\"\n            :labels=\"[t('cis.scan.pass'), t('cis.scan.fail')]\"\n          />\n        </div>\n      </div>\n      <template v-if=\"canBeScheduled\">\n        <h3>Scheduling</h3>\n        <div class=\"row mb-20\">\n          <div class=\"col\">\n            <RadioGroup\n              v-model=\"isScheduled\"\n              :mode=\"mode\"\n              name=\"scheduling\"\n              :options=\"[ {value: false, label: t('cis.scheduling.disable')}, {value: true, label: t('cis.scheduling.enable')}]\"\n            />\n          </div>\n        </div>\n        <template v-if=\"isScheduled\">\n          <div class=\"row mb-20\">\n            <div class=\"col span-6\">\n              <LabeledInput\n                v-model=\"scheduledScanConfig.cronSchedule\"\n                required\n                :mode=\"mode\"\n                :label=\"t('cis.cronSchedule.label')\"\n                :placeholder=\"t('cis.cronSchedule.placeholder')\"\n                type=\"cron\"\n              />\n            </div>\n            <div class=\"col span-6\">\n              <UnitInput\n                v-model.number=\"scheduledScanConfig.retentionCount\"\n                :suffix=\"t('cis.reports')\"\n                type=\"number\"\n                :mode=\"mode\"\n                :label=\"t('cis.retention')\"\n              />\n            </div>\n          </div>\n          <h3>\n            Alerting\n          </h3>\n          <div class=\"row mb-20\">\n            <div class=\"col span-12\">\n              <Banner\n                v-if=\"scanAlertRule.alertOnFailure || scanAlertRule.alertOnComplete\"\n                class=\"mt-0\"\n                :color=\"hasAlertManager ? 'info' : 'warning'\"\n              >\n                <span v-clean-html=\"t('cis.alertNeeded', {link: monitoringUrl}, true)\" />\n              </banner>\n              <Checkbox\n                v-model=\"scanAlertRule.alertOnComplete\"\n                :mode=\"mode\"\n                :label=\"t('cis.alertOnComplete')\"\n              />\n              <Checkbox\n                v-model=\"scanAlertRule.alertOnFailure\"\n                :mode=\"mode\"\n                :label=\"t('cis.alertOnFailure')\"\n              />\n            </div>\n          </div>\n        </template>\n      </template>\n    </template>\n  </CruResource>\n</template>\n"]}]}
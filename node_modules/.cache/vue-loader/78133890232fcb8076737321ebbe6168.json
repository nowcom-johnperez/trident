{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/list/management.cattle.io.user.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/list/management.cattle.io.user.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBBc3luY0J1dHRvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Bc3luY0J1dHRvbic7CmltcG9ydCB7IE5PUk1BTiB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBOQU1FIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9wcm9kdWN0L2F1dGgnOwppbXBvcnQgUmVzb3VyY2VUYWJsZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9SZXNvdXJjZVRhYmxlJzsKaW1wb3J0IE1hc3RoZWFkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1Jlc291cmNlTGlzdC9NYXN0aGVhZCc7CmltcG9ydCBSZXNvdXJjZUZldGNoIGZyb20gJ0BzaGVsbC9taXhpbnMvcmVzb3VyY2UtZmV0Y2gnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEFzeW5jQnV0dG9uLAogICAgUmVzb3VyY2VUYWJsZSwKICAgIE1hc3RoZWFkCiAgfSwKICBtaXhpbnM6IFtSZXNvdXJjZUZldGNoXSwKICBwcm9wczogIHsKICAgIHJlc291cmNlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICBsb2FkSW5kZXRlcm1pbmF0ZTogewogICAgICB0eXBlOiAgICBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICBpbmNyZW1lbnRhbExvYWRpbmdJbmRpY2F0b3I6IHsKICAgICAgdHlwZTogICAgQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgdXNlUXVlcnlQYXJhbXNGb3JTaW1wbGVGaWx0ZXJpbmc6IHsKICAgICAgdHlwZTogICAgQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGFzeW5jIGZldGNoKCkgewogICAgY29uc3Qgc3RvcmUgPSB0aGlzLiRzdG9yZTsKCiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChgcmFuY2hlci9maW5kQWxsYCwgeyB0eXBlOiBOT1JNQU4uVVNFUiB9KTsKCiAgICBhd2FpdCB0aGlzLiRmZXRjaFR5cGUodGhpcy5yZXNvdXJjZSk7CgogICAgdGhpcy5jYW5SZWZyZXNoQWNjZXNzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvcmVxdWVzdCcsIHsgdXJsOiAnL3YzL3VzZXJzP2xpbWl0PTAnIH0pCiAgICAgIC50aGVuKChyZXMpID0+ICEhcmVzPy5hY3Rpb25zPy5yZWZyZXNoYXV0aHByb3ZpZGVyYWNjZXNzKTsKICB9LAoKICBkYXRhKCkgewogICAgY29uc3QgZ2V0dGVycyA9IHRoaXMuJHN0b3JlLmdldHRlcnM7CgogICAgY29uc3Qgc2NoZW1hID0gZ2V0dGVyc1tgbWFuYWdlbWVudC9zY2hlbWFGb3JgXSh0aGlzLnJlc291cmNlKTsKCiAgICByZXR1cm4gewogICAgICBzY2hlbWEsCiAgICAgIGNhblJlZnJlc2hBY2Nlc3M6IGZhbHNlLAogICAgfTsKICB9LAoKICAkbG9hZGluZ1Jlc291cmNlcygpIHsKICAgIC8vIHJlc3VsdHMgYXJlIGZpbHRlcmVkIHNvIHdlIHdvdWxkbid0IGdldCB0aGUgY29ycmVjdCBjb3VudCBvbiBpbmRpY2F0b3IuLi4KICAgIHJldHVybiB7IGxvYWRJbmRldGVybWluYXRlOiB0cnVlIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGhlYWRlcnMoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5nZXR0ZXJzWyd0eXBlLW1hcC9oZWFkZXJzRm9yJ10odGhpcy5zY2hlbWEpOwogICAgfSwKCiAgICBncm91cEJ5KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1sndHlwZS1tYXAvZ3JvdXBCeUZvciddKHRoaXMuc2NoZW1hKTsKICAgIH0sCgogICAgdXNlcnMoKSB7CiAgICAgIGlmICggIXRoaXMucm93cyApIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIC8vIFVwZGF0ZSB0aGUgbGlzdCBvZiB1c2VycwogICAgICAvLyAxKSBPbmx5IHNob3cgc3lzdGVtIHVzZXJzIGluIGV4cGxvcmVyL3VzZXJzIGFuZCBub3QgaW4gYXV0aC91c2VycwogICAgICAvLyAyKSBTdXBwbGVtZW50IHVzZXIgd2l0aCBpbmZvIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSByZWZyZXNoIGdyb3VwIG1lbWJlcnNoaXAgYWN0aW9uICh0aGlzIGlzIG5vdCBwZXJzaXN0ZWQgb24gc2F2ZSkKICAgICAgY29uc3QgcGFyYW1zID0geyAuLi50aGlzLiRyb3V0ZS5wYXJhbXMgfTsKICAgICAgY29uc3QgcmVxdWlyZWRVc2VycyA9IHBhcmFtcy5wcm9kdWN0ID09PSBOQU1FID8gdGhpcy5yb3dzLmZpbHRlcigoYSkgPT4gIWEuaXNTeXN0ZW0pIDogdGhpcy5yb3dzOwoKICAgICAgcmVxdWlyZWRVc2Vycy5mb3JFYWNoKChyKSA9PiB7CiAgICAgICAgci5jYW5SZWZyZXNoQWNjZXNzID0gdGhpcy5jYW5SZWZyZXNoQWNjZXNzOwogICAgICB9KTsKCiAgICAgIHJldHVybiByZXF1aXJlZFVzZXJzOwogICAgfQoKICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyByZWZyZXNoR3JvdXBNZW1iZXJzaGlwcyhidXR0b25Eb25lKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvY29sbGVjdGlvbkFjdGlvbicsIHsKICAgICAgICAgIHR5cGU6ICAgICAgIE5PUk1BTi5VU0VSLAogICAgICAgICAgYWN0aW9uTmFtZTogJ3JlZnJlc2hhdXRocHJvdmlkZXJhY2Nlc3MnLAogICAgICAgIH0pOwoKICAgICAgICBidXR0b25Eb25lKHRydWUpOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnZ3Jvd2wvZnJvbUVycm9yJywgeyB0aXRsZTogdGhpcy50KCd1c2VyLmxpc3QuZXJyb3JSZWZyZXNoaW5nR3JvdXBNZW1iZXJzaGlwcycpLCBlcnIgfSwgeyByb290OiB0cnVlIH0pOwogICAgICAgIGJ1dHRvbkRvbmUoZmFsc2UpOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["management.cattle.io.user.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"management.cattle.io.user.vue","sourceRoot":"node_modules/@rancher/shell/list","sourcesContent":["<script>\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { NORMAN } from '@shell/config/types';\nimport { NAME } from '@shell/config/product/auth';\nimport ResourceTable from '@shell/components/ResourceTable';\nimport Masthead from '@shell/components/ResourceList/Masthead';\nimport ResourceFetch from '@shell/mixins/resource-fetch';\n\nexport default {\n  components: {\n    AsyncButton,\n    ResourceTable,\n    Masthead\n  },\n  mixins: [ResourceFetch],\n  props:  {\n    resource: {\n      type:     String,\n      required: true,\n    },\n\n    loadIndeterminate: {\n      type:    Boolean,\n      default: false\n    },\n\n    incrementalLoadingIndicator: {\n      type:    Boolean,\n      default: false\n    },\n\n    useQueryParamsForSimpleFiltering: {\n      type:    Boolean,\n      default: false\n    }\n  },\n  async fetch() {\n    const store = this.$store;\n\n    await store.dispatch(`rancher/findAll`, { type: NORMAN.USER });\n\n    await this.$fetchType(this.resource);\n\n    this.canRefreshAccess = await this.$store.dispatch('rancher/request', { url: '/v3/users?limit=0' })\n      .then((res) => !!res?.actions?.refreshauthprovideraccess);\n  },\n\n  data() {\n    const getters = this.$store.getters;\n\n    const schema = getters[`management/schemaFor`](this.resource);\n\n    return {\n      schema,\n      canRefreshAccess: false,\n    };\n  },\n\n  $loadingResources() {\n    // results are filtered so we wouldn't get the correct count on indicator...\n    return { loadIndeterminate: true };\n  },\n\n  computed: {\n    headers() {\n      return this.$store.getters['type-map/headersFor'](this.schema);\n    },\n\n    groupBy() {\n      return this.$store.getters['type-map/groupByFor'](this.schema);\n    },\n\n    users() {\n      if ( !this.rows ) {\n        return [];\n      }\n\n      // Update the list of users\n      // 1) Only show system users in explorer/users and not in auth/users\n      // 2) Supplement user with info to enable/disable the refresh group membership action (this is not persisted on save)\n      const params = { ...this.$route.params };\n      const requiredUsers = params.product === NAME ? this.rows.filter((a) => !a.isSystem) : this.rows;\n\n      requiredUsers.forEach((r) => {\n        r.canRefreshAccess = this.canRefreshAccess;\n      });\n\n      return requiredUsers;\n    }\n\n  },\n\n  methods: {\n    async refreshGroupMemberships(buttonDone) {\n      try {\n        await this.$store.dispatch('rancher/collectionAction', {\n          type:       NORMAN.USER,\n          actionName: 'refreshauthprovideraccess',\n        });\n\n        buttonDone(true);\n      } catch (err) {\n        this.$store.dispatch('growl/fromError', { title: this.t('user.list.errorRefreshingGroupMemberships'), err }, { root: true });\n        buttonDone(false);\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div>\n    <Masthead\n      :schema=\"schema\"\n      :resource=\"resource\"\n      :show-incremental-loading-indicator=\"incrementalLoadingIndicator\"\n      :load-resources=\"loadResources\"\n      :load-indeterminate=\"loadIndeterminate\"\n    >\n      <template slot=\"extraActions\">\n        <AsyncButton\n          v-if=\"canRefreshAccess\"\n          mode=\"refresh\"\n          :action-label=\"t('authGroups.actions.refresh')\"\n          :waiting-label=\"t('authGroups.actions.refresh')\"\n          :success-label=\"t('authGroups.actions.refresh')\"\n          :error-label=\"t('authGroups.actions.refresh')\"\n          @click=\"refreshGroupMemberships\"\n        />\n      </template>\n    </Masthead>\n\n    <ResourceTable\n      :schema=\"schema\"\n      :rows=\"users\"\n      :group-by=\"groupBy\"\n      :loading=\"loading\"\n      :use-query-params-for-simple-filtering=\"useQueryParamsForSimpleFiltering\"\n      :force-update-live-and-delayed=\"forceUpdateLiveAndDelayed\"\n    />\n  </div>\n</template>\n\n<style lang=\"scss\">\n</style>\n"]}]}
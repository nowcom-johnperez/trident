{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/dialog/AddProjectMemberDialog.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/dialog/AddProjectMemberDialog.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBDYXJkIH0gZnJvbSAnQGNvbXBvbmVudHMvQ2FyZCc7DQppbXBvcnQgUHJvamVjdE1lbWJlckVkaXRvciBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL1Byb2plY3RNZW1iZXJFZGl0b3InOw0KaW1wb3J0IEFzeW5jQnV0dG9uIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0FzeW5jQnV0dG9uJzsNCmltcG9ydCBCYW5uZXIgZnJvbSAnQGNvbXBvbmVudHMvQmFubmVyL0Jhbm5lci52dWUnOw0KaW1wb3J0IHsgTk9STUFOIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgY29tcG9uZW50czogew0KICAgIENhcmQsDQogICAgUHJvamVjdE1lbWJlckVkaXRvciwNCiAgICBBc3luY0J1dHRvbiwNCiAgICBCYW5uZXINCiAgfSwNCg0KICBwcm9wczogew0KICAgIHJlc291cmNlczogew0KICAgICAgdHlwZTogICAgIEFycmF5LA0KICAgICAgcmVxdWlyZWQ6IHRydWUNCiAgICB9LA0KDQogICAgb25BZGQ6IHsNCiAgICAgIHR5cGU6ICAgIEZ1bmN0aW9uLA0KICAgICAgZGVmYXVsdDogKCkgPT4ge30NCiAgICB9LA0KDQogICAgcHJvamVjdElkOiB7DQogICAgICB0eXBlOiAgICBTdHJpbmcsDQogICAgICBkZWZhdWx0OiBudWxsDQogICAgfSwNCg0KICAgIHNhdmVJbk1vZGFsOiB7DQogICAgICB0eXBlOiAgICBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UNCiAgICB9DQogIH0sDQoNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbWVtYmVyOiB7DQogICAgICAgIHBlcm1pc3Npb25Hcm91cDogJ21lbWJlcicsDQogICAgICAgIGN1c3RvbTogICAgICAgICAge30sDQogICAgICAgIHByaW5jaXBhbElkOiAgICAgJycsDQogICAgICAgIHJvbGVUZW1wbGF0ZUlkczogW10NCiAgICAgIH0sDQogICAgICBlcnJvcjogbnVsbA0KICAgIH07DQogIH0sDQoNCiAgY29tcHV0ZWQ6IHsNCiAgICBwcmluY2lwYWwoKSB7DQogICAgICBjb25zdCBwcmluY2lwYWxJZCA9IHRoaXMubWVtYmVyLnByaW5jaXBhbElkLnJlcGxhY2UoL1wvL2csICclMkYnKTsNCg0KICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2ZpbmQnLCB7DQogICAgICAgIHR5cGU6IE5PUk1BTi5QUklOQ0lQQUwsDQogICAgICAgIGlkOiAgIHRoaXMubWVtYmVyLnByaW5jaXBhbElkLA0KICAgICAgICBvcHQ6ICB7IHVybDogYC92My9wcmluY2lwYWxzLyR7IHByaW5jaXBhbElkIH1gIH0NCiAgICAgIH0sIHsgcm9vdDogdHJ1ZSB9KTsNCiAgICB9LA0KICB9LA0KDQogIG1ldGhvZHM6IHsNCiAgICBhc3luYyBwcmluY2lwYWxQcm9wZXJ0eSgpIHsNCiAgICAgIGNvbnN0IHByaW5jaXBhbCA9IGF3YWl0IHRoaXMucHJpbmNpcGFsOw0KDQogICAgICByZXR1cm4gcHJpbmNpcGFsPy5wcmluY2lwYWxUeXBlID09PSAnZ3JvdXAnID8gJ2dyb3VwUHJpbmNpcGFsSWQnIDogJ3VzZXJQcmluY2lwYWxJZCc7DQogICAgfSwNCg0KICAgIGNsb3NlKCkgew0KICAgICAgdGhpcy4kZW1pdCgnY2xvc2UnKTsNCiAgICB9LA0KDQogICAgYXN5bmMgYXBwbHkoKSB7DQogICAgICB0aGlzLm9uQWRkKGF3YWl0IHRoaXMuY3JlYXRlQmluZGluZ3MoKSk7DQogICAgICB0aGlzLmNsb3NlKCk7DQogICAgfSwNCg0KICAgIGFzeW5jIGNyZWF0ZUJpbmRpbmdzKCkgew0KICAgICAgY29uc3QgcHJpbmNpcGFsUHJvcGVydHkgPSBhd2FpdCB0aGlzLnByaW5jaXBhbFByb3BlcnR5KCk7DQogICAgICBjb25zdCBwcm9taXNlcyA9IHRoaXMubWVtYmVyLnJvbGVUZW1wbGF0ZUlkcy5tYXAoKHJvbGVUZW1wbGF0ZUlkKSA9PiB0aGlzLiRzdG9yZS5kaXNwYXRjaChgcmFuY2hlci9jcmVhdGVgLCB7DQogICAgICAgIHR5cGU6ICAgICAgICAgICAgICAgIE5PUk1BTi5QUk9KRUNUX1JPTEVfVEVNUExBVEVfQklORElORywNCiAgICAgICAgcm9sZVRlbXBsYXRlSWQsDQogICAgICAgIFtwcmluY2lwYWxQcm9wZXJ0eV06IHRoaXMubWVtYmVyLnByaW5jaXBhbElkLA0KICAgICAgICBwcm9qZWN0SWQ6ICAgICAgICAgICB0aGlzLnByb2plY3RJZCwNCiAgICAgIH0pKTsNCg0KICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTsNCiAgICB9LA0KDQogICAgc2F2ZUJpbmRpbmdzKGJ0bkNCKSB7DQogICAgICB0aGlzLmVycm9yID0gbnVsbDsNCiAgICAgIHRoaXMuY3JlYXRlQmluZGluZ3MoKQ0KICAgICAgICAudGhlbigoYmluZGluZ3MpID0+IHsNCiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoYmluZGluZ3MubWFwKChiKSA9PiBiLnNhdmUoKSkpOw0KICAgICAgICB9KQ0KICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgYnRuQ0IodHJ1ZSk7DQogICAgICAgICAgc2V0VGltZW91dCh0aGlzLmNsb3NlLCA1MDApOw0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnI7DQogICAgICAgICAgYnRuQ0IoZmFsc2UpOw0KICAgICAgICB9KTsNCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["AddProjectMemberDialog.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddProjectMemberDialog.vue","sourceRoot":"node_modules/@rancher/shell/dialog","sourcesContent":["<script>\r\nimport { Card } from '@components/Card';\r\nimport ProjectMemberEditor from '@shell/components/form/ProjectMemberEditor';\r\nimport AsyncButton from '@shell/components/AsyncButton';\r\nimport Banner from '@components/Banner/Banner.vue';\r\nimport { NORMAN } from '@shell/config/types';\r\n\r\nexport default {\r\n  components: {\r\n    Card,\r\n    ProjectMemberEditor,\r\n    AsyncButton,\r\n    Banner\r\n  },\r\n\r\n  props: {\r\n    resources: {\r\n      type:     Array,\r\n      required: true\r\n    },\r\n\r\n    onAdd: {\r\n      type:    Function,\r\n      default: () => {}\r\n    },\r\n\r\n    projectId: {\r\n      type:    String,\r\n      default: null\r\n    },\r\n\r\n    saveInModal: {\r\n      type:    Boolean,\r\n      default: false\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      member: {\r\n        permissionGroup: 'member',\r\n        custom:          {},\r\n        principalId:     '',\r\n        roleTemplateIds: []\r\n      },\r\n      error: null\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    principal() {\r\n      const principalId = this.member.principalId.replace(/\\//g, '%2F');\r\n\r\n      return this.$store.dispatch('rancher/find', {\r\n        type: NORMAN.PRINCIPAL,\r\n        id:   this.member.principalId,\r\n        opt:  { url: `/v3/principals/${ principalId }` }\r\n      }, { root: true });\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    async principalProperty() {\r\n      const principal = await this.principal;\r\n\r\n      return principal?.principalType === 'group' ? 'groupPrincipalId' : 'userPrincipalId';\r\n    },\r\n\r\n    close() {\r\n      this.$emit('close');\r\n    },\r\n\r\n    async apply() {\r\n      this.onAdd(await this.createBindings());\r\n      this.close();\r\n    },\r\n\r\n    async createBindings() {\r\n      const principalProperty = await this.principalProperty();\r\n      const promises = this.member.roleTemplateIds.map((roleTemplateId) => this.$store.dispatch(`rancher/create`, {\r\n        type:                NORMAN.PROJECT_ROLE_TEMPLATE_BINDING,\r\n        roleTemplateId,\r\n        [principalProperty]: this.member.principalId,\r\n        projectId:           this.projectId,\r\n      }));\r\n\r\n      return Promise.all(promises);\r\n    },\r\n\r\n    saveBindings(btnCB) {\r\n      this.error = null;\r\n      this.createBindings()\r\n        .then((bindings) => {\r\n          return Promise.all(bindings.map((b) => b.save()));\r\n        })\r\n        .then(() => {\r\n          btnCB(true);\r\n          setTimeout(this.close, 500);\r\n        })\r\n        .catch((err) => {\r\n          this.error = err;\r\n          btnCB(false);\r\n        });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<template>\r\n  <Card\r\n    class=\"prompt-rotate\"\r\n    :show-highlight-border=\"false\"\r\n    :sticky=\"true\"\r\n  >\r\n    <h4\r\n      slot=\"title\"\r\n      v-clean-html=\"t('addProjectMemberDialog.title')\"\r\n      class=\"text-default-text\"\r\n    />\r\n\r\n    <div\r\n      slot=\"body\"\r\n      class=\"pl-10 pr-10\"\r\n    >\r\n      <Banner\r\n        v-if=\"error\"\r\n        color=\"error\"\r\n      >\r\n        {{ error }}\r\n      </Banner>\r\n      <ProjectMemberEditor\r\n        v-model=\"member\"\r\n        :use-two-columns-for-custom=\"true\"\r\n      />\r\n    </div>\r\n\r\n    <div\r\n      slot=\"actions\"\r\n      class=\"buttons\"\r\n    >\r\n      <button\r\n        class=\"btn role-secondary mr-10\"\r\n        @click=\"close\"\r\n      >\r\n        {{ t('generic.cancel') }}\r\n      </button>\r\n\r\n      <AsyncButton\r\n        v-if=\"saveInModal\"\r\n        mode=\"create\"\r\n        @click=\"cb=>saveBindings(cb)\"\r\n      />\r\n\r\n      <button\r\n        v-else\r\n        class=\"btn role-primary\"\r\n        @click=\"apply\"\r\n      >\r\n        {{ t('generic.add') }}\r\n      </button>\r\n    </div>\r\n  </Card>\r\n</template>\r\n<style lang='scss' scoped>\r\n  .prompt-rotate {\r\n    margin: 0;\r\n  }\r\n  .buttons {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    width: 100%;\r\n  }\r\n</style>\r\n\r\n<style lang=\"scss\">\r\n  .card-container {\r\n    border: 1px solid var(--border);\r\n    box-shadow: none;\r\n  }\r\n</style>\r\n"]}]}
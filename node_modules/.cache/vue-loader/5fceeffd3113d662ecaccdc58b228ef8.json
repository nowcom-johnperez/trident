{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/chart/monitoring/steps/uninstall-v1.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/chart/monitoring/steps/uninstall-v1.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGhhdmVWMU1vbml0b3JpbmcsIGhhdmVWMU1vbml0b3JpbmdXb3JrbG9hZHMgfSBmcm9tICdAc2hlbGwvdXRpbHMvbW9uaXRvcmluZyc7CmltcG9ydCBBc3luY0J1dHRvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Bc3luY0J1dHRvbic7CmltcG9ydCBJY29uTWVzc2FnZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9JY29uTWVzc2FnZSc7CgpmdW5jdGlvbiBkZWxheSh0LCB2KSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICBzZXRUaW1lb3V0KHJlc29sdmUuYmluZChudWxsLCB2KSwgdCk7CiAgfSk7Cn0KCmV4cG9ydCBkZWZhdWx0IHsKCiAgbGFiZWw6ICAgJ21vbml0b3JpbmcuaW5zdGFsbFN0ZXBzLnVuaW5zdGFsbFYxLnN0ZXBUaXRsZScsCiAgc3VidGV4dDogJ21vbml0b3JpbmcuaW5zdGFsbFN0ZXBzLnVuaW5zdGFsbFYxLnN0ZXBTdWJ0ZXh0JywKICB3ZWlnaHQ6ICAxMDAsCgogIGNvbXBvbmVudHM6IHsKICAgIEFzeW5jQnV0dG9uLAogICAgSWNvbk1lc3NhZ2UKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaGF2ZVYxTW9uaXRvcmluZzogZmFsc2UsCiAgICAgIGVycm9yOiAgICAgICAgICAgIG51bGwsCiAgICB9OwogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmhhdmVWMU1vbml0b3JpbmcgPSBoYXZlVjFNb25pdG9yaW5nKHRoaXMuJHN0b3JlLmdldHRlcnMpOwogICAgdGhpcy4kZW1pdCgndXBkYXRlJywgewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgcmVhZHk6ICAgZmFsc2UsCiAgICAgIGhpZGRlbjogICF0aGlzLmhhdmVWMU1vbml0b3JpbmcsCiAgICB9KTsKICB9LAoKICBtZXRob2RzOiB7CiAgICB1bmluc3RhbGwoYnV0dG9uQ2IpIHsKICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvcHJvbXB0TW9kYWwnLCB7CiAgICAgICAgY29tcG9uZW50OiAgICAgICdHZW5lcmljUHJvbXB0JywKICAgICAgICBjb21wb25lbnRQcm9wczogewogICAgICAgICAgYXBwbHlNb2RlOiAgICd1bmluc3RhbGwnLAogICAgICAgICAgYXBwbHlBY3Rpb246IGFzeW5jKGJ1dHRvbkRvbmUpID0+IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZ2V0dGVyc1snY3VycmVudENsdXN0ZXInXS5kb0FjdGlvbignZGlzYWJsZU1vbml0b3JpbmcnKTsKCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCAzMDsgaW5kZXgrKykgewogICAgICAgICAgICAvLyBXYWl0IDMwIHNlY29uZHMgZm9yIHRoZSBjb250YWluZXJzIHRvIGdvCiAgICAgICAgICAgICAgY29uc3QgaGFzVjFNb25pdG9yaW5nID0gaGF2ZVYxTW9uaXRvcmluZyh0aGlzLiRzdG9yZS5nZXR0ZXJzKTsKICAgICAgICAgICAgICBjb25zdCBoYXNWMU1vbml0b3JpbmdXb3JrbG9hZHMgPSBhd2FpdCBoYXZlVjFNb25pdG9yaW5nV29ya2xvYWRzKHRoaXMuJHN0b3JlKTsKCiAgICAgICAgICAgICAgaWYgKCghaGFzVjFNb25pdG9yaW5nICYmICFoYXNWMU1vbml0b3JpbmdXb3JrbG9hZHMpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGUnLCB7IHJlYWR5OiB0cnVlLCBoaWRkZW46IHRydWUgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmhhdmVWMU1vbml0b3JpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBidXR0b25Eb25lKHRydWUpOwoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXdhaXQgZGVsYXkoMTAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVuaW5zdGFsbDogdGltZWQgb3V0YCk7CiAgICAgICAgICB9LAogICAgICAgICAgdGl0bGU6IHRoaXMudCgncHJvbXB0UmVtb3ZlLnRpdGxlJywge30sIHRydWUpLAogICAgICAgICAgYm9keTogIHRoaXMudCgnbW9uaXRvcmluZy5pbnN0YWxsU3RlcHMudW5pbnN0YWxsVjEucHJvbXB0RGVzY3JpcHRpb24nLCB7fSwgdHJ1ZSksCiAgICAgICAgfSwKICAgICAgfSk7CiAgICAgIGJ1dHRvbkNiKHRydWUpOwogICAgfSwKICB9Cn07Cgo="},{"version":3,"sources":["uninstall-v1.vue"],"names":[],"mappings":";AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"uninstall-v1.vue","sourceRoot":"node_modules/@rancher/shell/chart/monitoring/steps","sourcesContent":["\n<script>\nimport { haveV1Monitoring, haveV1MonitoringWorkloads } from '@shell/utils/monitoring';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport IconMessage from '@shell/components/IconMessage';\n\nfunction delay(t, v) {\n  return new Promise((resolve) => {\n    setTimeout(resolve.bind(null, v), t);\n  });\n}\n\nexport default {\n\n  label:   'monitoring.installSteps.uninstallV1.stepTitle',\n  subtext: 'monitoring.installSteps.uninstallV1.stepSubtext',\n  weight:  100,\n\n  components: {\n    AsyncButton,\n    IconMessage\n  },\n\n  data() {\n    return {\n      haveV1Monitoring: false,\n      error:            null,\n    };\n  },\n\n  mounted() {\n    this.haveV1Monitoring = haveV1Monitoring(this.$store.getters);\n    this.$emit('update', {\n      loading: false,\n      ready:   false,\n      hidden:  !this.haveV1Monitoring,\n    });\n  },\n\n  methods: {\n    uninstall(buttonCb) {\n      this.$store.dispatch('cluster/promptModal', {\n        component:      'GenericPrompt',\n        componentProps: {\n          applyMode:   'uninstall',\n          applyAction: async(buttonDone) => {\n            await this.$store.getters['currentCluster'].doAction('disableMonitoring');\n\n            for (let index = 0; index < 30; index++) {\n            // Wait 30 seconds for the containers to go\n              const hasV1Monitoring = haveV1Monitoring(this.$store.getters);\n              const hasV1MonitoringWorkloads = await haveV1MonitoringWorkloads(this.$store);\n\n              if ((!hasV1Monitoring && !hasV1MonitoringWorkloads)) {\n                this.$emit('update', { ready: true, hidden: true });\n                this.haveV1Monitoring = false;\n\n                buttonDone(true);\n\n                return;\n              }\n              await delay(1000);\n            }\n\n            throw new Error(`Failed to uninstall: timed out`);\n          },\n          title: this.t('promptRemove.title', {}, true),\n          body:  this.t('monitoring.installSteps.uninstallV1.promptDescription', {}, true),\n        },\n      });\n      buttonCb(true);\n    },\n  }\n};\n\n</script>\n<template>\n  <div class=\"v1-monitoring\">\n    <template v-if=\"haveV1Monitoring\">\n      <IconMessage\n        class=\"mt-40 mb-20\"\n        icon=\"icon-warning\"\n        :vertical=\"true\"\n        icon-state=\"warning\"\n      >\n        <template #message>\n          <p>\n            {{ t('monitoring.installSteps.uninstallV1.warning1') }}\n          </p>\n          <p\n            v-clean-html=\"t('monitoring.installSteps.uninstallV1.warning2', {}, true)\"\n            class=\"mt-10\"\n          />\n        </template>\n      </IconMessage>\n      <AsyncButton\n        mode=\"uninstall\"\n        :delay=\"0\"\n        @click=\"uninstall\"\n      />\n    </template>\n    <IconMessage\n      v-else\n      class=\"mt-40\"\n      icon=\"icon-checkmark\"\n      :vertical=\"true\"\n      icon-state=\"success\"\n    >\n      <template #message>\n        <p class=\"\">\n          {{ t('monitoring.installSteps.uninstallV1.success1') }}\n        </p>\n        <p\n          v-clean-html=\"t('monitoring.installSteps.uninstallV1.success2')\"\n          class=\"mt-10\"\n        />\n      </template>\n    </IconMessage>\n  </div>\n</template>\n\n<style lang='scss' scoped>\n.v1-monitoring {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  p {\n    max-width: 900px;\n  }\n  .btn {\n    min-width: 200px;\n  }\n}\n</style>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/CatalogUninstallDialog.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/CatalogUninstallDialog.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKCmltcG9ydCB7IENBVEFMT0csIFVJX1BMVUdJTiwgU0VSVklDRSwgV09SS0xPQURfVFlQRVMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgVUlfUExVR0lOX0xBQkVMUywgVUlfUExVR0lOX05BTUVTUEFDRSB9IGZyb20gJ0BzaGVsbC9jb25maWcvdWlwbHVnaW5zJzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKCmltcG9ydCBBc3luY0J1dHRvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Bc3luY0J1dHRvbic7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBBc3luY0J1dHRvbiB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGlmICggdGhpcy4kc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9zY2hlbWFGb3InXShVSV9QTFVHSU4pICkgewogICAgICBjb25zdCBwbHVnaW5zID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogVUlfUExVR0lOIH0pOwoKICAgICAgdGhpcy5wbHVnaW5zID0gcGx1Z2lucyB8fCBbXTsKICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY2F0YWxvZzogdW5kZWZpbmVkLCBidXN5OiBmYWxzZSwgcGx1Z2luczogbnVsbAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyh7IGFsbENoYXJ0czogJ2NhdGFsb2cvY2hhcnRzJyB9KSwKCiAgICBwbHVnaW5zRnJvbUNhdGFsb2dJbWFnZSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGx1Z2lucy5maWx0ZXIoKHApID0+IHAubWV0YWRhdGE/LmxhYmVscz8uW1VJX1BMVUdJTl9MQUJFTFMuQ0FUQUxPR19JTUFHRV0pOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3dEaWFsb2coY2F0YWxvZykgewogICAgICB0aGlzLmNhdGFsb2cgPSBjYXRhbG9nOwogICAgICB0aGlzLmJ1c3kgPSBmYWxzZTsKICAgICAgdGhpcy4kbW9kYWwuc2hvdygndW5pbnN0YWxsQ2F0YWxvZ0RpYWxvZycpOwogICAgfSwKCiAgICBjbG9zZURpYWxvZyhyZXN1bHQpIHsKICAgICAgdGhpcy4kbW9kYWwuaGlkZSgndW5pbnN0YWxsQ2F0YWxvZ0RpYWxvZycpOwogICAgICB0aGlzLiRlbWl0KCdjbG9zZWQnLCByZXN1bHQpOwoKICAgICAgaWYgKCByZXN1bHQgKSB7CiAgICAgICAgdGhpcy4kZW1pdCgncmVmcmVzaCcpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHVuaW5zdGFsbCgpIHsKICAgICAgdGhpcy5idXN5ID0gdHJ1ZTsKCiAgICAgIGNvbnN0IGNhdGFsb2cgPSB0aGlzLmNhdGFsb2c7CiAgICAgIGNvbnN0IGFwcHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBDQVRBTE9HLkFQUCB9KTsKICAgICAgY29uc3QgcGx1Z2luQXBwcyA9IGFwcHMuZmlsdGVyKChhcHApID0+IHsKICAgICAgICBpZiAoIGFwcC5uYW1lc3BhY2UgPT09IFVJX1BMVUdJTl9OQU1FU1BBQ0UgKSB7CiAgICAgICAgICAvLyBGaW5kIHRoZSByZWxhdGVkIGFwcHMgZnJvbSB0aGUgZGVwbG95ZWQgaGVsbSByZXBvc2l0b3J5CiAgICAgICAgICBjb25zdCBjaGFydHMgPSB0aGlzLmFsbENoYXJ0cy5maWx0ZXIoKGNoYXJ0KSA9PiBjaGFydC5yZXBvTmFtZSA9PT0gY2F0YWxvZy5yZXBvPy5tZXRhZGF0YT8ubmFtZSk7CgogICAgICAgICAgcmV0dXJuIGNoYXJ0cy5zb21lKChjaGFydCkgPT4gY2hhcnQuY2hhcnROYW1lID09PSBhcHAubWV0YWRhdGEubmFtZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0pOwoKICAgICAgYXdhaXQgdGhpcy5yZW1vdmVDYXRhbG9nUmVzb3VyY2VzKGNhdGFsb2cpOwoKICAgICAgaWYgKCBwbHVnaW5BcHBzLmxlbmd0aCApIHsKICAgICAgICB0cnkgewogICAgICAgICAgcGx1Z2luQXBwcy5mb3JFYWNoKChhcHApID0+IHsKICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlJywgYXBwLm5hbWUsICd1bmluc3RhbGwnKTsKICAgICAgICAgICAgYXBwLnJlbW92ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2dyb3dsL2Vycm9yJywgewogICAgICAgICAgICB0aXRsZTogICB0aGlzLnQoJ3BsdWdpbnMuZXJyb3IuZ2VuZXJpYycpLAogICAgICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UgPyBlLm1lc3NhZ2UgOiBlLAogICAgICAgICAgICB0aW1lb3V0OiAxMDAwMAogICAgICAgICAgfSwgeyByb290OiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FUQUxPRy5PUEVSQVRJT04gfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2xvc2VEaWFsb2coY2F0YWxvZyk7CiAgICB9LAoKICAgIGFzeW5jIHJlbW92ZUNhdGFsb2dSZXNvdXJjZXMoY2F0YWxvZykgewogICAgICBjb25zdCBzZWxlY3RvciA9IGAkeyBVSV9QTFVHSU5fTEFCRUxTLkNBVEFMT0dfSU1BR0UgfT0keyBjYXRhbG9nLm5hbWUgfWA7CiAgICAgIGNvbnN0IG5hbWVzcGFjZSA9IFVJX1BMVUdJTl9OQU1FU1BBQ0U7CgogICAgICBpZiAoIHNlbGVjdG9yICkgewogICAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBhbGxIYXNoKHsKICAgICAgICAgIGRlcGxveW1lbnQ6IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRNYXRjaGluZycsIHsKICAgICAgICAgICAgdHlwZTogV09SS0xPQURfVFlQRVMuREVQTE9ZTUVOVCwgc2VsZWN0b3IsIG5hbWVzcGFjZQogICAgICAgICAgfSksCiAgICAgICAgICBzZXJ2aWNlOiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kTWF0Y2hpbmcnLCB7CiAgICAgICAgICAgIHR5cGU6IFNFUlZJQ0UsIHNlbGVjdG9yLCBuYW1lc3BhY2UKICAgICAgICAgIH0pLAogICAgICAgICAgcmVwbzogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZE1hdGNoaW5nJywgeyB0eXBlOiBDQVRBTE9HLkNMVVNURVJfUkVQTywgc2VsZWN0b3IgfSkKICAgICAgICB9KTsKCiAgICAgICAgZm9yICggY29uc3QgcmVzb3VyY2Ugb2YgT2JqZWN0LmtleXMoaGFzaCkgKSB7CiAgICAgICAgICBpZiAoIGhhc2hbcmVzb3VyY2VdICkgewogICAgICAgICAgICBoYXNoW3Jlc291cmNlXS5mb3JFYWNoKChyKSA9PiByLnJlbW92ZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["CatalogUninstallDialog.vue"],"names":[],"mappings":";AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CatalogUninstallDialog.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\n\nimport { CATALOG, UI_PLUGIN, SERVICE, WORKLOAD_TYPES } from '@shell/config/types';\nimport { UI_PLUGIN_LABELS, UI_PLUGIN_NAMESPACE } from '@shell/config/uiplugins';\nimport { allHash } from '@shell/utils/promise';\n\nimport AsyncButton from '@shell/components/AsyncButton';\n\nexport default {\n  components: { AsyncButton },\n\n  async fetch() {\n    if ( this.$store.getters['management/schemaFor'](UI_PLUGIN) ) {\n      const plugins = this.$store.dispatch('management/findAll', { type: UI_PLUGIN });\n\n      this.plugins = plugins || [];\n    }\n  },\n\n  data() {\n    return {\n      catalog: undefined, busy: false, plugins: null\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allCharts: 'catalog/charts' }),\n\n    pluginsFromCatalogImage() {\n      return this.plugins.filter((p) => p.metadata?.labels?.[UI_PLUGIN_LABELS.CATALOG_IMAGE]);\n    }\n  },\n\n  methods: {\n    showDialog(catalog) {\n      this.catalog = catalog;\n      this.busy = false;\n      this.$modal.show('uninstallCatalogDialog');\n    },\n\n    closeDialog(result) {\n      this.$modal.hide('uninstallCatalogDialog');\n      this.$emit('closed', result);\n\n      if ( result ) {\n        this.$emit('refresh');\n      }\n    },\n\n    async uninstall() {\n      this.busy = true;\n\n      const catalog = this.catalog;\n      const apps = await this.$store.dispatch('management/findAll', { type: CATALOG.APP });\n      const pluginApps = apps.filter((app) => {\n        if ( app.namespace === UI_PLUGIN_NAMESPACE ) {\n          // Find the related apps from the deployed helm repository\n          const charts = this.allCharts.filter((chart) => chart.repoName === catalog.repo?.metadata?.name);\n\n          return charts.some((chart) => chart.chartName === app.metadata.name);\n        }\n\n        return false;\n      });\n\n      await this.removeCatalogResources(catalog);\n\n      if ( pluginApps.length ) {\n        try {\n          pluginApps.forEach((app) => {\n            this.$emit('update', app.name, 'uninstall');\n            app.remove();\n          });\n        } catch (e) {\n          this.$store.dispatch('growl/error', {\n            title:   this.t('plugins.error.generic'),\n            message: e.message ? e.message : e,\n            timeout: 10000\n          }, { root: true });\n        }\n\n        await this.$store.dispatch('management/findAll', { type: CATALOG.OPERATION });\n      }\n\n      this.closeDialog(catalog);\n    },\n\n    async removeCatalogResources(catalog) {\n      const selector = `${ UI_PLUGIN_LABELS.CATALOG_IMAGE }=${ catalog.name }`;\n      const namespace = UI_PLUGIN_NAMESPACE;\n\n      if ( selector ) {\n        const hash = await allHash({\n          deployment: this.$store.dispatch('management/findMatching', {\n            type: WORKLOAD_TYPES.DEPLOYMENT, selector, namespace\n          }),\n          service: this.$store.dispatch('management/findMatching', {\n            type: SERVICE, selector, namespace\n          }),\n          repo: this.$store.dispatch('management/findMatching', { type: CATALOG.CLUSTER_REPO, selector })\n        });\n\n        for ( const resource of Object.keys(hash) ) {\n          if ( hash[resource] ) {\n            hash[resource].forEach((r) => r.remove());\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <modal\n    name=\"uninstallCatalogDialog\"\n    height=\"auto\"\n    :scrollable=\"true\"\n  >\n    <div\n      v-if=\"catalog\"\n      class=\"plugin-install-dialog\"\n    >\n      <h4 class=\"mt-10\">\n        {{ t('plugins.uninstall.title', { name: catalog.name }) }}\n      </h4>\n      <div class=\"mt-10 dialog-panel\">\n        <div class=\"dialog-info\">\n          <p>\n            {{ t('plugins.uninstall.catalog') }}\n          </p>\n        </div>\n        <div class=\"dialog-buttons\">\n          <button\n            :disabled=\"busy\"\n            class=\"btn role-secondary\"\n            data-testid=\"uninstall-ext-modal-cancel-btn\"\n            @click=\"closeDialog(false)\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n          <AsyncButton\n            mode=\"uninstall\"\n            data-testid=\"uninstall-ext-modal-uninstall-btn\"\n            @click=\"uninstall()\"\n          />\n        </div>\n      </div>\n    </div>\n  </modal>\n</template>\n\n<style lang=\"scss\" scoped>\n  .plugin-install-dialog {\n    padding: 10px;\n\n    h4 {\n      font-weight: bold;\n    }\n\n    .dialog-panel {\n      display: flex;\n      flex-direction: column;\n      min-height: 100px;\n\n      .dialog-info {\n        flex: 1;\n      }\n    }\n\n    .dialog-buttons {\n      display: flex;\n      justify-content: flex-end;\n      margin-top: 10px;\n\n      > *:not(:last-child) {\n        margin-right: 10px;\n      }\n    }\n  }\n</style>\n"]}]}
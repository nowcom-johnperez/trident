{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/chart/rancher-backup/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/chart/rancher-backup/index.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBUYWIgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvVGFiYmVkL1RhYic7CmltcG9ydCBTMyBmcm9tICdAc2hlbGwvY2hhcnQvcmFuY2hlci1iYWNrdXAvUzMnOwppbXBvcnQgeyBSYWRpb0dyb3VwIH0gZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9SYWRpbyc7CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdCc7CmltcG9ydCB7IExhYmVsZWRJbnB1dCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vTGFiZWxlZElucHV0JzsKaW1wb3J0IHsgQmFubmVyIH0gZnJvbSAnQGNvbXBvbmVudHMvQmFubmVyJzsKaW1wb3J0IHsgZ2V0IH0gZnJvbSAnQHNoZWxsL3V0aWxzL29iamVjdCc7CmltcG9ydCB7IGFsbEhhc2ggfSBmcm9tICdAc2hlbGwvdXRpbHMvcHJvbWlzZSc7CmltcG9ydCB7IFNUT1JBR0VfQ0xBU1MsIFNFQ1JFVCwgUFYgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgeyBTVE9SQUdFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9sYWJlbHMtYW5ub3RhdGlvbnMnOwppbXBvcnQgQ2hhcnRQc3AgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ2hhcnRQc3AnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIFRhYiwKICAgIFJhZGlvR3JvdXAsCiAgICBTMywKICAgIExhYmVsZWRJbnB1dCwKICAgIExhYmVsZWRTZWxlY3QsCiAgICBCYW5uZXIsCiAgICBDaGFydFBzcAogIH0sCgogIGhhc1RhYnM6IHRydWUsCgogIHByb3BzOiB7CiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0KICAgIH0sCgogICAgbW9kZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdjcmVhdGUnCiAgICB9CiAgfSwKCiAgYXN5bmMgIGZldGNoKCkgewogICAgY29uc3QgaGFzaCA9IGF3YWl0IGFsbEhhc2goewogICAgICBzdG9yYWdlQ2xhc3NlczogICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsgdHlwZTogU1RPUkFHRV9DTEFTUyB9KSwKICAgICAgcGVyc2lzdGVudFZvbHVtZXM6IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmRBbGwnLCB7IHR5cGU6IFBWIH0pLAogICAgICBzZWNyZXRzOiAgICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsgdHlwZTogU0VDUkVUIH0pLAogICAgfSk7CgogICAgdGhpcy5zZWNyZXRzID0gaGFzaC5zZWNyZXRzOwogICAgdGhpcy5zdG9yYWdlQ2xhc3NlcyA9IGhhc2guc3RvcmFnZUNsYXNzZXM7CiAgICB0aGlzLnBlcnNpc3RlbnRWb2x1bWVzID0gaGFzaC5wZXJzaXN0ZW50Vm9sdW1lczsKCiAgICB0aGlzLnN0b3JhZ2VTb3VyY2UgPSB0aGlzLmdldFN0b3JhZ2VTb3VyY2UodGhpcy52YWx1ZSkgfHwgJ25vbmUnOwogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzZWNyZXRzOiAgICAgICAgICAgW10sCiAgICAgIHN0b3JhZ2VDbGFzc2VzOiAgICBbXSwKICAgICAgcGVyc2lzdGVudFZvbHVtZXM6IFtdLAogICAgICBzdG9yYWdlU291cmNlOiAgICAgbnVsbCwKICAgICAgc3RvcmFnZUNsYXNzOiAgICAgICcnLAogICAgICBwZXJzaXN0ZW50Vm9sdW1lOiAgJycsCiAgICAgIHJlY2xhaW1XYXJuaW5nOiAgICBmYWxzZQogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgZGVmYXVsdFN0b3JhZ2VDbGFzcygpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZUNsYXNzZXMuZmlsdGVyKChzYykgPT4gc2MubWV0YWRhdGEuYW5ub3RhdGlvbnNbU1RPUkFHRS5ERUZBVUxUX1NUT1JBR0VfQ0xBU1NdICYmIHNjLm1ldGFkYXRhLmFubm90YXRpb25zW1NUT1JBR0UuREVGQVVMVF9TVE9SQUdFX0NMQVNTXSAhPT0gJ2ZhbHNlJyApWzBdIHx8ICcnOwogICAgfSwKCiAgICBhdmFpbGFibGVQVnMoKSB7CiAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbnRWb2x1bWVzLmZpbHRlcigocHYpID0+IHB2LnN0YXR1cy5waGFzZS50b0xvd2VyQ2FzZSgpICE9PSAnYm91bmQnKTsKICAgIH0sCgogICAgcmFkaW9PcHRpb25zKCkgewogICAgICBjb25zdCBvcHRpb25zID0gWydub25lJywgJ3MzJywgJ3BpY2tTQycsICdwaWNrUFYnXTsKICAgICAgY29uc3QgbGFiZWxzID0gWwogICAgICAgIHRoaXMudCgnYmFja3VwUmVzdG9yZU9wZXJhdG9yLmRlcGxveW1lbnQuc3RvcmFnZS5vcHRpb25zLm5vbmUnKSwKICAgICAgICB0aGlzLnQoJ2JhY2t1cFJlc3RvcmVPcGVyYXRvci5kZXBsb3ltZW50LnN0b3JhZ2Uub3B0aW9ucy5zMycpLAogICAgICAgIHRoaXMudCgnYmFja3VwUmVzdG9yZU9wZXJhdG9yLmRlcGxveW1lbnQuc3RvcmFnZS5vcHRpb25zLnBpY2tTQycpLAogICAgICAgIHRoaXMudCgnYmFja3VwUmVzdG9yZU9wZXJhdG9yLmRlcGxveW1lbnQuc3RvcmFnZS5vcHRpb25zLnBpY2tQVicpLAogICAgICBdOwoKICAgICAgcmV0dXJuIHsgb3B0aW9ucywgbGFiZWxzIH07CiAgICB9LAoKICAgIC4uLm1hcEdldHRlcnMoWydjdXJyZW50Q2x1c3RlciddLCB7IHQ6ICdpMThuL3QnIH0pLAogIH0sCgogIHdhdGNoOiB7CiAgICBzdG9yYWdlU291cmNlKG5ldSkgewogICAgICBzd2l0Y2ggKG5ldSkgewogICAgICBjYXNlICdwaWNrU0MnOgogICAgICAgIHRoaXMudmFsdWUucGVyc2lzdGVuY2UuZW5hYmxlZCA9IHRydWU7CiAgICAgICAgdGhpcy52YWx1ZS5zMy5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFN0b3JhZ2VDbGFzcyAmJiAoIXRoaXMudmFsdWUucGVyc2lzdGVuY2Uuc3RvcmFnZUNsYXNzIHx8IHRoaXMudmFsdWUucGVyc2lzdGVuY2Uuc3RvcmFnZUNsYXNzID09PSAnLScgKSkgewogICAgICAgICAgdGhpcy52YWx1ZS5wZXJzaXN0ZW5jZS5zdG9yYWdlQ2xhc3MgPSB0aGlzLmRlZmF1bHRTdG9yYWdlQ2xhc3MuaWQ7CiAgICAgICAgICB0aGlzLnN0b3JhZ2VDbGFzcyA9IHRoaXMuZGVmYXVsdFN0b3JhZ2VDbGFzczsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RvcmFnZUNsYXNzPy5yZWNsYWltUG9saWN5ID09PSAnRGVsZXRlJykgewogICAgICAgICAgdGhpcy5yZWNsYWltV2FybmluZyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLnZvbHVtZU5hbWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3BpY2tQVic6CiAgICAgICAgdGhpcy52YWx1ZS5wZXJzaXN0ZW5jZS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLnZhbHVlLnMzLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLnN0b3JhZ2VDbGFzcyA9ICctJzsKICAgICAgICB0aGlzLnJlY2xhaW1XYXJuaW5nID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3MzJzoKICAgICAgICB0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLnZhbHVlLnMzLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRoaXMudmFsdWUucGVyc2lzdGVuY2UuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgIHRoaXMudmFsdWUuczMuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIHN0b3JhZ2VDbGFzcyhuZXUgPSB7fSkgewogICAgICB0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLnN0b3JhZ2VDbGFzcyA9IG5ldS5pZDsKICAgICAgaWYgKG5ldS5yZWNsYWltUG9saWN5ID09PSAnRGVsZXRlJykgewogICAgICAgIHRoaXMucmVjbGFpbVdhcm5pbmcgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmVjbGFpbVdhcm5pbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBwZXJzaXN0ZW50Vm9sdW1lKG5ldSkgewogICAgICB0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLnZvbHVtZU5hbWUgPSBuZXUubWV0YWRhdGEubmFtZTsKICAgICAgaWYgKG5ldS5zcGVjPy5wZXJzaXN0ZW50Vm9sdW1lUmVjbGFpbVBvbGljeSA9PT0gJ0RlbGV0ZScpIHsKICAgICAgICB0aGlzLnJlY2xhaW1XYXJuaW5nID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlY2xhaW1XYXJuaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgfSwKCiAgbWV0aG9kczogewogICAgZ2V0U3RvcmFnZVNvdXJjZSgpIHsKICAgICAgaWYgKGdldCh0aGlzLnZhbHVlLCAnczMuZW5hYmxlZCcpKSB7CiAgICAgICAgcmV0dXJuICdzMyc7CiAgICAgIH0gaWYgKGdldCh0aGlzLnZhbHVlLCAncGVyc2lzdGVuY2UuZW5hYmxlZCcpKSB7CiAgICAgICAgaWYgKHRoaXMudmFsdWUucGVyc2lzdGVuY2Uuc3RvcmFnZUNsYXNzKSB7CiAgICAgICAgICByZXR1cm4gJ3BpY2tTQyc7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnZhbHVlLnBlcnNpc3RlbmNlLnZvbHVtZU5hbWUpIHsKICAgICAgICAgIHJldHVybiAncGlja1BWJzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAnbm9uZSc7CiAgICB9LAogICAgdXBkYXRlUGFnZVZhbGlkKHVwZGF0ZSkgewogICAgICB0aGlzLiRlbWl0KCd2YWxpZCcsIHVwZGF0ZSk7CiAgICB9CiAgfSwKICBnZXQKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/chart/rancher-backup","sourcesContent":["<script>\nimport Tab from '@shell/components/Tabbed/Tab';\nimport S3 from '@shell/chart/rancher-backup/S3';\nimport { RadioGroup } from '@components/Form/Radio';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { Banner } from '@components/Banner';\nimport { get } from '@shell/utils/object';\nimport { allHash } from '@shell/utils/promise';\nimport { STORAGE_CLASS, SECRET, PV } from '@shell/config/types';\nimport { mapGetters } from 'vuex';\nimport { STORAGE } from '@shell/config/labels-annotations';\nimport ChartPsp from '@shell/components/ChartPsp';\n\nexport default {\n  components: {\n    Tab,\n    RadioGroup,\n    S3,\n    LabeledInput,\n    LabeledSelect,\n    Banner,\n    ChartPsp\n  },\n\n  hasTabs: true,\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    },\n\n    mode: {\n      type:    String,\n      default: 'create'\n    }\n  },\n\n  async  fetch() {\n    const hash = await allHash({\n      storageClasses:    this.$store.dispatch('cluster/findAll', { type: STORAGE_CLASS }),\n      persistentVolumes: this.$store.dispatch('cluster/findAll', { type: PV }),\n      secrets:           this.$store.dispatch('cluster/findAll', { type: SECRET }),\n    });\n\n    this.secrets = hash.secrets;\n    this.storageClasses = hash.storageClasses;\n    this.persistentVolumes = hash.persistentVolumes;\n\n    this.storageSource = this.getStorageSource(this.value) || 'none';\n  },\n\n  data() {\n    return {\n      secrets:           [],\n      storageClasses:    [],\n      persistentVolumes: [],\n      storageSource:     null,\n      storageClass:      '',\n      persistentVolume:  '',\n      reclaimWarning:    false\n    };\n  },\n\n  computed: {\n    defaultStorageClass() {\n      return this.storageClasses.filter((sc) => sc.metadata.annotations[STORAGE.DEFAULT_STORAGE_CLASS] && sc.metadata.annotations[STORAGE.DEFAULT_STORAGE_CLASS] !== 'false' )[0] || '';\n    },\n\n    availablePVs() {\n      return this.persistentVolumes.filter((pv) => pv.status.phase.toLowerCase() !== 'bound');\n    },\n\n    radioOptions() {\n      const options = ['none', 's3', 'pickSC', 'pickPV'];\n      const labels = [\n        this.t('backupRestoreOperator.deployment.storage.options.none'),\n        this.t('backupRestoreOperator.deployment.storage.options.s3'),\n        this.t('backupRestoreOperator.deployment.storage.options.pickSC'),\n        this.t('backupRestoreOperator.deployment.storage.options.pickPV'),\n      ];\n\n      return { options, labels };\n    },\n\n    ...mapGetters(['currentCluster'], { t: 'i18n/t' }),\n  },\n\n  watch: {\n    storageSource(neu) {\n      switch (neu) {\n      case 'pickSC':\n        this.value.persistence.enabled = true;\n        this.value.s3.enabled = false;\n        if (this.defaultStorageClass && (!this.value.persistence.storageClass || this.value.persistence.storageClass === '-' )) {\n          this.value.persistence.storageClass = this.defaultStorageClass.id;\n          this.storageClass = this.defaultStorageClass;\n        }\n        if (this.storageClass?.reclaimPolicy === 'Delete') {\n          this.reclaimWarning = true;\n        }\n        delete this.value.persistence.volumeName;\n        break;\n      case 'pickPV':\n        this.value.persistence.enabled = true;\n        this.value.s3.enabled = false;\n        this.value.persistence.storageClass = '-';\n        this.reclaimWarning = false;\n        break;\n      case 's3':\n        this.value.persistence.enabled = false;\n        this.value.s3.enabled = true;\n        break;\n      default:\n        this.value.persistence.enabled = false;\n        this.value.s3.enabled = false;\n        break;\n      }\n    },\n\n    storageClass(neu = {}) {\n      this.value.persistence.storageClass = neu.id;\n      if (neu.reclaimPolicy === 'Delete') {\n        this.reclaimWarning = true;\n      } else {\n        this.reclaimWarning = false;\n      }\n    },\n\n    persistentVolume(neu) {\n      this.value.persistence.volumeName = neu.metadata.name;\n      if (neu.spec?.persistentVolumeReclaimPolicy === 'Delete') {\n        this.reclaimWarning = true;\n      } else {\n        this.reclaimWarning = false;\n      }\n    },\n  },\n\n  methods: {\n    getStorageSource() {\n      if (get(this.value, 's3.enabled')) {\n        return 's3';\n      } if (get(this.value, 'persistence.enabled')) {\n        if (this.value.persistence.storageClass) {\n          return 'pickSC';\n        }\n        if (this.value.persistence.volumeName) {\n          return 'pickPV';\n        }\n      }\n\n      return 'none';\n    },\n    updatePageValid(update) {\n      this.$emit('valid', update);\n    }\n  },\n  get\n};\n</script>\n\n<template>\n  <div>\n    <Tab\n      label=\"Chart Options\"\n      name=\"chartOptions\"\n    >\n      <!-- Conditionally display PSP checkbox -->\n      <ChartPsp\n        :value=\"value\"\n        :cluster=\"currentCluster\"\n      />\n\n      <Banner\n        color=\"info\"\n        :label=\"t('backupRestoreOperator.deployment.storage.tip')\"\n      />\n      <RadioGroup\n        v-model=\"storageSource\"\n        name=\"storageSource\"\n        :label=\"t('backupRestoreOperator.deployment.storage.label')\"\n        class=\"mb-10\"\n        :options=\"radioOptions.options\"\n        :labels=\"radioOptions.labels\"\n      />\n      <S3\n        v-if=\"storageSource==='s3'\"\n        :value=\"value.s3\"\n        :secrets=\"secrets\"\n        :mode=\"mode\"\n        @valid=\"updatePageValid($event)\"\n      />\n      <template v-else>\n        <div class=\"row\">\n          <template v-if=\"storageSource === 'pickSC'\">\n            <div class=\"col span-6\">\n              <LabeledSelect\n                :key=\"storageSource\"\n                v-model=\"storageClass\"\n                :get-option-label=\"opt => opt.id || opt\"\n                :label=\"t('backupRestoreOperator.deployment.storage.storageClass.label')\"\n                :tooltip=\"reclaimWarning ? t('backupRestoreOperator.deployment.storage.warning', {type: 'Storage Class'}) : null\"\n                :mode=\"mode\"\n                :status=\"reclaimWarning ? 'warning' : null\"\n                :options=\"storageClasses\"\n                :hover-tooltip=\"true\"\n              />\n            </div>\n            <div class=\"col span-6\">\n              <LabeledInput\n                v-model=\"value.persistence.size\"\n                :mode=\"mode\"\n                :label=\"t('backupRestoreOperator.deployment.size')\"\n              />\n            </div>\n          </template>\n          <div\n            v-else-if=\"storageSource === 'pickPV'\"\n            class=\"col span-6\"\n          >\n            <LabeledSelect\n              :key=\"storageSource\"\n              v-model=\"persistentVolume\"\n              :get-option-label=\"opt => opt.id || opt\"\n              :label=\"t('backupRestoreOperator.deployment.storage.persistentVolume.label')\"\n              :tooltip=\"reclaimWarning ? t('backupRestoreOperator.deployment.storage.warning', {type: 'Persistent Volume'}) : null\"\n              :mode=\"mode\"\n              :status=\"reclaimWarning ? 'warning' : null\"\n              :options=\"availablePVs\"\n              :hover-tooltip=\"true\"\n            />\n          </div>\n        </div>\n      </template>\n    </Tab>\n  </div>\n</template>\n\n<style lang='scss' scoped>\n::v-deep .radio-group.label>SPAN {\n  font-size: 1em;\n}\n</style>\n"]}]}
{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/list/management.cattle.io.feature.vue?vue&type=style&index=0&id=829a59d6&lang=scss&scoped=true","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/list/management.cattle.io.feature.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1716430467357},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1716430467929},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/postcss-loader/src/index.js","mtime":1716430467882},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/sass-loader/dist/cjs.js","mtime":1716430453705},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5wcm9tcHQtdXBkYXRlIHsKICAmLmNhcmQtY29udGFpbmVyIHsKICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgfQoKICA6OnYtZGVlcCAuY2FyZC1hY3Rpb25zIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICB9Cn0KCi53YWl0aW5nIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgZm9udC1zaXplOiAxNHB4OwogIG1hcmdpbjogMTBweCAwOwoKICBwIHsKICAgIGxpbmUtaGVpZ2h0OiAyMHB4OzsKICB9Cn0KCi5yZXN0YXJ0aW5nLWljb24gewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgbWFyZ2luLXRvcDogMTBweDsKCiAgPiBJIHsKICBmb250LXNpemU6IDI0cHg7CiAgfQp9CgouZmVhdHVyZS1uYW1lIHsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGRpc3BsYXk6IGZsZXg7CgogID4gaSB7CiAgICBtYXJnaW4tbGVmdDogMTBweDsKICB9Cn0K"},{"version":3,"sources":["management.cattle.io.feature.vue"],"names":[],"mappings":";AA+WA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"management.cattle.io.feature.vue","sourceRoot":"node_modules/@rancher/shell/list","sourcesContent":["<script>\nimport { mapState, mapGetters } from 'vuex';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Card } from '@components/Card';\nimport ResourceTable from '@shell/components/ResourceTable';\nimport { Banner } from '@components/Banner';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { MANAGEMENT } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport ResourceFetch from '@shell/mixins/resource-fetch';\n\nexport default {\n  components: {\n    AsyncButton,\n    Banner,\n    Card,\n    ResourceTable,\n    LabeledInput\n  },\n  mixins: [ResourceFetch],\n  props:  {\n    resource: {\n      type:     String,\n      required: true,\n    },\n\n    schema: {\n      type:     Object,\n      required: true,\n    },\n\n    useQueryParamsForSimpleFiltering: {\n      type:    Boolean,\n      default: false\n    }\n  },\n\n  async fetch() {\n    await this.$fetchType(this.resource);\n\n    this.serverUrlSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.SERVER_URL);\n\n    if (this.serverUrlSetting?.value) {\n      this.serverUrl = this.serverUrlSetting.value;\n    } else {\n      this.noUrlSet = true;\n      if ( process.server ) {\n        const { req } = this.$nuxt.context;\n\n        this.serverUrl = req.headers.host;\n      } else {\n        this.serverUrl = window.location.origin;\n      }\n    }\n  },\n\n  data() {\n    return {\n      update:           [],\n      updateMode:       'activate',\n      error:            null,\n      enabling:         false,\n      restart:          false,\n      waiting:          false,\n      timer:            null,\n      serverUrlSetting: {},\n      serverUrl:        '',\n      noUrlSet:         false,\n    };\n  },\n\n  computed: {\n    ...mapState('action-menu', ['showPromptUpdate', 'toUpdate']),\n    ...mapGetters({ t: 'i18n/t' }),\n\n    filteredRows() {\n      return this.rows.filter((x) => x.name !== 'fleet');\n    },\n\n    promptForUrl() {\n      return this.update?.id === 'multi-cluster-management' && this.noUrlSet;\n    },\n\n    enableRowActions() {\n      const schema = this.$store.getters[`management/schemaFor`](MANAGEMENT.FEATURE);\n\n      return schema?.resourceMethods?.includes('PUT');\n    },\n  },\n\n  $loadingResources() {\n    // results are filtered so we wouldn't get the correct count on indicator...\n    return { loadIndeterminate: true };\n  },\n\n  watch: {\n    showPromptUpdate(show) {\n      if (show) {\n        this.$modal.show('toggleFlag');\n      } else {\n        this.$modal.hide('toggleFlag');\n      }\n    },\n\n    toUpdate(neu) {\n      // Only support updating one at a time - bulk does not make sense, as they may\n      // be in different states and with different restart values\n      this.update = Array.isArray(neu) ? neu[0] : neu;\n      if (this.update) {\n        this.restart = this.update.restartRequired;\n        // If the value is currently false, then we will be enabling it\n        this.enabling = !this.update.enabled;\n        this.updateMode = this.enabling ? 'activate' : 'deactivate';\n      }\n    }\n  },\n\n  methods: {\n    close() {\n      this.$store.commit('action-menu/togglePromptUpdate');\n\n      if (this.timer) {\n        clearTimeout(this.timer);\n        this.timer = null;\n      }\n    },\n\n    toggleFlag(btnCB) {\n      if (this.restart) {\n        this.doToggleWithRestart(btnCB);\n      } else {\n        this.doToggle(btnCB);\n      }\n    },\n\n    async doToggle(btnCB) {\n      this.error = null;\n      try {\n        this.update.spec.value = !this.update.enabled;\n        await this.update.save();\n        btnCB(true);\n        this.close();\n      } catch (err) {\n        this.error = err;\n        btnCB(false);\n      }\n    },\n\n    doToggleWithRestart(btnCB) {\n      this.error = null;\n      try {\n        this.update.spec.value = !this.update.enabled;\n        // await can go back in when backend returns from the save before restarting\n        this.update.save();\n      } catch (err) {}\n\n      this.waitForBackend(btnCB, this.update.id);\n      this.waiting = true;\n    },\n\n    waitForBackend(btnCB, id) {\n      const url = `/v3/features/${ id }`;\n\n      this.timer = setTimeout(async() => {\n        try {\n          const response = await this.$axios.get(url, { timeout: 5000 });\n\n          if (response?.status === 200) {\n            this.rows = await this.$store.dispatch('management/findAll', { type: this.resource, opt: { force: true } });\n            btnCB(true);\n            this.close();\n            this.waiting = false;\n          }\n        } catch (e) {}\n\n        this.waitForBackend(btnCB, id);\n      }, 2500);\n    },\n\n    async saveUrl(btnCB) {\n      try {\n        this.serverUrlSetting.value = this.serverUrl;\n        await this.serverUrlSetting.save();\n        btnCB(true);\n      } catch (err) {\n        this.error = err;\n        btnCB(false);\n      }\n    },\n  }\n};\n</script>\n\n<template>\n  <div>\n    <ResourceTable\n      :schema=\"schema\"\n      :rows=\"filteredRows\"\n      :row-actions=\"enableRowActions\"\n      :loading=\"loading\"\n      :use-query-params-for-simple-filtering=\"useQueryParamsForSimpleFiltering\"\n      :force-update-live-and-delayed=\"forceUpdateLiveAndDelayed\"\n    >\n      <template\n        slot=\"cell:name\"\n        slot-scope=\"scope\"\n      >\n        <div class=\"feature-name\">\n          <div>{{ scope.row.nameDisplay }}</div>\n          <i\n            v-if=\"scope.row.status.lockedValue !== null\"\n            class=\"icon icon-lock\"\n          />\n        </div>\n      </template>\n    </ResourceTable>\n    <modal\n      class=\"update-modal\"\n      name=\"toggleFlag\"\n      :width=\"350\"\n      height=\"auto\"\n      styles=\"max-height: 100vh;\"\n      :click-to-close=\"!restart || !waiting\"\n      @closed=\"close\"\n    >\n      <Card\n        v-if=\"!waiting\"\n        class=\"prompt-update\"\n        :show-highlight-border=\"false\"\n      >\n        <h4\n          slot=\"title\"\n          class=\"text-default-text\"\n        >\n          Are you sure?\n        </h4>\n        <div slot=\"body\">\n          <div\n            v-if=\"update\"\n            class=\"mb-10\"\n          >\n            <div v-if=\"enabling\">\n              <span>\n                {{ t('featureFlags.promptActivate', {flag: update.id}) }}\n              </span>\n              <div\n                v-if=\"promptForUrl\"\n                class=\"mt-10\"\n              >\n                <span> {{ t('featureFlags.requiresSetting') }}</span>\n                <div\n                  :style=\"{'align-items':'center'}\"\n                  class=\"row mt-10\"\n                >\n                  <LabeledInput\n                    v-model=\"serverUrl\"\n                    :label=\"t('setup.serverUrl.label')\"\n                  />\n                  <div class=\"col pl-5\">\n                    <AsyncButton @click=\"saveUrl\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n            <span v-else>\n              {{ t('featureFlags.promptDeactivate', {flag: update.id}) }}\n            </span>\n            <Banner\n              v-if=\"restart\"\n              color=\"warning\"\n              :label=\"t('featureFlags.restartRequired')\"\n            />\n          </div>\n          <div class=\"text-error mb-10\">\n            {{ error }}\n          </div>\n        </div>\n        <template #actions>\n          <button\n            class=\"btn role-secondary\"\n            @click=\"close\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n          <AsyncButton\n            :disabled=\"promptForUrl && !serverUrlSetting.value\"\n            :mode=\"updateMode\"\n            class=\"btn bg-error ml-10\"\n            @click=\"toggleFlag\"\n          />\n        </template>\n      </Card>\n      <Card\n        v-else\n        class=\"prompt-update\"\n        :show-highlight-border=\"false\"\n      >\n        <h4\n          slot=\"title\"\n          class=\"text-default-text\"\n        >\n          {{ t('featureFlags.restart.title') }}\n        </h4>\n        <div\n          slot=\"body\"\n          class=\"waiting\"\n        >\n          <p>{{ t('featureFlags.restart.wait') }}</p>\n          <span class=\"restarting-icon\">\n            <i class=\" icon icon-spinner icon-spin\" />\n          </span>\n        </div>\n        <template #actions>\n          <button\n            class=\"btn role-secondary\"\n            @click=\"close\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n        </template>\n      </Card>\n    </modal>\n  </div>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-update {\n    &.card-container {\n      box-shadow: none;\n    }\n\n    ::v-deep .card-actions {\n      display: flex;\n      justify-content: center;\n    }\n  }\n\n  .waiting {\n    text-align: center;\n    font-size: 14px;\n    margin: 10px 0;\n\n    p {\n      line-height: 20px;;\n    }\n  }\n\n  .restarting-icon {\n    display: flex;\n    justify-content: center;\n    margin-top: 10px;\n\n    > I {\n    font-size: 24px;\n    }\n  }\n\n  .feature-name {\n    align-items: center;\n    display: flex;\n\n    > i {\n      margin-left: 10px;\n    }\n  }\n</style>\n"]}]}
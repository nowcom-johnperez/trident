{"remainingRequest":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/RoleBindings.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@rancher/shell/components/RoleBindings.vue","mtime":1716430447141},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/babel-loader/lib/index.js","mtime":1716430465839},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/cache-loader/dist/cjs.js","mtime":1716430465924},{"path":"/Users/nowcom/Documents/nowcom/trident-extension-package/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1716430467929}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IFJCQUMgYXMgUkJBQ19MQUJFTFMgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCB7IGFsbEhhc2ggfSBmcm9tICdAc2hlbGwvdXRpbHMvcHJvbWlzZSc7CmltcG9ydCB7IFJCQUMsIE1BTkFHRU1FTlQgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgX0NPTkZJRywgX0RFVEFJTCwgX0VESVQsIF9WSUVXIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9xdWVyeS1wYXJhbXMnOwppbXBvcnQgeyBmaW5kQnksIHJlbW92ZUF0LCByZW1vdmVPYmplY3QgfSBmcm9tICdAc2hlbGwvdXRpbHMvYXJyYXknOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IFNvcnRhYmxlVGFibGUgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvU29ydGFibGVUYWJsZSc7CmltcG9ydCBMYWJlbGVkU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTGFiZWxlZFNlbGVjdCc7CgpleHBvcnQgY29uc3QgU0NPUEVfTkFNRVNQQUNFID0gJ1JvbGUnOwpleHBvcnQgY29uc3QgU0NPUEVfQ0xVU1RFUiA9ICdDbHVzdGVyUm9sZSc7Ci8vIGV4cG9ydCBjb25zdCBTQ09QRV9HTE9CQUwgPSAnR2xvYmFsUm9sZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTG9hZGluZywgTGFiZWxlZFNlbGVjdCwgU29ydGFibGVUYWJsZQogIH0sCgogIHByb3BzOiB7CiAgICByZWdpc3RlckFmdGVySG9vazogewogICAgICB0eXBlOiAgICBGdW5jdGlvbiwKICAgICAgZGVmYXVsdDogbnVsbCwKICAgIH0sCgogICAgbW9kZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IF9FRElULAogICAgfSwKCiAgICBhczogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IF9DT05GSUcsCiAgICB9LAoKICAgIGluU3RvcmU6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiAnY2x1c3RlcicsCiAgICB9LAoKICAgIHJvbGVTY29wZTogewogICAgICB0eXBlOiAgICAgU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdmFsaWRhdG9yKHZhbCkgewogICAgICAgIHJldHVybiBbU0NPUEVfTkFNRVNQQUNFLCBTQ09QRV9DTFVTVEVSXS5pbmNsdWRlcyh2YWwpOwogICAgICB9CiAgICB9LAoKICAgIGJpbmRpbmdTY29wZTogewogICAgICB0eXBlOiAgICAgU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdmFsaWRhdG9yKHZhbCkgewogICAgICAgIHJldHVybiBbU0NPUEVfTkFNRVNQQUNFLCBTQ09QRV9DTFVTVEVSXS5pbmNsdWRlcyh2YWwpOwogICAgICB9CiAgICB9LAoKICAgIG5hbWVzcGFjZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICB9LAoKICAgIGZpbHRlclJvbGVLZXk6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiBSQkFDX0xBQkVMUy5QUk9EVUNUCiAgICB9LAoKICAgIGZpbHRlclJvbGVWYWx1ZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICB9LAogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgY29uc3QgaGFzaCA9IHsgYWxsVXNlcnM6IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuVVNFUiB9KSB9OwogICAgY29uc3QgaW5TdG9yZSA9IHRoaXMuaW5TdG9yZTsKCiAgICBpZiAoIHRoaXMucm9sZVNjb3BlID09PSBTQ09QRV9OQU1FU1BBQ0UgKSB7CiAgICAgIGhhc2guYWxsUm9sZXMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaChgJHsgaW5TdG9yZSB9L2ZpbmRBbGxgLCB7IHR5cGU6IFJCQUMuUk9MRSB9KTsKICAgIH0gZWxzZSBpZiAoIHRoaXMucm9sZVNjb3BlID09PSBTQ09QRV9DTFVTVEVSICkgewogICAgICBoYXNoLmFsbFJvbGVzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goYCR7IGluU3RvcmUgfS9maW5kQWxsYCwgeyB0eXBlOiBSQkFDLkNMVVNURVJfUk9MRSB9KTsKICAgIC8vIH0gZWxzZSBpZiAoIHRoaXMucm9sZVNjb3BlID09PSBTQ09QRV9HTE9CQUwgKSB7CiAgICAvLyBoYXNoLmFsbFJvbGVzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5HTE9CQUxfUk9MRSB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biByb2xlU2NvcGUnKTsKICAgIH0KCiAgICBpZiAoIHRoaXMuYmluZGluZ1Njb3BlID09PSBTQ09QRV9OQU1FU1BBQ0UgKSB7CiAgICAgIGhhc2guYWxsQmluZGluZ3MgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaChgJHsgaW5TdG9yZSB9L2ZpbmRBbGxgLCB7IHR5cGU6IFJCQUMuUk9MRV9CSU5ESU5HIH0pOwogICAgfSBlbHNlIGlmICggdGhpcy5iaW5kaW5nU2NvcGUgPT09IFNDT1BFX0NMVVNURVIgKSB7CiAgICAgIGhhc2guYWxsQmluZGluZ3MgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaChgJHsgaW5TdG9yZSB9L2ZpbmRBbGxgLCB7IHR5cGU6IFJCQUMuQ0xVU1RFUl9ST0xFX0JJTkRJTkcgfSk7CiAgICAvLyB9IGVsc2UgaWYgKCB0aGlzLmJpbmRpbmdTY29wZSA9PT0gU0NPUEVfR0xPQkFMICkgewogICAgLy8gaGFzaC5hbGxCaW5kaW5ncyA9IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEVfQklORElORyB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBzY29wZScpOwogICAgfQoKICAgIGNvbnN0IG91dCA9IGF3YWl0IGFsbEhhc2goaGFzaCk7CgogICAgZm9yICggY29uc3Qga2V5IGluIG91dCApIHsKICAgICAgdGhpc1trZXldID0gb3V0W2tleV07CiAgICB9CgogICAgdGhpcy5yZWFkRXhpc3RpbmdCaW5kaW5ncygpOwogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhbGxSb2xlczogICAgbnVsbCwKICAgICAgYWxsQmluZGluZ3M6IG51bGwsCiAgICAgIGFsbFVzZXJzOiAgICBudWxsLAogICAgICByb3dzOiAgICAgICAgbnVsbCwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGlzVmlldygpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gX1ZJRVc7CiAgICB9LAoKICAgIHNob3dEZXRhaWwoKSB7CiAgICAgIHJldHVybiB0aGlzLmFzID09PSBfREVUQUlMOwogICAgfSwKCiAgICBkZXRhaWxIZWFkZXJzKCkgewogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAndHlwZScsCiAgICAgICAgICBsYWJlbEtleTogJ3RhYmxlSGVhZGVycy50eXBlJywKICAgICAgICAgIHZhbHVlOiAgICAnc3ViamVjdEtpbmQnLAogICAgICAgICAgc29ydDogICAgICdzdWJqZWN0S2luZCcsCiAgICAgICAgICBzZWFyY2g6ICAgJ3N1YmplY3RLaW5kJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAnc3ViamVjdCcsCiAgICAgICAgICBsYWJlbEtleTogJ3RhYmxlSGVhZGVycy5zdWJqZWN0JywKICAgICAgICAgIHZhbHVlOiAgICAndXNlck9iai5sYWJlbEZvclNlbGVjdCcsCiAgICAgICAgICBzb3J0OiAgICAgJ3VzZXJPYmoubGFiZWxGb3JTZWxlY3QnLAogICAgICAgICAgc2VhcmNoOiAgICd1c2VyT2JqLmxhYmVsRm9yU2VsZWN0JywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAncm9sZScsCiAgICAgICAgICBsYWJlbEtleTogJ3RhYmxlSGVhZGVycy5yb2xlJywKICAgICAgICAgIHZhbHVlOiAgICAncm9sZU9iai5uYW1lV2l0aGluUHJvZHVjdCcsCiAgICAgICAgICBzb3J0OiAgICAgJ3JvbGVPYmoubmFtZVdpdGhpblByb2R1Y3QnLAogICAgICAgICAgc2VhcmNoOiAgICdyb2xlT2JqLm5hbWVXaXRoaW5Qcm9kdWN0JywKICAgICAgICB9LAogICAgICBdOwogICAgfSwKCiAgICB1c2VyT3B0aW9ucygpIHsKICAgICAgcmV0dXJuIHRoaXMuYWxsVXNlcnMuZmlsdGVyKCh4KSA9PiB7CiAgICAgICAgcmV0dXJuICF4LmlzU3lzdGVtOwogICAgICB9KS5tYXAoKHgpID0+IHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGFiZWw6IHgubGFiZWxGb3JTZWxlY3QsCiAgICAgICAgICB2YWx1ZTogeC5pZCwKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sCgogICAgcm9sZU9wdGlvbnMoKSB7CiAgICAgIHJldHVybiB0aGlzLnJvbGVzLm1hcCgoeCkgPT4gewogICAgICAgIHJldHVybiB7IGxhYmVsOiB4Lm5hbWVXaXRoaW5Qcm9kdWN0LCB2YWx1ZTogeC5uYW1lIH07CiAgICAgIH0pOwogICAgfSwKCiAgICByb2xlcygpIHsKICAgICAgY29uc3QgYWxsID0gdGhpcy5hbGxSb2xlczsKCiAgICAgIGlmICggIXRoaXMuZmlsdGVyUm9sZUtleSB8fCAhdGhpcy5maWx0ZXJSb2xlVmFsdWUgKSB7CiAgICAgICAgcmV0dXJuIGFsbDsKICAgICAgfQoKICAgICAgY29uc3Qgb3V0ID0gYWxsLmZpbHRlcigocm9sZSkgPT4gewogICAgICAgIHJldHVybiByb2xlLm1ldGFkYXRhPy5sYWJlbHM/Llt0aGlzLmZpbHRlclJvbGVLZXldID09PSB0aGlzLmZpbHRlclJvbGVWYWx1ZTsKICAgICAgfSk7CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICBleGlzdGluZ0JpbmRpbmdzKCkgewogICAgICBjb25zdCByb2xlcyA9IHRoaXMucm9sZXMubWFwKCh4KSA9PiB4Lm5hbWUpOwoKICAgICAgY29uc3Qgb3V0ID0gdGhpcy5hbGxCaW5kaW5ncy5maWx0ZXIoKGJpbmRpbmcpID0+IHsKICAgICAgICBpZiAoIGJpbmRpbmcucm9sZVJlZi5raW5kICE9PSB0aGlzLnJvbGVTY29wZSB8fCAhYmluZGluZy5yb2xlUmVmPy5uYW1lKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoIHRoaXMuYmluZGluZ1Njb3BlID09PSBTQ09QRV9OQU1FU1BBQ0UgJiYgYmluZGluZy5tZXRhZGF0YT8ubmFtZXNwYWNlICE9PSB0aGlzLm5hbWVzcGFjZSApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByb2xlcy5pbmNsdWRlcyhiaW5kaW5nLnJvbGVSZWYubmFtZSk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG91dDsKICAgIH0sCgogICAgdW5yZW1vdmVkUm93cygpIHsKICAgICAgcmV0dXJuIHRoaXMucm93cy5maWx0ZXIoKHgpID0+IHgucmVtb3ZlICE9PSB0cnVlKTsKICAgIH0sCiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIGlmICggdGhpcy5tb2RlICE9PSBfVklFVyApIHsKICAgICAgdGhpcy5yZWdpc3RlckFmdGVySG9vayh0aGlzLnNhdmVSb2xlQmluZGluZ3MsICdzYXZlUm9sZUJpbmRpbmdzJyk7CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgcmVhZEV4aXN0aW5nQmluZGluZ3MoKSB7CiAgICAgIHRoaXMucm93cyA9IHRoaXMuZXhpc3RpbmdCaW5kaW5ncy5tYXAoKGJpbmRpbmcpID0+IHsKICAgICAgICBmb3IgKCBsZXQgaSA9IDAgOyBpIDwgYmluZGluZy5zdWJqZWN0cy5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgICBjb25zdCBzdWJqZWN0ID0gYmluZGluZy5zdWJqZWN0c1tpXTsKCiAgICAgICAgICAvLyBXZSBoYXZlIG5vIHdheSB0byBkbyBncm91cHMgcmlnaHQgbm93Li4uCiAgICAgICAgICBpZiAoIHN1YmplY3Qua2luZCAhPT0gJ1VzZXInICkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdWJqZWN0S2luZDogc3ViamVjdC5raW5kLAogICAgICAgICAgICBzdWJqZWN0OiAgICAgc3ViamVjdC5uYW1lLAogICAgICAgICAgICB1c2VyT2JqOiAgICAgZmluZEJ5KHRoaXMuYWxsVXNlcnMsICdpZCcsIHN1YmplY3QubmFtZSksCiAgICAgICAgICAgIHJvbGVLaW5kOiAgICBiaW5kaW5nLnJvbGVSZWYua2luZCwKICAgICAgICAgICAgcm9sZTogICAgICAgIGJpbmRpbmcucm9sZVJlZi5uYW1lLAogICAgICAgICAgICByb2xlT2JqOiAgICAgZmluZEJ5KHRoaXMuYWxsUm9sZXMsICdpZCcsIGJpbmRpbmcucm9sZVJlZi5uYW1lKSwKICAgICAgICAgICAgZXhpc3Rpbmc6ICAgIGJpbmRpbmcsCiAgICAgICAgICAgIGV4aXN0aW5nSWR4OiBpLAogICAgICAgICAgICByZW1vdmU6ICAgICAgZmFsc2UsCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIHNhdmVSb2xlQmluZGluZ3MoKSB7CiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8KCiAgICAgIGNvbnN0IHByb21pc2VzID0gW107CgogICAgICBmb3IgKCBjb25zdCByb3cgb2YgdGhpcy5yb3dzICkgewogICAgICAgIGlmICggcm93LnJlbW92ZSApIHsKICAgICAgICAgIC8vIFJlbW92ZSBhbiBleGlzdGluZyBlbnRyeQoKICAgICAgICAgIGlmICggcm93LmV4aXN0aW5nLnN1YmplY3RzLmxlbmd0aCA9PT0gMSApIHsKICAgICAgICAgICAgLy8gVGhlcmUncyBvbmx5IG9uZSBzdWJqZWN0LCByZW1vdmUgdGhlIHdob2xlIGJpbmRpbmcKICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnUmVtb3ZlJywgcm93LmV4aXN0aW5nLmlkLCAnb25seSBvbmUgc3ViamVjdCcpOwogICAgICAgICAgICBwcm9taXNlcy5wdXNoKHJvdy5leGlzdGluZy5yZW1vdmUoKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gVGhlcmUncyBtdWx0aXBsZSBzdWJqZWN0cywgcmVtb3ZlIGp1c3QgdGhpcyBvbmUKICAgICAgICAgICAgcmVtb3ZlQXQocm93LmV4aXN0aW5nLnN1YmplY3RzLCByb3cuZXhpc3RpbmdJZHgpOwogICAgICAgICAgICBjb25zb2xlLmRlYnVnKCdSZW1vdmUnLCByb3cuZXhpc3RpbmcuaWQsICdzdWJqZWN0Jywgcm93LmV4aXN0aW5nSWR4KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCByb3cuZXhpc3RpbmcgKSB7CiAgICAgICAgICAvLyBNYXliZSB1cGRhdGUgZXhpc3RpbmcsIHdoaWNoIG1pZ2h0IGJlIGEgUFVULCBvciBhIFBVVCArIFBPU1QsIG9yIGEgREVMRVRFICsgUE9TVAogICAgICAgICAgLy8gYmVjYXVzZSB0aGUgcm9sZSBvZiBhbiBleGlzdGluZyBiaW5kaW5nIGNhbid0IGJlIGVkaXRlZCBpbiBrOHMgKGJlY2F1c2UgcmVhc29ucywgcHJlc3VtYWJseSkuCiAgICAgICAgICBjb25zdCBvYmogPSByb3cuZXhpc3Rpbmc7CiAgICAgICAgICBjb25zdCBzdWJqID0gb2JqLnN1YmplY3RzW3Jvdy5leGlzdGluZ0lkeF07CgogICAgICAgICAgaWYgKCBvYmoucm9sZVJlZi5uYW1lICE9PSByb3cucm9sZSB8fCBvYmoucm9sZVJlZi5raW5kICE9PSByb3cucm9sZUtpbmQgKSB7CiAgICAgICAgICAgIC8vIFRoZSByb2xlIGNoYW5nZWQKICAgICAgICAgICAgY29uc3QgbmV1ID0gYXdhaXQgdGhpcy5jcmVhdGVGcm9tKHJvdyk7CgogICAgICAgICAgICAvLyBNYWtlIGEgbmV3IGJpbmRpbmcKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChuZXUuc2F2ZSgpKTsKICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnQ3JlYXRlIGJpbmRpbmcgZnJvbScsIHJvdy5leGlzdGluZy5pZCwgJ2JlY2F1c2Ugcm9sZSBjaGFuZ2VkJyk7CgogICAgICAgICAgICBpZiAoIG9iai5zdWJqZWN0cy5sZW5ndGggPT09IDEgKSB7CiAgICAgICAgICAgICAgLy8gVGhlcmUncyBvbmx5IG9uZSBzdWJqZWN0LCByZW1vdmUgdGhlIHdob2xlIGJpbmRpbmcKICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKG9iai5yZW1vdmUoKSk7CiAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnUmVtb3ZlJywgcm93LmV4aXN0aW5nLmlkLCAnYmVjYXVzZSByb2xlIGNoYW5nZWQsIG9ubHkgb25lIHN1YmplY3QnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBUaGVyZSdzIG11bHRpcGxlIHN1YmplY3QsIHJlbW92ZSB0aGlzIG9uZSBqdXN0IHRoaXMgb25lCiAgICAgICAgICAgICAgcmVtb3ZlQXQob2JqLnN1YmplY3RzLCByb3cuZXhpc3RpbmdJZHgpOwogICAgICAgICAgICAgIHByb21pc2VzLnB1c2gob2JqLnNhdmUoKSk7CiAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnVXBkYXRlJywgcm93LmV4aXN0aW5nLmlkLCAncmVtb3ZlIHN1YmplY3QnLCByb3cuZXhpc3RpbmdJZHgsICdiZWNhdXNlIHJvbGUgY2hhbmdlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKCBzdWJqLm5hbWUgIT09IHJvdy5zdWJqZWN0IHx8IHN1Ymoua2luZCAhPT0gcm93LnN1YmplY3RLaW5kICkgewogICAgICAgICAgICAvLyBUaGlzIHN1YmplY3QgY2hhbmdlZAogICAgICAgICAgICBzdWJqLmtpbmQgPSByb3cuc3ViamVjdEtpbmQ7CiAgICAgICAgICAgIHN1YmoubmFtZSA9IHJvdy5zdWJqZWN0OwoKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChvYmouc2F2ZSgpKTsKICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnQ2hhbmdlZCcsIHJvdy5leGlzdGluZy5pZCwgJ3N1YmplY3QnLCByb3cuZXhpc3RpbmdJZHgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTm90aGluZyBjaGFuZ2VkCiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ1VuY2hhbmdlZCcsIHJvdy5leGlzdGluZy5pZCwgJ3N1YmplY3QnLCByb3cuZXhpc3RpbmdJZHgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBDcmVhdGUgbmV3CiAgICAgICAgICBjb25zdCBvYmogPSBhd2FpdCB0aGlzLmNyZWF0ZUZyb20ocm93KTsKCiAgICAgICAgICBwcm9taXNlcy5wdXNoKG9iai5zYXZlKCkpOwogICAgICAgICAgY29uc29sZS5kZWJ1ZygnQ3JlYXRlIGJpbmRpbmcnKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gSWYgc29tZXRoaW5nIGdvZXMgd3JvbmcsIGZvcmdldCBldmVyeXRoaW5nIGFuZCByZWxvYWQgdG8gZ2V0IHRoZSBjdXJyZW50IHN0YXRlLgogICAgICAgIHRoaXMucmVhZEV4aXN0aW5nQmluZGluZ3MoKTsKICAgICAgICB0aHJvdyBlOwogICAgICB9CgogICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbnNvbGUgKi8KICAgIH0sCgogICAgY3JlYXRlRnJvbShyb3cpIHsKICAgICAgbGV0IHR5cGUsIGFwaUdyb3VwOwogICAgICBjb25zdCBpblN0b3JlID0gdGhpcy5pblN0b3JlOwoKICAgICAgaWYgKCB0aGlzLmJpbmRpbmdTY29wZSA9PT0gU0NPUEVfTkFNRVNQQUNFICkgewogICAgICAgIHR5cGUgPSBSQkFDLlJPTEVfQklORElORzsKICAgICAgICBhcGlHcm91cCA9ICdyYmFjLmF1dGhvcml6YXRpb24uazhzLmlvJzsKICAgICAgfSBlbHNlIGlmICggdGhpcy5iaW5kaW5nU2NvcGUgPT09IFNDT1BFX0NMVVNURVIgKSB7CiAgICAgICAgdHlwZSA9IFJCQUMuQ0xVU1RFUl9ST0xFX0JJTkRJTkc7CiAgICAgICAgYXBpR3JvdXAgPSAncmJhYy5hdXRob3JpemF0aW9uLms4cy5pbyc7CiAgICAgIC8vIH0gZWxzZSBpZiAoIHRoaXMuYmluZGluZ1Njb3BlID09PSBTQ09QRV9HTE9CQUwgKSB7CiAgICAgIC8vICAgdHlwZSA9IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEVfQklORElORzsKICAgICAgLy8gICBpblN0b3JlID0gJ21hbmFnZW1lbnQnCiAgICAgIC8vICAgYXBpR3JvdXAgPSAnbWFuYWdlbWVudC5jYXR0bGUuaW8nID8KICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gYmluZGluZyBzY29wZScpOwogICAgICB9CgogICAgICBjb25zdCBvYmogPSB0aGlzLiRzdG9yZS5kaXNwYXRjaChgJHsgaW5TdG9yZSB9L2NyZWF0ZWAsIHsKICAgICAgICB0eXBlLAogICAgICAgIG1ldGFkYXRhOiB7CiAgICAgICAgICBnZW5lcmF0ZU5hbWU6IGB1aS0keyB0aGlzLmZpbHRlclJvbGVWYWx1ZSA/IGAkeyB0aGlzLmZpbHRlclJvbGVWYWx1ZSB9LWAgOiAnJyB9YCwKICAgICAgICAgIG5hbWVzcGFjZTogICAgdGhpcy5uYW1lc3BhY2UsCiAgICAgICAgfSwKICAgICAgICByb2xlUmVmOiB7CiAgICAgICAgICBhcGlHcm91cCwKICAgICAgICAgIGtpbmQ6IHJvdy5yb2xlS2luZCwKICAgICAgICAgIG5hbWU6IHJvdy5yb2xlLAogICAgICAgIH0sCiAgICAgICAgc3ViamVjdHM6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgYXBpR3JvdXAsCiAgICAgICAgICAgIGtpbmQ6IHJvdy5zdWJqZWN0S2luZCwKICAgICAgICAgICAgbmFtZTogcm93LnN1YmplY3QsCiAgICAgICAgICB9LAogICAgICAgIF0KICAgICAgfSk7CgogICAgICByZXR1cm4gb2JqOwogICAgfSwKCiAgICByZW1vdmUocm93KSB7CiAgICAgIGlmICggcm93LmV4aXN0aW5nICkgewogICAgICAgIHRoaXMuJHNldChyb3csICdyZW1vdmUnLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZW1vdmVPYmplY3QodGhpcy5yb3dzLCByb3cpOwogICAgICB9CiAgICB9LAoKICAgIGFkZCgpIHsKICAgICAgdGhpcy5yb3dzLnB1c2goewogICAgICAgIHN1YmplY3RLaW5kOiAnVXNlcicsCiAgICAgICAgc3ViamVjdDogICAgICcnLAogICAgICAgIHJvbGVLaW5kOiAgICB0aGlzLnJvbGVTY29wZSwKICAgICAgICByb2xlOiAgICAgICAgJycsCiAgICAgIH0pOwogICAgfQogIH0sCn07Cg=="},{"version":3,"sources":["RoleBindings.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RoleBindings.vue","sourceRoot":"node_modules/@rancher/shell/components","sourcesContent":["<script>\nimport { RBAC as RBAC_LABELS } from '@shell/config/labels-annotations';\nimport { allHash } from '@shell/utils/promise';\nimport { RBAC, MANAGEMENT } from '@shell/config/types';\nimport { _CONFIG, _DETAIL, _EDIT, _VIEW } from '@shell/config/query-params';\nimport { findBy, removeAt, removeObject } from '@shell/utils/array';\nimport Loading from '@shell/components/Loading';\nimport SortableTable from '@shell/components/SortableTable';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\n\nexport const SCOPE_NAMESPACE = 'Role';\nexport const SCOPE_CLUSTER = 'ClusterRole';\n// export const SCOPE_GLOBAL = 'GlobalRole';\n\nexport default {\n  components: {\n    Loading, LabeledSelect, SortableTable\n  },\n\n  props: {\n    registerAfterHook: {\n      type:    Function,\n      default: null,\n    },\n\n    mode: {\n      type:    String,\n      default: _EDIT,\n    },\n\n    as: {\n      type:    String,\n      default: _CONFIG,\n    },\n\n    inStore: {\n      type:    String,\n      default: 'cluster',\n    },\n\n    roleScope: {\n      type:     String,\n      required: true,\n      validator(val) {\n        return [SCOPE_NAMESPACE, SCOPE_CLUSTER].includes(val);\n      }\n    },\n\n    bindingScope: {\n      type:     String,\n      required: true,\n      validator(val) {\n        return [SCOPE_NAMESPACE, SCOPE_CLUSTER].includes(val);\n      }\n    },\n\n    namespace: {\n      type:    String,\n      default: null,\n    },\n\n    filterRoleKey: {\n      type:    String,\n      default: RBAC_LABELS.PRODUCT\n    },\n\n    filterRoleValue: {\n      type:    String,\n      default: null,\n    },\n  },\n\n  async fetch() {\n    const hash = { allUsers: this.$store.dispatch('management/findAll', { type: MANAGEMENT.USER }) };\n    const inStore = this.inStore;\n\n    if ( this.roleScope === SCOPE_NAMESPACE ) {\n      hash.allRoles = this.$store.dispatch(`${ inStore }/findAll`, { type: RBAC.ROLE });\n    } else if ( this.roleScope === SCOPE_CLUSTER ) {\n      hash.allRoles = this.$store.dispatch(`${ inStore }/findAll`, { type: RBAC.CLUSTER_ROLE });\n    // } else if ( this.roleScope === SCOPE_GLOBAL ) {\n    // hash.allRoles = this.$store.dispatch('management/findAll', { type: MANAGEMENT.GLOBAL_ROLE });\n    } else {\n      throw new Error('Unknown roleScope');\n    }\n\n    if ( this.bindingScope === SCOPE_NAMESPACE ) {\n      hash.allBindings = this.$store.dispatch(`${ inStore }/findAll`, { type: RBAC.ROLE_BINDING });\n    } else if ( this.bindingScope === SCOPE_CLUSTER ) {\n      hash.allBindings = this.$store.dispatch(`${ inStore }/findAll`, { type: RBAC.CLUSTER_ROLE_BINDING });\n    // } else if ( this.bindingScope === SCOPE_GLOBAL ) {\n    // hash.allBindings = this.$store.dispatch('management/findAll', { type: MANAGEMENT.GLOBAL_ROLE_BINDING });\n    } else {\n      throw new Error('Unknown scope');\n    }\n\n    const out = await allHash(hash);\n\n    for ( const key in out ) {\n      this[key] = out[key];\n    }\n\n    this.readExistingBindings();\n  },\n\n  data() {\n    return {\n      allRoles:    null,\n      allBindings: null,\n      allUsers:    null,\n      rows:        null,\n    };\n  },\n\n  computed: {\n    isView() {\n      return this.mode === _VIEW;\n    },\n\n    showDetail() {\n      return this.as === _DETAIL;\n    },\n\n    detailHeaders() {\n      return [\n        {\n          name:     'type',\n          labelKey: 'tableHeaders.type',\n          value:    'subjectKind',\n          sort:     'subjectKind',\n          search:   'subjectKind',\n        },\n        {\n          name:     'subject',\n          labelKey: 'tableHeaders.subject',\n          value:    'userObj.labelForSelect',\n          sort:     'userObj.labelForSelect',\n          search:   'userObj.labelForSelect',\n        },\n        {\n          name:     'role',\n          labelKey: 'tableHeaders.role',\n          value:    'roleObj.nameWithinProduct',\n          sort:     'roleObj.nameWithinProduct',\n          search:   'roleObj.nameWithinProduct',\n        },\n      ];\n    },\n\n    userOptions() {\n      return this.allUsers.filter((x) => {\n        return !x.isSystem;\n      }).map((x) => {\n        return {\n          label: x.labelForSelect,\n          value: x.id,\n        };\n      });\n    },\n\n    roleOptions() {\n      return this.roles.map((x) => {\n        return { label: x.nameWithinProduct, value: x.name };\n      });\n    },\n\n    roles() {\n      const all = this.allRoles;\n\n      if ( !this.filterRoleKey || !this.filterRoleValue ) {\n        return all;\n      }\n\n      const out = all.filter((role) => {\n        return role.metadata?.labels?.[this.filterRoleKey] === this.filterRoleValue;\n      });\n\n      return out;\n    },\n\n    existingBindings() {\n      const roles = this.roles.map((x) => x.name);\n\n      const out = this.allBindings.filter((binding) => {\n        if ( binding.roleRef.kind !== this.roleScope || !binding.roleRef?.name) {\n          return false;\n        }\n\n        if ( this.bindingScope === SCOPE_NAMESPACE && binding.metadata?.namespace !== this.namespace ) {\n          return false;\n        }\n\n        return roles.includes(binding.roleRef.name);\n      });\n\n      return out;\n    },\n\n    unremovedRows() {\n      return this.rows.filter((x) => x.remove !== true);\n    },\n  },\n\n  created() {\n    if ( this.mode !== _VIEW ) {\n      this.registerAfterHook(this.saveRoleBindings, 'saveRoleBindings');\n    }\n  },\n\n  methods: {\n    readExistingBindings() {\n      this.rows = this.existingBindings.map((binding) => {\n        for ( let i = 0 ; i < binding.subjects.length ; i++ ) {\n          const subject = binding.subjects[i];\n\n          // We have no way to do groups right now...\n          if ( subject.kind !== 'User' ) {\n            continue;\n          }\n\n          return {\n            subjectKind: subject.kind,\n            subject:     subject.name,\n            userObj:     findBy(this.allUsers, 'id', subject.name),\n            roleKind:    binding.roleRef.kind,\n            role:        binding.roleRef.name,\n            roleObj:     findBy(this.allRoles, 'id', binding.roleRef.name),\n            existing:    binding,\n            existingIdx: i,\n            remove:      false,\n          };\n        }\n      });\n    },\n\n    async saveRoleBindings() {\n      /* eslint-disable no-console */\n\n      const promises = [];\n\n      for ( const row of this.rows ) {\n        if ( row.remove ) {\n          // Remove an existing entry\n\n          if ( row.existing.subjects.length === 1 ) {\n            // There's only one subject, remove the whole binding\n            console.debug('Remove', row.existing.id, 'only one subject');\n            promises.push(row.existing.remove());\n          } else {\n          // There's multiple subjects, remove just this one\n            removeAt(row.existing.subjects, row.existingIdx);\n            console.debug('Remove', row.existing.id, 'subject', row.existingIdx);\n          }\n        } else if ( row.existing ) {\n          // Maybe update existing, which might be a PUT, or a PUT + POST, or a DELETE + POST\n          // because the role of an existing binding can't be edited in k8s (because reasons, presumably).\n          const obj = row.existing;\n          const subj = obj.subjects[row.existingIdx];\n\n          if ( obj.roleRef.name !== row.role || obj.roleRef.kind !== row.roleKind ) {\n            // The role changed\n            const neu = await this.createFrom(row);\n\n            // Make a new binding\n            promises.push(neu.save());\n            console.debug('Create binding from', row.existing.id, 'because role changed');\n\n            if ( obj.subjects.length === 1 ) {\n              // There's only one subject, remove the whole binding\n              promises.push(obj.remove());\n              console.debug('Remove', row.existing.id, 'because role changed, only one subject');\n            } else {\n              // There's multiple subject, remove this one just this one\n              removeAt(obj.subjects, row.existingIdx);\n              promises.push(obj.save());\n              console.debug('Update', row.existing.id, 'remove subject', row.existingIdx, 'because role changed');\n            }\n          } else if ( subj.name !== row.subject || subj.kind !== row.subjectKind ) {\n            // This subject changed\n            subj.kind = row.subjectKind;\n            subj.name = row.subject;\n\n            promises.push(obj.save());\n            console.debug('Changed', row.existing.id, 'subject', row.existingIdx);\n          } else {\n            // Nothing changed\n            console.debug('Unchanged', row.existing.id, 'subject', row.existingIdx);\n          }\n        } else {\n          // Create new\n          const obj = await this.createFrom(row);\n\n          promises.push(obj.save());\n          console.debug('Create binding');\n        }\n      }\n\n      try {\n        await Promise.all(promises);\n      } catch (e) {\n        // If something goes wrong, forget everything and reload to get the current state.\n        this.readExistingBindings();\n        throw e;\n      }\n\n      /* eslint-enable no-console */\n    },\n\n    createFrom(row) {\n      let type, apiGroup;\n      const inStore = this.inStore;\n\n      if ( this.bindingScope === SCOPE_NAMESPACE ) {\n        type = RBAC.ROLE_BINDING;\n        apiGroup = 'rbac.authorization.k8s.io';\n      } else if ( this.bindingScope === SCOPE_CLUSTER ) {\n        type = RBAC.CLUSTER_ROLE_BINDING;\n        apiGroup = 'rbac.authorization.k8s.io';\n      // } else if ( this.bindingScope === SCOPE_GLOBAL ) {\n      //   type = MANAGEMENT.GLOBAL_ROLE_BINDING;\n      //   inStore = 'management'\n      //   apiGroup = 'management.cattle.io' ?\n      } else {\n        throw new Error('Unknown binding scope');\n      }\n\n      const obj = this.$store.dispatch(`${ inStore }/create`, {\n        type,\n        metadata: {\n          generateName: `ui-${ this.filterRoleValue ? `${ this.filterRoleValue }-` : '' }`,\n          namespace:    this.namespace,\n        },\n        roleRef: {\n          apiGroup,\n          kind: row.roleKind,\n          name: row.role,\n        },\n        subjects: [\n          {\n            apiGroup,\n            kind: row.subjectKind,\n            name: row.subject,\n          },\n        ]\n      });\n\n      return obj;\n    },\n\n    remove(row) {\n      if ( row.existing ) {\n        this.$set(row, 'remove', true);\n      } else {\n        removeObject(this.rows, row);\n      }\n    },\n\n    add() {\n      this.rows.push({\n        subjectKind: 'User',\n        subject:     '',\n        roleKind:    this.roleScope,\n        role:        '',\n      });\n    }\n  },\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div v-else-if=\"showDetail\">\n    <SortableTable\n      :rows=\"unremovedRows\"\n      :headers=\"detailHeaders\"\n      :table-actions=\"false\"\n      :row-actions=\"false\"\n      key-field=\"existing.id\"\n      default-sort-by=\"subject\"\n      :paged=\"true\"\n    />\n  </div>\n  <div v-else>\n    <div\n      v-for=\"(row, idx) in unremovedRows\"\n      :key=\"idx\"\n      class=\"role-row\"\n      :class=\"{[mode]: true}\"\n    >\n      <div class=\"subject\">\n        <LabeledSelect\n          v-model=\"row.subject\"\n          label-key=\"rbac.roleBinding.user.label\"\n          :mode=\"mode\"\n          :searchable=\"true\"\n          :taggable=\"true\"\n          :options=\"userOptions\"\n        />\n      </div>\n      <div class=\"binding\">\n        <LabeledSelect\n          v-model=\"row.role\"\n          label-key=\"rbac.roleBinding.role.label\"\n          :mode=\"mode\"\n          :searchable=\"true\"\n          :taggable=\"true\"\n          :options=\"roleOptions\"\n        />\n      </div>\n      <div class=\"remove\">\n        <button\n          v-t=\"'generic.remove'\"\n          :disabled=\"isView\"\n          type=\"button\"\n          class=\"btn role-link\"\n          @click=\"remove(row)\"\n        />\n      </div>\n    </div>\n    <div>\n      <button\n        v-t=\"'rbac.roleBinding.add'\"\n        :disabled=\"isView\"\n        type=\"button\"\n        class=\"btn role-tertiary add\"\n        @click=\"add()\"\n      />\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.role-row{\n  display: grid;\n  grid-template-columns: 45% 45% 10%;\n\n  grid-column-gap: $column-gutter;\n  margin-bottom: 10px;\n  align-items: center;\n  & .port{\n    display: flex;\n    justify-content: space-between;\n  }\n\n  &.show-host{\n    grid-template-columns: 30% 16% 10% 15% 15% 5%;\n  }\n\n}\n\n.add-host {\n  justify-self: center;\n}\n\n.protocol {\n  height: 100%;\n}\n\n.ports-headers {\n  color: var(--input-label);\n}\n\n.toggle-host-ports {\n  color: var(--primary);\n}\n\n.remove BUTTON {\n  padding: 0px;\n}\n</style>\n"]}]}